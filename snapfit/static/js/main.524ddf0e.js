/*! For license information please see main.524ddf0e.js.LICENSE.txt */
!function(){var e={76:function(e,t,n){"use strict";n.d(t,{Z:function(){return ae}});var r=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(r){0}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0},e}(),a=Math.abs,i=String.fromCharCode,o=Object.assign;function s(e){return e.trim()}function u(e,t,n){return e.replace(t,n)}function c(e,t){return e.indexOf(t)}function l(e,t){return 0|e.charCodeAt(t)}function h(e,t,n){return e.slice(t,n)}function f(e){return e.length}function d(e){return e.length}function p(e,t){return t.push(e),e}var v=1,m=1,g=0,y=0,b=0,k="";function V(e,t,n,r,a,i,o){return{value:e,root:t,parent:n,type:r,props:a,children:i,line:v,column:m,length:o,return:""}}function x(e,t){return o(V("",null,null,"",null,null,0),e,{length:-e.length},t)}function w(){return b=y>0?l(k,--y):0,m--,10===b&&(m=1,v--),b}function I(){return b=y<g?l(k,y++):0,m++,10===b&&(m=1,v++),b}function S(){return l(k,y)}function C(){return y}function E(e,t){return h(k,e,t)}function T(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function N(e){return v=m=1,g=f(k=e),y=0,[]}function A(e){return k="",e}function R(e){return s(E(y-1,F(91===e?e+2:40===e?e+1:e)))}function _(e){for(;(b=S())&&b<33;)I();return T(e)>2||T(b)>3?"":" "}function D(e,t){for(;--t&&I()&&!(b<48||b>102||b>57&&b<65||b>70&&b<97););return E(e,C()+(t<6&&32==S()&&32==I()))}function F(e){for(;I();)switch(b){case e:return y;case 34:case 39:34!==e&&39!==e&&F(b);break;case 40:41===e&&F(e);break;case 92:I()}return y}function O(e,t){for(;I()&&e+b!==57&&(e+b!==84||47!==S()););return"/*"+E(t,y-1)+"*"+i(47===e?e:I())}function L(e){for(;!T(S());)I();return E(e,y)}var M="-ms-",P="-moz-",z="-webkit-",B="comm",U="rule",W="decl",j="@keyframes";function Z(e,t){for(var n="",r=d(e),a=0;a<r;a++)n+=t(e[a],a,e,t)||"";return n}function G(e,t,n,r){switch(e.type){case"@import":case W:return e.return=e.return||e.value;case B:return"";case j:return e.return=e.value+"{"+Z(e.children,r)+"}";case U:e.value=e.props.join(",")}return f(n=Z(e.children,r))?e.return=e.value+"{"+n+"}":""}function H(e,t){switch(function(e,t){return(((t<<2^l(e,0))<<2^l(e,1))<<2^l(e,2))<<2^l(e,3)}(e,t)){case 5103:return z+"print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return z+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return z+e+P+e+M+e+e;case 6828:case 4268:return z+e+M+e+e;case 6165:return z+e+M+"flex-"+e+e;case 5187:return z+e+u(e,/(\w+).+(:[^]+)/,"-webkit-box-$1$2-ms-flex-$1$2")+e;case 5443:return z+e+M+"flex-item-"+u(e,/flex-|-self/,"")+e;case 4675:return z+e+M+"flex-line-pack"+u(e,/align-content|flex-|-self/,"")+e;case 5548:return z+e+M+u(e,"shrink","negative")+e;case 5292:return z+e+M+u(e,"basis","preferred-size")+e;case 6060:return z+"box-"+u(e,"-grow","")+z+e+M+u(e,"grow","positive")+e;case 4554:return z+u(e,/([^-])(transform)/g,"$1-webkit-$2")+e;case 6187:return u(u(u(e,/(zoom-|grab)/,z+"$1"),/(image-set)/,z+"$1"),e,"")+e;case 5495:case 3959:return u(e,/(image-set\([^]*)/,z+"$1$`$1");case 4968:return u(u(e,/(.+:)(flex-)?(.*)/,"-webkit-box-pack:$3-ms-flex-pack:$3"),/s.+-b[^;]+/,"justify")+z+e+e;case 4095:case 3583:case 4068:case 2532:return u(e,/(.+)-inline(.+)/,z+"$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(f(e)-1-t>6)switch(l(e,t+1)){case 109:if(45!==l(e,t+4))break;case 102:return u(e,/(.+:)(.+)-([^]+)/,"$1-webkit-$2-$3$1"+P+(108==l(e,t+3)?"$3":"$2-$3"))+e;case 115:return~c(e,"stretch")?H(u(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==l(e,t+1))break;case 6444:switch(l(e,f(e)-3-(~c(e,"!important")&&10))){case 107:return u(e,":",":"+z)+e;case 101:return u(e,/(.+:)([^;!]+)(;|!.+)?/,"$1"+z+(45===l(e,14)?"inline-":"")+"box$3$1"+z+"$2$3$1"+M+"$2box$3")+e}break;case 5936:switch(l(e,t+11)){case 114:return z+e+M+u(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return z+e+M+u(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return z+e+M+u(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return z+e+M+e+e}return e}function q(e){return A(K("",null,null,null,[""],e=N(e),0,[0],e))}function K(e,t,n,r,a,o,s,l,h){for(var d=0,v=0,m=s,g=0,y=0,b=0,k=1,V=1,x=1,E=0,T="",N=a,A=o,F=r,M=T;V;)switch(b=E,E=I()){case 40:if(108!=b&&58==M.charCodeAt(m-1)){-1!=c(M+=u(R(E),"&","&\f"),"&\f")&&(x=-1);break}case 34:case 39:case 91:M+=R(E);break;case 9:case 10:case 13:case 32:M+=_(b);break;case 92:M+=D(C()-1,7);continue;case 47:switch(S()){case 42:case 47:p(Q(O(I(),C()),t,n),h);break;default:M+="/"}break;case 123*k:l[d++]=f(M)*x;case 125*k:case 59:case 0:switch(E){case 0:case 125:V=0;case 59+v:y>0&&f(M)-m&&p(y>32?Y(M+";",r,n,m-1):Y(u(M," ","")+";",r,n,m-2),h);break;case 59:M+=";";default:if(p(F=X(M,t,n,d,v,a,l,T,N=[],A=[],m),o),123===E)if(0===v)K(M,t,F,F,N,o,m,l,A);else switch(g){case 100:case 109:case 115:K(e,F,F,r&&p(X(e,F,F,0,0,a,l,T,a,N=[],m),A),a,A,m,l,r?N:A);break;default:K(M,F,F,F,[""],A,0,l,A)}}d=v=y=0,k=x=1,T=M="",m=s;break;case 58:m=1+f(M),y=b;default:if(k<1)if(123==E)--k;else if(125==E&&0==k++&&125==w())continue;switch(M+=i(E),E*k){case 38:x=v>0?1:(M+="\f",-1);break;case 44:l[d++]=(f(M)-1)*x,x=1;break;case 64:45===S()&&(M+=R(I())),g=S(),v=m=f(T=M+=L(C())),E++;break;case 45:45===b&&2==f(M)&&(k=0)}}return o}function X(e,t,n,r,i,o,c,l,f,p,v){for(var m=i-1,g=0===i?o:[""],y=d(g),b=0,k=0,x=0;b<r;++b)for(var w=0,I=h(e,m+1,m=a(k=c[b])),S=e;w<y;++w)(S=s(k>0?g[w]+" "+I:u(I,/&\f/g,g[w])))&&(f[x++]=S);return V(e,t,n,0===i?U:l,f,p,v)}function Q(e,t,n){return V(e,t,n,B,i(b),h(e,2,-2),0)}function Y(e,t,n,r){return V(e,t,n,W,h(e,0,r),h(e,r+1,-1),r)}var J=function(e,t,n){for(var r=0,a=0;r=a,a=S(),38===r&&12===a&&(t[n]=1),!T(a);)I();return E(e,y)},$=function(e,t){return A(function(e,t){var n=-1,r=44;do{switch(T(r)){case 0:38===r&&12===S()&&(t[n]=1),e[n]+=J(y-1,t,n);break;case 2:e[n]+=R(r);break;case 4:if(44===r){e[++n]=58===S()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=i(r)}}while(r=I());return e}(N(e),t))},ee=new WeakMap,te=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,r=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||ee.get(n))&&!r){ee.set(e,!0);for(var a=[],i=$(t,a),o=n.props,s=0,u=0;s<i.length;s++)for(var c=0;c<o.length;c++,u++)e.props[u]=a[s]?i[s].replace(/&\f/g,o[c]):o[c]+" "+i[s]}}},ne=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}},re=[function(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case W:e.return=H(e.value,e.length);break;case j:return Z([x(e,{value:u(e.value,"@","@"+z)})],r);case U:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return Z([x(e,{props:[u(t,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return Z([x(e,{props:[u(t,/:(plac\w+)/,":-webkit-input-$1")]}),x(e,{props:[u(t,/:(plac\w+)/,":-moz-$1")]}),x(e,{props:[u(t,/:(plac\w+)/,M+"input-$1")]})],r)}return""}))}}],ae=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var a=e.stylisPlugins||re;var i,o,s={},u=[];i=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)s[t[n]]=!0;u.push(e)}));var c,l,h=[G,(l=function(e){c.insert(e)},function(e){e.root||(e=e.return)&&l(e)})],f=function(e){var t=d(e);return function(n,r,a,i){for(var o="",s=0;s<t;s++)o+=e[s](n,r,a,i)||"";return o}}([te,ne].concat(a,h));o=function(e,t,n,r){c=n,Z(q(e?e+"{"+t.styles+"}":t.styles),f),r&&(p.inserted[t.name]=!0)};var p={key:t,sheet:new r({key:t,container:i,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:s,registered:{},insert:o};return p.sheet.hydrate(u),p}},9797:function(e,t){"use strict";t.Z=function(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}},9140:function(e,t,n){"use strict";n.d(t,{O:function(){return v}});var r=function(e){for(var t,n=0,r=0,a=e.length;a>=4;++r,a-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(a){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)},a={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},i=n(9797),o=/[A-Z]|^ms/g,s=/_EMO_([^_]+?)_([^]*?)_EMO_/g,u=function(e){return 45===e.charCodeAt(1)},c=function(e){return null!=e&&"boolean"!==typeof e},l=(0,i.Z)((function(e){return u(e)?e:e.replace(o,"-$&").toLowerCase()})),h=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(s,(function(e,t,n){return d={name:t,styles:n,next:d},t}))}return 1===a[e]||u(e)||"number"!==typeof t||0===t?t:t+"px"};function f(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles)return n;switch(typeof n){case"boolean":return"";case"object":if(1===n.anim)return d={name:n.name,styles:n.styles,next:d},n.name;if(void 0!==n.styles){var r=n.next;if(void 0!==r)for(;void 0!==r;)d={name:r.name,styles:r.styles,next:d},r=r.next;return n.styles+";"}return function(e,t,n){var r="";if(Array.isArray(n))for(var a=0;a<n.length;a++)r+=f(e,t,n[a])+";";else for(var i in n){var o=n[i];if("object"!==typeof o)null!=t&&void 0!==t[o]?r+=i+"{"+t[o]+"}":c(o)&&(r+=l(i)+":"+h(i,o)+";");else if(!Array.isArray(o)||"string"!==typeof o[0]||null!=t&&void 0!==t[o[0]]){var s=f(e,t,o);switch(i){case"animation":case"animationName":r+=l(i)+":"+s+";";break;default:r+=i+"{"+s+"}"}}else for(var u=0;u<o.length;u++)c(o[u])&&(r+=l(i)+":"+h(i,o[u])+";")}return r}(e,t,n);case"function":if(void 0!==e){var a=d,i=n(e);return d=a,f(e,t,i)}}if(null==t)return n;var o=t[n];return void 0!==o?o:n}var d,p=/label:\s*([^\s;\n{]+)\s*(;|$)/g;var v=function(e,t,n){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var a=!0,i="";d=void 0;var o=e[0];null==o||void 0===o.raw?(a=!1,i+=f(n,t,o)):i+=o[0];for(var s=1;s<e.length;s++)i+=f(n,t,e[s]),a&&(i+=o[s]);p.lastIndex=0;for(var u,c="";null!==(u=p.exec(i));)c+="-"+u[1];return{name:r(i)+c,styles:i,next:d}}},2561:function(e,t,n){"use strict";var r;n.d(t,{L:function(){return o}});var a=n(2791),i=!!(r||(r=n.t(a,2))).useInsertionEffect&&(r||(r=n.t(a,2))).useInsertionEffect,o=i||function(e){return e()};i||a.useLayoutEffect},2419:function(e,t,n){"use strict";var r=n(4836);t.Z=void 0;var a=r(n(5649)),i=n(184),o=(0,a.default)((0,i.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"}),"Add");t.Z=o},2017:function(e,t,n){"use strict";var r=n(4836);t.Z=void 0;var a=r(n(5649)),i=n(184),o=(0,a.default)((0,i.jsx)("path",{d:"M11.67 3.87 9.9 2.1 0 12l9.9 9.9 1.77-1.77L3.54 12z"}),"ArrowBackIos");t.Z=o},3385:function(e,t,n){"use strict";var r=n(4836);t.Z=void 0;var a=r(n(5649)),i=n(184),o=(0,a.default)((0,i.jsx)("path",{d:"M6.23 20.23 8 22l10-10L8 2 6.23 3.77 14.46 12z"}),"ArrowForwardIos");t.Z=o},2868:function(e,t,n){"use strict";var r=n(4836);t.Z=void 0;var a=r(n(5649)),i=n(184),o=(0,a.default)([(0,i.jsx)("circle",{cx:"12",cy:"12",r:"3.2"},"0"),(0,i.jsx)("path",{d:"M9 2 7.17 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2h-3.17L15 2H9zm3 15c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5z"},"1")],"CameraAlt");t.Z=o},135:function(e,t,n){"use strict";var r=n(4836);t.Z=void 0;var a=r(n(5649)),i=n(184),o=(0,a.default)((0,i.jsx)("path",{d:"M21.6 18.2 13 11.75v-.91c1.65-.49 2.8-2.17 2.43-4.05-.26-1.31-1.3-2.4-2.61-2.7C10.54 3.57 8.5 5.3 8.5 7.5h2c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5c0 .84-.69 1.52-1.53 1.5-.54-.01-.97.45-.97.99v1.76L2.4 18.2c-.77.58-.36 1.8.6 1.8h18c.96 0 1.37-1.22.6-1.8zM6 18l6-4.5 6 4.5H6z"}),"Checkroom");t.Z=o},3411:function(e,t,n){"use strict";var r=n(4836);t.Z=void 0;var a=r(n(5649)),i=n(184),o=(0,a.default)((0,i.jsx)("path",{d:"M20.5 4c-2.61.7-5.67 1-8.5 1s-5.89-.3-8.5-1L3 6c1.86.5 4 .83 6 1v12h2v-6h2v6h2V7c2-.17 4.14-.5 6-1l-.5-2zM12 4c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2zM7 24h2v-2H7v2zm4 0h2v-2h-2v2zm4 0h2v-2h-2v2z"}),"SettingsAccessibility");t.Z=o},5649:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return r.createSvgIcon}});var r=n(2291)},4360:function(e,t,n){"use strict";n.d(t,{Z:function(){return z}});var r=n(7462),a=n(3366),i=n(6189),o=n(2466),s=n(5080),u=n(4942);function c(e,t){var n;return(0,r.Z)({toolbar:(n={minHeight:56},(0,u.Z)(n,e.up("xs"),{"@media (orientation: landscape)":{minHeight:48}}),(0,u.Z)(n,e.up("sm"),{minHeight:64}),n)},t)}var l=n(2065),h={black:"#000",white:"#fff"},f={50:"#fafafa",100:"#f5f5f5",200:"#eeeeee",300:"#e0e0e0",400:"#bdbdbd",500:"#9e9e9e",600:"#757575",700:"#616161",800:"#424242",900:"#212121",A100:"#f5f5f5",A200:"#eeeeee",A400:"#bdbdbd",A700:"#616161"},d={50:"#f3e5f5",100:"#e1bee7",200:"#ce93d8",300:"#ba68c8",400:"#ab47bc",500:"#9c27b0",600:"#8e24aa",700:"#7b1fa2",800:"#6a1b9a",900:"#4a148c",A100:"#ea80fc",A200:"#e040fb",A400:"#d500f9",A700:"#aa00ff"},p={50:"#ffebee",100:"#ffcdd2",200:"#ef9a9a",300:"#e57373",400:"#ef5350",500:"#f44336",600:"#e53935",700:"#d32f2f",800:"#c62828",900:"#b71c1c",A100:"#ff8a80",A200:"#ff5252",A400:"#ff1744",A700:"#d50000"},v={50:"#fff3e0",100:"#ffe0b2",200:"#ffcc80",300:"#ffb74d",400:"#ffa726",500:"#ff9800",600:"#fb8c00",700:"#f57c00",800:"#ef6c00",900:"#e65100",A100:"#ffd180",A200:"#ffab40",A400:"#ff9100",A700:"#ff6d00"},m={50:"#e3f2fd",100:"#bbdefb",200:"#90caf9",300:"#64b5f6",400:"#42a5f5",500:"#2196f3",600:"#1e88e5",700:"#1976d2",800:"#1565c0",900:"#0d47a1",A100:"#82b1ff",A200:"#448aff",A400:"#2979ff",A700:"#2962ff"},g={50:"#e1f5fe",100:"#b3e5fc",200:"#81d4fa",300:"#4fc3f7",400:"#29b6f6",500:"#03a9f4",600:"#039be5",700:"#0288d1",800:"#0277bd",900:"#01579b",A100:"#80d8ff",A200:"#40c4ff",A400:"#00b0ff",A700:"#0091ea"},y={50:"#e8f5e9",100:"#c8e6c9",200:"#a5d6a7",300:"#81c784",400:"#66bb6a",500:"#4caf50",600:"#43a047",700:"#388e3c",800:"#2e7d32",900:"#1b5e20",A100:"#b9f6ca",A200:"#69f0ae",A400:"#00e676",A700:"#00c853"},b=["mode","contrastThreshold","tonalOffset"],k={text:{primary:"rgba(0, 0, 0, 0.87)",secondary:"rgba(0, 0, 0, 0.6)",disabled:"rgba(0, 0, 0, 0.38)"},divider:"rgba(0, 0, 0, 0.12)",background:{paper:h.white,default:h.white},action:{active:"rgba(0, 0, 0, 0.54)",hover:"rgba(0, 0, 0, 0.04)",hoverOpacity:.04,selected:"rgba(0, 0, 0, 0.08)",selectedOpacity:.08,disabled:"rgba(0, 0, 0, 0.26)",disabledBackground:"rgba(0, 0, 0, 0.12)",disabledOpacity:.38,focus:"rgba(0, 0, 0, 0.12)",focusOpacity:.12,activatedOpacity:.12}},V={text:{primary:h.white,secondary:"rgba(255, 255, 255, 0.7)",disabled:"rgba(255, 255, 255, 0.5)",icon:"rgba(255, 255, 255, 0.5)"},divider:"rgba(255, 255, 255, 0.12)",background:{paper:"#121212",default:"#121212"},action:{active:h.white,hover:"rgba(255, 255, 255, 0.08)",hoverOpacity:.08,selected:"rgba(255, 255, 255, 0.16)",selectedOpacity:.16,disabled:"rgba(255, 255, 255, 0.3)",disabledBackground:"rgba(255, 255, 255, 0.12)",disabledOpacity:.38,focus:"rgba(255, 255, 255, 0.12)",focusOpacity:.12,activatedOpacity:.24}};function x(e,t,n,r){var a=r.light||r,i=r.dark||1.5*r;e[t]||(e.hasOwnProperty(n)?e[t]=e[n]:"light"===t?e.light=(0,l.$n)(e.main,a):"dark"===t&&(e.dark=(0,l._j)(e.main,i)))}function w(e){var t=e.mode,n=void 0===t?"light":t,s=e.contrastThreshold,u=void 0===s?3:s,c=e.tonalOffset,w=void 0===c?.2:c,I=(0,a.Z)(e,b),S=e.primary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:m[200],light:m[50],dark:m[400]}:{main:m[700],light:m[400],dark:m[800]}}(n),C=e.secondary||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:d[200],light:d[50],dark:d[400]}:{main:d[500],light:d[300],dark:d[700]}}(n),E=e.error||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:p[500],light:p[300],dark:p[700]}:{main:p[700],light:p[400],dark:p[800]}}(n),T=e.info||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:g[400],light:g[300],dark:g[700]}:{main:g[700],light:g[500],dark:g[900]}}(n),N=e.success||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:y[400],light:y[300],dark:y[700]}:{main:y[800],light:y[500],dark:y[900]}}(n),A=e.warning||function(){return"dark"===(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"light")?{main:v[400],light:v[300],dark:v[700]}:{main:"#ed6c02",light:v[500],dark:v[900]}}(n);function R(e){return(0,l.mi)(e,V.text.primary)>=u?V.text.primary:k.text.primary}var _=function(e){var t=e.color,n=e.name,a=e.mainShade,o=void 0===a?500:a,s=e.lightShade,u=void 0===s?300:s,c=e.darkShade,l=void 0===c?700:c;if(!(t=(0,r.Z)({},t)).main&&t[o]&&(t.main=t[o]),!t.hasOwnProperty("main"))throw new Error((0,i.Z)(11,n?" (".concat(n,")"):"",o));if("string"!==typeof t.main)throw new Error((0,i.Z)(12,n?" (".concat(n,")"):"",JSON.stringify(t.main)));return x(t,"light",u,w),x(t,"dark",l,w),t.contrastText||(t.contrastText=R(t.main)),t},D={dark:V,light:k};return(0,o.Z)((0,r.Z)({common:(0,r.Z)({},h),mode:n,primary:_({color:S,name:"primary"}),secondary:_({color:C,name:"secondary",mainShade:"A400",lightShade:"A200",darkShade:"A700"}),error:_({color:E,name:"error"}),warning:_({color:A,name:"warning"}),info:_({color:T,name:"info"}),success:_({color:N,name:"success"}),grey:f,contrastThreshold:u,getContrastText:R,augmentColor:_,tonalOffset:w},D[n]),I)}var I=["fontFamily","fontSize","fontWeightLight","fontWeightRegular","fontWeightMedium","fontWeightBold","htmlFontSize","allVariants","pxToRem"];var S={textTransform:"uppercase"},C='"Roboto", "Helvetica", "Arial", sans-serif';function E(e,t){var n="function"===typeof t?t(e):t,i=n.fontFamily,s=void 0===i?C:i,u=n.fontSize,c=void 0===u?14:u,l=n.fontWeightLight,h=void 0===l?300:l,f=n.fontWeightRegular,d=void 0===f?400:f,p=n.fontWeightMedium,v=void 0===p?500:p,m=n.fontWeightBold,g=void 0===m?700:m,y=n.htmlFontSize,b=void 0===y?16:y,k=n.allVariants,V=n.pxToRem,x=(0,a.Z)(n,I);var w=c/14,E=V||function(e){return"".concat(e/b*w,"rem")},T=function(e,t,n,a,i){return(0,r.Z)({fontFamily:s,fontWeight:e,fontSize:E(t),lineHeight:n},s===C?{letterSpacing:"".concat((o=a/t,Math.round(1e5*o)/1e5),"em")}:{},i,k);var o},N={h1:T(h,96,1.167,-1.5),h2:T(h,60,1.2,-.5),h3:T(d,48,1.167,0),h4:T(d,34,1.235,.25),h5:T(d,24,1.334,0),h6:T(v,20,1.6,.15),subtitle1:T(d,16,1.75,.15),subtitle2:T(v,14,1.57,.1),body1:T(d,16,1.5,.15),body2:T(d,14,1.43,.15),button:T(v,14,1.75,.4,S),caption:T(d,12,1.66,.4),overline:T(d,12,2.66,1,S)};return(0,o.Z)((0,r.Z)({htmlFontSize:b,pxToRem:E,fontFamily:s,fontSize:c,fontWeightLight:h,fontWeightRegular:d,fontWeightMedium:v,fontWeightBold:g},N),x,{clone:!1})}function T(){return["".concat(arguments.length<=0?void 0:arguments[0],"px ").concat(arguments.length<=1?void 0:arguments[1],"px ").concat(arguments.length<=2?void 0:arguments[2],"px ").concat(arguments.length<=3?void 0:arguments[3],"px rgba(0,0,0,").concat(.2,")"),"".concat(arguments.length<=4?void 0:arguments[4],"px ").concat(arguments.length<=5?void 0:arguments[5],"px ").concat(arguments.length<=6?void 0:arguments[6],"px ").concat(arguments.length<=7?void 0:arguments[7],"px rgba(0,0,0,").concat(.14,")"),"".concat(arguments.length<=8?void 0:arguments[8],"px ").concat(arguments.length<=9?void 0:arguments[9],"px ").concat(arguments.length<=10?void 0:arguments[10],"px ").concat(arguments.length<=11?void 0:arguments[11],"px rgba(0,0,0,").concat(.12,")")].join(",")}var N=["none",T(0,2,1,-1,0,1,1,0,0,1,3,0),T(0,3,1,-2,0,2,2,0,0,1,5,0),T(0,3,3,-2,0,3,4,0,0,1,8,0),T(0,2,4,-1,0,4,5,0,0,1,10,0),T(0,3,5,-1,0,5,8,0,0,1,14,0),T(0,3,5,-1,0,6,10,0,0,1,18,0),T(0,4,5,-2,0,7,10,1,0,2,16,1),T(0,5,5,-3,0,8,10,1,0,3,14,2),T(0,5,6,-3,0,9,12,1,0,3,16,2),T(0,6,6,-3,0,10,14,1,0,4,18,3),T(0,6,7,-4,0,11,15,1,0,4,20,3),T(0,7,8,-4,0,12,17,2,0,5,22,4),T(0,7,8,-4,0,13,19,2,0,5,24,4),T(0,7,9,-4,0,14,21,2,0,5,26,4),T(0,8,9,-5,0,15,22,2,0,6,28,5),T(0,8,10,-5,0,16,24,2,0,6,30,5),T(0,8,11,-5,0,17,26,2,0,6,32,5),T(0,9,11,-5,0,18,28,2,0,7,34,6),T(0,9,12,-6,0,19,29,2,0,7,36,6),T(0,10,13,-6,0,20,31,3,0,8,38,7),T(0,10,13,-6,0,21,33,3,0,8,40,7),T(0,10,14,-6,0,22,35,3,0,8,42,7),T(0,11,14,-7,0,23,36,3,0,9,44,8),T(0,11,15,-7,0,24,38,3,0,9,46,8)],A=["duration","easing","delay"],R={easeInOut:"cubic-bezier(0.4, 0, 0.2, 1)",easeOut:"cubic-bezier(0.0, 0, 0.2, 1)",easeIn:"cubic-bezier(0.4, 0, 1, 1)",sharp:"cubic-bezier(0.4, 0, 0.6, 1)"},_={shortest:150,shorter:200,short:250,standard:300,complex:375,enteringScreen:225,leavingScreen:195};function D(e){return"".concat(Math.round(e),"ms")}function F(e){if(!e)return 0;var t=e/36;return Math.round(10*(4+15*Math.pow(t,.25)+t/5))}function O(e){var t=(0,r.Z)({},R,e.easing),n=(0,r.Z)({},_,e.duration);return(0,r.Z)({getAutoHeightDuration:F,create:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:["all"],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=r.duration,o=void 0===i?n.standard:i,s=r.easing,u=void 0===s?t.easeInOut:s,c=r.delay,l=void 0===c?0:c;(0,a.Z)(r,A);return(Array.isArray(e)?e:[e]).map((function(e){return"".concat(e," ").concat("string"===typeof o?o:D(o)," ").concat(u," ").concat("string"===typeof l?l:D(l))})).join(",")}},e,{easing:t,duration:n})}var L={mobileStepper:1e3,fab:1050,speedDial:1050,appBar:1100,drawer:1200,modal:1300,snackbar:1400,tooltip:1500},M=["breakpoints","mixins","spacing","palette","transitions","typography","shape"];function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.mixins,n=void 0===t?{}:t,u=e.palette,l=void 0===u?{}:u,h=e.transitions,f=void 0===h?{}:h,d=e.typography,p=void 0===d?{}:d,v=(0,a.Z)(e,M);if(e.vars)throw new Error((0,i.Z)(18));var m=w(l),g=(0,s.Z)(e),y=(0,o.Z)(g,{mixins:c(g.breakpoints,n),palette:m,shadows:N.slice(),typography:E(m,p),transitions:O(f),zIndex:(0,r.Z)({},L)});y=(0,o.Z)(y,v);for(var b=arguments.length,k=new Array(b>1?b-1:0),V=1;V<b;V++)k[V-1]=arguments[V];return y=k.reduce((function(e,t){return(0,o.Z)(e,t)}),y)}var z=P},4205:function(e,t,n){"use strict";var r=(0,n(4360).Z)();t.Z=r},6863:function(e,t,n){"use strict";n.d(t,{ZP:function(){return E},FO:function(){return S}});var r=n(3433),a=n(9439),i=n(3366),o=n(7462),s=n(1125),u=n(5080),c=n(7312),l=["variant"];function h(e){return 0===e.length}function f(e){var t=e.variant,n=(0,i.Z)(e,l),r=t||"";return Object.keys(n).sort().forEach((function(t){r+="color"===t?h(r)?e[t]:(0,c.Z)(e[t]):"".concat(h(r)?t:(0,c.Z)(t)).concat((0,c.Z)(e[t].toString()))})),r}var d=n(104),p=["name","slot","skipVariantsResolver","skipSx","overridesResolver"],v=["theme"],m=["theme"];function g(e){return 0===Object.keys(e).length}function y(e){return"string"===typeof e&&e.charCodeAt(0)>96}var b=function(e,t){return t.components&&t.components[e]&&t.components[e].styleOverrides?t.components[e].styleOverrides:null},k=function(e,t){var n=[];t&&t.components&&t.components[e]&&t.components[e].variants&&(n=t.components[e].variants);var r={};return n.forEach((function(e){var t=f(e.props);r[t]=e.style})),r},V=function(e,t,n,r){var a,i,o=e.ownerState,s=void 0===o?{}:o,u=[],c=null==n||null==(a=n.components)||null==(i=a[r])?void 0:i.variants;return c&&c.forEach((function(n){var r=!0;Object.keys(n.props).forEach((function(t){s[t]!==n.props[t]&&e[t]!==n.props[t]&&(r=!1)})),r&&u.push(t[f(n.props)])})),u};function x(e){return"ownerState"!==e&&"theme"!==e&&"sx"!==e&&"as"!==e}var w=(0,u.Z)();var I=n(4205),S=function(e){return x(e)&&"classes"!==e},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.defaultTheme,n=void 0===t?w:t,u=e.rootShouldForwardProp,c=void 0===u?x:u,l=e.slotShouldForwardProp,h=void 0===l?x:l,f=e.styleFunctionSx,I=void 0===f?d.Z:f,S=function(e){var t=g(e.theme)?n:e.theme;return I((0,o.Z)({},e,{theme:t}))};return S.__mui_systemSx=!0,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(0,s.Co)(e,(function(e){return e.filter((function(e){return!(null!=e&&e.__mui_systemSx)}))}));var u,l=t.name,f=t.slot,d=t.skipVariantsResolver,w=t.skipSx,I=t.overridesResolver,C=(0,i.Z)(t,p),E=void 0!==d?d:f&&"Root"!==f||!1,T=w||!1;var N=x;"Root"===f?N=c:f?N=h:y(e)&&(N=void 0);var A=(0,s.ZP)(e,(0,o.Z)({shouldForwardProp:N,label:u},C)),R=function(e){for(var t=arguments.length,s=new Array(t>1?t-1:0),u=1;u<t;u++)s[u-1]=arguments[u];var c=s?s.map((function(e){return"function"===typeof e&&e.__emotion_real!==e?function(t){var r=t.theme,a=(0,i.Z)(t,v);return e((0,o.Z)({theme:g(r)?n:r},a))}:e})):[],h=e;l&&I&&c.push((function(e){var t=g(e.theme)?n:e.theme,r=b(l,t);if(r){var i={};return Object.entries(r).forEach((function(n){var r=(0,a.Z)(n,2),s=r[0],u=r[1];i[s]="function"===typeof u?u((0,o.Z)({},e,{theme:t})):u})),I(e,i)}return null})),l&&!E&&c.push((function(e){var t=g(e.theme)?n:e.theme;return V(e,k(l,t),t,l)})),T||c.push(S);var f=c.length-s.length;if(Array.isArray(e)&&f>0){var d=new Array(f).fill("");(h=[].concat((0,r.Z)(e),(0,r.Z)(d))).raw=[].concat((0,r.Z)(e.raw),(0,r.Z)(d))}else"function"===typeof e&&e.__emotion_real!==e&&(h=function(t){var r=t.theme,a=(0,i.Z)(t,m);return e((0,o.Z)({theme:g(r)?n:r},a))});var p=A.apply(void 0,[h].concat((0,r.Z)(c)));return p};return A.withConfig&&(R.withConfig=A.withConfig),R}}({defaultTheme:I.Z,rootShouldForwardProp:S}),E=C},5873:function(e,t,n){"use strict";n.d(t,{Z:function(){return s}});var r=n(5735);var a=n(886);function i(e){var t=e.props,n=e.name,i=e.defaultTheme,o=function(e){var t=e.theme,n=e.name,a=e.props;return t&&t.components&&t.components[n]&&t.components[n].defaultProps?(0,r.Z)(t.components[n].defaultProps,a):a}({theme:(0,a.Z)(i),name:n,props:t});return o}var o=n(4205);function s(e){return i({props:e.props,name:e.name,defaultTheme:o.Z})}},9853:function(e,t,n){"use strict";var r=n(7312);t.Z=r.Z},1245:function(e,t,n){"use strict";n.d(t,{Z:function(){return y}});var r=n(7462),a=n(2791),i=n(3366),o=n(8182),s=n(4419),u=n(9853),c=n(5873),l=n(6863),h=n(1217);function f(e){return(0,h.Z)("MuiSvgIcon",e)}(0,n(5878).Z)("MuiSvgIcon",["root","colorPrimary","colorSecondary","colorAction","colorError","colorDisabled","fontSizeInherit","fontSizeSmall","fontSizeMedium","fontSizeLarge"]);var d=n(184),p=["children","className","color","component","fontSize","htmlColor","inheritViewBox","titleAccess","viewBox"],v=(0,l.ZP)("svg",{name:"MuiSvgIcon",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,"inherit"!==n.color&&t["color".concat((0,u.Z)(n.color))],t["fontSize".concat((0,u.Z)(n.fontSize))]]}})((function(e){var t,n,r,a,i,o,s,u,c,l,h,f,d,p,v,m,g,y=e.theme,b=e.ownerState;return{userSelect:"none",width:"1em",height:"1em",display:"inline-block",fill:"currentColor",flexShrink:0,transition:null==(t=y.transitions)||null==(n=t.create)?void 0:n.call(t,"fill",{duration:null==(r=y.transitions)||null==(a=r.duration)?void 0:a.shorter}),fontSize:{inherit:"inherit",small:(null==(i=y.typography)||null==(o=i.pxToRem)?void 0:o.call(i,20))||"1.25rem",medium:(null==(s=y.typography)||null==(u=s.pxToRem)?void 0:u.call(s,24))||"1.5rem",large:(null==(c=y.typography)||null==(l=c.pxToRem)?void 0:l.call(c,35))||"2.1875"}[b.fontSize],color:null!=(h=null==(f=(y.vars||y).palette)||null==(d=f[b.color])?void 0:d.main)?h:{action:null==(p=(y.vars||y).palette)||null==(v=p.action)?void 0:v.active,disabled:null==(m=(y.vars||y).palette)||null==(g=m.action)?void 0:g.disabled,inherit:void 0}[b.color]}})),m=a.forwardRef((function(e,t){var n=(0,c.Z)({props:e,name:"MuiSvgIcon"}),a=n.children,l=n.className,h=n.color,m=void 0===h?"inherit":h,g=n.component,y=void 0===g?"svg":g,b=n.fontSize,k=void 0===b?"medium":b,V=n.htmlColor,x=n.inheritViewBox,w=void 0!==x&&x,I=n.titleAccess,S=n.viewBox,C=void 0===S?"0 0 24 24":S,E=(0,i.Z)(n,p),T=(0,r.Z)({},n,{color:m,component:y,fontSize:k,instanceFontSize:e.fontSize,inheritViewBox:w,viewBox:C}),N={};w||(N.viewBox=C);var A=function(e){var t=e.color,n=e.fontSize,r=e.classes,a={root:["root","inherit"!==t&&"color".concat((0,u.Z)(t)),"fontSize".concat((0,u.Z)(n))]};return(0,s.Z)(a,f,r)}(T);return(0,d.jsxs)(v,(0,r.Z)({as:y,className:(0,o.Z)(A.root,l),ownerState:T,focusable:"false",color:V,"aria-hidden":!I||void 0,role:I?"img":void 0,ref:t},N,E,{children:[a,I?(0,d.jsx)("title",{children:I}):null]}))}));m.muiName="SvgIcon";var g=m;function y(e,t){var n=function(n,a){return(0,d.jsx)(g,(0,r.Z)({"data-testid":"".concat(t,"Icon"),ref:a},n,{children:e}))};return n.muiName=g.muiName,a.memo(a.forwardRef(n))}},5602:function(e,t,n){"use strict";n.d(t,{Z:function(){return r}});var r=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:166;function r(){for(var r=this,a=arguments.length,i=new Array(a),o=0;o<a;o++)i[o]=arguments[o];var s=function(){e.apply(r,i)};clearTimeout(t),t=setTimeout(s,n)}return r.clear=function(){clearTimeout(t)},r}},2291:function(e,t,n){"use strict";n.r(t),n.d(t,{capitalize:function(){return a.Z},createChainedFunction:function(){return i},createSvgIcon:function(){return o.Z},debounce:function(){return s.Z},deprecatedPropType:function(){return u},isMuiElement:function(){return h},ownerDocument:function(){return f.Z},ownerWindow:function(){return d.Z},requirePropFactory:function(){return p},setRef:function(){return v},unstable_ClassNameGenerator:function(){return C},unstable_useEnhancedEffect:function(){return m},unstable_useId:function(){return k},unsupportedProp:function(){return V},useControlled:function(){return x},useEventCallback:function(){return w.Z},useForkRef:function(){return I.Z},useIsFocusVisible:function(){return S.Z}});var r=n(5902),a=n(9853);var i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.reduce((function(e,t){return null==t?e:function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];e.apply(this,r),t.apply(this,r)}}),(function(){}))},o=n(1245),s=n(5602);var u=function(e,t){return function(){return null}},c=n(2791),l=n.t(c,2);var h=function(e,t){return c.isValidElement(e)&&-1!==t.indexOf(e.type.muiName)},f=n(5783),d=n(1003);n(7462);var p=function(e,t){return function(){return null}},v=n(2971).Z,m=n(5721).Z,g=n(9439),y=0;var b=l.useId;var k=function(e){if(void 0!==b){var t=b();return null!=e?e:t}return function(e){var t=c.useState(e),n=(0,g.Z)(t,2),r=n[0],a=n[1],i=e||r;return c.useEffect((function(){null==r&&a("mui-".concat(y+=1))}),[r]),i}(e)};var V=function(e,t,n,r,a){return null};var x=function(e){var t=e.controlled,n=e.default,r=(e.name,e.state,c.useRef(void 0!==t).current),a=c.useState(n),i=(0,g.Z)(a,2),o=i[0],s=i[1];return[r?t:o,c.useCallback((function(e){r||s(e)}),[])]},w=n(6702),I=n(792),S=n(2763),C={configure:function(e){console.warn(["MUI: `ClassNameGenerator` import from `@mui/material/utils` is outdated and might cause unexpected issues.","","You should use `import { unstable_ClassNameGenerator } from '@mui/material/className'` instead","","The detail of the issue: https://github.com/mui/material-ui/issues/30011#issuecomment-1024993401","","The updated documentation: https://mui.com/guides/classname-generator/"].join("\n")),r.Z.configure(e)}}},5783:function(e,t,n){"use strict";var r=n(9723);t.Z=r.Z},1003:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(9723);var a=function(e){return(0,r.Z)(e).defaultView||window}},6702:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(2791),a=n(5721);var i=function(e){var t=r.useRef(e);return(0,a.Z)((function(){t.current=e})),r.useCallback((function(){return t.current.apply(void 0,arguments)}),[])}},792:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(2791),a=n(2971);var i=function(e,t){return r.useMemo((function(){return null==e&&null==t?null:function(n){(0,a.Z)(e,n),(0,a.Z)(t,n)}}),[e,t])}},2763:function(e,t,n){"use strict";n.d(t,{Z:function(){return f}});var r,a=n(2791),i=!0,o=!1,s={text:!0,search:!0,url:!0,tel:!0,email:!0,password:!0,number:!0,date:!0,month:!0,week:!0,time:!0,datetime:!0,"datetime-local":!0};function u(e){e.metaKey||e.altKey||e.ctrlKey||(i=!0)}function c(){i=!1}function l(){"hidden"===this.visibilityState&&o&&(i=!0)}function h(e){var t=e.target;try{return t.matches(":focus-visible")}catch(n){}return i||function(e){var t=e.type,n=e.tagName;return!("INPUT"!==n||!s[t]||e.readOnly)||"TEXTAREA"===n&&!e.readOnly||!!e.isContentEditable}(t)}var f=function(){var e=a.useCallback((function(e){var t;null!=e&&((t=e.ownerDocument).addEventListener("keydown",u,!0),t.addEventListener("mousedown",c,!0),t.addEventListener("pointerdown",c,!0),t.addEventListener("touchstart",c,!0),t.addEventListener("visibilitychange",l,!0))}),[]),t=a.useRef(!1);return{isFocusVisibleRef:t,onFocus:function(e){return!!h(e)&&(t.current=!0,!0)},onBlur:function(){return!!t.current&&(o=!0,window.clearTimeout(r),r=window.setTimeout((function(){o=!1}),100),t.current=!1,!0)},ref:e}}},6532:function(e,t){"use strict";var n,r=Symbol.for("react.element"),a=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),o=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),u=Symbol.for("react.provider"),c=Symbol.for("react.context"),l=Symbol.for("react.server_context"),h=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),d=Symbol.for("react.suspense_list"),p=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),m=Symbol.for("react.offscreen");function g(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case i:case s:case o:case f:case d:return e;default:switch(e=e&&e.$$typeof){case l:case c:case h:case v:case p:case u:return e;default:return t}}case a:return t}}}n=Symbol.for("react.module.reference")},8457:function(e,t,n){"use strict";n(6532)},1125:function(e,t,n){"use strict";n.d(t,{ZP:function(){return I},Co:function(){return S}});var r=n(2791),a=n(7462),i=n(9797),o=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,s=(0,i.Z)((function(e){return o.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),u=n(76),c=n(9140),l=n(2561),h=(0,r.createContext)("undefined"!==typeof HTMLElement?(0,u.Z)({key:"css"}):null);h.Provider;var f=function(e){return(0,r.forwardRef)((function(t,n){var a=(0,r.useContext)(h);return e(t,a,n)}))},d=(0,r.createContext)({});function p(e,t,n){var r="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):r+=n+" "})),r}var v=function(e,t,n){var r=e.key+"-"+t.name;!1===n&&void 0===e.registered[r]&&(e.registered[r]=t.styles)},m=s,g=function(e){return"theme"!==e},y=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?m:g},b=function(e,t,n){var r;if(t){var a=t.shouldForwardProp;r=e.__emotion_forwardProp&&a?function(t){return e.__emotion_forwardProp(t)&&a(t)}:a}return"function"!==typeof r&&n&&(r=e.__emotion_forwardProp),r},k=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;v(t,n,r);(0,l.L)((function(){return function(e,t,n){v(e,t,n);var r=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var a=t;do{e.insert(t===a?"."+r:"",a,e.sheet,!0),a=a.next}while(void 0!==a)}}(t,n,r)}));return null},V=function e(t,n){var i,o,s=t.__emotion_real===t,u=s&&t.__emotion_base||t;void 0!==n&&(i=n.label,o=n.target);var l=b(t,n,s),h=l||y(u),v=!h("as");return function(){var m=arguments,g=s&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==i&&g.push("label:"+i+";"),null==m[0]||void 0===m[0].raw)g.push.apply(g,m);else{0,g.push(m[0][0]);for(var V=m.length,x=1;x<V;x++)g.push(m[x],m[0][x])}var w=f((function(e,t,n){var a=v&&e.as||u,i="",s=[],f=e;if(null==e.theme){for(var m in f={},e)f[m]=e[m];f.theme=(0,r.useContext)(d)}"string"===typeof e.className?i=p(t.registered,s,e.className):null!=e.className&&(i=e.className+" ");var b=(0,c.O)(g.concat(s),t.registered,f);i+=t.key+"-"+b.name,void 0!==o&&(i+=" "+o);var V=v&&void 0===l?y(a):h,x={};for(var w in e)v&&"as"===w||V(w)&&(x[w]=e[w]);return x.className=i,x.ref=n,(0,r.createElement)(r.Fragment,null,(0,r.createElement)(k,{cache:t,serialized:b,isStringTag:"string"===typeof a}),(0,r.createElement)(a,x))}));return w.displayName=void 0!==i?i:"Styled("+("string"===typeof u?u:u.displayName||u.name||"Component")+")",w.defaultProps=t.defaultProps,w.__emotion_real=w,w.__emotion_base=u,w.__emotion_styles=g,w.__emotion_forwardProp=l,Object.defineProperty(w,"toString",{value:function(){return"."+o}}),w.withComponent=function(t,r){return e(t,(0,a.Z)({},n,r,{shouldForwardProp:b(w,r,!0)})).apply(void 0,g)},w}},x=V.bind();["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){x[e]=x(e)}));var w=x;function I(e,t){return w(e,t)}var S=function(e,t){Array.isArray(e.__emotion_styles)&&(e.__emotion_styles=t(e.__emotion_styles))}},1184:function(e,t,n){"use strict";n.d(t,{L7:function(){return u},P$:function(){return l},VO:function(){return a},W8:function(){return s},dt:function(){return c},k9:function(){return o}});var r=n(2466),a={xs:0,sm:600,md:900,lg:1200,xl:1536},i={keys:["xs","sm","md","lg","xl"],up:function(e){return"@media (min-width:".concat(a[e],"px)")}};function o(e,t,n){var r=e.theme||{};if(Array.isArray(t)){var o=r.breakpoints||i;return t.reduce((function(e,r,a){return e[o.up(o.keys[a])]=n(t[a]),e}),{})}if("object"===typeof t){var s=r.breakpoints||i;return Object.keys(t).reduce((function(e,r){if(-1!==Object.keys(s.values||a).indexOf(r)){e[s.up(r)]=n(t[r],r)}else{var i=r;e[i]=t[i]}return e}),{})}return n(t)}function s(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=null==(e=t.keys)?void 0:e.reduce((function(e,n){return e[t.up(n)]={},e}),{});return n||{}}function u(e,t){return e.reduce((function(e,t){var n=e[t];return(!n||0===Object.keys(n).length)&&delete e[t],e}),t)}function c(e){for(var t=s(e),n=arguments.length,a=new Array(n>1?n-1:0),i=1;i<n;i++)a[i-1]=arguments[i];var o=[t].concat(a).reduce((function(e,t){return(0,r.Z)(e,t)}),{});return u(Object.keys(t),o)}function l(e){var t,n=e.values,r=e.breakpoints,a=e.base||function(e,t){if("object"!==typeof e)return{};var n={},r=Object.keys(t);return Array.isArray(e)?r.forEach((function(t,r){r<e.length&&(n[t]=!0)})):r.forEach((function(t){null!=e[t]&&(n[t]=!0)})),n}(n,r),i=Object.keys(a);return 0===i.length?n:i.reduce((function(e,r,a){return Array.isArray(n)?(e[r]=null!=n[a]?n[a]:n[t],t=a):"object"===typeof n?(e[r]=null!=n[r]?n[r]:n[t],t=r):e[r]=n,e}),{})}},2065:function(e,t,n){"use strict";n.d(t,{$n:function(){return h},Fq:function(){return c},_j:function(){return l},mi:function(){return u}});var r=n(6189);function a(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return Math.min(Math.max(t,e),n)}function i(e){if(e.type)return e;if("#"===e.charAt(0))return i(function(e){e=e.slice(1);var t=new RegExp(".{1,".concat(e.length>=6?2:1,"}"),"g"),n=e.match(t);return n&&1===n[0].length&&(n=n.map((function(e){return e+e}))),n?"rgb".concat(4===n.length?"a":"","(").concat(n.map((function(e,t){return t<3?parseInt(e,16):Math.round(parseInt(e,16)/255*1e3)/1e3})).join(", "),")"):""}(e));var t=e.indexOf("("),n=e.substring(0,t);if(-1===["rgb","rgba","hsl","hsla","color"].indexOf(n))throw new Error((0,r.Z)(9,e));var a,o=e.substring(t+1,e.length-1);if("color"===n){if(a=(o=o.split(" ")).shift(),4===o.length&&"/"===o[3].charAt(0)&&(o[3]=o[3].slice(1)),-1===["srgb","display-p3","a98-rgb","prophoto-rgb","rec-2020"].indexOf(a))throw new Error((0,r.Z)(10,a))}else o=o.split(",");return{type:n,values:o=o.map((function(e){return parseFloat(e)})),colorSpace:a}}function o(e){var t=e.type,n=e.colorSpace,r=e.values;return-1!==t.indexOf("rgb")?r=r.map((function(e,t){return t<3?parseInt(e,10):e})):-1!==t.indexOf("hsl")&&(r[1]="".concat(r[1],"%"),r[2]="".concat(r[2],"%")),r=-1!==t.indexOf("color")?"".concat(n," ").concat(r.join(" ")):"".concat(r.join(", ")),"".concat(t,"(").concat(r,")")}function s(e){var t="hsl"===(e=i(e)).type?i(function(e){var t=(e=i(e)).values,n=t[0],r=t[1]/100,a=t[2]/100,s=r*Math.min(a,1-a),u=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e+n/30)%12;return a-s*Math.max(Math.min(t-3,9-t,1),-1)},c="rgb",l=[Math.round(255*u(0)),Math.round(255*u(8)),Math.round(255*u(4))];return"hsla"===e.type&&(c+="a",l.push(t[3])),o({type:c,values:l})}(e)).values:e.values;return t=t.map((function(t){return"color"!==e.type&&(t/=255),t<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4)})),Number((.2126*t[0]+.7152*t[1]+.0722*t[2]).toFixed(3))}function u(e,t){var n=s(e),r=s(t);return(Math.max(n,r)+.05)/(Math.min(n,r)+.05)}function c(e,t){return e=i(e),t=a(t),"rgb"!==e.type&&"hsl"!==e.type||(e.type+="a"),"color"===e.type?e.values[3]="/".concat(t):e.values[3]=t,o(e)}function l(e,t){if(e=i(e),t=a(t),-1!==e.type.indexOf("hsl"))e.values[2]*=1-t;else if(-1!==e.type.indexOf("rgb")||-1!==e.type.indexOf("color"))for(var n=0;n<3;n+=1)e.values[n]*=1-t;return o(e)}function h(e,t){if(e=i(e),t=a(t),-1!==e.type.indexOf("hsl"))e.values[2]+=(100-e.values[2])*t;else if(-1!==e.type.indexOf("rgb"))for(var n=0;n<3;n+=1)e.values[n]+=(255-e.values[n])*t;else if(-1!==e.type.indexOf("color"))for(var r=0;r<3;r+=1)e.values[r]+=(1-e.values[r])*t;return o(e)}},5080:function(e,t,n){"use strict";n.d(t,{Z:function(){return d}});var r=n(7462),a=n(3366),i=n(2466),o=n(4942),s=["values","unit","step"];function u(e){var t=e.values,n=void 0===t?{xs:0,sm:600,md:900,lg:1200,xl:1536}:t,i=e.unit,u=void 0===i?"px":i,c=e.step,l=void 0===c?5:c,h=(0,a.Z)(e,s),f=function(e){var t=Object.keys(e).map((function(t){return{key:t,val:e[t]}}))||[];return t.sort((function(e,t){return e.val-t.val})),t.reduce((function(e,t){return(0,r.Z)({},e,(0,o.Z)({},t.key,t.val))}),{})}(n),d=Object.keys(f);function p(e){var t="number"===typeof n[e]?n[e]:e;return"@media (min-width:".concat(t).concat(u,")")}function v(e){var t="number"===typeof n[e]?n[e]:e;return"@media (max-width:".concat(t-l/100).concat(u,")")}function m(e,t){var r=d.indexOf(t);return"@media (min-width:".concat("number"===typeof n[e]?n[e]:e).concat(u,") and ")+"(max-width:".concat((-1!==r&&"number"===typeof n[d[r]]?n[d[r]]:t)-l/100).concat(u,")")}return(0,r.Z)({keys:d,values:f,up:p,down:v,between:m,only:function(e){return d.indexOf(e)+1<d.length?m(e,d[d.indexOf(e)+1]):p(e)},not:function(e){var t=d.indexOf(e);return 0===t?p(d[1]):t===d.length-1?v(d[t]):m(e,d[d.indexOf(e)+1]).replace("@media","@media not all and")},unit:u},h)}var c={borderRadius:4},l=n(5682);function h(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;if(e.mui)return e;var t=(0,l.hB)({spacing:e}),n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=0===n.length?[1]:n;return a.map((function(e){var n=t(e);return"number"===typeof n?"".concat(n,"px"):n})).join(" ")};return n.mui=!0,n}var f=["breakpoints","palette","spacing","shape"];var d=function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.breakpoints,n=void 0===t?{}:t,o=e.palette,s=void 0===o?{}:o,l=e.spacing,d=e.shape,p=void 0===d?{}:d,v=(0,a.Z)(e,f),m=u(n),g=h(l),y=(0,i.Z)({breakpoints:m,direction:"ltr",components:{},palette:(0,r.Z)({mode:"light"},s),spacing:g,shape:(0,r.Z)({},c,p)},v),b=arguments.length,k=new Array(b>1?b-1:0),V=1;V<b;V++)k[V-1]=arguments[V];return y=k.reduce((function(e,t){return(0,i.Z)(e,t)}),y)}},114:function(e,t,n){"use strict";n.d(t,{Gc:function(){return X},G$:function(){return K}});var r=n(8529),a=n(8247);var i=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce((function(e,t){return t.filterProps.forEach((function(n){e[n]=t})),e}),{}),i=function(e){return Object.keys(e).reduce((function(t,n){return r[n]?(0,a.Z)(t,r[n](e)):t}),{})};return i.propTypes={},i.filterProps=t.reduce((function(e,t){return e.concat(t.filterProps)}),[]),i},o=n(5682),s=n(1184);function u(e){return"number"!==typeof e?e:"".concat(e,"px solid")}var c=(0,r.Z)({prop:"border",themeKey:"borders",transform:u}),l=(0,r.Z)({prop:"borderTop",themeKey:"borders",transform:u}),h=(0,r.Z)({prop:"borderRight",themeKey:"borders",transform:u}),f=(0,r.Z)({prop:"borderBottom",themeKey:"borders",transform:u}),d=(0,r.Z)({prop:"borderLeft",themeKey:"borders",transform:u}),p=(0,r.Z)({prop:"borderColor",themeKey:"palette"}),v=(0,r.Z)({prop:"borderTopColor",themeKey:"palette"}),m=(0,r.Z)({prop:"borderRightColor",themeKey:"palette"}),g=(0,r.Z)({prop:"borderBottomColor",themeKey:"palette"}),y=(0,r.Z)({prop:"borderLeftColor",themeKey:"palette"}),b=function(e){if(void 0!==e.borderRadius&&null!==e.borderRadius){var t=(0,o.eI)(e.theme,"shape.borderRadius",4,"borderRadius");return(0,s.k9)(e,e.borderRadius,(function(e){return{borderRadius:(0,o.NA)(t,e)}}))}return null};b.propTypes={},b.filterProps=["borderRadius"];var k=i(c,l,h,f,d,p,v,m,g,y,b),V=i((0,r.Z)({prop:"displayPrint",cssProperty:!1,transform:function(e){return{"@media print":{display:e}}}}),(0,r.Z)({prop:"display"}),(0,r.Z)({prop:"overflow"}),(0,r.Z)({prop:"textOverflow"}),(0,r.Z)({prop:"visibility"}),(0,r.Z)({prop:"whiteSpace"})),x=i((0,r.Z)({prop:"flexBasis"}),(0,r.Z)({prop:"flexDirection"}),(0,r.Z)({prop:"flexWrap"}),(0,r.Z)({prop:"justifyContent"}),(0,r.Z)({prop:"alignItems"}),(0,r.Z)({prop:"alignContent"}),(0,r.Z)({prop:"order"}),(0,r.Z)({prop:"flex"}),(0,r.Z)({prop:"flexGrow"}),(0,r.Z)({prop:"flexShrink"}),(0,r.Z)({prop:"alignSelf"}),(0,r.Z)({prop:"justifyItems"}),(0,r.Z)({prop:"justifySelf"})),w=function(e){if(void 0!==e.gap&&null!==e.gap){var t=(0,o.eI)(e.theme,"spacing",8,"gap");return(0,s.k9)(e,e.gap,(function(e){return{gap:(0,o.NA)(t,e)}}))}return null};w.propTypes={},w.filterProps=["gap"];var I=function(e){if(void 0!==e.columnGap&&null!==e.columnGap){var t=(0,o.eI)(e.theme,"spacing",8,"columnGap");return(0,s.k9)(e,e.columnGap,(function(e){return{columnGap:(0,o.NA)(t,e)}}))}return null};I.propTypes={},I.filterProps=["columnGap"];var S=function(e){if(void 0!==e.rowGap&&null!==e.rowGap){var t=(0,o.eI)(e.theme,"spacing",8,"rowGap");return(0,s.k9)(e,e.rowGap,(function(e){return{rowGap:(0,o.NA)(t,e)}}))}return null};S.propTypes={},S.filterProps=["rowGap"];var C=i(w,I,S,(0,r.Z)({prop:"gridColumn"}),(0,r.Z)({prop:"gridRow"}),(0,r.Z)({prop:"gridAutoFlow"}),(0,r.Z)({prop:"gridAutoColumns"}),(0,r.Z)({prop:"gridAutoRows"}),(0,r.Z)({prop:"gridTemplateColumns"}),(0,r.Z)({prop:"gridTemplateRows"}),(0,r.Z)({prop:"gridTemplateAreas"}),(0,r.Z)({prop:"gridArea"})),E=i((0,r.Z)({prop:"position"}),(0,r.Z)({prop:"zIndex",themeKey:"zIndex"}),(0,r.Z)({prop:"top"}),(0,r.Z)({prop:"right"}),(0,r.Z)({prop:"bottom"}),(0,r.Z)({prop:"left"})),T=i((0,r.Z)({prop:"color",themeKey:"palette"}),(0,r.Z)({prop:"bgcolor",cssProperty:"backgroundColor",themeKey:"palette"}),(0,r.Z)({prop:"backgroundColor",themeKey:"palette"})),N=(0,r.Z)({prop:"boxShadow",themeKey:"shadows"});function A(e){return e<=1&&0!==e?"".concat(100*e,"%"):e}var R=(0,r.Z)({prop:"width",transform:A}),_=function(e){if(void 0!==e.maxWidth&&null!==e.maxWidth){return(0,s.k9)(e,e.maxWidth,(function(t){var n,r,a;return{maxWidth:(null==(n=e.theme)||null==(r=n.breakpoints)||null==(a=r.values)?void 0:a[t])||s.VO[t]||A(t)}}))}return null};_.filterProps=["maxWidth"];var D=(0,r.Z)({prop:"minWidth",transform:A}),F=(0,r.Z)({prop:"height",transform:A}),O=(0,r.Z)({prop:"maxHeight",transform:A}),L=(0,r.Z)({prop:"minHeight",transform:A}),M=((0,r.Z)({prop:"size",cssProperty:"width",transform:A}),(0,r.Z)({prop:"size",cssProperty:"height",transform:A}),i(R,_,D,F,O,L,(0,r.Z)({prop:"boxSizing"}))),P=(0,r.Z)({prop:"fontFamily",themeKey:"typography"}),z=(0,r.Z)({prop:"fontSize",themeKey:"typography"}),B=(0,r.Z)({prop:"fontStyle",themeKey:"typography"}),U=(0,r.Z)({prop:"fontWeight",themeKey:"typography"}),W=(0,r.Z)({prop:"letterSpacing"}),j=(0,r.Z)({prop:"textTransform"}),Z=(0,r.Z)({prop:"lineHeight"}),G=(0,r.Z)({prop:"textAlign"}),H=i((0,r.Z)({prop:"typography",cssProperty:!1,themeKey:"typography"}),P,z,B,U,W,Z,G,j),q={borders:k.filterProps,display:V.filterProps,flexbox:x.filterProps,grid:C.filterProps,positions:E.filterProps,palette:T.filterProps,shadows:N.filterProps,sizing:M.filterProps,spacing:o.ZP.filterProps,typography:H.filterProps},K={borders:k,display:V,flexbox:x,grid:C,positions:E,palette:T,shadows:N,sizing:M,spacing:o.ZP,typography:H},X=Object.keys(q).reduce((function(e,t){return q[t].forEach((function(n){e[n]=K[t]})),e}),{})},8247:function(e,t,n){"use strict";var r=n(2466);t.Z=function(e,t){return t?(0,r.Z)(e,t,{clone:!1}):e}},5682:function(e,t,n){"use strict";n.d(t,{hB:function(){return v},eI:function(){return p},ZP:function(){return x},NA:function(){return m}});var r=n(9439),a=n(1184),i=n(8529),o=n(8247);var s={m:"margin",p:"padding"},u={t:"Top",r:"Right",b:"Bottom",l:"Left",x:["Left","Right"],y:["Top","Bottom"]},c={marginX:"mx",marginY:"my",paddingX:"px",paddingY:"py"},l=function(e){var t={};return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}}((function(e){if(e.length>2){if(!c[e])return[e];e=c[e]}var t=e.split(""),n=(0,r.Z)(t,2),a=n[0],i=n[1],o=s[a],l=u[i]||"";return Array.isArray(l)?l.map((function(e){return o+e})):[o+l]})),h=["m","mt","mr","mb","ml","mx","my","margin","marginTop","marginRight","marginBottom","marginLeft","marginX","marginY","marginInline","marginInlineStart","marginInlineEnd","marginBlock","marginBlockStart","marginBlockEnd"],f=["p","pt","pr","pb","pl","px","py","padding","paddingTop","paddingRight","paddingBottom","paddingLeft","paddingX","paddingY","paddingInline","paddingInlineStart","paddingInlineEnd","paddingBlock","paddingBlockStart","paddingBlockEnd"],d=[].concat(h,f);function p(e,t,n,r){var a,o=null!=(a=(0,i.D)(e,t,!1))?a:n;return"number"===typeof o?function(e){return"string"===typeof e?e:o*e}:Array.isArray(o)?function(e){return"string"===typeof e?e:o[e]}:"function"===typeof o?o:function(){}}function v(e){return p(e,"spacing",8)}function m(e,t){if("string"===typeof t||null==t)return t;var n=e(Math.abs(t));return t>=0?n:"number"===typeof n?-n:"-".concat(n)}function g(e,t,n,r){if(-1===t.indexOf(n))return null;var i=function(e,t){return function(n){return e.reduce((function(e,r){return e[r]=m(t,n),e}),{})}}(l(n),r),o=e[n];return(0,a.k9)(e,o,i)}function y(e,t){var n=v(e.theme);return Object.keys(e).map((function(r){return g(e,t,r,n)})).reduce(o.Z,{})}function b(e){return y(e,h)}function k(e){return y(e,f)}function V(e){return y(e,d)}b.propTypes={},b.filterProps=h,k.propTypes={},k.filterProps=f,V.propTypes={},V.filterProps=d;var x=V},8529:function(e,t,n){"use strict";n.d(t,{D:function(){return o}});var r=n(4942),a=n(7312),i=n(1184);function o(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||"string"!==typeof t)return null;if(e&&e.vars&&n){var r="vars.".concat(t).split(".").reduce((function(e,t){return e&&e[t]?e[t]:null}),e);if(null!=r)return r}return t.split(".").reduce((function(e,t){return e&&null!=e[t]?e[t]:null}),e)}function s(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n;return r="function"===typeof e?e(n):Array.isArray(e)?e[n]||a:o(e,n)||a,t&&(r=t(r)),r}t.Z=function(e){var t=e.prop,n=e.cssProperty,u=void 0===n?e.prop:n,c=e.themeKey,l=e.transform,h=function(e){if(null==e[t])return null;var n=e[t],h=o(e.theme,c)||{};return(0,i.k9)(e,n,(function(e){var n=s(h,l,e);return e===n&&"string"===typeof e&&(n=s(h,l,"".concat(t).concat("default"===e?"":(0,a.Z)(e)),e)),!1===u?n:(0,r.Z)({},u,n)}))};return h.propTypes={},h.filterProps=[t],h}},104:function(e,t,n){"use strict";var r=n(4942),a=n(8247),i=n(114),o=n(1184);function s(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.reduce((function(e,t){return e.concat(Object.keys(t))}),[]),a=new Set(r);return t.every((function(e){return a.size===Object.keys(e).length}))}function u(e,t){return"function"===typeof e?e(t):e}var c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:i.G$,t=Object.keys(e).reduce((function(t,n){return e[n].filterProps.forEach((function(r){t[r]=e[n]})),t}),{});function n(e,n,a){var i,o=(i={},(0,r.Z)(i,e,n),(0,r.Z)(i,"theme",a),i),s=t[e];return s?s(o):(0,r.Z)({},e,n)}function c(e){var i=e||{},l=i.sx,h=i.theme,f=void 0===h?{}:h;if(!l)return null;function d(e){var i=e;if("function"===typeof e)i=e(f);else if("object"!==typeof e)return e;if(!i)return null;var l=(0,o.W8)(f.breakpoints),h=Object.keys(l),d=l;return Object.keys(i).forEach((function(e){var l=u(i[e],f);if(null!==l&&void 0!==l)if("object"===typeof l)if(t[e])d=(0,a.Z)(d,n(e,l,f));else{var h=(0,o.k9)({theme:f},l,(function(t){return(0,r.Z)({},e,t)}));s(h,l)?d[e]=c({sx:l,theme:f}):d=(0,a.Z)(d,h)}else d=(0,a.Z)(d,n(e,l,f))})),(0,o.L7)(h,d)}return Array.isArray(l)?l.map(d):d(l)}return c}();c.filterProps=["sx"],t.Z=c},886:function(e,t,n){"use strict";n.d(t,{Z:function(){return l}});var r=n(5080),a=n(2791);var i=a.createContext(null);function o(){return a.useContext(i)}function s(e){return 0===Object.keys(e).length}var u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=o();return!t||s(t)?e:t},c=(0,r.Z)();var l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:c;return u(e)}},5902:function(e,t){"use strict";var n=function(e){return e},r=function(){var e=n;return{configure:function(t){e=t},generate:function(t){return e(t)},reset:function(){e=n}}}();t.Z=r},7312:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(6189);function a(e){if("string"!==typeof e)throw new Error((0,r.Z)(7));return e.charAt(0).toUpperCase()+e.slice(1)}},4419:function(e,t,n){"use strict";function r(e,t,n){var r={};return Object.keys(e).forEach((function(a){r[a]=e[a].reduce((function(e,r){return r&&(e.push(t(r)),n&&n[r]&&e.push(n[r])),e}),[]).join(" ")})),r}n.d(t,{Z:function(){return r}})},2466:function(e,t,n){"use strict";n.d(t,{P:function(){return a},Z:function(){return i}});var r=n(7462);function a(e){return null!==e&&"object"===typeof e&&e.constructor===Object}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{clone:!0},o=n.clone?(0,r.Z)({},e):e;return a(e)&&a(t)&&Object.keys(t).forEach((function(r){"__proto__"!==r&&(a(t[r])&&r in e&&a(e[r])?o[r]=i(e[r],t[r],n):o[r]=t[r])})),o}},6189:function(e,t,n){"use strict";function r(e){for(var t="https://mui.com/production-error/?code="+e,n=1;n<arguments.length;n+=1)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified MUI error #"+e+"; visit "+t+" for the full message."}n.d(t,{Z:function(){return r}})},1217:function(e,t,n){"use strict";n.d(t,{Z:function(){return i}});var r=n(5902),a={active:"active",checked:"checked",completed:"completed",disabled:"disabled",error:"error",expanded:"expanded",focused:"focused",focusVisible:"focusVisible",required:"required",selected:"selected"};function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui",i=a[t];return i?"".concat(n,"-").concat(i):"".concat(r.Z.generate(e),"-").concat(t)}},5878:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(1217);function a(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Mui",a={};return t.forEach((function(t){a[t]=(0,r.Z)(e,t,n)})),a}},9723:function(e,t,n){"use strict";function r(e){return e&&e.ownerDocument||document}n.d(t,{Z:function(){return r}})},5735:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(7462);function a(e,t){var n=(0,r.Z)({},t);return Object.keys(e).forEach((function(t){void 0===n[t]&&(n[t]=e[t])})),n}},2971:function(e,t,n){"use strict";function r(e,t){"function"===typeof e?e(t):e&&(e.current=t)}n.d(t,{Z:function(){return r}})},5721:function(e,t,n){"use strict";var r=n(2791),a="undefined"!==typeof window?r.useLayoutEffect:r.useEffect;t.Z=a},8182:function(e,t,n){"use strict";function r(e){var t,n,a="";if("string"==typeof e||"number"==typeof e)a+=e;else if("object"==typeof e)if(Array.isArray(e))for(t=0;t<e.length;t++)e[t]&&(n=r(e[t]))&&(a&&(a+=" "),a+=n);else for(t in e)e[t]&&(a&&(a+=" "),a+=t);return a}t.Z=function(){for(var e,t,n=0,a="";n<arguments.length;)(e=arguments[n++])&&(t=r(e))&&(a&&(a+=" "),a+=t);return a}},2110:function(e,t,n){"use strict";var r=n(8309),a={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function u(e){return r.isMemo(e)?o:s[e.$$typeof]||a}s[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[r.Memo]=o;var c=Object.defineProperty,l=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,p=Object.prototype;e.exports=function e(t,n,r){if("string"!==typeof n){if(p){var a=d(n);a&&a!==p&&e(t,a,r)}var o=l(n);h&&(o=o.concat(h(n)));for(var s=u(t),v=u(n),m=0;m<o.length;++m){var g=o[m];if(!i[g]&&(!r||!r[g])&&(!v||!v[g])&&(!s||!s[g])){var y=f(n,g);try{c(t,g,y)}catch(b){}}}}return t}},746:function(e,t){"use strict";var n="function"===typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,a=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,o=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,u=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,l=n?Symbol.for("react.async_mode"):60111,h=n?Symbol.for("react.concurrent_mode"):60111,f=n?Symbol.for("react.forward_ref"):60112,d=n?Symbol.for("react.suspense"):60113,p=n?Symbol.for("react.suspense_list"):60120,v=n?Symbol.for("react.memo"):60115,m=n?Symbol.for("react.lazy"):60116,g=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,k=n?Symbol.for("react.scope"):60119;function V(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case l:case h:case i:case s:case o:case d:return e;default:switch(e=e&&e.$$typeof){case c:case f:case m:case v:case u:return e;default:return t}}case a:return t}}}function x(e){return V(e)===h}t.AsyncMode=l,t.ConcurrentMode=h,t.ContextConsumer=c,t.ContextProvider=u,t.Element=r,t.ForwardRef=f,t.Fragment=i,t.Lazy=m,t.Memo=v,t.Portal=a,t.Profiler=s,t.StrictMode=o,t.Suspense=d,t.isAsyncMode=function(e){return x(e)||V(e)===l},t.isConcurrentMode=x,t.isContextConsumer=function(e){return V(e)===c},t.isContextProvider=function(e){return V(e)===u},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return V(e)===f},t.isFragment=function(e){return V(e)===i},t.isLazy=function(e){return V(e)===m},t.isMemo=function(e){return V(e)===v},t.isPortal=function(e){return V(e)===a},t.isProfiler=function(e){return V(e)===s},t.isStrictMode=function(e){return V(e)===o},t.isSuspense=function(e){return V(e)===d},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===i||e===h||e===s||e===o||e===d||e===p||"object"===typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===v||e.$$typeof===u||e.$$typeof===c||e.$$typeof===f||e.$$typeof===y||e.$$typeof===b||e.$$typeof===k||e.$$typeof===g)},t.typeOf=V},8309:function(e,t,n){"use strict";e.exports=n(746)},8987:function(e){e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(S){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var a={},i={};function o(e,t){var n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=i[e])?r:(n=u(e,(0|e)<0?-1:0,!0),o&&(i[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=a[e])?r:(n=u(e,e<0?-1:0,!1),o&&(a[e]=n),n)}function s(e,t){if(isNaN(e))return t?g:m;if(t){if(e<0)return g;if(e>=d)return x}else{if(e<=-p)return w;if(e+1>=p)return V}return e<0?s(-e,t).neg():u(e%f|0,e/f|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=s,n.fromBits=u;var c=Math.pow;function l(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(e.substring(1),t,n).neg();for(var a=s(c(n,8)),i=m,o=0;o<e.length;o+=8){var u=Math.min(8,e.length-o),h=parseInt(e.substring(o,o+u),n);if(u<8){var f=s(c(n,u));i=i.mul(f).add(s(h))}else i=(i=i.mul(a)).add(s(h))}return i.unsigned=t,i}function h(e,t){return"number"===typeof e?s(e,t):"string"===typeof e?l(e,t):u(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=l,n.fromValue=h;var f=4294967296,d=f*f,p=d/2,v=o(1<<24),m=o(0);n.ZERO=m;var g=o(0,!0);n.UZERO=g;var y=o(1);n.ONE=y;var b=o(1,!0);n.UONE=b;var k=o(-1);n.NEG_ONE=k;var V=u(-1,2147483647,!1);n.MAX_VALUE=V;var x=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=x;var w=u(0,-2147483648,!1);n.MIN_VALUE=w;var I=n.prototype;I.toInt=function(){return this.unsigned?this.low>>>0:this.low},I.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},I.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(w)){var t=s(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=s(c(e,6),this.unsigned),i=this,o="";;){var u=i.div(a),l=(i.sub(u.mul(a)).toInt()>>>0).toString(e);if((i=u).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},I.getHighBits=function(){return this.high},I.getHighBitsUnsigned=function(){return this.high>>>0},I.getLowBits=function(){return this.low},I.getLowBitsUnsigned=function(){return this.low>>>0},I.getNumBitsAbs=function(){if(this.isNegative())return this.eq(w)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},I.isZero=function(){return 0===this.high&&0===this.low},I.eqz=I.isZero,I.isNegative=function(){return!this.unsigned&&this.high<0},I.isPositive=function(){return this.unsigned||this.high>=0},I.isOdd=function(){return 1===(1&this.low)},I.isEven=function(){return 0===(1&this.low)},I.equals=function(e){return r(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},I.eq=I.equals,I.notEquals=function(e){return!this.eq(e)},I.neq=I.notEquals,I.ne=I.notEquals,I.lessThan=function(e){return this.comp(e)<0},I.lt=I.lessThan,I.lessThanOrEqual=function(e){return this.comp(e)<=0},I.lte=I.lessThanOrEqual,I.le=I.lessThanOrEqual,I.greaterThan=function(e){return this.comp(e)>0},I.gt=I.greaterThan,I.greaterThanOrEqual=function(e){return this.comp(e)>=0},I.gte=I.greaterThanOrEqual,I.ge=I.greaterThanOrEqual,I.compare=function(e){if(r(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},I.comp=I.compare,I.negate=function(){return!this.unsigned&&this.eq(w)?w:this.not().add(y)},I.neg=I.negate,I.add=function(e){r(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,c=e.low>>>16,l=0,f=0,d=0,p=0;return d+=(p+=i+(65535&e.low))>>>16,f+=(d+=a+c)>>>16,l+=(f+=n+s)>>>16,l+=t+o,u((d&=65535)<<16|(p&=65535),(l&=65535)<<16|(f&=65535),this.unsigned)},I.subtract=function(e){return r(e)||(e=h(e)),this.add(e.neg())},I.sub=I.subtract,I.multiply=function(e){if(this.isZero())return m;if(r(e)||(e=h(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(w))return e.isOdd()?w:m;if(e.eq(w))return this.isOdd()?w:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(v)&&e.lt(v))return s(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=65535&this.high,i=this.low>>>16,o=65535&this.low,c=e.high>>>16,l=65535&e.high,f=e.low>>>16,d=65535&e.low,p=0,g=0,y=0,b=0;return y+=(b+=o*d)>>>16,g+=(y+=i*d)>>>16,y&=65535,g+=(y+=o*f)>>>16,p+=(g+=a*d)>>>16,g&=65535,p+=(g+=i*f)>>>16,g&=65535,p+=(g+=o*l)>>>16,p+=n*d+a*f+i*l+o*c,u((y&=65535)<<16|(b&=65535),(p&=65535)<<16|(g&=65535),this.unsigned)},I.mul=I.multiply,I.divide=function(e){if(r(e)||(e=h(e)),e.isZero())throw Error("division by zero");var n,a,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return b;i=g}else{if(this.eq(w))return e.eq(y)||e.eq(k)?w:e.eq(w)?y:(n=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?y:k:(a=this.sub(e.mul(n)),i=n.add(a.div(e)));if(e.eq(w))return this.unsigned?g:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=m}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),l=o<=48?1:c(2,o-48),f=s(n),d=f.mul(e);d.isNegative()||d.gt(a);)d=(f=s(n-=l,this.unsigned)).mul(e);f.isZero()&&(f=y),i=i.add(f),a=a.sub(d)}return i},I.div=I.divide,I.modulo=function(e){return r(e)||(e=h(e)),t?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},I.mod=I.modulo,I.rem=I.modulo,I.not=function(){return u(~this.low,~this.high,this.unsigned)},I.and=function(e){return r(e)||(e=h(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},I.or=function(e){return r(e)||(e=h(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},I.xor=function(e){return r(e)||(e=h(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},I.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},I.shl=I.shiftLeft,I.shiftRight=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},I.shr=I.shiftRight,I.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},I.shru=I.shiftRightUnsigned,I.shr_u=I.shiftRightUnsigned,I.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},I.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},I.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},I.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},I.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},4463:function(e,t,n){"use strict";var r=n(2791),a=n(5296);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},p={};function v(e,t,n,r,a,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var a=m.hasOwnProperty(t)?m[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!h.call(p,e)||!h.call(d,e)&&(f.test(e)?p[e]=!0:(d[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var k=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,V=Symbol.for("react.element"),x=Symbol.for("react.portal"),w=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),S=Symbol.for("react.profiler"),C=Symbol.for("react.provider"),E=Symbol.for("react.context"),T=Symbol.for("react.forward_ref"),N=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),R=Symbol.for("react.memo"),_=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var F=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=F&&e[F]||e["@@iterator"])?e:null}var L,M=Object.assign;function P(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var z=!1;function B(e,t){if(!e||z)return"";z=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var u="\n"+a[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{z=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?P(e):""}function U(e){switch(e.tag){case 5:return P(e.type);case 16:return P("Lazy");case 13:return P("Suspense");case 19:return P("SuspenseList");case 0:case 2:case 15:return e=B(e.type,!1);case 11:return e=B(e.type.render,!1);case 1:return e=B(e.type,!0);default:return""}}function W(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case w:return"Fragment";case x:return"Portal";case S:return"Profiler";case I:return"StrictMode";case N:return"Suspense";case A:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case E:return(e.displayName||"Context")+".Consumer";case C:return(e._context.displayName||"Context")+".Provider";case T:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case R:return null!==(t=e.displayName||null)?t:W(e.type)||"Memo";case _:t=e._payload,e=e._init;try{return W(e(t))}catch(n){}}return null}function j(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W(t);case 8:return t===I?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function Z(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function G(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function H(e){e._valueTracker||(e._valueTracker=function(e){var t=G(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function q(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=G(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function X(e,t){var n=t.checked;return M({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=Z(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Y(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Y(e,t);var n=Z(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,Z(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+Z(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return M({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:Z(n)}}function ie(e,t){var n=Z(t.value),r=Z(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,le,he=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function fe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var de={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ve(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||de.hasOwnProperty(e)&&de[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=ve(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(de).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),de[t]=de[e]}))}));var ge=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ke=null;function Ve(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var xe=null,we=null,Ie=null;function Se(e){if(e=ba(e)){if("function"!==typeof xe)throw Error(i(280));var t=e.stateNode;t&&(t=Va(t),xe(e.stateNode,e.type,t))}}function Ce(e){we?Ie?Ie.push(e):Ie=[e]:we=e}function Ee(){if(we){var e=we,t=Ie;if(Ie=we=null,Se(e),t)for(e=0;e<t.length;e++)Se(t[e])}}function Te(e,t){return e(t)}function Ne(){}var Ae=!1;function Re(e,t,n){if(Ae)return e(t,n);Ae=!0;try{return Te(e,t,n)}finally{Ae=!1,(null!==we||null!==Ie)&&(Ne(),Ee())}}function _e(e,t){var n=e.stateNode;if(null===n)return null;var r=Va(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var De=!1;if(l)try{var Fe={};Object.defineProperty(Fe,"passive",{get:function(){De=!0}}),window.addEventListener("test",Fe,Fe),window.removeEventListener("test",Fe,Fe)}catch(le){De=!1}function Oe(e,t,n,r,a,i,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Le=!1,Me=null,Pe=!1,ze=null,Be={onError:function(e){Le=!0,Me=e}};function Ue(e,t,n,r,a,i,o,s,u){Le=!1,Me=null,Oe.apply(Be,arguments)}function We(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function je(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function Ze(e){if(We(e)!==e)throw Error(i(188))}function Ge(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=We(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(r=a.return)){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return Ze(a),e;if(o===r)return Ze(a),t;o=o.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,u=a.child;u;){if(u===n){s=!0,n=a,r=o;break}if(u===r){s=!0,r=a,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=a;break}if(u===r){s=!0,r=o,n=a;break}u=u.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var qe=a.unstable_scheduleCallback,Ke=a.unstable_cancelCallback,Xe=a.unstable_shouldYield,Qe=a.unstable_requestPaint,Ye=a.unstable_now,Je=a.unstable_getCurrentPriorityLevel,$e=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,it=null;var ot=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var ct=64,lt=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ft(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=ht(s):0!==(i&=o)&&(r=ht(i))}else 0!==(o=n&~a)?r=ht(o):0!==i&&(r=ht(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-ot(t)),r|=e[n],t&=~a;return r}function dt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var bt=0;function kt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Vt,xt,wt,It,St,Ct=!1,Et=[],Tt=null,Nt=null,At=null,Rt=new Map,_t=new Map,Dt=[],Ft="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":Tt=null;break;case"dragenter":case"dragleave":Nt=null;break;case"mouseover":case"mouseout":At=null;break;case"pointerover":case"pointerout":Rt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":_t.delete(t.pointerId)}}function Lt(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=ba(t))&&xt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Mt(e){var t=ya(e.target);if(null!==t){var n=We(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=je(n)))return e.blockedOn=t,void St(e.priority,(function(){wt(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function Pt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Xt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ba(n))&&xt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);ke=r,n.target.dispatchEvent(r),ke=null,t.shift()}return!0}function zt(e,t,n){Pt(e)&&n.delete(t)}function Bt(){Ct=!1,null!==Tt&&Pt(Tt)&&(Tt=null),null!==Nt&&Pt(Nt)&&(Nt=null),null!==At&&Pt(At)&&(At=null),Rt.forEach(zt),_t.forEach(zt)}function Ut(e,t){e.blockedOn===t&&(e.blockedOn=null,Ct||(Ct=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Bt)))}function Wt(e){function t(t){return Ut(t,e)}if(0<Et.length){Ut(Et[0],e);for(var n=1;n<Et.length;n++){var r=Et[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==Tt&&Ut(Tt,e),null!==Nt&&Ut(Nt,e),null!==At&&Ut(At,e),Rt.forEach(t),_t.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Mt(n),null===n.blockedOn&&Dt.shift()}var jt=k.ReactCurrentBatchConfig,Zt=!0;function Gt(e,t,n,r){var a=bt,i=jt.transition;jt.transition=null;try{bt=1,qt(e,t,n,r)}finally{bt=a,jt.transition=i}}function Ht(e,t,n,r){var a=bt,i=jt.transition;jt.transition=null;try{bt=4,qt(e,t,n,r)}finally{bt=a,jt.transition=i}}function qt(e,t,n,r){if(Zt){var a=Xt(e,t,n,r);if(null===a)Zr(e,t,r,Kt,n),Ot(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return Tt=Lt(Tt,e,t,n,r,a),!0;case"dragenter":return Nt=Lt(Nt,e,t,n,r,a),!0;case"mouseover":return At=Lt(At,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Rt.set(i,Lt(Rt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,_t.set(i,Lt(_t.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Ft.indexOf(e)){for(;null!==a;){var i=ba(a);if(null!==i&&Vt(i),null===(i=Xt(e,t,n,r))&&Zr(e,t,r,Kt,n),i===a)break;a=i}null!==a&&r.stopPropagation()}else Zr(e,t,r,null,n)}}var Kt=null;function Xt(e,t,n,r){if(Kt=null,null!==(e=ya(e=Ve(r))))if(null===(t=We(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=je(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Yt=null,Jt=null,$t=null;function en(){if($t)return $t;var e,t,n=Jt,r=n.length,a="value"in Yt?Yt.value:Yt.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return $t=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,i){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return M(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=an(cn),hn=M({},cn,{view:0,detail:0}),fn=an(hn),dn=M({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(on=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=on=0,un=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=an(dn),vn=an(M({},dn,{dataTransfer:0})),mn=an(M({},hn,{relatedTarget:0})),gn=an(M({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=M({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=an(yn),kn=an(M({},cn,{data:0})),Vn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},xn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},wn={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function In(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=wn[e])&&!!t[e]}function Sn(){return In}var Cn=M({},hn,{key:function(e){if(e.key){var t=Vn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?xn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),En=an(Cn),Tn=an(M({},dn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),Nn=an(M({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sn})),An=an(M({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Rn=M({},dn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),_n=an(Rn),Dn=[9,13,27,32],Fn=l&&"CompositionEvent"in window,On=null;l&&"documentMode"in document&&(On=document.documentMode);var Ln=l&&"TextEvent"in window&&!On,Mn=l&&(!Fn||On&&8<On&&11>=On),Pn=String.fromCharCode(32),zn=!1;function Bn(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Un(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Wn=!1;var jn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!jn[e.type]:"textarea"===t}function Gn(e,t,n,r){Ce(r),0<(t=Hr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Hn=null,qn=null;function Kn(e){Pr(e,0)}function Xn(e){if(q(ka(e)))return e}function Qn(e,t){if("change"===e)return t}var Yn=!1;if(l){var Jn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Jn=$n}else Jn=!1;Yn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Hn&&(Hn.detachEvent("onpropertychange",nr),qn=Hn=null)}function nr(e){if("value"===e.propertyName&&Xn(qn)){var t=[];Gn(t,qn,e,Ve(e)),Re(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),qn=n,(Hn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Xn(qn)}function ir(e,t){if("click"===e)return Xn(t)}function or(e,t){if("input"===e||"change"===e)return Xn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!h.call(t,a)||!sr(e[a],t[a]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function fr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function dr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=fr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&dr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=void 0===r.end?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=lr(n,i);var o=lr(n,r);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vr=l&&"documentMode"in document&&11>=document.documentMode,mr=null,gr=null,yr=null,br=!1;function kr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==mr||mr!==K(r)||("selectionStart"in(r=mr)&&dr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=Hr(gr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function Vr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var xr={animationend:Vr("Animation","AnimationEnd"),animationiteration:Vr("Animation","AnimationIteration"),animationstart:Vr("Animation","AnimationStart"),transitionend:Vr("Transition","TransitionEnd")},wr={},Ir={};function Sr(e){if(wr[e])return wr[e];if(!xr[e])return e;var t,n=xr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Ir)return wr[e]=n[t];return e}l&&(Ir=document.createElement("div").style,"AnimationEvent"in window||(delete xr.animationend.animation,delete xr.animationiteration.animation,delete xr.animationstart.animation),"TransitionEvent"in window||delete xr.transitionend.transition);var Cr=Sr("animationend"),Er=Sr("animationiteration"),Tr=Sr("animationstart"),Nr=Sr("transitionend"),Ar=new Map,Rr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function _r(e,t){Ar.set(e,t),u(t,[e])}for(var Dr=0;Dr<Rr.length;Dr++){var Fr=Rr[Dr];_r(Fr.toLowerCase(),"on"+(Fr[0].toUpperCase()+Fr.slice(1)))}_r(Cr,"onAnimationEnd"),_r(Er,"onAnimationIteration"),_r(Tr,"onAnimationStart"),_r("dblclick","onDoubleClick"),_r("focusin","onFocus"),_r("focusout","onBlur"),_r(Nr,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function Mr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,o,s,u,c){if(Ue.apply(this,arguments),Le){if(!Le)throw Error(i(198));var l=Me;Le=!1,Me=null,Pe||(Pe=!0,ze=l)}}(r,t,void 0,e),e.currentTarget=null}function Pr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==i&&a.isPropagationStopped())break e;Mr(a,s,c),i=u}else for(o=0;o<r.length;o++){if(u=(s=r[o]).instance,c=s.currentTarget,s=s.listener,u!==i&&a.isPropagationStopped())break e;Mr(a,s,c),i=u}}}if(Pe)throw e=ze,Pe=!1,ze=null,e}function zr(e,t){var n=t[va];void 0===n&&(n=t[va]=new Set);var r=e+"__bubble";n.has(r)||(jr(t,e,2,!1),n.add(r))}function Br(e,t,n){var r=0;t&&(r|=4),jr(n,e,r,t)}var Ur="_reactListening"+Math.random().toString(36).slice(2);function Wr(e){if(!e[Ur]){e[Ur]=!0,o.forEach((function(t){"selectionchange"!==t&&(Lr.has(t)||Br(t,!1,e),Br(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Ur]||(t[Ur]=!0,Br("selectionchange",!1,t))}}function jr(e,t,n,r){switch(Qt(t)){case 1:var a=Gt;break;case 4:a=Ht;break;default:a=qt}n=a.bind(null,t,n,e),a=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function Zr(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=r.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===a||8===u.nodeType&&u.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=ya(s)))return;if(5===(u=o.tag)||6===u){r=i=o;continue e}s=s.parentNode}}r=r.return}Re((function(){var r=i,a=Ve(n),o=[];e:{var s=Ar.get(e);if(void 0!==s){var u=ln,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=En;break;case"focusin":c="focus",u=mn;break;case"focusout":c="blur",u=mn;break;case"beforeblur":case"afterblur":u=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=vn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=Nn;break;case Cr:case Er:case Tr:u=gn;break;case Nr:u=An;break;case"scroll":u=fn;break;case"wheel":u=_n;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=Tn}var l=0!==(4&t),h=!l&&"scroll"===e,f=l?null!==s?s+"Capture":null:s;l=[];for(var d,p=r;null!==p;){var v=(d=p).stateNode;if(5===d.tag&&null!==v&&(d=v,null!==f&&(null!=(v=_e(p,f))&&l.push(Gr(p,v,d)))),h)break;p=p.return}0<l.length&&(s=new u(s,c,null,n,a),o.push({event:s,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===ke||!(c=n.relatedTarget||n.fromElement)||!ya(c)&&!c[pa])&&(u||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?ya(c):null)&&(c!==(h=We(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=pn,v="onMouseLeave",f="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(l=Tn,v="onPointerLeave",f="onPointerEnter",p="pointer"),h=null==u?s:ka(u),d=null==c?s:ka(c),(s=new l(v,p+"leave",u,n,a)).target=h,s.relatedTarget=d,v=null,ya(a)===r&&((l=new l(f,p+"enter",c,n,a)).target=d,l.relatedTarget=h,v=l),h=v,u&&c)e:{for(f=c,p=0,d=l=u;d;d=qr(d))p++;for(d=0,v=f;v;v=qr(v))d++;for(;0<p-d;)l=qr(l),p--;for(;0<d-p;)f=qr(f),d--;for(;p--;){if(l===f||null!==f&&l===f.alternate)break e;l=qr(l),f=qr(f)}l=null}else l=null;null!==u&&Kr(o,s,u,l,!1),null!==c&&null!==h&&Kr(o,h,c,l,!0)}if("select"===(u=(s=r?ka(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var m=Qn;else if(Zn(s))if(Yn)m=or;else{m=ar;var g=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ir);switch(m&&(m=m(e,r))?Gn(o,m,n,a):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?ka(r):window,e){case"focusin":(Zn(g)||"true"===g.contentEditable)&&(mr=g,gr=r,yr=null);break;case"focusout":yr=gr=mr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,kr(o,n,a);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":kr(o,n,a)}var y;if(Fn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Wn?Bn(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Mn&&"ko"!==n.locale&&(Wn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Wn&&(y=en()):(Jt="value"in(Yt=a)?Yt.value:Yt.textContent,Wn=!0)),0<(g=Hr(r,b)).length&&(b=new kn(b,e,null,n,a),o.push({event:b,listeners:g}),y?b.data=y:null!==(y=Un(n))&&(b.data=y))),(y=Ln?function(e,t){switch(e){case"compositionend":return Un(t);case"keypress":return 32!==t.which?null:(zn=!0,Pn);case"textInput":return(e=t.data)===Pn&&zn?null:e;default:return null}}(e,n):function(e,t){if(Wn)return"compositionend"===e||!Fn&&Bn(e,t)?(e=en(),$t=Jt=Yt=null,Wn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Mn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Hr(r,"onBeforeInput")).length&&(a=new kn("onBeforeInput","beforeinput",null,n,a),o.push({event:a,listeners:r}),a.data=y))}Pr(o,t)}))}function Gr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=_e(e,n))&&r.unshift(Gr(e,i,a)),null!=(i=_e(e,t))&&r.push(Gr(e,i,a))),e=e.return}return r}function qr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,a){for(var i=t._reactName,o=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,a?null!=(u=_e(n,i))&&o.unshift(Gr(n,u,s)):a||null!=(u=_e(n,i))&&o.push(Gr(n,u,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Xr=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Yr(e){return("string"===typeof e?e:""+e).replace(Xr,"\n").replace(Qr,"")}function Jr(e,t,n){if(t=Yr(t),Yr(e)!==t&&n)throw Error(i(425))}function $r(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,ia="function"===typeof Promise?Promise:void 0,oa="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ia?function(e){return ia.resolve(null).then(e).catch(sa)}:ra;function sa(e){setTimeout((function(){throw e}))}function ua(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void Wt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);Wt(t)}function ca(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function la(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ha=Math.random().toString(36).slice(2),fa="__reactFiber$"+ha,da="__reactProps$"+ha,pa="__reactContainer$"+ha,va="__reactEvents$"+ha,ma="__reactListeners$"+ha,ga="__reactHandles$"+ha;function ya(e){var t=e[fa];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pa]||n[fa]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=la(e);null!==e;){if(n=e[fa])return n;e=la(e)}return t}n=(e=n).parentNode}return null}function ba(e){return!(e=e[fa]||e[pa])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function ka(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function Va(e){return e[da]||null}var xa=[],wa=-1;function Ia(e){return{current:e}}function Sa(e){0>wa||(e.current=xa[wa],xa[wa]=null,wa--)}function Ca(e,t){wa++,xa[wa]=e.current,e.current=t}var Ea={},Ta=Ia(Ea),Na=Ia(!1),Aa=Ea;function Ra(e,t){var n=e.type.contextTypes;if(!n)return Ea;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function _a(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Da(){Sa(Na),Sa(Ta)}function Fa(e,t,n){if(Ta.current!==Ea)throw Error(i(168));Ca(Ta,t),Ca(Na,n)}function Oa(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,j(e)||"Unknown",a));return M({},n,r)}function La(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ea,Aa=Ta.current,Ca(Ta,e),Ca(Na,Na.current),!0}function Ma(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Oa(e,t,Aa),r.__reactInternalMemoizedMergedChildContext=e,Sa(Na),Sa(Ta),Ca(Ta,e)):Sa(Na),Ca(Na,n)}var Pa=null,za=!1,Ba=!1;function Ua(e){null===Pa?Pa=[e]:Pa.push(e)}function Wa(){if(!Ba&&null!==Pa){Ba=!0;var e=0,t=bt;try{var n=Pa;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Pa=null,za=!1}catch(a){throw null!==Pa&&(Pa=Pa.slice(e+1)),qe($e,Wa),a}finally{bt=t,Ba=!1}}return null}var ja=[],Za=0,Ga=null,Ha=0,qa=[],Ka=0,Xa=null,Qa=1,Ya="";function Ja(e,t){ja[Za++]=Ha,ja[Za++]=Ga,Ga=e,Ha=t}function $a(e,t,n){qa[Ka++]=Qa,qa[Ka++]=Ya,qa[Ka++]=Xa,Xa=e;var r=Qa;e=Ya;var a=32-ot(r)-1;r&=~(1<<a),n+=1;var i=32-ot(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Qa=1<<32-ot(t)+a|n<<a|r,Ya=i+e}else Qa=1<<i|n<<a|r,Ya=e}function ei(e){null!==e.return&&(Ja(e,1),$a(e,1,0))}function ti(e){for(;e===Ga;)Ga=ja[--Za],ja[Za]=null,Ha=ja[--Za],ja[Za]=null;for(;e===Xa;)Xa=qa[--Ka],qa[Ka]=null,Ya=qa[--Ka],qa[Ka]=null,Qa=qa[--Ka],qa[Ka]=null}var ni=null,ri=null,ai=!1,ii=null;function oi(e,t){var n=Rc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function si(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=ca(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Xa?{id:Qa,overflow:Ya}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Rc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function ui(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ci(e){if(ai){var t=ri;if(t){var n=t;if(!si(e,t)){if(ui(e))throw Error(i(418));t=ca(n.nextSibling);var r=ni;t&&si(e,t)?oi(r,n):(e.flags=-4097&e.flags|2,ai=!1,ni=e)}}else{if(ui(e))throw Error(i(418));e.flags=-4097&e.flags|2,ai=!1,ni=e}}}function li(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function hi(e){if(e!==ni)return!1;if(!ai)return li(e),ai=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=ri)){if(ui(e))throw fi(),Error(i(418));for(;t;)oi(e,t),t=ca(t.nextSibling)}if(li(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=ca(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?ca(e.stateNode.nextSibling):null;return!0}function fi(){for(var e=ri;e;)e=ca(e.nextSibling)}function di(){ri=ni=null,ai=!1}function pi(e){null===ii?ii=[e]:ii.push(e)}var vi=k.ReactCurrentBatchConfig;function mi(e,t){if(e&&e.defaultProps){for(var n in t=M({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var gi=Ia(null),yi=null,bi=null,ki=null;function Vi(){ki=bi=yi=null}function xi(e){var t=gi.current;Sa(gi),e._currentValue=t}function wi(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Ii(e,t){yi=e,ki=bi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(ks=!0),e.firstContext=null)}function Si(e){var t=e._currentValue;if(ki!==e)if(e={context:e,memoizedValue:t,next:null},null===bi){if(null===yi)throw Error(i(308));bi=e,yi.dependencies={lanes:0,firstContext:e}}else bi=bi.next=e;return t}var Ci=null;function Ei(e){null===Ci?Ci=[e]:Ci.push(e)}function Ti(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Ei(t)):(n.next=a.next,a.next=n),t.interleaved=n,Ni(e,r)}function Ni(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Ai=!1;function Ri(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function _i(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Di(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Fi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Tu)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Ni(e,n)}return null===(a=r.interleaved)?(t.next=t,Ei(r)):(t.next=a.next,a.next=t),r.interleaved=t,Ni(e,n)}function Oi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Li(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Mi(e,t,n,r){var a=e.updateQueue;Ai=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(null!==s){a.shared.pending=null;var u=s,c=u.next;u.next=null,null===o?i=c:o.next=c,o=u;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==o&&(null===s?l.firstBaseUpdate=c:s.next=c,l.lastBaseUpdate=u))}if(null!==i){var h=a.baseState;for(o=0,l=c=u=null,s=i;;){var f=s.lane,d=s.eventTime;if((r&f)===f){null!==l&&(l=l.next={eventTime:d,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,v=s;switch(f=t,d=n,v.tag){case 1:if("function"===typeof(p=v.payload)){h=p.call(d,h,f);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(f="function"===typeof(p=v.payload)?p.call(d,h,f):p)||void 0===f)break e;h=M({},h,f);break e;case 2:Ai=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(f=a.effects)?a.effects=[s]:f.push(s))}else d={eventTime:d,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(c=l=d,u=h):l=l.next=d,o|=f;if(null===(s=s.next)){if(null===(s=a.shared.pending))break;s=(f=s).next,f.next=null,a.lastBaseUpdate=f,a.shared.pending=null}}if(null===l&&(u=h),a.baseState=u,a.firstBaseUpdate=c,a.lastBaseUpdate=l,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===i&&(a.shared.lanes=0);Lu|=o,e.lanes=o,e.memoizedState=h}}function Pi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(i(191,a));a.call(r)}}}var zi=(new r.Component).refs;function Bi(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:M({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Ui={isMounted:function(e){return!!(e=e._reactInternals)&&We(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),a=tc(e),i=Di(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Fi(e,i,a))&&(nc(t,e,a,r),Oi(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),a=tc(e),i=Di(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Fi(e,i,a))&&(nc(t,e,a,r),Oi(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),a=Di(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Fi(e,a,r))&&(nc(t,e,r,n),Oi(t,e,r))}};function Wi(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(a,i))}function ji(e,t,n){var r=!1,a=Ea,i=t.contextType;return"object"===typeof i&&null!==i?i=Si(i):(a=_a(t)?Aa:Ta.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Ra(e,a):Ea),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Ui,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function Zi(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Ui.enqueueReplaceState(t,t.state,null)}function Gi(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=zi,Ri(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=Si(i):(i=_a(t)?Aa:Ta.current,a.context=Ra(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(Bi(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Ui.enqueueReplaceState(a,a.state,null),Mi(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function Hi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var a=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;t===zi&&(t=a.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function qi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ki(e){return(0,e._init)(e._payload)}function Xi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Dc(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Mc(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===w?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===_&&Ki(i)===t.type)?((r=a(t,n.props)).ref=Hi(e,t,n),r.return=e,r):((r=Fc(n.type,n.key,n.props,null,e.mode,r)).ref=Hi(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=Pc(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function h(e,t,n,r,i){return null===t||7!==t.tag?((t=Oc(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Mc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case V:return(n=Fc(t.type,t.key,t.props,null,e.mode,n)).ref=Hi(e,null,t),n.return=e,n;case x:return(t=Pc(t,e.mode,n)).return=e,t;case _:return f(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Oc(t,e.mode,n,null)).return=e,t;qi(e,t)}return null}function d(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case V:return n.key===a?c(e,t,n,r):null;case x:return n.key===a?l(e,t,n,r):null;case _:return d(e,t,(a=n._init)(n._payload),r)}if(te(n)||O(n))return null!==a?null:h(e,t,n,r,null);qi(e,n)}return null}function p(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case V:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case x:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a);case _:return p(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||O(r))return h(t,e=e.get(n)||null,r,a,null);qi(t,r)}return null}function v(a,i,s,u){for(var c=null,l=null,h=i,v=i=0,m=null;null!==h&&v<s.length;v++){h.index>v?(m=h,h=null):m=h.sibling;var g=d(a,h,s[v],u);if(null===g){null===h&&(h=m);break}e&&h&&null===g.alternate&&t(a,h),i=o(g,i,v),null===l?c=g:l.sibling=g,l=g,h=m}if(v===s.length)return n(a,h),ai&&Ja(a,v),c;if(null===h){for(;v<s.length;v++)null!==(h=f(a,s[v],u))&&(i=o(h,i,v),null===l?c=h:l.sibling=h,l=h);return ai&&Ja(a,v),c}for(h=r(a,h);v<s.length;v++)null!==(m=p(h,a,v,s[v],u))&&(e&&null!==m.alternate&&h.delete(null===m.key?v:m.key),i=o(m,i,v),null===l?c=m:l.sibling=m,l=m);return e&&h.forEach((function(e){return t(a,e)})),ai&&Ja(a,v),c}function m(a,s,u,c){var l=O(u);if("function"!==typeof l)throw Error(i(150));if(null==(u=l.call(u)))throw Error(i(151));for(var h=l=null,v=s,m=s=0,g=null,y=u.next();null!==v&&!y.done;m++,y=u.next()){v.index>m?(g=v,v=null):g=v.sibling;var b=d(a,v,y.value,c);if(null===b){null===v&&(v=g);break}e&&v&&null===b.alternate&&t(a,v),s=o(b,s,m),null===h?l=b:h.sibling=b,h=b,v=g}if(y.done)return n(a,v),ai&&Ja(a,m),l;if(null===v){for(;!y.done;m++,y=u.next())null!==(y=f(a,y.value,c))&&(s=o(y,s,m),null===h?l=y:h.sibling=y,h=y);return ai&&Ja(a,m),l}for(v=r(a,v);!y.done;m++,y=u.next())null!==(y=p(v,a,m,y.value,c))&&(e&&null!==y.alternate&&v.delete(null===y.key?m:y.key),s=o(y,s,m),null===h?l=y:h.sibling=y,h=y);return e&&v.forEach((function(e){return t(a,e)})),ai&&Ja(a,m),l}return function e(r,i,o,u){if("object"===typeof o&&null!==o&&o.type===w&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case V:e:{for(var c=o.key,l=i;null!==l;){if(l.key===c){if((c=o.type)===w){if(7===l.tag){n(r,l.sibling),(i=a(l,o.props.children)).return=r,r=i;break e}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===_&&Ki(c)===l.type){n(r,l.sibling),(i=a(l,o.props)).ref=Hi(r,l,o),i.return=r,r=i;break e}n(r,l);break}t(r,l),l=l.sibling}o.type===w?((i=Oc(o.props.children,r.mode,u,o.key)).return=r,r=i):((u=Fc(o.type,o.key,o.props,null,r.mode,u)).ref=Hi(r,i,o),u.return=r,r=u)}return s(r);case x:e:{for(l=o.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=Pc(o,r.mode,u)).return=r,r=i}return s(r);case _:return e(r,i,(l=o._init)(o._payload),u)}if(te(o))return v(r,i,o,u);if(O(o))return m(r,i,o,u);qi(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=Mc(o,r.mode,u)).return=r,r=i),s(r)):n(r,i)}}var Qi=Xi(!0),Yi=Xi(!1),Ji={},$i=Ia(Ji),eo=Ia(Ji),to=Ia(Ji);function no(e){if(e===Ji)throw Error(i(174));return e}function ro(e,t){switch(Ca(to,t),Ca(eo,e),Ca($i,Ji),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Sa($i),Ca($i,t)}function ao(){Sa($i),Sa(eo),Sa(to)}function io(e){no(to.current);var t=no($i.current),n=ue(t,e.type);t!==n&&(Ca(eo,e),Ca($i,n))}function oo(e){eo.current===e&&(Sa($i),Sa(eo))}var so=Ia(0);function uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var co=[];function lo(){for(var e=0;e<co.length;e++)co[e]._workInProgressVersionPrimary=null;co.length=0}var ho=k.ReactCurrentDispatcher,fo=k.ReactCurrentBatchConfig,po=0,vo=null,mo=null,go=null,yo=!1,bo=!1,ko=0,Vo=0;function xo(){throw Error(i(321))}function wo(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function Io(e,t,n,r,a,o){if(po=o,vo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?ss:us,e=n(r,a),bo){o=0;do{if(bo=!1,ko=0,25<=o)throw Error(i(301));o+=1,go=mo=null,t.updateQueue=null,ho.current=cs,e=n(r,a)}while(bo)}if(ho.current=os,t=null!==mo&&null!==mo.next,po=0,go=mo=vo=null,yo=!1,t)throw Error(i(300));return e}function So(){var e=0!==ko;return ko=0,e}function Co(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?vo.memoizedState=go=e:go=go.next=e,go}function Eo(){if(null===mo){var e=vo.alternate;e=null!==e?e.memoizedState:null}else e=mo.next;var t=null===go?vo.memoizedState:go.next;if(null!==t)go=t,mo=e;else{if(null===e)throw Error(i(310));e={memoizedState:(mo=e).memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},null===go?vo.memoizedState=go=e:go=go.next=e}return go}function To(e,t){return"function"===typeof t?t(e):t}function No(e){var t=Eo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=mo,a=r.baseQueue,o=n.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(null!==a){o=a.next,r=r.baseState;var u=s=null,c=null,l=o;do{var h=l.lane;if((po&h)===h)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var f={lane:h,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=f,s=r):c=c.next=f,vo.lanes|=h,Lu|=h}l=l.next}while(null!==l&&l!==o);null===c?s=r:c.next=u,sr(r,t.memoizedState)||(ks=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{o=a.lane,vo.lanes|=o,Lu|=o,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Ao(e){var t=Eo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);sr(o,t.memoizedState)||(ks=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function Ro(){}function _o(e,t){var n=vo,r=Eo(),a=t(),o=!sr(r.memoizedState,a);if(o&&(r.memoizedState=a,ks=!0),r=r.queue,Zo(Oo.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,zo(9,Fo.bind(null,n,r,a,t),void 0,null),null===Nu)throw Error(i(349));0!==(30&po)||Do(n,t,a)}return a}function Do(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Fo(e,t,n,r){t.value=n,t.getSnapshot=r,Lo(t)&&Mo(e)}function Oo(e,t,n){return n((function(){Lo(t)&&Mo(e)}))}function Lo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Mo(e){var t=Ni(e,1);null!==t&&nc(t,e,1,-1)}function Po(e){var t=Co();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:To,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,vo,e),[t.memoizedState,e]}function zo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Bo(){return Eo().memoizedState}function Uo(e,t,n,r){var a=Co();vo.flags|=e,a.memoizedState=zo(1|t,n,void 0,void 0===r?null:r)}function Wo(e,t,n,r){var a=Eo();r=void 0===r?null:r;var i=void 0;if(null!==mo){var o=mo.memoizedState;if(i=o.destroy,null!==r&&wo(r,o.deps))return void(a.memoizedState=zo(t,n,i,r))}vo.flags|=e,a.memoizedState=zo(1|t,n,i,r)}function jo(e,t){return Uo(8390656,8,e,t)}function Zo(e,t){return Wo(2048,8,e,t)}function Go(e,t){return Wo(4,2,e,t)}function Ho(e,t){return Wo(4,4,e,t)}function qo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ko(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Wo(4,4,qo.bind(null,t,e),n)}function Xo(){}function Qo(e,t){var n=Eo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&wo(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Yo(e,t){var n=Eo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&wo(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Jo(e,t,n){return 0===(21&po)?(e.baseState&&(e.baseState=!1,ks=!0),e.memoizedState=n):(sr(n,t)||(n=vt(),vo.lanes|=n,Lu|=n,e.baseState=!0),t)}function $o(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=fo.transition;fo.transition={};try{e(!1),t()}finally{bt=n,fo.transition=r}}function es(){return Eo().memoizedState}function ts(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))as(t,n);else if(null!==(n=Ti(e,t,n,r))){nc(n,e,r,ec()),is(n,t,r)}}function ns(e,t,n){var r=tc(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))as(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,sr(s,o)){var u=t.interleaved;return null===u?(a.next=a,Ei(t)):(a.next=u.next,u.next=a),void(t.interleaved=a)}}catch(c){}null!==(n=Ti(e,t,a,r))&&(nc(n,e,r,a=ec()),is(n,t,r))}}function rs(e){var t=e.alternate;return e===vo||null!==t&&t===vo}function as(e,t){bo=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function is(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var os={readContext:Si,useCallback:xo,useContext:xo,useEffect:xo,useImperativeHandle:xo,useInsertionEffect:xo,useLayoutEffect:xo,useMemo:xo,useReducer:xo,useRef:xo,useState:xo,useDebugValue:xo,useDeferredValue:xo,useTransition:xo,useMutableSource:xo,useSyncExternalStore:xo,useId:xo,unstable_isNewReconciler:!1},ss={readContext:Si,useCallback:function(e,t){return Co().memoizedState=[e,void 0===t?null:t],e},useContext:Si,useEffect:jo,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Uo(4194308,4,qo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Uo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Uo(4,2,e,t)},useMemo:function(e,t){var n=Co();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Co();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,vo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Co().memoizedState=e},useState:Po,useDebugValue:Xo,useDeferredValue:function(e){return Co().memoizedState=e},useTransition:function(){var e=Po(!1),t=e[0];return e=$o.bind(null,e[1]),Co().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=vo,a=Co();if(ai){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Nu)throw Error(i(349));0!==(30&po)||Do(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,jo(Oo.bind(null,r,o,e),[e]),r.flags|=2048,zo(9,Fo.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=Co(),t=Nu.identifierPrefix;if(ai){var n=Ya;t=":"+t+"R"+(n=(Qa&~(1<<32-ot(Qa)-1)).toString(32)+n),0<(n=ko++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Vo++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},us={readContext:Si,useCallback:Qo,useContext:Si,useEffect:Zo,useImperativeHandle:Ko,useInsertionEffect:Go,useLayoutEffect:Ho,useMemo:Yo,useReducer:No,useRef:Bo,useState:function(){return No(To)},useDebugValue:Xo,useDeferredValue:function(e){return Jo(Eo(),mo.memoizedState,e)},useTransition:function(){return[No(To)[0],Eo().memoizedState]},useMutableSource:Ro,useSyncExternalStore:_o,useId:es,unstable_isNewReconciler:!1},cs={readContext:Si,useCallback:Qo,useContext:Si,useEffect:Zo,useImperativeHandle:Ko,useInsertionEffect:Go,useLayoutEffect:Ho,useMemo:Yo,useReducer:Ao,useRef:Bo,useState:function(){return Ao(To)},useDebugValue:Xo,useDeferredValue:function(e){var t=Eo();return null===mo?t.memoizedState=e:Jo(t,mo.memoizedState,e)},useTransition:function(){return[Ao(To)[0],Eo().memoizedState]},useMutableSource:Ro,useSyncExternalStore:_o,useId:es,unstable_isNewReconciler:!1};function ls(e,t){try{var n="",r=t;do{n+=U(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a,digest:null}}function hs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function fs(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ds="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=Di(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){Zu||(Zu=!0,Gu=r),fs(0,t)},n}function vs(e,t,n){(n=Di(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){fs(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){fs(0,t),"function"!==typeof r&&(null===Hu?Hu=new Set([this]):Hu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ds;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Sc.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Di(-1,1)).tag=2,Fi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bs=k.ReactCurrentOwner,ks=!1;function Vs(e,t,n,r){t.child=null===e?Yi(t,null,n,r):Qi(t,e.child,n,r)}function xs(e,t,n,r,a){n=n.render;var i=t.ref;return Ii(t,a),r=Io(e,t,n,r,i,a),n=So(),null===e||ks?(ai&&n&&ei(t),t.flags|=1,Vs(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Zs(e,t,a))}function ws(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||_c(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Fc(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Is(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(o,r)&&e.ref===t.ref)return Zs(e,t,a)}return t.flags|=1,(e=Dc(i,r)).ref=t.ref,e.return=t,t.child=e}function Is(e,t,n,r,a){if(null!==e){var i=e.memoizedProps;if(ur(i,r)&&e.ref===t.ref){if(ks=!1,t.pendingProps=r=i,0===(e.lanes&a))return t.lanes=e.lanes,Zs(e,t,a);0!==(131072&e.flags)&&(ks=!0)}}return Es(e,t,n,r,a)}function Ss(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ca(Du,_u),_u|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ca(Du,_u),_u|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Ca(Du,_u),_u|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Ca(Du,_u),_u|=r;return Vs(e,t,a,n),t.child}function Cs(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Es(e,t,n,r,a){var i=_a(n)?Aa:Ta.current;return i=Ra(t,i),Ii(t,a),n=Io(e,t,n,r,i,a),r=So(),null===e||ks?(ai&&r&&ei(t),t.flags|=1,Vs(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,Zs(e,t,a))}function Ts(e,t,n,r,a){if(_a(n)){var i=!0;La(t)}else i=!1;if(Ii(t,a),null===t.stateNode)js(e,t),ji(t,n,r),Gi(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=Si(c):c=Ra(t,c=_a(n)?Aa:Ta.current);var l=n.getDerivedStateFromProps,h="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&Zi(t,o,r,c),Ai=!1;var f=t.memoizedState;o.state=f,Mi(t,r,o,a),u=t.memoizedState,s!==r||f!==u||Na.current||Ai?("function"===typeof l&&(Bi(t,n,l,r),u=t.memoizedState),(s=Ai||Wi(t,n,s,r,f,u,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,_i(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:mi(t.type,s),o.props=c,h=t.pendingProps,f=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=Si(u):u=Ra(t,u=_a(n)?Aa:Ta.current);var d=n.getDerivedStateFromProps;(l="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||f!==u)&&Zi(t,o,r,u),Ai=!1,f=t.memoizedState,o.state=f,Mi(t,r,o,a);var p=t.memoizedState;s!==h||f!==p||Na.current||Ai?("function"===typeof d&&(Bi(t,n,d,r),p=t.memoizedState),(c=Ai||Wi(t,n,c,r,f,p,u)||!1)?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=u,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return Ns(e,t,n,r,i,a)}function Ns(e,t,n,r,a,i){Cs(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&Ma(t,n,!1),Zs(e,t,i);r=t.stateNode,bs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Qi(t,e.child,null,i),t.child=Qi(t,null,s,i)):Vs(e,t,s,i),t.memoizedState=r.state,a&&Ma(t,n,!0),t.child}function As(e){var t=e.stateNode;t.pendingContext?Fa(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Fa(0,t.context,!1),ro(e,t.containerInfo)}function Rs(e,t,n,r,a){return di(),pi(a),t.flags|=256,Vs(e,t,n,r),t.child}var _s,Ds,Fs,Os={dehydrated:null,treeContext:null,retryLane:0};function Ls(e){return{baseLanes:e,cachePool:null,transitions:null}}function Ms(e,t,n){var r,a=t.pendingProps,o=so.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ca(so,1&o),null===e)return ci(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=a.children,e=a.fallback,s?(a=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Lc(u,a,0,null),e=Oc(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ls(n),t.memoizedState=Os,e):Ps(t,u));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,a,o,s){if(n)return 256&t.flags?(t.flags&=-257,zs(e,t,s,r=hs(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=Lc({mode:"visible",children:r.children},a,0,null),(o=Oc(o,a,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Qi(t,e.child,null,s),t.child.memoizedState=Ls(s),t.memoizedState=Os,o);if(0===(1&t.mode))return zs(e,t,s,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var u=r.dgst;return r=u,zs(e,t,s,r=hs(o=Error(i(419)),r,void 0))}if(u=0!==(s&e.childLanes),ks||u){if(null!==(r=Nu)){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|s))?0:a)&&a!==o.retryLane&&(o.retryLane=a,Ni(e,a),nc(r,e,a,-1))}return vc(),zs(e,t,s,r=hs(Error(i(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Ec.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,ri=ca(a.nextSibling),ni=t,ai=!0,ii=null,null!==e&&(qa[Ka++]=Qa,qa[Ka++]=Ya,qa[Ka++]=Xa,Qa=e.id,Ya=e.overflow,Xa=t),(t=Ps(t,r.children)).flags|=4096,t)}(e,t,u,a,r,o,n);if(s){s=a.fallback,u=t.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:a.children};return 0===(1&u)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null):(a=Dc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Dc(r,s):(s=Oc(s,u,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,u=null===(u=e.child.memoizedState)?Ls(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Os,a}return e=(s=e.child).sibling,a=Dc(s,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function Ps(e,t){return(t=Lc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function zs(e,t,n,r){return null!==r&&pi(r),Qi(t,e.child,null,n),(e=Ps(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Bs(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),wi(e.return,t,n)}function Us(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function Ws(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Vs(e,t,r.children,n),0!==(2&(r=so.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Bs(e,n,t);else if(19===e.tag)Bs(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ca(so,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===uo(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Us(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===uo(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Us(t,!0,n,null,i);break;case"together":Us(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function js(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Zs(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Lu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Dc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function Gs(e,t){if(!ai)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Hs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function qs(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hs(t),null;case 1:case 17:return _a(t.type)&&Da(),Hs(t),null;case 3:return r=t.stateNode,ao(),Sa(Na),Sa(Ta),lo(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(hi(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(oc(ii),ii=null))),Hs(t),null;case 5:oo(t);var a=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Ds(e,t,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Hs(t),null}if(e=no($i.current),hi(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[fa]=t,r[da]=o,e=0!==(1&t.mode),n){case"dialog":zr("cancel",r),zr("close",r);break;case"iframe":case"object":case"embed":zr("load",r);break;case"video":case"audio":for(a=0;a<Or.length;a++)zr(Or[a],r);break;case"source":zr("error",r);break;case"img":case"image":case"link":zr("error",r),zr("load",r);break;case"details":zr("toggle",r);break;case"input":Q(r,o),zr("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},zr("invalid",r);break;case"textarea":ae(r,o),zr("invalid",r)}for(var u in ye(n,o),a=null,o)if(o.hasOwnProperty(u)){var c=o[u];"children"===u?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),a=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),a=["children",""+c]):s.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&zr("scroll",r)}switch(n){case"input":H(r),$(r,o,!0);break;case"textarea":H(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=$r)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[fa]=t,e[da]=r,_s(e,t),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":zr("cancel",e),zr("close",e),a=r;break;case"iframe":case"object":case"embed":zr("load",e),a=r;break;case"video":case"audio":for(a=0;a<Or.length;a++)zr(Or[a],e);a=r;break;case"source":zr("error",e),a=r;break;case"img":case"image":case"link":zr("error",e),zr("load",e),a=r;break;case"details":zr("toggle",e),a=r;break;case"input":Q(e,r),a=X(e,r),zr("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=M({},r,{value:void 0}),zr("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),zr("invalid",e)}for(o in ye(n,a),c=a)if(c.hasOwnProperty(o)){var l=c[o];"style"===o?me(e,l):"dangerouslySetInnerHTML"===o?null!=(l=l?l.__html:void 0)&&he(e,l):"children"===o?"string"===typeof l?("textarea"!==n||""!==l)&&fe(e,l):"number"===typeof l&&fe(e,""+l):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=l&&"onScroll"===o&&zr("scroll",e):null!=l&&b(e,o,l,u))}switch(n){case"input":H(e),$(e,r,!1);break;case"textarea":H(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+Z(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Hs(t),null;case 6:if(e&&null!=t.stateNode)Fs(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=no(to.current),no($i.current),hi(t)){if(r=t.stateNode,n=t.memoizedProps,r[fa]=t,(o=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Jr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[fa]=t,t.stateNode=r}return Hs(t),null;case 13:if(Sa(so),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ai&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))fi(),di(),t.flags|=98560,o=!1;else if(o=hi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[fa]=t}else di(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Hs(t),o=!1}else null!==ii&&(oc(ii),ii=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Fu&&(Fu=3):vc())),null!==t.updateQueue&&(t.flags|=4),Hs(t),null);case 4:return ao(),null===e&&Wr(t.stateNode.containerInfo),Hs(t),null;case 10:return xi(t.type._context),Hs(t),null;case 19:if(Sa(so),null===(o=t.memoizedState))return Hs(t),null;if(r=0!==(128&t.flags),null===(u=o.rendering))if(r)Gs(o,!1);else{if(0!==Fu||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=uo(e))){for(t.flags|=128,Gs(o,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(u=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,e=u.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ca(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Ye()>Wu&&(t.flags|=128,r=!0,Gs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=uo(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),Gs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!u.alternate&&!ai)return Hs(t),null}else 2*Ye()-o.renderingStartTime>Wu&&1073741824!==n&&(t.flags|=128,r=!0,Gs(o,!1),t.lanes=4194304);o.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=o.last)?n.sibling=u:t.child=u,o.last=u)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Ye(),t.sibling=null,n=so.current,Ca(so,r?1&n|2:1&n),t):(Hs(t),null);case 22:case 23:return hc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&_u)&&(Hs(t),6&t.subtreeFlags&&(t.flags|=8192)):Hs(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Ks(e,t){switch(ti(t),t.tag){case 1:return _a(t.type)&&Da(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ao(),Sa(Na),Sa(Ta),lo(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Sa(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));di()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Sa(so),null;case 4:return ao(),null;case 10:return xi(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}_s=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,no($i.current);var i,o=null;switch(n){case"input":a=X(e,a),r=X(e,r),o=[];break;case"select":a=M({},a,{value:void 0}),r=M({},r,{value:void 0}),o=[];break;case"textarea":a=re(e,a),r=re(e,r),o=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in ye(n,r),n=null,a)if(!r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&null!=a[l])if("style"===l){var u=a[l];for(i in u)u.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var c=r[l];if(u=null!=a?a[l]:void 0,r.hasOwnProperty(l)&&c!==u&&(null!=c||null!=u))if("style"===l)if(u){for(i in u)!u.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&u[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(o||(o=[]),o.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(o=o||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&zr("scroll",e),o||u===c||(o=[])):(o=o||[]).push(l,c))}n&&(o=o||[]).push("style",n);var l=o;(t.updateQueue=l)&&(t.flags|=4)}},Fs=function(e,t,n,r){n!==r&&(t.flags|=4)};var Xs=!1,Qs=!1,Ys="function"===typeof WeakSet?WeakSet:Set,Js=null;function $s(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Ic(e,t,r)}else n.current=null}function eu(e,t,n){try{n()}catch(r){Ic(e,t,r)}}var tu=!1;function nu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&eu(t,n,i)}a=a.next}while(a!==r)}}function ru(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function au(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function iu(e){var t=e.alternate;null!==t&&(e.alternate=null,iu(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[fa],delete t[da],delete t[va],delete t[ma],delete t[ga])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ou(e){return 5===e.tag||3===e.tag||4===e.tag}function su(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ou(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}function cu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cu(e,t,n),e=e.sibling;null!==e;)cu(e,t,n),e=e.sibling}var lu=null,hu=!1;function fu(e,t,n){for(n=n.child;null!==n;)du(e,t,n),n=n.sibling}function du(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(at,n)}catch(s){}switch(n.tag){case 5:Qs||$s(n,t);case 6:var r=lu,a=hu;lu=null,fu(e,t,n),hu=a,null!==(lu=r)&&(hu?(e=lu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):lu.removeChild(n.stateNode));break;case 18:null!==lu&&(hu?(e=lu,n=n.stateNode,8===e.nodeType?ua(e.parentNode,n):1===e.nodeType&&ua(e,n),Wt(e)):ua(lu,n.stateNode));break;case 4:r=lu,a=hu,lu=n.stateNode.containerInfo,hu=!0,fu(e,t,n),lu=r,hu=a;break;case 0:case 11:case 14:case 15:if(!Qs&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,void 0!==o&&(0!==(2&i)||0!==(4&i))&&eu(n,t,o),a=a.next}while(a!==r)}fu(e,t,n);break;case 1:if(!Qs&&($s(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Ic(n,t,s)}fu(e,t,n);break;case 21:fu(e,t,n);break;case 22:1&n.mode?(Qs=(r=Qs)||null!==n.memoizedState,fu(e,t,n),Qs=r):fu(e,t,n);break;default:fu(e,t,n)}}function pu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Ys),t.forEach((function(t){var r=Tc.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function vu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var o=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:lu=u.stateNode,hu=!1;break e;case 3:case 4:lu=u.stateNode.containerInfo,hu=!0;break e}u=u.return}if(null===lu)throw Error(i(160));du(o,s,a),lu=null,hu=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(l){Ic(a,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)mu(t,e),t=t.sibling}function mu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vu(t,e),gu(e),4&r){try{nu(3,e,e.return),ru(3,e)}catch(m){Ic(e,e.return,m)}try{nu(5,e,e.return)}catch(m){Ic(e,e.return,m)}}break;case 1:vu(t,e),gu(e),512&r&&null!==n&&$s(n,n.return);break;case 5:if(vu(t,e),gu(e),512&r&&null!==n&&$s(n,n.return),32&e.flags){var a=e.stateNode;try{fe(a,"")}catch(m){Ic(e,e.return,m)}}if(4&r&&null!=(a=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,u=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===u&&"radio"===o.type&&null!=o.name&&Y(a,o),be(u,s);var l=be(u,o);for(s=0;s<c.length;s+=2){var h=c[s],f=c[s+1];"style"===h?me(a,f):"dangerouslySetInnerHTML"===h?he(a,f):"children"===h?fe(a,f):b(a,h,f,l)}switch(u){case"input":J(a,o);break;case"textarea":ie(a,o);break;case"select":var d=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(a,!!o.multiple,p,!1):d!==!!o.multiple&&(null!=o.defaultValue?ne(a,!!o.multiple,o.defaultValue,!0):ne(a,!!o.multiple,o.multiple?[]:"",!1))}a[da]=o}catch(m){Ic(e,e.return,m)}}break;case 6:if(vu(t,e),gu(e),4&r){if(null===e.stateNode)throw Error(i(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(m){Ic(e,e.return,m)}}break;case 3:if(vu(t,e),gu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Wt(t.containerInfo)}catch(m){Ic(e,e.return,m)}break;case 4:default:vu(t,e),gu(e);break;case 13:vu(t,e),gu(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Uu=Ye())),4&r&&pu(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Qs=(l=Qs)||h,vu(t,e),Qs=l):vu(t,e),gu(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!h&&0!==(1&e.mode))for(Js=e,h=e.child;null!==h;){for(f=Js=h;null!==Js;){switch(p=(d=Js).child,d.tag){case 0:case 11:case 14:case 15:nu(4,d,d.return);break;case 1:$s(d,d.return);var v=d.stateNode;if("function"===typeof v.componentWillUnmount){r=d,n=d.return;try{t=r,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(m){Ic(r,n,m)}}break;case 5:$s(d,d.return);break;case 22:if(null!==d.memoizedState){Vu(f);continue}}null!==p?(p.return=d,Js=p):Vu(f)}h=h.sibling}e:for(h=null,f=e;;){if(5===f.tag){if(null===h){h=f;try{a=f.stateNode,l?"function"===typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(u=f.stateNode,s=void 0!==(c=f.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,u.style.display=ve("display",s))}catch(m){Ic(e,e.return,m)}}}else if(6===f.tag){if(null===h)try{f.stateNode.nodeValue=l?"":f.memoizedProps}catch(m){Ic(e,e.return,m)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===e)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;null===f.sibling;){if(null===f.return||f.return===e)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:vu(t,e),gu(e),4&r&&pu(e);case 21:}}function gu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ou(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(fe(a,""),r.flags&=-33),cu(e,su(e),a);break;case 3:case 4:var o=r.stateNode.containerInfo;uu(e,su(e),o);break;default:throw Error(i(161))}}catch(s){Ic(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yu(e,t,n){Js=e,bu(e,t,n)}function bu(e,t,n){for(var r=0!==(1&e.mode);null!==Js;){var a=Js,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||Xs;if(!o){var s=a.alternate,u=null!==s&&null!==s.memoizedState||Qs;s=Xs;var c=Qs;if(Xs=o,(Qs=u)&&!c)for(Js=a;null!==Js;)u=(o=Js).child,22===o.tag&&null!==o.memoizedState?xu(a):null!==u?(u.return=o,Js=u):xu(a);for(;null!==i;)Js=i,bu(i,t,n),i=i.sibling;Js=a,Xs=s,Qs=c}ku(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,Js=i):ku(e)}}function ku(e){for(;null!==Js;){var t=Js;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qs||ru(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Qs)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:mi(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&Pi(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}Pi(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var h=l.memoizedState;if(null!==h){var f=h.dehydrated;null!==f&&Wt(f)}}}break;default:throw Error(i(163))}Qs||512&t.flags&&au(t)}catch(d){Ic(t,t.return,d)}}if(t===e){Js=null;break}if(null!==(n=t.sibling)){n.return=t.return,Js=n;break}Js=t.return}}function Vu(e){for(;null!==Js;){var t=Js;if(t===e){Js=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Js=n;break}Js=t.return}}function xu(e){for(;null!==Js;){var t=Js;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ru(4,t)}catch(u){Ic(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(u){Ic(t,a,u)}}var i=t.return;try{au(t)}catch(u){Ic(t,i,u)}break;case 5:var o=t.return;try{au(t)}catch(u){Ic(t,o,u)}}}catch(u){Ic(t,t.return,u)}if(t===e){Js=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Js=s;break}Js=t.return}}var wu,Iu=Math.ceil,Su=k.ReactCurrentDispatcher,Cu=k.ReactCurrentOwner,Eu=k.ReactCurrentBatchConfig,Tu=0,Nu=null,Au=null,Ru=0,_u=0,Du=Ia(0),Fu=0,Ou=null,Lu=0,Mu=0,Pu=0,zu=null,Bu=null,Uu=0,Wu=1/0,ju=null,Zu=!1,Gu=null,Hu=null,qu=!1,Ku=null,Xu=0,Qu=0,Yu=null,Ju=-1,$u=0;function ec(){return 0!==(6&Tu)?Ye():-1!==Ju?Ju:Ju=Ye()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Tu)&&0!==Ru?Ru&-Ru:null!==vi.transition?(0===$u&&($u=vt()),$u):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function nc(e,t,n,r){if(50<Qu)throw Qu=0,Yu=null,Error(i(185));gt(e,n,r),0!==(2&Tu)&&e===Nu||(e===Nu&&(0===(2&Tu)&&(Mu|=n),4===Fu&&sc(e,Ru)),rc(e,r),1===n&&0===Tu&&0===(1&t.mode)&&(Wu=Ye()+500,za&&Wa()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-ot(i),s=1<<o,u=a[o];-1===u?0!==(s&n)&&0===(s&r)||(a[o]=dt(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=ft(e,e===Nu?Ru:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){za=!0,Ua(e)}(uc.bind(null,e)):Ua(uc.bind(null,e)),oa((function(){0===(6&Tu)&&Wa()})),n=null;else{switch(kt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Nc(n,ac.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ac(e,t){if(Ju=-1,$u=0,0!==(6&Tu))throw Error(i(327));var n=e.callbackNode;if(xc()&&e.callbackNode!==n)return null;var r=ft(e,e===Nu?Ru:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=mc(e,r);else{t=r;var a=Tu;Tu|=2;var o=pc();for(Nu===e&&Ru===t||(ju=null,Wu=Ye()+500,fc(e,t));;)try{yc();break}catch(u){dc(e,u)}Vi(),Su.current=o,Tu=a,null!==Au?t=0:(Nu=null,Ru=0,t=Fu)}if(0!==t){if(2===t&&(0!==(a=pt(e))&&(r=a,t=ic(e,a))),1===t)throw n=Ou,fc(e,0),sc(e,r),rc(e,Ye()),n;if(6===t)sc(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!sr(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=mc(e,r))&&(0!==(o=pt(e))&&(r=o,t=ic(e,o))),1===t))throw n=Ou,fc(e,0),sc(e,r),rc(e,Ye()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:Vc(e,Bu,ju);break;case 3:if(sc(e,r),(130023424&r)===r&&10<(t=Uu+500-Ye())){if(0!==ft(e,0))break;if(((a=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(Vc.bind(null,e,Bu,ju),t);break}Vc(e,Bu,ju);break;case 4:if(sc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>a&&(a=s),r&=~o}if(r=a,10<(r=(120>(r=Ye()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Iu(r/1960))-r)){e.timeoutHandle=ra(Vc.bind(null,e,Bu,ju),r);break}Vc(e,Bu,ju);break;default:throw Error(i(329))}}}return rc(e,Ye()),e.callbackNode===n?ac.bind(null,e):null}function ic(e,t){var n=zu;return e.current.memoizedState.isDehydrated&&(fc(e,t).flags|=256),2!==(e=mc(e,t))&&(t=Bu,Bu=n,null!==t&&oc(t)),e}function oc(e){null===Bu?Bu=e:Bu.push.apply(Bu,e)}function sc(e,t){for(t&=~Pu,t&=~Mu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function uc(e){if(0!==(6&Tu))throw Error(i(327));xc();var t=ft(e,0);if(0===(1&t))return rc(e,Ye()),null;var n=mc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ic(e,r))}if(1===n)throw n=Ou,fc(e,0),sc(e,t),rc(e,Ye()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Vc(e,Bu,ju),rc(e,Ye()),null}function cc(e,t){var n=Tu;Tu|=1;try{return e(t)}finally{0===(Tu=n)&&(Wu=Ye()+500,za&&Wa())}}function lc(e){null!==Ku&&0===Ku.tag&&0===(6&Tu)&&xc();var t=Tu;Tu|=1;var n=Eu.transition,r=bt;try{if(Eu.transition=null,bt=1,e)return e()}finally{bt=r,Eu.transition=n,0===(6&(Tu=t))&&Wa()}}function hc(){_u=Du.current,Sa(Du)}function fc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Au)for(n=Au.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Da();break;case 3:ao(),Sa(Na),Sa(Ta),lo();break;case 5:oo(r);break;case 4:ao();break;case 13:case 19:Sa(so);break;case 10:xi(r.type._context);break;case 22:case 23:hc()}n=n.return}if(Nu=e,Au=e=Dc(e.current,null),Ru=_u=t,Fu=0,Ou=null,Pu=Mu=Lu=0,Bu=zu=null,null!==Ci){for(t=0;t<Ci.length;t++)if(null!==(r=(n=Ci[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}Ci=null}return e}function dc(e,t){for(;;){var n=Au;try{if(Vi(),ho.current=os,yo){for(var r=vo.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}yo=!1}if(po=0,go=mo=vo=null,bo=!1,ko=0,Cu.current=null,null===n||null===n.return){Fu=1,Ou=t,Au=null;break}e:{var o=e,s=n.return,u=n,c=t;if(t=Ru,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,h=u,f=h.tag;if(0===(1&h.mode)&&(0===f||11===f||15===f)){var d=h.alternate;d?(h.updateQueue=d.updateQueue,h.memoizedState=d.memoizedState,h.lanes=d.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,ys(p,s,u,0,t),1&p.mode&&ms(o,l,t),c=l;var v=(t=p).updateQueue;if(null===v){var m=new Set;m.add(c),t.updateQueue=m}else v.add(c);break e}if(0===(1&t)){ms(o,l,t),vc();break e}c=Error(i(426))}else if(ai&&1&u.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),ys(g,s,u,0,t),pi(ls(c,u));break e}}o=c=ls(c,u),4!==Fu&&(Fu=2),null===zu?zu=[o]:zu.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Li(o,ps(0,c,t));break e;case 1:u=c;var y=o.type,b=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Hu||!Hu.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Li(o,vs(o,u,t));break e}}o=o.return}while(null!==o)}kc(n)}catch(k){t=k,Au===n&&null!==n&&(Au=n=n.return);continue}break}}function pc(){var e=Su.current;return Su.current=os,null===e?os:e}function vc(){0!==Fu&&3!==Fu&&2!==Fu||(Fu=4),null===Nu||0===(268435455&Lu)&&0===(268435455&Mu)||sc(Nu,Ru)}function mc(e,t){var n=Tu;Tu|=2;var r=pc();for(Nu===e&&Ru===t||(ju=null,fc(e,t));;)try{gc();break}catch(a){dc(e,a)}if(Vi(),Tu=n,Su.current=r,null!==Au)throw Error(i(261));return Nu=null,Ru=0,Fu}function gc(){for(;null!==Au;)bc(Au)}function yc(){for(;null!==Au&&!Xe();)bc(Au)}function bc(e){var t=wu(e.alternate,e,_u);e.memoizedProps=e.pendingProps,null===t?kc(e):Au=t,Cu.current=null}function kc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=qs(n,t,_u)))return void(Au=n)}else{if(null!==(n=Ks(n,t)))return n.flags&=32767,void(Au=n);if(null===e)return Fu=6,void(Au=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Au=t);Au=t=e}while(null!==t);0===Fu&&(Fu=5)}function Vc(e,t,n){var r=bt,a=Eu.transition;try{Eu.transition=null,bt=1,function(e,t,n,r){do{xc()}while(null!==Ku);if(0!==(6&Tu))throw Error(i(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-ot(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,o),e===Nu&&(Au=Nu=null,Ru=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||qu||(qu=!0,Nc(tt,(function(){return xc(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Eu.transition,Eu.transition=null;var s=bt;bt=1;var u=Tu;Tu|=4,Cu.current=null,function(e,t){if(ea=Zt,dr(e=fr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(V){n=null;break e}var s=0,u=-1,c=-1,l=0,h=0,f=e,d=null;t:for(;;){for(var p;f!==n||0!==a&&3!==f.nodeType||(u=s+a),f!==o||0!==r&&3!==f.nodeType||(c=s+r),3===f.nodeType&&(s+=f.nodeValue.length),null!==(p=f.firstChild);)d=f,f=p;for(;;){if(f===e)break t;if(d===n&&++l===a&&(u=s),d===o&&++h===r&&(c=s),null!==(p=f.nextSibling))break;d=(f=d).parentNode}f=p}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},Zt=!1,Js=t;null!==Js;)if(e=(t=Js).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Js=e;else for(;null!==Js;){t=Js;try{var v=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var m=v.memoizedProps,g=v.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:mi(t.type,m),g);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var k=t.stateNode.containerInfo;1===k.nodeType?k.textContent="":9===k.nodeType&&k.documentElement&&k.removeChild(k.documentElement);break;default:throw Error(i(163))}}catch(V){Ic(t,t.return,V)}if(null!==(e=t.sibling)){e.return=t.return,Js=e;break}Js=t.return}v=tu,tu=!1}(e,n),mu(n,e),pr(ta),Zt=!!ea,ta=ea=null,e.current=n,yu(n,e,a),Qe(),Tu=u,bt=s,Eu.transition=o}else e.current=n;if(qu&&(qu=!1,Ku=e,Xu=a),0===(o=e.pendingLanes)&&(Hu=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Ye()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((a=t[n]).value,{componentStack:a.stack,digest:a.digest});if(Zu)throw Zu=!1,e=Gu,Gu=null,e;0!==(1&Xu)&&0!==e.tag&&xc(),0!==(1&(o=e.pendingLanes))?e===Yu?Qu++:(Qu=0,Yu=e):Qu=0,Wa()}(e,t,n,r)}finally{Eu.transition=a,bt=r}return null}function xc(){if(null!==Ku){var e=kt(Xu),t=Eu.transition,n=bt;try{if(Eu.transition=null,bt=16>e?16:e,null===Ku)var r=!1;else{if(e=Ku,Ku=null,Xu=0,0!==(6&Tu))throw Error(i(331));var a=Tu;for(Tu|=4,Js=e.current;null!==Js;){var o=Js,s=o.child;if(0!==(16&Js.flags)){var u=o.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for(Js=l;null!==Js;){var h=Js;switch(h.tag){case 0:case 11:case 15:nu(8,h,o)}var f=h.child;if(null!==f)f.return=h,Js=f;else for(;null!==Js;){var d=(h=Js).sibling,p=h.return;if(iu(h),h===l){Js=null;break}if(null!==d){d.return=p,Js=d;break}Js=p}}}var v=o.alternate;if(null!==v){var m=v.child;if(null!==m){v.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}Js=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Js=s;else e:for(;null!==Js;){if(0!==(2048&(o=Js).flags))switch(o.tag){case 0:case 11:case 15:nu(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,Js=y;break e}Js=o.return}}var b=e.current;for(Js=b;null!==Js;){var k=(s=Js).child;if(0!==(2064&s.subtreeFlags)&&null!==k)k.return=s,Js=k;else e:for(s=b;null!==Js;){if(0!==(2048&(u=Js).flags))try{switch(u.tag){case 0:case 11:case 15:ru(9,u)}}catch(x){Ic(u,u.return,x)}if(u===s){Js=null;break e}var V=u.sibling;if(null!==V){V.return=u.return,Js=V;break e}Js=u.return}}if(Tu=a,Wa(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(at,e)}catch(x){}r=!0}return r}finally{bt=n,Eu.transition=t}}return!1}function wc(e,t,n){e=Fi(e,t=ps(0,t=ls(n,t),1),1),t=ec(),null!==e&&(gt(e,1,t),rc(e,t))}function Ic(e,t,n){if(3===e.tag)wc(e,e,n);else for(;null!==t;){if(3===t.tag){wc(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Hu||!Hu.has(r))){t=Fi(t,e=vs(t,e=ls(n,e),1),1),e=ec(),null!==t&&(gt(t,1,e),rc(t,e));break}}t=t.return}}function Sc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Nu===e&&(Ru&n)===n&&(4===Fu||3===Fu&&(130023424&Ru)===Ru&&500>Ye()-Uu?fc(e,0):Pu|=n),rc(e,t)}function Cc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=ec();null!==(e=Ni(e,t))&&(gt(e,t,n),rc(e,n))}function Ec(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Cc(e,n)}function Tc(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Cc(e,n)}function Nc(e,t){return qe(e,t)}function Ac(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Rc(e,t,n,r){return new Ac(e,t,n,r)}function _c(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dc(e,t){var n=e.alternate;return null===n?((n=Rc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Fc(e,t,n,r,a,o){var s=2;if(r=e,"function"===typeof e)_c(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case w:return Oc(n.children,a,o,t);case I:s=8,a|=8;break;case S:return(e=Rc(12,n,t,2|a)).elementType=S,e.lanes=o,e;case N:return(e=Rc(13,n,t,a)).elementType=N,e.lanes=o,e;case A:return(e=Rc(19,n,t,a)).elementType=A,e.lanes=o,e;case D:return Lc(n,a,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case C:s=10;break e;case E:s=9;break e;case T:s=11;break e;case R:s=14;break e;case _:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Rc(s,n,t,a)).elementType=e,t.type=r,t.lanes=o,t}function Oc(e,t,n,r){return(e=Rc(7,e,r,t)).lanes=n,e}function Lc(e,t,n,r){return(e=Rc(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Mc(e,t,n){return(e=Rc(6,e,null,t)).lanes=n,e}function Pc(e,t,n){return(t=Rc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function zc(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Bc(e,t,n,r,a,i,o,s,u){return e=new zc(e,t,n,s,u),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Rc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ri(i),e}function Uc(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:x,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Wc(e){if(!e)return Ea;e:{if(We(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(_a(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(_a(n))return Oa(e,n,t)}return t}function jc(e,t,n,r,a,i,o,s,u){return(e=Bc(n,r,!0,e,0,i,0,s,u)).context=Wc(null),n=e.current,(i=Di(r=ec(),a=tc(n))).callback=void 0!==t&&null!==t?t:null,Fi(n,i,a),e.current.lanes=a,gt(e,a,r),rc(e,r),e}function Zc(e,t,n,r){var a=t.current,i=ec(),o=tc(a);return n=Wc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Di(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Fi(a,t,o))&&(nc(e,a,o,i),Oi(e,a,o)),o}function Gc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function qc(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}wu=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Na.current)ks=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return ks=!1,function(e,t,n){switch(t.tag){case 3:As(t),di();break;case 5:io(t);break;case 1:_a(t.type)&&La(t);break;case 4:ro(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ca(gi,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ca(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Ms(e,t,n):(Ca(so,1&so.current),null!==(e=Zs(e,t,n))?e.sibling:null);Ca(so,1&so.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Ws(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ca(so,so.current),r)break;return null;case 22:case 23:return t.lanes=0,Ss(e,t,n)}return Zs(e,t,n)}(e,t,n);ks=0!==(131072&e.flags)}else ks=!1,ai&&0!==(1048576&t.flags)&&$a(t,Ha,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;js(e,t),e=t.pendingProps;var a=Ra(t,Ta.current);Ii(t,n),a=Io(null,t,r,e,a,n);var o=So();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,_a(r)?(o=!0,La(t)):o=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Ri(t),a.updater=Ui,t.stateNode=a,a._reactInternals=t,Gi(t,r,e,n),t=Ns(null,t,r,!0,o,n)):(t.tag=0,ai&&o&&ei(t),Vs(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(js(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return _c(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===T)return 11;if(e===R)return 14}return 2}(r),e=mi(r,e),a){case 0:t=Es(null,t,r,e,n);break e;case 1:t=Ts(null,t,r,e,n);break e;case 11:t=xs(null,t,r,e,n);break e;case 14:t=ws(null,t,r,mi(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Es(e,t,r,a=t.elementType===r?a:mi(r,a),n);case 1:return r=t.type,a=t.pendingProps,Ts(e,t,r,a=t.elementType===r?a:mi(r,a),n);case 3:e:{if(As(t),null===e)throw Error(i(387));r=t.pendingProps,a=(o=t.memoizedState).element,_i(e,t),Mi(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Rs(e,t,r,n,a=ls(Error(i(423)),t));break e}if(r!==a){t=Rs(e,t,r,n,a=ls(Error(i(424)),t));break e}for(ri=ca(t.stateNode.containerInfo.firstChild),ni=t,ai=!0,ii=null,n=Yi(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(di(),r===a){t=Zs(e,t,n);break e}Vs(e,t,r,n)}t=t.child}return t;case 5:return io(t),null===e&&ci(t),r=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,na(r,a)?s=null:null!==o&&na(r,o)&&(t.flags|=32),Cs(e,t),Vs(e,t,s,n),t.child;case 6:return null===e&&ci(t),null;case 13:return Ms(e,t,n);case 4:return ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Qi(t,null,r,n):Vs(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,xs(e,t,r,a=t.elementType===r?a:mi(r,a),n);case 7:return Vs(e,t,t.pendingProps,n),t.child;case 8:case 12:return Vs(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,Ca(gi,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===a.children&&!Na.current){t=Zs(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var u=o.dependencies;if(null!==u){s=o.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Di(-1,n&-n)).tag=2;var l=o.updateQueue;if(null!==l){var h=(l=l.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),l.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),wi(o.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),wi(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}Vs(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Ii(t,n),r=r(a=Si(a)),t.flags|=1,Vs(e,t,r,n),t.child;case 14:return a=mi(r=t.type,t.pendingProps),ws(e,t,r,a=mi(r.type,a),n);case 15:return Is(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:mi(r,a),js(e,t),t.tag=1,_a(r)?(e=!0,La(t)):e=!1,Ii(t,n),ji(t,r,a),Gi(t,r,a,n),Ns(null,t,r,!0,e,n);case 19:return Ws(e,t,n);case 22:return Ss(e,t,n)}throw Error(i(156,t.tag))};var Kc="function"===typeof reportError?reportError:function(e){console.error(e)};function Xc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Yc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $c(){}function el(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if("function"===typeof a){var s=a;a=function(){var e=Gc(o);s.call(e)}}Zc(t,o,e,a)}else o=function(e,t,n,r,a){if(a){if("function"===typeof r){var i=r;r=function(){var e=Gc(o);i.call(e)}}var o=jc(t,r,e,0,null,!1,0,"",$c);return e._reactRootContainer=o,e[pa]=o.current,Wr(8===e.nodeType?e.parentNode:e),lc(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var s=r;r=function(){var e=Gc(u);s.call(e)}}var u=Bc(e,0,!1,null,0,!1,0,"",$c);return e._reactRootContainer=u,e[pa]=u.current,Wr(8===e.nodeType?e.parentNode:e),lc((function(){Zc(t,u,n,r)})),u}(n,t,e,a,r);return Gc(o)}Qc.prototype.render=Xc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));Zc(e,t,null,null)},Qc.prototype.unmount=Xc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;lc((function(){Zc(null,e,null,null)})),t[pa]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=It();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Mt(e)}},Vt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,Ye()),0===(6&Tu)&&(Wu=Ye()+500,Wa()))}break;case 13:lc((function(){var t=Ni(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}})),qc(e,1)}},xt=function(e){if(13===e.tag){var t=Ni(e,134217728);if(null!==t)nc(t,e,134217728,ec());qc(e,134217728)}},wt=function(e){if(13===e.tag){var t=tc(e),n=Ni(e,t);if(null!==n)nc(n,e,t,ec());qc(e,t)}},It=function(){return bt},St=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},xe=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=Va(r);if(!a)throw Error(i(90));q(r),J(r,a)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Te=cc,Ne=lc;var tl={usingClientEntryPoint:!1,Events:[ba,ka,Va,Ce,Ee,cc]},nl={findFiberByHostInstance:ya,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rl={bundleType:nl.bundleType,version:nl.version,rendererPackageName:nl.rendererPackageName,rendererConfig:nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:k.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=Ge(e))?null:e.stateNode},findFiberByHostInstance:nl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var al=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!al.isDisabled&&al.supportsFiber)try{at=al.inject(rl),it=al}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Yc(t))throw Error(i(200));return Uc(e,t,null,n)},t.createRoot=function(e,t){if(!Yc(e))throw Error(i(299));var n=!1,r="",a=Kc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=Bc(e,1,!1,null,0,n,0,r,a),e[pa]=t.current,Wr(8===e.nodeType?e.parentNode:e),new Xc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=Ge(t))?null:e.stateNode},t.flushSync=function(e){return lc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(i(200));return el(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Yc(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,a=!1,o="",s=Kc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=jc(t,null,e,1,null!=n?n:null,a,0,o,s),e[pa]=t.current,Wr(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Qc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(i(200));return el(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(i(40));return!!e._reactRootContainer&&(lc((function(){el(null,null,e,!1,(function(){e._reactRootContainer=null,e[pa]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return el(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},1250:function(e,t,n){"use strict";var r=n(4164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4463)},6050:function(e,t,n){var r;e.exports=(r=n(2791),function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t){e.exports=r},function(e,t,n){e.exports=n(7)()},function(e,t,n){!function(t,n){e.exports=n()}(0,(function(){return function(e){function t(r){if(n[r])return n[r].exports;var a=n[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,r){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:r})},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=3)}([function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o}));var r=n(1),a=n(7);n.d(t,"a",(function(){return a.a}));var i=r.a.FACING_MODES,o=r.a.IMAGE_TYPES},function(e,t,n){"use strict";var r=n(5);n.d(t,"a",(function(){return r.a}))},function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"e",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"f",(function(){return s})),n.d(t,"c",(function(){return u})),n.d(t,"b",(function(){return c})),n.d(t,"d",(function(){return l}));var a,i=["user","environment"],o={USER:"user",ENVIRONMENT:"environment"},s=["jpg","png"],u={PNG:"png",JPG:"jpg"},c=(r(a={},"jpg","image/jpeg"),r(a,"png","image/png"),a),l={audio:!1,video:{}}},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(0);n.d(t,"FACING_MODES",(function(){return r.b})),n.d(t,"IMAGE_TYPES",(function(){return r.c}));var a=n(9);n.d(t,"downloadPhoto",(function(){return a.a})),t.default=r.a},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return s}));var a=n(6),i=n(2),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=function(){function e(){r(this,e)}return o(e,null,[{key:"getDataUri",value:function(e,t){var n=t.sizeFactor,r=t.imageType,i=t.imageCompression,o=t.isImageMirror,s=e.videoWidth,u=e.videoHeight,c=Object(a.b)(s,u,n),l=c.imageWidth,h=c.imageHeight,f=document.createElement("canvas");f.width=l,f.height=h;var d=f.getContext("2d");return o&&d.setTransform(-1,0,0,1,f.width,0),d.drawImage(e,0,0,l,h),Object(a.a)(f,r,i)}},{key:"getWindowURL",value:function(){return window.URL||window.webkitURL||window.mozURL||window.msURL}},{key:"getNavigatorMediaDevices",value:function(){var e=null,t=!(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia),n=!(!navigator.mozGetUserMedia&&!navigator.webkitGetUserMedia);if(t)e=navigator.mediaDevices;else if(n){var r=navigator.mozGetUserMedia||navigator.webkitGetUserMedia,a={getUserMedia:function(e){return new Promise((function(t,n){r.call(navigator,e,t,n)}))}};e=Object.assign(r,a)}return e}},{key:"isSupportedFacingMode",value:function(){return e.getNavigatorMediaDevices().getSupportedConstraints().facingMode}},{key:"getIdealConstraints",value:function(t,n){var r=i.d;if(Object(a.d)(t,n))return i.d;var o=e.getNavigatorMediaDevices().getSupportedConstraints();return o.width&&o.height?(t&&(i.e.includes(t)?r.video.facingMode=t:r.video.deviceId={exact:t}),n&&n.width&&(r.video.width=n.width),n&&n.height&&(r.video.height=n.height),r):(console.error("Constraint width or height not supported! fallback to default resolution"),i.d)}},{key:"_getMaxResolutionConstraintsIphoneOrIpad",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n={width:{min:640,ideal:3840},height:{min:480,ideal:2160}};return e.getIdealConstraints(t,n)}},{key:"getMaxResolutionConstraints",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments[1];console.warn("numberOfMaxResolutionTry",n);var r=e.getIdealConstraints(t),i=[{width:{min:640}},{width:{min:800}},{width:{min:900}},{width:{min:1024}},{width:{min:1080}},{width:{min:1280}},{width:{min:1920}},{width:{min:2560}},{width:{min:3840}}];if(0===n)return Object(a.c)()?(console.warn("fallback to iPad/iPhone constraints"),e._getMaxResolutionConstraintsIphoneOrIpad(t,n)):(r.video.advanced=i,r);if(n<i.length){var o=i.slice(0,-n);return r.video.advanced=o,r}return null}},{key:"FACING_MODES",get:function(){return i.a}},{key:"IMAGE_TYPES",get:function(){return i.c}}]),e}()},function(e,t,n){"use strict";function r(e,t){if(!(t>=0&&t<=1))throw new Error(t+" is invalid imageCompression, choose between: [0, 1]");if(!l.f.includes(e))throw new Error(e+" is invalid imageType, choose between: "+l.f.join(", "));return!0}function a(e,t){var n={};try{r(e,t),n.imageType=e,n.imageCompression=t}catch(e){console.error(e),console.error("default value of "+l.c.PNG+" is used"),n.imageType=l.c.PNG,n.imageCompression=null}return n}function i(e,t,n){var r=e*parseFloat(n);return{imageWidth:r,imageHeight:t/(e/r)}}function o(e,t,n){return a(t,n).imageType===l.c.JPG?n?e.toDataURL(l.b[l.c.JPG],n):e.toDataURL(l.b[l.c.JPG]):e.toDataURL(l.b[t])}function s(e){if("object"===("undefined"===typeof e?"undefined":h(e)))for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function u(e,t){return!(e||t&&!s(t))}function c(){var e=window.navigator.userAgent;return e.match(/iPad/i)||e.match(/iPhone/i)}t.b=i,t.a=o,t.d=u,t.c=c;var l=n(2),h="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e}},function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}n.d(t,"a",(function(){return u}));var a=n(1),i=n(8),o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),s=a.a.IMAGE_TYPES.PNG,u=function(){function e(t){r(this,e),this.videoElement=t,this.stream=null,this.numberOfMaxResolutionTry=0,this.settings=null,this.cameras=[],this.windowURL=a.a.getWindowURL(),this.mediaDevices=a.a.getNavigatorMediaDevices()}return o(e,[{key:"_getStreamDevice",value:function(e,t){var n=this;return new Promise((function(r,i){var o=a.a.getIdealConstraints(e,t);n.mediaDevices.getUserMedia(o).then((function(e){n._gotStream(e),r(e)})).catch((function(e){i(e)}))}))}},{key:"_getStreamDeviceMaxResolution",value:function(e){var t=this,n=a.a.getMaxResolutionConstraints(e,this.numberOfMaxResolutionTry);if(null==n){var r={};return this._getStreamDevice(e,r)}return new Promise((function(r,a){t.mediaDevices.getUserMedia(n).then((function(e){t._gotStream(e),r(e)})).catch((function(n){setTimeout((function(){t.numberOfMaxResolutionTry+=1,t._getStreamDeviceMaxResolution(e).catch((function(){a(n)}))}),20)}))}))}},{key:"_setVideoSrc",value:function(e){if("srcObject"in this.videoElement)this.videoElement.srcObject=e;else{var t=this.windowURL.createObjectURL(e);this.videoElement.src=t}}},{key:"_setSettings",value:function(e){this.settings=null;var t=e&&e.getTracks?e.getTracks():[];t.length>0&&t[0].getSettings&&(this.settings=t[0].getSettings())}},{key:"_enumerateCamerasPromise",value:function(){var e=this;return new Promise((function(t,n){var r=[];e.mediaDevices.enumerateDevices().then((function(e){e.forEach((function(e){"videoinput"===e.kind&&e.deviceId&&r.push(e)})),t(r)})).catch((function(e){n(e)}))}))}},{key:"_gotStream",value:function(e){this.stream=e,this._setSettings(e),this._setVideoSrc(e)}},{key:"getCameraSettings",value:function(){return this.settings}},{key:"enumerateCameras",value:function(){var e=this;return this.stream?this._enumerateCamerasPromise():this.stopCamera().then((function(){})).catch((function(){})).then((function(){var t={video:!0};return e.mediaDevices.getUserMedia(t).then((function(e){setTimeout((function(){e.getTracks().forEach((function(e){e.stop()}))}),20)})).then((function(){})).catch((function(){})).then((function(){return e._enumerateCamerasPromise()}))}))}},{key:"startCamera",value:function(e,t){var n=this;return this.stopCamera().then((function(){})).catch((function(){})).then((function(){return n._getStreamDevice(e,t)}))}},{key:"startCameraMaxResolution",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return this.numberOfMaxResolutionTry=0,this.stopCamera().then((function(){})).catch((function(){})).then((function(){return e._getStreamDeviceMaxResolution(t)}))}},{key:"getDataUri",value:function(e){var t={sizeFactor:void 0===e.sizeFactor?i.c:e.sizeFactor,imageType:void 0===e.imageType?s:e.imageType,imageCompression:void 0===e.imageCompression?i.a:e.imageCompression,isImageMirror:void 0===e.isImageMirror?i.b:e.isImageMirror};return a.a.getDataUri(this.videoElement,t)}},{key:"stopCamera",value:function(){var e=this;return new Promise((function(t,n){e.stream&&(e.stream.getTracks().forEach((function(e){e.stop()})),e.videoElement.src="",e.stream=null,e._setSettings(null),t()),n(Error("no stream to stop!"))}))}}]),e}()},function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return i}));var r=1,a=null,i=!1},function(e,t,n){"use strict";var r=n(10);n.d(t,"a",(function(){return r.a}))},function(e,t,n){"use strict";function r(e){for(var t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(t.length),a=new Uint8Array(r),i=0;i<t.length;i++)a[i]=t.charCodeAt(i);return new Blob([r],{type:n})}function a(e,t){return(e+="").length>=t?e:new Array(t-e.length+1).join("0")+e}function i(e){var t=c.c.PNG;return"image/jpeg"===e&&(t=c.c.JPG),t}function o(e,t,n){return e+"-"+a(t,4)+"."+i(n)}function s(e,t,n){window.URL=window.webkitURL||window.URL;var r=document.createElement("a");r.download=o(t,n,e.type),r.href=window.URL.createObjectURL(e);var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,0,null),r.dispatchEvent(a)}function u(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"photo",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;s(r(e),t,n)}t.a=u;var c=n(0)}])}))},function(e,t,n){e.exports=n(4)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(5);n.d(t,"Camera",(function(){return r.c})),n.d(t,"FACING_MODES",(function(){return r.a})),n.d(t,"IMAGE_TYPES",(function(){return r.b})),t.default=r.c},function(e,t,n){"use strict";var r=n(6);n.d(t,"a",(function(){return r.a})),n.d(t,"b",(function(){return r.b})),t.c=r.c},function(e,t,n){"use strict";function r(e){function t(){m&&clearTimeout(m)}function n(){return void 0!==e.isImageMirror?e.isImageMirror:e.idealFacingMode===u.FACING_MODES.USER}function r(){var r={sizeFactor:e.sizeFactor,imageType:e.imageType,imageCompression:e.imageCompression,isImageMirror:n()},a=_(r);e.isSilentMode||Object(d.c)(),"function"===typeof e.onTakePhoto&&e.onTakePhoto(a),g(a),V(!1),t(),m=setTimeout((function(){V(!0),"function"===typeof e.onTakePhotoAnimationDone&&e.onTakePhotoAnimationDone(a)}),900)}var o=Object(a.useState)(""),s=v(o,2),p=s[0],g=s[1],y=Object(a.useState)(!0),b=v(y,2),k=b[0],V=b[1],x=Object(a.useState)(""),w=v(x,2),I=w[0],S=w[1],C=Object(a.useRef)(null),E=Object(c.a)(C,e.idealFacingMode,e.idealResolution,e.isMaxResolution),T=v(E,4),N=T[0],A=T[1],R=T[2],_=T[3];Object(a.useEffect)((function(){N?"function"===typeof e.onCameraStart&&e.onCameraStart(N):"function"===typeof e.onCameraStop&&e.onCameraStop()}),[N]),Object(a.useEffect)((function(){A&&(S(A.name+" "+A.message),"function"===typeof e.onCameraError&&e.onCameraError(A))}),[A]),Object(a.useEffect)((function(){R&&Object(d.d)(R.message)}),[R]);var D=Object(d.b)(k,n()),F=Object(d.a)(!k),O=e.isFullscreen?"react-html5-camera-photo-fullscreen":"";return i.a.createElement("div",{className:"react-html5-camera-photo "+O},i.a.createElement(f.a,{cssClass:"display-error",isDisplayError:e.isDisplayStartCameraError,errorMsg:I}),i.a.createElement(h.a,{isShowWhiteFlash:!k}),i.a.createElement("img",{style:F,alt:"camera",src:p}),i.a.createElement("video",{style:D,ref:C,autoPlay:!0,muted:!0,playsInline:!0}),i.a.createElement(l.a,{isClicked:!k,onClick:r}))}var a=n(0),i=n.n(a),o=n(1),s=n.n(o),u=n(2),c=(n.n(u),n(9)),l=n(13),h=n(15),f=n(17),d=n(19),p=n(21);n.n(p),n.o(u,"FACING_MODES")&&n.d(t,"a",(function(){return u.FACING_MODES})),n.o(u,"IMAGE_TYPES")&&n.d(t,"b",(function(){return u.IMAGE_TYPES}));var v=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=null;t.c=r,r.propTypes={onTakePhoto:s.a.func,onTakePhotoAnimationDone:s.a.func,onCameraError:s.a.func,idealFacingMode:s.a.string,idealResolution:s.a.object,imageType:s.a.string,isImageMirror:s.a.bool,isSilentMode:s.a.bool,isDisplayStartCameraError:s.a.bool,imageCompression:s.a.number,isMaxResolution:s.a.bool,isFullscreen:s.a.bool,sizeFactor:s.a.number,onCameraStart:s.a.func,onCameraStop:s.a.func},r.defaultProps={isDisplayStartCameraError:!0}},function(e,t,n){"use strict";function r(){}function a(){}var i=n(8);a.resetWarningCache=r,e.exports=function(){function e(e,t,n,r,a,o){if(o!==i){var s=new Error("Calling PropTypes validators directly is not supported by the `prop-types` package. Use PropTypes.checkPropTypes() to call them. Read more at http://fb.me/use-check-prop-types");throw s.name="Invariant Violation",s}}function t(){return e}e.isRequired=e;var n={array:e,bool:e,func:e,number:e,object:e,string:e,symbol:e,any:e,arrayOf:t,element:e,elementType:e,instanceOf:t,node:e,objectOf:t,oneOf:t,oneOfType:t,shape:t,exact:t,checkPropTypes:a,resetWarningCache:r};return n.PropTypes=n,n}},function(e,t,n){"use strict";e.exports="SECRET_DO_NOT_PASS_THIS_OR_YOU_WILL_BE_FIRED"},function(e,t,n){"use strict";function r(e){return function(){var t=e.apply(this,arguments);return new Promise((function(e,n){function r(a,i){try{var o=t[a](i),s=o.value}catch(e){return void n(e)}if(!o.done)return Promise.resolve(s).then((function(e){r("next",e)}),(function(e){r("throw",e)}));e(s)}return r("next")}))}}function a(e,t,n,a){function i(e){return h.getDataUri(e)}var u=Object(s.useState)(null),d=l(u,2),p=d[0],v=d[1],m=Object(s.useState)(null),g=l(m,2),y=g[0],b=g[1],k=Object(s.useState)(null),V=l(k,2),x=V[0],w=V[1];return Object(s.useEffect)((function(){e&&e.current&&(h=new c.a(e.current))}),[e]),Object(s.useEffect)((function(){var i=function(){var e=r(o.a.mark((function e(){var r;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(f=!0,e.prev=1,r=null,!a){e.next=9;break}return e.next=6,h.startCameraMaxResolution(t);case 6:r=e.sent,e.next=12;break;case 9:return e.next=11,h.startCamera(t,n);case 11:r=e.sent;case 12:v(r),b(null),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),b(e.t0);case 19:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(){return e.apply(this,arguments)}}();if(p)return function(){function t(){return n.apply(this,arguments)}var n=r(o.a.mark((function t(){return o.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,!f){t.next=5;break}return f=!1,t.next=5,h.stopCamera();case 5:e&&e.current&&(v(null),w(null)),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(0),w(t.t0);case 11:case"end":return t.stop()}}),t,this,[[0,8]])})));return t}();i()}),[e,p,t,n,a]),[p,y,x,i]}t.a=a;var i=n(10),o=n.n(i),s=n(0),u=(n.n(s),n(2)),c=n.n(u),l=function(){function e(e,t){var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){a=!0,i=e}finally{try{!r&&s.return&&s.return()}finally{if(a)throw i}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=null,f=!1},function(e,t,n){e.exports=n(11)},function(e,t,n){var r=function(){return this}()||Function("return this")(),a=r.regeneratorRuntime&&Object.getOwnPropertyNames(r).indexOf("regeneratorRuntime")>=0,i=a&&r.regeneratorRuntime;if(r.regeneratorRuntime=void 0,e.exports=n(12),a)r.regeneratorRuntime=i;else try{delete r.regeneratorRuntime}catch(e){r.regeneratorRuntime=void 0}},function(e,t){!function(t){"use strict";function n(e,t,n,r){var i=t&&t.prototype instanceof a?t:a,o=Object.create(i.prototype),s=new d(r||[]);return o._invoke=c(e,n,s),o}function r(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function a(){}function i(){}function o(){}function s(e){["next","throw","return"].forEach((function(t){e[t]=function(e){return this._invoke(t,e)}}))}function u(e){function t(n,a,i,o){var s=r(e[n],e,a);if("throw"!==s.type){var u=s.arg,c=u.value;return c&&"object"===typeof c&&y.call(c,"__await")?Promise.resolve(c.__await).then((function(e){t("next",e,i,o)}),(function(e){t("throw",e,i,o)})):Promise.resolve(c).then((function(e){u.value=e,i(u)}),o)}o(s.arg)}function n(e,n){function r(){return new Promise((function(r,a){t(e,n,r,a)}))}return a=a?a.then(r,r):r()}var a;this._invoke=n}function c(e,t,n){var a=S;return function(i,o){if(a===E)throw new Error("Generator is already running");if(a===T){if("throw"===i)throw o;return v()}for(n.method=i,n.arg=o;;){var s=n.delegate;if(s){var u=l(s,n);if(u){if(u===N)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===S)throw a=T,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=E;var c=r(e,t,n);if("normal"===c.type){if(a=n.done?T:C,c.arg===N)continue;return{value:c.arg,done:n.done}}"throw"===c.type&&(a=T,n.method="throw",n.arg=c.arg)}}}function l(e,t){var n=e.iterator[t.method];if(n===m){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=m,l(e,t),"throw"===t.method))return N;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return N}var a=r(n,e.iterator,t.arg);if("throw"===a.type)return t.method="throw",t.arg=a.arg,t.delegate=null,N;var i=a.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=m),t.delegate=null,N):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,N)}function h(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function f(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function d(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(h,this),this.reset(!0)}function p(e){if(e){var t=e[k];if(t)return t.call(e);if("function"===typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(y.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=m,t.done=!0,t};return r.next=r}}return{next:v}}function v(){return{value:m,done:!0}}var m,g=Object.prototype,y=g.hasOwnProperty,b="function"===typeof Symbol?Symbol:{},k=b.iterator||"@@iterator",V=b.asyncIterator||"@@asyncIterator",x=b.toStringTag||"@@toStringTag",w="object"===typeof e,I=t.regeneratorRuntime;if(I)w&&(e.exports=I);else{(I=t.regeneratorRuntime=w?e.exports:{}).wrap=n;var S="suspendedStart",C="suspendedYield",E="executing",T="completed",N={},A={};A[k]=function(){return this};var R=Object.getPrototypeOf,_=R&&R(R(p([])));_&&_!==g&&y.call(_,k)&&(A=_);var D=o.prototype=a.prototype=Object.create(A);i.prototype=D.constructor=o,o.constructor=i,o[x]=i.displayName="GeneratorFunction",I.isGeneratorFunction=function(e){var t="function"===typeof e&&e.constructor;return!!t&&(t===i||"GeneratorFunction"===(t.displayName||t.name))},I.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,o):(e.__proto__=o,x in e||(e[x]="GeneratorFunction")),e.prototype=Object.create(D),e},I.awrap=function(e){return{__await:e}},s(u.prototype),u.prototype[V]=function(){return this},I.AsyncIterator=u,I.async=function(e,t,r,a){var i=new u(n(e,t,r,a));return I.isGeneratorFunction(t)?i:i.next().then((function(e){return e.done?e.value:i.next()}))},s(D),D[x]="Generator",D[k]=function(){return this},D.toString=function(){return"[object Generator]"},I.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},I.values=p,d.prototype={constructor:d,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=m,this.done=!1,this.delegate=null,this.method="next",this.arg=m,this.tryEntries.forEach(f),!e)for(var t in this)"t"===t.charAt(0)&&y.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=m)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){function t(t,r){return i.type="throw",i.arg=e,n.next=t,r&&(n.method="next",n.arg=m),!!r}if(this.done)throw e;for(var n=this,r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],i=a.completion;if("root"===a.tryLoc)return t("end");if(a.tryLoc<=this.prev){var o=y.call(a,"catchLoc"),s=y.call(a,"finallyLoc");if(o&&s){if(this.prev<a.catchLoc)return t(a.catchLoc,!0);if(this.prev<a.finallyLoc)return t(a.finallyLoc)}else if(o){if(this.prev<a.catchLoc)return t(a.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return t(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&y.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=e,i.arg=t,a?(this.method="next",this.next=a.finallyLoc,N):this.complete(i)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),N},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),f(n),N}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;f(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:p(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=m),N}}}}(function(){return this}()||Function("return this")())},function(e,t,n){"use strict";var r=n(0),a=n.n(r),i=n(1),o=n.n(i),s=n(14),u=(n.n(s),function(e){var t=e.onClick,n=e.isClicked,r=n?"is-clicked":"";return a.a.createElement("div",{id:"container-circles"},a.a.createElement("div",{id:"outer-circle",onClick:function(e){n||t()}},a.a.createElement("div",{id:"inner-circle",className:r})))});u.propTypes={onClick:o.a.func.isRequired,isClicked:o.a.bool.isRequired},t.a=u},function(e,t){},function(e,t,n){"use strict";var r=n(0),a=n.n(r),i=n(1),o=n.n(i),s=n(16),u=(n.n(s),function(e){var t=(e.isShowWhiteFlash?"do-transition":"")+" normal";return a.a.createElement("div",{id:"white-flash",className:t})});u.propTypes={isShowWhiteFlash:o.a.bool.isRequired},t.a=u},function(e,t){},function(e,t,n){"use strict";function r(e,t){return e&&t&&t.length>0}var a=n(0),i=n.n(a),o=n(1),s=n.n(o),u=n(18),c=(n.n(u),function(e){var t=e.isDisplayError,n=e.errorMsg,a=e.cssClass;return r(t,n)?(console.log("cssClass",a),i.a.createElement("div",{className:a,id:"display-error"},i.a.createElement("h1",null,"Camera error: ",n))):null});c.propTypes={isDisplayError:s.a.bool,errorMsg:s.a.string,cssClass:s.a.string},t.a=c},function(e,t){},function(e,t,n){"use strict";function r(e){return e?{display:"inline-block"}:{display:"none"}}function a(e){return e?{transform:"rotateY(180deg)"}:{transform:"none"}}function i(e,t){return Object.assign({},a(t),r(e))}function o(){new Audio("data:audio/mp3;base64,"+c.a.base64).play()}function s(e){console.info("react-html5-camera-photo info:",e)}t.a=r,t.b=i,t.c=o,t.d=s;var u=n(20),c=n.n(u)},function(e,t){e.exports={base64:"SUQzBAAAAAAASVRQRTEAAAAcAAADU291bmRKYXkuY29tIFNvdW5kIEVmZmVjdHMAVFNTRQAAAA8AAANMYXZmNTcuNzIuMTAxAAAAAAAAAAAAAAD/+1QAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABJbmZvAAAADwAAAB0AACxAAA0NDRUVFR4eHh4nJycvLy8vODg4QUFBQUlJSVJSUlJbW1tjY2NsbGxsdXV1fX19fYaGho+Pj4+Xl5egoKCgqampsbGxurq6usPDw8vLy8vU1NTd3d3d5eXl7u7u7vf39////wAAAABMYXZjNTcuOTMAAAAAAAAAAAAAAAAkAkAAAAAAAAAsQC+b5ZH/+5RkAA/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAAR4RBEitS0FLUmhcO1TSK1JoJrUtC4dpmkUlLQTQUtC4dpqkUkVoJoJpxcO01KKSK1JoJoRcO01i0kUlLGJkCdw7Skpaho4aHGJkCZkO0pIrDBxw0OGHoEzD3aUkVhg4wMHDD0E4tjjUkUgw8YPDhloJxbSaSRSGhxg8YpaCcW00kRSRWpNBOxZ/1VVFlv/9LLLqu//VVVUW//WWWWXd/6VVVVd/+qsssGH/ZZZVVUDt+1VVlli1dIxZZVUDI0RhaqqyzX9GLLLKq/+QtVVGgCAACMZAAY0NkBDHeIlc0SIVc0Kpu8Sudc0SucfQq+iRCd4hOlc0SubvEJ3NHiE76FErnCr13iE74d4hO8Q0SuaJUSuaJXKvEJ330Su8Q0KuaFUJ3iVzcWaJQ7wWYBHSMAgAD4xjjeYxjZ35znnO/zkJOfqQhKnO6B88jTnnOd0IRjhwUZTnO85///znkD/+5Rkrg7gAABpAAAACAAADSAAAAEQ2Y50IITAARuAEEgQjXnhDgIHCKc53IHxdyEbnOehCEkJ+pCelSMp4gHBRQ4HG5CSE8hJCN/U7oIBwONJAAAAABzNHNlZ0RgQYz9Z7iGTHEB/80BaFYCuiQxoNtAsgAYQaVXEGCOw1eAQwscAnqCA4wbgC2AfcLWgsjQU2SxNkDIOQcAICYDsC/QfJunpFwYwiBPhc4QIMLhqQFyQQMafSYToaBt4ucd4uQQUAgwyMNQQuQItic+ghuLAQdlkELTqJsxICMaQ4UERZT0KbbSURTRUOZYcwcwY5MiwoENUDJjGFslwwOn609SlqYXIK0HgXO8XPcbKThcIPIuUVoQiSyXYhB9OtX////+MF0v////zWIAICAEKgAB/mXJmPHgWEBgPOgZOlaYsIFBP+AQ4QLHrqkMPcPAKKBZ7ZFyAhl8AcIGyALmsoLqwDiCwCxhv4aX8i47Q9MOXKIXAEgKFDAxNenFnkHFkEQb/+5RE9QADBV+6LQRgAltMZtWglABa0gEKuaiAC3vAoeM1MAAWYQILzHIICTw5nW7RcBUEpjnkHEoDmA3lH0Xw/cQVFJCxdNqCh2E2Xy+dJs3JsiossdgrUcoTkRIc5t++OWO8ToPJNi5D0XIXSYEJxaidDVAy5PlocIZPW62fVpyLigBQBAHrIuVrJOFrg5pLCcSAkokPocwjSNHPHN0//////////+QhCj7qaGYVYmpqaAAAGq7AwgBlh8VBaQtGWez8jOC40Cs8QWdoEoqxgWS1OGgVhKDhH+mSYIkesyxKFQLAOJPHUkiRlkHQGoXY9YwWxnKGEht1WcAxxbxjowl8ZZOpjMoTFYLhMp1UWNzTcRKlEThVyzRJ9C5JpucTzZNnKasIvafZ4+7b8Nv83+Mazrf1JvUKBJrxNz2pLmfWWKB/Cz8x/7RM5/1Ce/+L76+P5VVv//Of/6N7Pce0F4fxJEPU6bWE3FR6oN5kpCbjkeTdixgeMWuvWJWbPnn/+5RkagAFn1nIzmXgAoEqWPDHsABTQW8/uPeACTkOaPcYsABbsyzEjbu+fchSvlqOGJ9HCWDt1LSxKyl8Ukl5ZzCMTzuj69ziub5eq/GI1/jU05e/Vyef+sLP2UOTjPezyH/2pWN3Kd+UX7tbbLmTSNimTrrEzKqWI82ZXEVz/f+APYQWsTYAFgsDYkDgbEotLbToGU/zJZiBhooccZojHRxKjGTDmIYgELVTQ6I2QqDhXYc7gxAUg/WKLpvmqB/Aa3CjVqNWDqJq6FkPVCvUdaazrdNQLVgv4+X93OD48uq7h+33naGTRWem5b5x8/PzbP34OY+8UeZuq839/vV6xL5/9b/XgaviJ9X39eff////zE3/////R5XdMx9Zlv5kMT+fb+7lKgBsvQwB1JIZFR4wVnWT2FlJ/9ydOZTEtzzjSMAwIrF0HW4nk9iLot6Z7fXzZ9ce865weBD+l9AJVqCZJWiEQsTcMVtf+2qtxuAtqJsBk0mAUCkVg8GmyjH/+5RkCQADSzRfbjFgBDyCa4/GlACMzGFh/PMACSAXa/+SUACjoDx0SmqACERx/bjtG4yJBsfEURAKyS7HTNFQ7ithQtedceTij5ucmkWN8luex6UdfP/y85Ma9PZExfX7fX5N6mDZIDUU5B4GFjoqoho+gmvcXDwfOFEQBAJAImIAIgAEBgoCAACgBWBb6r87R1ptBJTt9CIxPHoSUlxjgK9m/SEj3c159dg8LocfP5dBMH0/+r8bNvCqREJgBAo3AsBPzmJsdpUPjpXS9g9FMzKZrbNwgKTOuEDqnHmTRomLkbR2pd3RDi2Tznwzv//7otGijIoTEh2G3Q46FAgGDpWjmXd5f7f/7jYhgVdpAWecCrcCQt2IrHuQFiFFHxnaDIwAAJAFyyJGMwQlgONtlkI6kliXEWGr3/aI4kBnKOqNM539ilaUrLMZH/lUzP+ubGjlo8qZtgiBDTywUCohJd1f/r7rKml6giMBAAJEqYxixGCLCoy4k/LilUWoA4T/+5RkDIIDKhvW+ekyIkcDiu8kYoQMtHVX56UMiSmMKrj0jJnnxKuJignB5BdoZW+9uSWOWnCfrsssUm7dsQBie/NwY8W5Mcwd2coQYLGa4lTralcVA1UmoIyYTV/+2yAhmrb2/n/usGNZ7WlQTff6IlqcUUhEAJEqA8DKDVVREeIr8esjOrIUkuirufCdazjA811RD9N4LbvbaQCrw4dHvhMDz5A2w6KgoASjBS/Z+oFXtQIWF1JaIlkIxIAVMLauzmL6Rl2Q88yap03k8jXbwTjyBATEib0nyZFm3bJLlisBM01260qLqxtjRyN3m+oeF0gaslaUUUQ+FPb3T5AmE9qgnWRkokRC7/ODQPHdJPvq//9E2/SxEVK8v8htbsiCAAAgWWvTAjwQFpoiNLhYgE54RXwYLM+nGalvD2YxIJBjCwcqYng0c1/O3ts1SX8vgE9ZFUddfs8VPyCUwUA1wwzDBe2/+arbfpkEAAkBTABB0BwGgTAGdBCwAkBHJh7/+5RkDAADMxjUaYxJwkuiap8xIygM4G9Tp5kQmQkTrXzAmmOsHqFdAdFFCiEr5yxbLwZtWEEdVovOs23MAvAStVLKV8IXKgKrT8ncmLedi7bB/cA3VbAaKlqOq5/HaA4InbPz5nmuucADoe6xcBNt7tSPMuqIZAAAJBShDfodhw8JW8ZZJHhUwH3Fw7/DalLuM1CoAAQXCh4QvMhMrHIu0JKhUHpigUiESAQcKQCBYuIlFAIIUGgiPNQr+3/qOciRRBARJTh8shKgNIuRVKUxSdti8UYsSmgfCmU53r4EGDk9h+UaQORLKigsxpCqsGqz2zQThjt29fjfjzCmksKQOfPf4ErnOwvcZIT9DQVP/9TFYZiYuyTT96/zSiWVZKgcauvX/Fd2hVVUNhuyQBJGdRxhU4uKqjyBE8rLjlmFbTMFLMEjhIDHv6NmRNmf/x/F/5cxOiRvEoLByWYmOhp3cSRgUq/7/qoYV0MBAAAAIAdHYSUB4FLQkP5cCxrCATz/+5RkDAADcxrQ+e8ackTCep8wwjpL4TlL56RsgQ2T6HjEiTjmdytbVp+p2hSvFX/J3siqX5Wp2r5mJhZB/SmifjK/QQ4ShGCxzKeZDGcp/kktH8kDWWOSZDARPRv7gK6He3vFplnf/ISQ4UblSirr/7W5uvEVbi7d/41VMOCGZhBRugHYuN2QEgAmo6plMR15BTDpS6GyW+h+zjhlE8LMf//ITt//LrTQsNbb/J9Zyp169ismbG93VWFmoE0ymLyzqiiAgAXG5uD/P1BnCX472hAoSyXQ5JvjJEp2tNIkZx/G6bBA1KGgQYzpIzGm5IWHFI3Mrnvebeakn//f8j/pWaH1rsSqWc2dp0jnbn3/7JmdV7+rm4jPHhXFE1r0tJiYoAAAAigB0SlA5VjmyuiQgE4EkySaHa9QarZQzE+i/c44HSRySJ4CDjRhoytL7p/+PEeSed2CYQgcEgTaIoDtrrpKeaNEABAKbd2LYYyuPAvgvmUzBhOEiQkCUASwM4n/+5RkDwACrRjR+eZCQEOC2f4x5jYL0TlD56RriN8N7HyXiJ54Gw8X6M1cW+MDfWrsKucJQ0gMq/komUNiAq4FSIwOpfEowi0zG6KleQCSwEHCweBskbbnvsRfcri9EggAAUkBeGC1nNGwSq4XGArmaGnlPGbIccshyzql3zEm2iXAZItfIUAwLCoVDYKxffIQWDp2wsVDAJDsKevOnvQcxkqRgBAKSS4GO+X2ZRCBlqF/QtpvneXKjA4qgriVakmnNLSUvMmiVGtept5SCQ5tDuocjzRsk/bPpezir/nVJu2kc4xlwvbaEtJd6zQ6R3eZfPv/ZJ9m7oiBSzn3SsPUuzAigOuJgJs0MnJOxdG1Hos5k5GjucbkewcqlX//d9egcowOwg72yIVFgeHHACCQIp/9PT01NnhGAQAAAknKA6Tbgw7HGWOAnUc4qlQxWxVTQozhF1NqtN4r5ZNzwrSNPp7VsAAhMNBEATOaL/+InKoczbIhOQm8yucxCbkEwBj/+5RkJQACy03O+eEWUj8Cqd0kI2JK7FM957BJCP8LZrDEjRj7MQQulP8iNv1ZQ4OWjvqHfxoAAAVtoBJyKgSboha50SOlHFNhEvo0yk1IDQILHJd8pzLwyCCFsP8b6IUbJYLXxxLBnDxp1STleWZlv/9Kz3aKJGABkluAYT6bKlJ0SsMEFQhDZNG46mJhXjMyWnaEijV2W3UQQjhJ2y0PbgCxKEv/f+ooiGu9UlKa1tKv4sNhxYveU5D+e9J/2/3u9i4YA5osaQqZV7oIAAVOEC1I9By09EwqKkMtLA2RufTbvi1rZ3AWUsGCwYCCGdpMJPBVQLQqxvFCAWEaRqjziYSr/tU5CgK2lSZ5l0MQIByXbAOUTklQFwOgfB8rh4B4jOlhhg7ZuucQTkGoy6+ZAqKKQ6gWMbPkZmZ9al/+kwJlkVSkI3uaVC2PdDdkO2QyMxaaVttL+yKt1NKxBTFCCAVrowyW2stA1KFv0hbLb65ETygHpTFEK1a04Ng4gIb/+5RkOwAC0k7O+YMUUj6BiiwFgg3KmJ8zphhtQRKNZGBmJRA3zVydPlFXGVS////puxqodg5reZNm7/MndWf/JPWm/zFfXM98bBIBmkEAqijiJIAzdzxAOh6LS9CEgB3NmijZQuE95VFuWutlsK2FVMstBJuVY76LLWembjBBYkSAGFCwCSE1Ppa8UNIPf/rQVegNg4JAcJFg6bBbQAIAMCuSFKdNYIqoIFhkZHZCSAvBs6hSPpInc9z4qA4OHAHPHf+l0aFJ/6EAAV2ArBonPBCu1MQoShTe7XNf9XsZ9qpd+AAP+gZLrd1p3akdlU8FYXUqpYXEkAAVGvN3ewT7cvODAwWv/t31+k+EtuUdesnV7G0KUzixLoR06olmbZdiqiqzv7N7ttT6aftruhpizihYWJqUcutcZKiaIBXJKbYkBix6RiszxMK5sJ3Ztcpka/ndJlS85HzhllK4TzomBkODyvw6MKWqB1yAbBMTKNvY95k+RrRGFkLBABAgI4n/+5RkT4QSok5JyeYT4kUDee0Z40mKUJ8YyLypwOeOZChhDhBy6cO3WizCTU0ThVTKhLA6LJCj9VhvNbUxMr572iZ6pVQhrx7L5n3lEWWQSMJMsqkMdU/2ogTDpQ1LUgDmIw0+xSPp8q74NAETGx7fpCHkBgwgHtJJbfdIBQ2Ei9iiS4Fg8HgwECBAIpSoj4KVspVh+KNAkISWq9gdCp655vAt6qxRINC8/20T9M/zI5/3sr5eevDsXTYoZDpVDe4LaAc3X7C+k/mRXV/V5vK5X/MCgvHUGw6tbfym3UZ9VRnJVEgkcSR3dZmtOt37p7dv6f/T6V/5QuVKCHLFJbd+mxP/FHcjQI+/uXECJ7zhGKxohM9ZXlY1KlYdgNDNEOUMYLMaFMiPhVqvdmtZbF0KohuyOtfX+j/+n/xVc7/7fut6xwOQ9a6vx5ougb49A6BJJiQoymSK5RLTnwaC0KFVw9GzUl1d/2ZWq5kZlbpVkQ4EZ1WpHor+uT365V/7vT//+5Rkao9yt1FEAeY+EEBoWIAk4pQJATkOBZhRAQuSIZBzCXDoq+3/8Y3/2M/FBCAObWqHRAAtBiifAQCA1BRpVb52s2S5LI2Dq/8pdzkc9Eo10eK9QbhdwiNCt85vHP1ouZJ3FHtp77tE/0fZHon7N6oJwACADvQx9SohjjDiuogvjxhWFb55pURta2RhcxRyGZ73J0P0VvoiQ4ZlVaNv1djz1ZmtRGX9aKt2/33+1vszag1xXTcAbOWQBd6nCJkAAAwE50ngeCHKFx4NgkajxyDQGDg8gbAB82lgNsldzF0/I1VXDWjZv6losVd/pjqv+mkYxQAgLAqKmFTMqgPTSAlvGL6vsVEwoP4QoNGxYoxifXxK5OK3E9Raod2Xk6CZV263XWvqrscMz9Fa3b0ATfVXh3tQen8E8aMctpDNFg+tKkvaxhtKRI5UCFQOo+ei5Y3ApV5GBuyyL3V5hL1tIrGwRIlHhIqrvQBtZxSWLjrVaqwMSGQ1hqCNaJDGiFH/+5RkhwBSYU3DQUYS4DThKHsAIgQHeGkNgIhqgQQJ4NQAjCJAlFF/+Pt02b8lSSXzdgtLH4ihpv64/LHJp/ekvx66X+Hd5lMVFew/KbF2/CeuO7/xf903H92Cr0eRG0lKHlls5APGEG0b1MrTN/Pxtf92++3b1/ZC7yOuo1L/fUJr99PmOau1+DczWWohH8L0eh/nWTbo8/OvyZ/ccZuEf/+Rn/l/L/M//+ZEqKpH+ZFToqJ+iqi+i/yoi+ip9yhgYMh27OZUWpgoIEd1ITFaxUllRQWcDAaskNCYwCgJAlEQaBsJgsBQSlREGgbCYLBUBAUSiINB2dKnUZK3kSJ1948Y9LNCn/I9c763Wf1AVct8rUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5REtg5yOQ+/ACAYIkLiWBAEIy5G6UjKQIBcAPWAH5ARjShVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVACCU025+ZGfywyOy3//ksyP+XMmstIyNWCggQNHI1ls////WWRyMmVgYME6GTLJZ///2WWxyNWWSoZGrWyzL/9WVqCBOhkyhgYMI6GrBQUqFpoVFP9bDILCzOLiv/rFRYk//qF+LCrDKm/4o2sVFtbP6hdmLCsyoXUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5Rkjg/ygl8ruCAaQiiABWAAAAAAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUxBTUUzLjk5LjVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVX/+5RkUY/wAABpAAAACAAADSAAAAEAAAGkAAAAIAAANIAAAARVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVU="}},function(e,t){}]))},6374:function(e,t,n){"use strict";var r=n(2791),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!u.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:l,props:i,_owner:s.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},9117:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),d=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,m={};function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var k=b.prototype=new y;k.constructor=b,v(k,g.prototype),k.isPureReactComponent=!0;var V=Array.isArray,x=Object.prototype.hasOwnProperty,w={current:null},I={key:!0,ref:!0,__self:!0,__source:!0};function S(e,t,r){var a,i={},o=null,s=null;if(null!=t)for(a in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)x.call(t,a)&&!I.hasOwnProperty(a)&&(i[a]=t[a]);var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(a in u=e.defaultProps)void 0===i[a]&&(i[a]=u[a]);return{$$typeof:n,type:e,key:o,ref:s,props:i,_owner:w.current}}function C(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var E=/\/+/g;function T(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function N(e,t,a,i,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return o=o(u=e),e=""===i?"."+T(u,0):i,V(o)?(a="",null!=e&&(a=e.replace(E,"$&/")+"/"),N(o,t,a,"",(function(e){return e}))):null!=o&&(C(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(E,"$&/")+"/")+e)),t.push(o)),1;if(u=0,i=""===i?".":i+":",V(e))for(var c=0;c<e.length;c++){var l=i+T(s=e[c],c);u+=N(s,t,a,l,o)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)u+=N(s=s.value,t,a,l=i+T(s,c++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function A(e,t,n){if(null==e)return e;var r=[],a=0;return N(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function R(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var _={current:null},D={transition:null},F={ReactCurrentDispatcher:_,ReactCurrentBatchConfig:D,ReactCurrentOwner:w};t.Children={map:A,forEach:function(e,t,n){A(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return A(e,(function(){t++})),t},toArray:function(e){return A(e,(function(e){return e}))||[]},only:function(e){if(!C(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=a,t.Profiler=o,t.PureComponent=b,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=F,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=v({},e.props),i=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=w.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)x.call(t,c)&&!I.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){u=Array(c);for(var l=0;l<c;l++)u[l]=arguments[l+2];a.children=u}return{$$typeof:n,type:e.type,key:i,ref:o,props:a,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=S,t.createFactory=function(e){var t=S.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:R}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return _.current.useCallback(e,t)},t.useContext=function(e){return _.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return _.current.useDeferredValue(e)},t.useEffect=function(e,t){return _.current.useEffect(e,t)},t.useId=function(){return _.current.useId()},t.useImperativeHandle=function(e,t,n){return _.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return _.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return _.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return _.current.useMemo(e,t)},t.useReducer=function(e,t,n){return _.current.useReducer(e,t,n)},t.useRef=function(e){return _.current.useRef(e)},t.useState=function(e){return _.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return _.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return _.current.useTransition()},t.version="18.2.0"},2791:function(e,t,n){"use strict";e.exports=n(9117)},184:function(e,t,n){"use strict";e.exports=n(6374)},6813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,u=e[s],c=s+1,l=e[c];if(0>i(u,n))c<a&&0>i(l,u)?(e[r]=l,e[c]=n,r=c):(e[r]=u,e[s]=n,r=s);else{if(!(c<a&&0>i(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var c=[],l=[],h=1,f=null,d=3,p=!1,v=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function k(e){for(var t=r(l);null!==t;){if(null===t.callback)a(l);else{if(!(t.startTime<=e))break;a(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function V(e){if(m=!1,k(e),!v)if(null!==r(c))v=!0,D(x);else{var t=r(l);null!==t&&F(V,t.startTime-e)}}function x(e,n){v=!1,m&&(m=!1,y(C),C=-1),p=!0;var i=d;try{for(k(n),f=r(c);null!==f&&(!(f.expirationTime>n)||e&&!N());){var o=f.callback;if("function"===typeof o){f.callback=null,d=f.priorityLevel;var s=o(f.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?f.callback=s:f===r(c)&&a(c),k(n)}else a(c);f=r(c)}if(null!==f)var u=!0;else{var h=r(l);null!==h&&F(V,h.startTime-n),u=!1}return u}finally{f=null,d=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var w,I=!1,S=null,C=-1,E=5,T=-1;function N(){return!(t.unstable_now()-T<E)}function A(){if(null!==S){var e=t.unstable_now();T=e;var n=!0;try{n=S(!0,e)}finally{n?w():(I=!1,S=null)}}else I=!1}if("function"===typeof b)w=function(){b(A)};else if("undefined"!==typeof MessageChannel){var R=new MessageChannel,_=R.port2;R.port1.onmessage=A,w=function(){_.postMessage(null)}}else w=function(){g(A,0)};function D(e){S=e,I||(I=!0,w())}function F(e,n){C=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,D(x))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(l,e),null===r(c)&&e===r(l)&&(m?(y(C),C=-1):m=!0,F(V,i-o))):(e.sortIndex=s,n(c,e),v||p||(v=!0,D(x))),e},t.unstable_shouldYield=N,t.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}},5296:function(e,t,n){"use strict";e.exports=n(6813)},6699:function(e,t,n){var r=n(2501),a=n(9112),i=n(2132),o=n(890),s=n(4113),u=n(1725),c=n(7616);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},2501:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197;return function(t){t=String(t);for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},1725:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},9112:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},4113:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},890:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},2132:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},7616:function(e,t,n){var r;!function(a,i,o){var s,u=256,c=o.pow(u,6),l=o.pow(2,52),h=2*l,f=255;function d(e,t,n){var r=[],f=g(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(i)]:null==e?function(){try{var e;return s&&(e=s.randomBytes)?e=e(u):(e=new Uint8Array(u),(a.crypto||a.msCrypto).getRandomValues(e)),y(e)}catch(r){var t=a.navigator,n=t&&t.plugins;return[+new Date,a,n,a.screen,y(i)]}}():e,3),r),d=new p(r),b=function(){for(var e=d.g(6),t=c,n=0;e<l;)e=(e+n)*u,t*=u,n=d.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|d.g(4)},b.quick=function(){return d.g(4)/4294967296},b.double=b,g(y(d.S),i),(t.pass||n||function(e,t,n,r){return r&&(r.S&&v(r,d),e.state=function(){return v(d,{})}),n?(o.random=e,t):e})(b,f,"global"in t?t.global:this==o,t.state)}function p(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<u;)o[a]=a++;for(a=0;a<u;a++)o[a]=o[i=f&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=f&a+1],n=n*u+o[f&(o[a]=o[i=f&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(u)}function v(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(m(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[f&a]=f&(n^=19*t[f&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(g(o.random(),i),e.exports){e.exports=d;try{s=n(5042)}catch(b){}}else void 0===(r=function(){return d}.call(t,n,t,e))||(e.exports=r)}("undefined"!==typeof self?self:this,[],Math)},5410:function(){},8628:function(){},1601:function(){},7792:function(){},4977:function(){},5042:function(){},4836:function(e){e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},907:function(e,t,n){"use strict";function r(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}n.d(t,{Z:function(){return r}})},3878:function(e,t,n){"use strict";function r(e){if(Array.isArray(e))return e}n.d(t,{Z:function(){return r}})},4942:function(e,t,n){"use strict";function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,{Z:function(){return r}})},7462:function(e,t,n){"use strict";function r(){return r=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},r.apply(this,arguments)}n.d(t,{Z:function(){return r}})},9199:function(e,t,n){"use strict";function r(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}n.d(t,{Z:function(){return r}})},5267:function(e,t,n){"use strict";function r(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n.d(t,{Z:function(){return r}})},3366:function(e,t,n){"use strict";function r(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}n.d(t,{Z:function(){return r}})},9439:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(3878);var a=n(181),i=n(5267);function o(e,t){return(0,r.Z)(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(u){s=!0,a=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(e,t)||(0,a.Z)(e,t)||(0,i.Z)()}},3433:function(e,t,n){"use strict";n.d(t,{Z:function(){return o}});var r=n(907);var a=n(9199),i=n(181);function o(e){return function(e){if(Array.isArray(e))return(0,r.Z)(e)}(e)||(0,a.Z)(e)||(0,i.Z)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},181:function(e,t,n){"use strict";n.d(t,{Z:function(){return a}});var r=n(907);function a(e,t){if(e){if("string"===typeof e)return(0,r.Z)(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(e,t):void 0}}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}n.amdD=function(){throw new Error("define cannot be used indirect")},n.amdO={},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};n.t=function(r,a){if(1&a&&(r=this(r)),8&a)return r;if("object"===typeof r&&r){if(4&a&&r.__esModule)return r;if(16&a&&"function"===typeof r.then)return r}var i=Object.create(null);n.r(i);var o={};e=e||[null,t({}),t([]),t(t)];for(var s=2&a&&r;"object"==typeof s&&!~e.indexOf(s);s=t(s))Object.getOwnPropertyNames(s).forEach((function(e){o[e]=function(){return r[e]}}));return o.default=function(){return r},n.d(i,o),i}}(),n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},n.p="/",function(){"use strict";var e={};n.r(e),n.d(e,{FirebaseError:function(){return O},SDK_VERSION:function(){return We},_DEFAULT_ENTRY_NAME:function(){return Ne},_addComponent:function(){return De},_addOrOverwriteComponent:function(){return Fe},_apps:function(){return Re},_clearComponents:function(){return Pe},_components:function(){return _e},_getProvider:function(){return Le},_registerComponent:function(){return Oe},_removeServiceInstance:function(){return Me},deleteApp:function(){return He},getApp:function(){return Ze},getApps:function(){return Ge},initializeApp:function(){return je},onLog:function(){return Xe},registerVersion:function(){return Ke},setLogLevel:function(){return Qe}});var t={};n.r(t),n.d(t,{browserFiles:function(){return vN},browserHTTPRequest:function(){return EN},concatenateArrayBuffers:function(){return fT},copyModel:function(){return eN},decodeWeights:function(){return oT},encodeWeights:function(){return aT},fromMemory:function(){return _N},fromMemorySync:function(){return DN},getLoadHandlers:function(){return wT},getModelArtifactsForJSON:function(){return vT},getModelArtifactsInfoForJSON:function(){return gT},getSaveHandlers:function(){return xT},http:function(){return CN},isHTTPScheme:function(){return IN},listModels:function(){return QT},loadWeights:function(){return bN},moveModel:function(){return nN},registerLoadRouter:function(){return VT},registerSaveRouter:function(){return kT},removeModel:function(){return JT},weightsLoaderFactory:function(){return VN},withSaveHandler:function(){return FN},withSaveHandlerSync:function(){return ON}});var r=n(2791),a=n.t(r,2),i=n(1250);n.p;function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function s(){s=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",u=r.toStringTag||"@@toStringTag";function c(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{c({},"")}catch(T){c=function(e,t,n){return e[t]=n}}function l(e,t,n,r){var a=t&&t.prototype instanceof d?t:d,i=Object.create(a.prototype),o=new S(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return E()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=x(o,n);if(s){if(s===f)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=h(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===f)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),i}function h(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(T){return{type:"throw",arg:T}}}e.wrap=l;var f={};function d(){}function p(){}function v(){}var m={};c(m,a,(function(){return this}));var g=Object.getPrototypeOf,y=g&&g(g(C([])));y&&y!==t&&n.call(y,a)&&(m=y);var b=v.prototype=d.prototype=Object.create(m);function k(e){["next","throw","return"].forEach((function(t){c(e,t,(function(e){return this._invoke(t,e)}))}))}function V(e,t){function r(a,i,s,u){var c=h(e[a],e,i);if("throw"!==c.type){var l=c.arg,f=l.value;return f&&"object"==o(f)&&n.call(f,"__await")?t.resolve(f.__await).then((function(e){r("next",e,s,u)}),(function(e){r("throw",e,s,u)})):t.resolve(f).then((function(e){l.value=e,s(l)}),(function(e){return r("throw",e,s,u)}))}u(c.arg)}var a;this._invoke=function(e,n){function i(){return new t((function(t,a){r(e,n,t,a)}))}return a=a?a.then(i,i):i()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return f;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return f}var r=h(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,f;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,f):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,f)}function w(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function I(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function S(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(w,this),this.reset(!0)}function C(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:E}}function E(){return{value:void 0,done:!0}}return p.prototype=v,c(b,"constructor",v),c(v,"constructor",p),p.displayName=c(v,u,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===p||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,v):(e.__proto__=v,c(e,u,"GeneratorFunction")),e.prototype=Object.create(b),e},e.awrap=function(e){return{__await:e}},k(V.prototype),c(V.prototype,i,(function(){return this})),e.AsyncIterator=V,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new V(l(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(b),c(b,u,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=C,S.prototype={constructor:S,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(I),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,f):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),f},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),I(n),f}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;I(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:C(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),f}},e}function u(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){u(i,r,a,o,s,"next",e)}function s(e){u(i,r,a,o,s,"throw",e)}o(void 0)}))}}var l=n(9439),h=n(4942);function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}var v=n(181);function m(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=(0,v.Z)(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function y(e,t){return y=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},y(e,t)}function b(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&y(e,t)}function k(e){return k=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},k(e)}function V(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function x(e,t){if(t&&("object"===o(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function w(e){var t=V();return function(){var n,r=k(e);if(t){var a=k(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return x(this,n)}}function I(e,t,n){return I=V()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&y(a,n.prototype),a},I.apply(null,arguments)}function S(e){var t="function"===typeof Map?new Map:void 0;return S=function(e){if(null===e||!function(e){return-1!==Function.toString.call(e).indexOf("[native code]")}(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return I(e,arguments,k(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),y(n,e)},S(e)}var C=function(e){for(var t=[],n=0,r=0;r<e.length;r++){var a=e.charCodeAt(r);a<128?t[n++]=a:a<2048?(t[n++]=a>>6|192,t[n++]=63&a|128):55296===(64512&a)&&r+1<e.length&&56320===(64512&e.charCodeAt(r+1))?(a=65536+((1023&a)<<10)+(1023&e.charCodeAt(++r)),t[n++]=a>>18|240,t[n++]=a>>12&63|128,t[n++]=a>>6&63|128,t[n++]=63&a|128):(t[n++]=a>>12|224,t[n++]=a>>6&63|128,t[n++]=63&a|128)}return t},E={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray:function(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],a=0;a<e.length;a+=3){var i=e[a],o=a+1<e.length,s=o?e[a+1]:0,u=a+2<e.length,c=u?e[a+2]:0,l=i>>2,h=(3&i)<<4|s>>4,f=(15&s)<<2|c>>6,d=63&c;u||(d=64,o||(f=64)),r.push(n[l],n[h],n[f],n[d])}return r.join("")},encodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(C(e),t)},decodeString:function(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){for(var t=[],n=0,r=0;n<e.length;){var a=e[n++];if(a<128)t[r++]=String.fromCharCode(a);else if(a>191&&a<224){var i=e[n++];t[r++]=String.fromCharCode((31&a)<<6|63&i)}else if(a>239&&a<365){var o=((7&a)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[r++]=String.fromCharCode(55296+(o>>10)),t[r++]=String.fromCharCode(56320+(1023&o))}else{var s=e[n++],u=e[n++];t[r++]=String.fromCharCode((15&a)<<12|(63&s)<<6|63&u)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray:function(e,t){this.init_();for(var n=t?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],a=0;a<e.length;){var i=n[e.charAt(a++)],o=a<e.length?n[e.charAt(a)]:0,s=++a<e.length?n[e.charAt(a)]:64,u=++a<e.length?n[e.charAt(a)]:64;if(++a,null==i||null==o||null==s||null==u)throw Error();var c=i<<2|o>>4;if(r.push(c),64!==s){var l=o<<4&240|s>>2;if(r.push(l),64!==u){var h=s<<6&192|u;r.push(h)}}}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},T=function(e){return function(e){var t=C(e);return E.encodeByteArray(t,!0)}(e).replace(/\./g,"")};function N(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(var n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=N(e[n],t[n]));return e}var A=function(){function e(){var t=this;f(this,e),this.reject=function(){},this.resolve=function(){},this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))}return p(e,[{key:"wrapCallback",value:function(e){var t=this;return function(n,r){n?t.reject(n):t.resolve(r),"function"===typeof e&&(t.promise.catch((function(){})),1===e.length?e(n):e(n,r))}}}]),e}();function R(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=t||"demo-project",r=e.iat||0,a=e.sub||e.user_id;if(!a)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var i=Object.assign({iss:"https://securetoken.google.com/".concat(n),aud:n,iat:r,exp:r+3600,auth_time:r,sub:a,user_id:a,firebase:{sign_in_provider:"custom",identities:{}}},e);return[T(JSON.stringify({alg:"none",type:"JWT"})),T(JSON.stringify(i)),""].join(".")}function _(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function D(){return!function(){try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(e){return!1}}()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function F(){return"object"===typeof indexedDB}var O=function(e){b(n,e);var t=w(n);function n(e,r,a){var i;return f(this,n),(i=t.call(this,r)).code=e,i.customData=a,i.name="FirebaseError",Object.setPrototypeOf(g(i),n.prototype),Error.captureStackTrace&&Error.captureStackTrace(g(i),L.prototype.create),i}return p(n)}(S(Error)),L=function(){function e(t,n,r){f(this,e),this.service=t,this.serviceName=n,this.errors=r}return p(e,[{key:"create",value:function(e){var t=(arguments.length<=1?void 0:arguments[1])||{},n="".concat(this.service,"/").concat(e),r=this.errors[e],a=r?M(r,t):"Error",i="".concat(this.serviceName,": ").concat(a," (").concat(n,")."),o=new O(n,i,t);return o}}]),e}();function M(e,t){return e.replace(P,(function(e,n){var r=t[n];return null!=r?String(r):"<".concat(n,"?>")}))}var P=/\{\$([^}]+)}/g;function z(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function B(e,t){if(e===t)return!0;for(var n=Object.keys(e),r=Object.keys(t),a=0,i=n;a<i.length;a++){var o=i[a];if(!r.includes(o))return!1;var s=e[o],u=t[o];if(U(s)&&U(u)){if(!B(s,u))return!1}else if(s!==u)return!1}for(var c=0,l=r;c<l.length;c++){var h=l[c];if(!n.includes(h))return!1}return!0}function U(e){return null!==e&&"object"===typeof e}function W(e,t){var n=new j(e,t);return n.subscribe.bind(n)}var j=function(){function e(t,n){var r=this;f(this,e),this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then((function(){t(r)})).catch((function(e){r.error(e)}))}return p(e,[{key:"next",value:function(e){this.forEachObserver((function(t){t.next(e)}))}},{key:"error",value:function(e){this.forEachObserver((function(t){t.error(e)})),this.close(e)}},{key:"complete",value:function(){this.forEachObserver((function(e){e.complete()})),this.close()}},{key:"subscribe",value:function(e,t,n){var r,a=this;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(e,t){if("object"!==typeof e||null===e)return!1;var n,r=m(t);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a in e&&"function"===typeof e[a])return!0}}catch(i){r.e(i)}finally{r.f()}return!1}(e,["next","error","complete"])?e:{next:e,error:t,complete:n}).next&&(r.next=Z),void 0===r.error&&(r.error=Z),void 0===r.complete&&(r.complete=Z);var i=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((function(){try{a.finalError?r.error(a.finalError):r.complete()}catch(e){}})),this.observers.push(r),i}},{key:"unsubscribeOne",value:function(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}},{key:"forEachObserver",value:function(e){if(!this.finalized)for(var t=0;t<this.observers.length;t++)this.sendOne(t,e)}},{key:"sendOne",value:function(e,t){var n=this;this.task.then((function(){if(void 0!==n.observers&&void 0!==n.observers[e])try{t(n.observers[e])}catch(r){"undefined"!==typeof console&&console.error&&console.error(r)}}))}},{key:"close",value:function(e){var t=this;this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((function(){t.observers=void 0,t.onNoObservers=void 0})))}}]),e}();function Z(){}function G(e){return e&&e._delegate?e._delegate:e}var H=n(3433),q=function(){function e(t,n,r){f(this,e),this.name=t,this.instanceFactory=n,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return p(e,[{key:"setInstantiationMode",value:function(e){return this.instantiationMode=e,this}},{key:"setMultipleInstances",value:function(e){return this.multipleInstances=e,this}},{key:"setServiceProps",value:function(e){return this.serviceProps=e,this}},{key:"setInstanceCreatedCallback",value:function(e){return this.onInstanceCreated=e,this}}]),e}(),K="[DEFAULT]",X=function(){function e(t,n){f(this,e),this.name=t,this.container=n,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return p(e,[{key:"get",value:function(e){var t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){var n=new A;if(this.instancesDeferred.set(t,n),this.isInitialized(t)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:t});r&&n.resolve(r)}catch(a){}}return this.instancesDeferred.get(t).promise}},{key:"getImmediate",value:function(e){var t,n=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),r=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(a){if(r)return null;throw a}}},{key:"getComponent",value:function(){return this.component}},{key:"setComponent",value:function(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:K})}catch(u){}var t,n=m(this.instancesDeferred.entries());try{for(n.s();!(t=n.n()).done;){var r=(0,l.Z)(t.value,2),a=r[0],i=r[1],o=this.normalizeInstanceIdentifier(a);try{var s=this.getOrInitializeService({instanceIdentifier:o});i.resolve(s)}catch(u){}}}catch(c){n.e(c)}finally{n.f()}}}},{key:"clearInstance",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}},{key:"delete",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Array.from(this.instances.values()),e.next=3,Promise.all([].concat((0,H.Z)(t.filter((function(e){return"INTERNAL"in e})).map((function(e){return e.INTERNAL.delete()}))),(0,H.Z)(t.filter((function(e){return"_delete"in e})).map((function(e){return e._delete()})))));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isComponentSet",value:function(){return null!=this.component}},{key:"isInitialized",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K;return this.instances.has(e)}},{key:"getOptions",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K;return this.instancesOptions.get(e)||{}}},{key:"initialize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.options,n=void 0===t?{}:t,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error("".concat(this.name,"(").concat(r,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));var a,i=this.getOrInitializeService({instanceIdentifier:r,options:n}),o=m(this.instancesDeferred.entries());try{for(o.s();!(a=o.n()).done;){var s=(0,l.Z)(a.value,2),u=s[0],c=s[1],h=this.normalizeInstanceIdentifier(u);r===h&&c.resolve(i)}}catch(f){o.e(f)}finally{o.f()}return i}},{key:"onInit",value:function(e,t){var n,r=this.normalizeInstanceIdentifier(t),a=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;a.add(e),this.onInitCallbacks.set(r,a);var i=this.instances.get(r);return i&&e(i,r),function(){a.delete(e)}}},{key:"invokeOnInitCallbacks",value:function(e,t){var n=this.onInitCallbacks.get(t);if(n){var r,a=m(n);try{for(a.s();!(r=a.n()).done;){var i=r.value;try{i(e,t)}catch(Bv){}}}catch(o){a.e(o)}finally{a.f()}}}},{key:"getOrInitializeService",value:function(e){var t,n=e.instanceIdentifier,r=e.options,a=void 0===r?{}:r,i=this.instances.get(n);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:(t=n,t===K?void 0:t),options:a}),this.instances.set(n,i),this.instancesOptions.set(n,a),this.invokeOnInitCallbacks(i,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,i)}catch(Bv){}return i||null}},{key:"normalizeInstanceIdentifier",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:K;return this.component?this.component.multipleInstances?e:K:e}},{key:"shouldAutoInitialize",value:function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}]),e}();var Q,Y,J=function(){function e(t){f(this,e),this.name=t,this.providers=new Map}return p(e,[{key:"addComponent",value:function(e){var t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}},{key:"addOrOverwriteComponent",value:function(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}},{key:"getProvider",value:function(e){if(this.providers.has(e))return this.providers.get(e);var t=new X(e,this);return this.providers.set(e,t),t}},{key:"getProviders",value:function(){return Array.from(this.providers.values())}}]),e}(),$=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Y||(Y={}));var ee={debug:Y.DEBUG,verbose:Y.VERBOSE,info:Y.INFO,warn:Y.WARN,error:Y.ERROR,silent:Y.SILENT},te=Y.INFO,ne=(Q={},(0,h.Z)(Q,Y.DEBUG,"log"),(0,h.Z)(Q,Y.VERBOSE,"log"),(0,h.Z)(Q,Y.INFO,"info"),(0,h.Z)(Q,Y.WARN,"warn"),(0,h.Z)(Q,Y.ERROR,"error"),Q),re=function(e,t){if(!(t<e.logLevel)){var n=(new Date).toISOString(),r=ne[t];if(!r)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var a,i=arguments.length,o=new Array(i>2?i-2:0),s=2;s<i;s++)o[s-2]=arguments[s];(a=console)[r].apply(a,["[".concat(n,"]  ").concat(e.name,":")].concat(o))}},ae=function(){function e(t){f(this,e),this.name=t,this._logLevel=te,this._logHandler=re,this._userLogHandler=null,$.push(this)}return p(e,[{key:"logLevel",get:function(){return this._logLevel},set:function(e){if(!(e in Y))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}},{key:"setLogLevel",value:function(e){this._logLevel="string"===typeof e?ee[e]:e}},{key:"logHandler",get:function(){return this._logHandler},set:function(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}},{key:"userLogHandler",get:function(){return this._userLogHandler},set:function(e){this._userLogHandler=e}},{key:"debug",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,Y.DEBUG].concat(t)),this._logHandler.apply(this,[this,Y.DEBUG].concat(t))}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,Y.VERBOSE].concat(t)),this._logHandler.apply(this,[this,Y.VERBOSE].concat(t))}},{key:"info",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,Y.INFO].concat(t)),this._logHandler.apply(this,[this,Y.INFO].concat(t))}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,Y.WARN].concat(t)),this._logHandler.apply(this,[this,Y.WARN].concat(t))}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];this._userLogHandler&&this._userLogHandler.apply(this,[this,Y.ERROR].concat(t)),this._logHandler.apply(this,[this,Y.ERROR].concat(t))}}]),e}();function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){(0,h.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var se,ue;var ce=new WeakMap,le=new WeakMap,he=new WeakMap,fe=new WeakMap,de=new WeakMap;var pe={get:function(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return le.get(e);if("objectStoreNames"===t)return e.objectStoreNames||he.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ge(e[t])},set:function(e,t,n){return e[t]=n,!0},has:function(e,t){return e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e}};function ve(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ue||(ue=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(ye(this),n),ge(ce.get(this))}:function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return ge(e.apply(ye(this),n))}:function(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];var i=e.call.apply(e,[ye(this),t].concat(r));return he.set(i,t.sort?t.sort():[t]),ge(i)}}function me(e){return"function"===typeof e?ve(e):(e instanceof IDBTransaction&&function(e){if(!le.has(e)){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("complete",a),e.removeEventListener("error",i),e.removeEventListener("abort",i)},a=function(){t(),r()},i=function(){n(e.error||new DOMException("AbortError","AbortError")),r()};e.addEventListener("complete",a),e.addEventListener("error",i),e.addEventListener("abort",i)}));le.set(e,t)}}(e),t=e,(se||(se=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some((function(e){return t instanceof e}))?new Proxy(e,pe):e);var t}function ge(e){if(e instanceof IDBRequest)return function(e){var t=new Promise((function(t,n){var r=function(){e.removeEventListener("success",a),e.removeEventListener("error",i)},a=function(){t(ge(e.result)),r()},i=function(){n(e.error),r()};e.addEventListener("success",a),e.addEventListener("error",i)}));return t.then((function(t){t instanceof IDBCursor&&ce.set(t,e)})).catch((function(){})),de.set(t,e),t}(e);if(fe.has(e))return fe.get(e);var t=me(e);return t!==e&&(fe.set(e,t),de.set(t,e)),t}var ye=function(e){return de.get(e)};var be,ke,Ve=["get","getKey","getAll","getAllKeys","count"],xe=["put","add","delete","clear"],we=new Map;function Ie(e,t){if(e instanceof IDBDatabase&&!(t in e)&&"string"===typeof t){if(we.get(t))return we.get(t);var n=t.replace(/FromIndex$/,""),r=t!==n,a=xe.includes(n);if(n in(r?IDBIndex:IDBObjectStore).prototype&&(a||Ve.includes(n))){var i=function(){var e=c(s().mark((function e(t){var i,o,u,c,l,h,f=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(o=this.transaction(t,a?"readwrite":"readonly"),u=o.store,c=f.length,l=new Array(c>1?c-1:0),h=1;h<c;h++)l[h-1]=f[h];return r&&(u=u.index(l.shift())),e.next=6,Promise.all([(i=u)[n].apply(i,l),a&&o.done]);case 6:return e.abrupt("return",e.sent[0]);case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}();return we.set(t,i),i}}}pe=function(e){return oe(oe({},e),{},{get:function(t,n,r){return Ie(t,n)||e.get(t,n,r)},has:function(t,n){return!!Ie(t,n)||e.has(t,n)}})}(pe);var Se=function(){function e(t){f(this,e),this.container=t}return p(e,[{key:"getPlatformInfoString",value:function(){return this.container.getProviders().map((function(e){if(function(e){var t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){var t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null})).filter((function(e){return e})).join(" ")}}]),e}();var Ce="@firebase/app",Ee="0.7.33",Te=new ae("@firebase/app"),Ne="[DEFAULT]",Ae=(be={},(0,h.Z)(be,Ce,"fire-core"),(0,h.Z)(be,"@firebase/app-compat","fire-core-compat"),(0,h.Z)(be,"@firebase/analytics","fire-analytics"),(0,h.Z)(be,"@firebase/analytics-compat","fire-analytics-compat"),(0,h.Z)(be,"@firebase/app-check","fire-app-check"),(0,h.Z)(be,"@firebase/app-check-compat","fire-app-check-compat"),(0,h.Z)(be,"@firebase/auth","fire-auth"),(0,h.Z)(be,"@firebase/auth-compat","fire-auth-compat"),(0,h.Z)(be,"@firebase/database","fire-rtdb"),(0,h.Z)(be,"@firebase/database-compat","fire-rtdb-compat"),(0,h.Z)(be,"@firebase/functions","fire-fn"),(0,h.Z)(be,"@firebase/functions-compat","fire-fn-compat"),(0,h.Z)(be,"@firebase/installations","fire-iid"),(0,h.Z)(be,"@firebase/installations-compat","fire-iid-compat"),(0,h.Z)(be,"@firebase/messaging","fire-fcm"),(0,h.Z)(be,"@firebase/messaging-compat","fire-fcm-compat"),(0,h.Z)(be,"@firebase/performance","fire-perf"),(0,h.Z)(be,"@firebase/performance-compat","fire-perf-compat"),(0,h.Z)(be,"@firebase/remote-config","fire-rc"),(0,h.Z)(be,"@firebase/remote-config-compat","fire-rc-compat"),(0,h.Z)(be,"@firebase/storage","fire-gcs"),(0,h.Z)(be,"@firebase/storage-compat","fire-gcs-compat"),(0,h.Z)(be,"@firebase/firestore","fire-fst"),(0,h.Z)(be,"@firebase/firestore-compat","fire-fst-compat"),(0,h.Z)(be,"fire-js","fire-js"),(0,h.Z)(be,"firebase","fire-js-all"),be),Re=new Map,_e=new Map;function De(e,t){try{e.container.addComponent(t)}catch(n){Te.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),n)}}function Fe(e,t){e.container.addOrOverwriteComponent(t)}function Oe(e){var t=e.name;if(_e.has(t))return Te.debug("There were multiple attempts to register component ".concat(t,".")),!1;_e.set(t,e);var n,r=m(Re.values());try{for(r.s();!(n=r.n()).done;){De(n.value,e)}}catch(a){r.e(a)}finally{r.f()}return!0}function Le(e,t){var n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}function Me(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ne;Le(e,t).clearInstance(n)}function Pe(){_e.clear()}var ze=(ke={},(0,h.Z)(ke,"no-app","No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()"),(0,h.Z)(ke,"bad-app-name","Illegal App name: '{$appName}"),(0,h.Z)(ke,"duplicate-app","Firebase App named '{$appName}' already exists with different options or config"),(0,h.Z)(ke,"app-deleted","Firebase App named '{$appName}' already deleted"),(0,h.Z)(ke,"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),(0,h.Z)(ke,"invalid-log-argument","First argument to `onLog` must be null or a function."),(0,h.Z)(ke,"idb-open","Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}."),(0,h.Z)(ke,"idb-get","Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}."),(0,h.Z)(ke,"idb-set","Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}."),(0,h.Z)(ke,"idb-delete","Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."),ke),Be=new L("app","Firebase",ze),Ue=function(){function e(t,n,r){var a=this;f(this,e),this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},n),this._name=n.name,this._automaticDataCollectionEnabled=n.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new q("app",(function(){return a}),"PUBLIC"))}return p(e,[{key:"automaticDataCollectionEnabled",get:function(){return this.checkDestroyed(),this._automaticDataCollectionEnabled},set:function(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}},{key:"name",get:function(){return this.checkDestroyed(),this._name}},{key:"options",get:function(){return this.checkDestroyed(),this._options}},{key:"config",get:function(){return this.checkDestroyed(),this._config}},{key:"container",get:function(){return this._container}},{key:"isDeleted",get:function(){return this._isDeleted},set:function(e){this._isDeleted=e}},{key:"checkDestroyed",value:function(){if(this.isDeleted)throw Be.create("app-deleted",{appName:this._name})}}]),e}(),We="9.10.0";function je(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"!==typeof t){var n=t;t={name:n}}var r=Object.assign({name:Ne,automaticDataCollectionEnabled:!1},t),a=r.name;if("string"!==typeof a||!a)throw Be.create("bad-app-name",{appName:String(a)});var i=Re.get(a);if(i){if(B(e,i.options)&&B(r,i.config))return i;throw Be.create("duplicate-app",{appName:a})}var o,s=new J(a),u=m(_e.values());try{for(u.s();!(o=u.n()).done;){var c=o.value;s.addComponent(c)}}catch(h){u.e(h)}finally{u.f()}var l=new Ue(e,r,s);return Re.set(a,l),l}function Ze(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ne,t=Re.get(e);if(!t)throw Be.create("no-app",{appName:e});return t}function Ge(){return Array.from(Re.values())}function He(e){return qe.apply(this,arguments)}function qe(){return(qe=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.name,!Re.has(n)){e.next=6;break}return Re.delete(n),e.next=5,Promise.all(t.container.getProviders().map((function(e){return e.delete()})));case 5:t.isDeleted=!0;case 6:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ke(e,t,n){var r,a=null!==(r=Ae[e])&&void 0!==r?r:e;n&&(a+="-".concat(n));var i=a.match(/\s|\//),o=t.match(/\s|\//);if(i||o){var s=['Unable to register library "'.concat(a,'" with version "').concat(t,'":')];return i&&s.push('library name "'.concat(a,'" contains illegal characters (whitespace or "/")')),i&&o&&s.push("and"),o&&s.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void Te.warn(s.join(" "))}Oe(new q("".concat(a,"-version"),(function(){return{library:a,version:t}}),"VERSION"))}function Xe(e,t){if(null!==e&&"function"!==typeof e)throw Be.create("invalid-log-argument");!function(e,t){var n,r=m($);try{var a=function(){var r=n.value,a=null;t&&t.level&&(a=ee[t.level]),r.userLogHandler=null===e?null:function(t,n){for(var r=arguments.length,i=new Array(r>2?r-2:0),o=2;o<r;o++)i[o-2]=arguments[o];var s=i.map((function(e){if(null==e)return null;if("string"===typeof e)return e;if("number"===typeof e||"boolean"===typeof e)return e.toString();if(e instanceof Error)return e.message;try{return JSON.stringify(e)}catch(t){return null}})).filter((function(e){return e})).join(" ");n>=(null!==a&&void 0!==a?a:t.logLevel)&&e({level:Y[n].toLowerCase(),message:s,args:i,type:t.name})}};for(r.s();!(n=r.n()).done;)a()}catch(i){r.e(i)}finally{r.f()}}(e,t)}function Qe(e){var t;t=e,$.forEach((function(e){e.setLogLevel(t)}))}var Ye="firebase-heartbeat-store",Je=null;function $e(){return Je||(Je=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.blocked,a=n.upgrade,i=n.blocking,o=n.terminated,s=indexedDB.open(e,t),u=ge(s);return a&&s.addEventListener("upgradeneeded",(function(e){a(ge(s.result),e.oldVersion,e.newVersion,ge(s.transaction))})),r&&s.addEventListener("blocked",(function(){return r()})),u.then((function(e){o&&e.addEventListener("close",(function(){return o()})),i&&e.addEventListener("versionchange",(function(){return i()}))})).catch((function(){})),u}("firebase-heartbeat-database",1,{upgrade:function(e,t){if(0===t)e.createObjectStore(Ye)}}).catch((function(e){throw Be.create("idb-open",{originalErrorMessage:e.message})}))),Je}function et(e){return tt.apply(this,arguments)}function tt(){return tt=c(s().mark((function e(t){var n,r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$e();case 3:return r=e.sent,e.abrupt("return",r.transaction(Ye).objectStore(Ye).get(at(t)));case 7:e.prev=7,e.t0=e.catch(0),e.t0 instanceof O?Te.warn(e.t0.message):(a=Be.create("idb-get",{originalErrorMessage:null===(n=e.t0)||void 0===n?void 0:n.message}),Te.warn(a.message));case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),tt.apply(this,arguments)}function nt(e,t){return rt.apply(this,arguments)}function rt(){return rt=c(s().mark((function e(t,n){var r,a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,$e();case 3:return a=e.sent,i=a.transaction(Ye,"readwrite"),o=i.objectStore(Ye),e.next=8,o.put(n,at(t));case 8:return e.abrupt("return",i.done);case 11:e.prev=11,e.t0=e.catch(0),e.t0 instanceof O?Te.warn(e.t0.message):(u=Be.create("idb-set",{originalErrorMessage:null===(r=e.t0)||void 0===r?void 0:r.message}),Te.warn(u.message));case 14:case"end":return e.stop()}}),e,null,[[0,11]])}))),rt.apply(this,arguments)}function at(e){return"".concat(e.name,"!").concat(e.options.appId)}var it=function(){function e(t){var n=this;f(this,e),this.container=t,this._heartbeatsCache=null;var r=this.container.getProvider("app").getImmediate();this._storage=new lt(r),this._heartbeatsCachePromise=this._storage.read().then((function(e){return n._heartbeatsCache=e,e}))}return p(e,[{key:"triggerHeartbeat",value:function(){var e=c(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.container.getProvider("platform-logger").getImmediate(),n=t.getPlatformInfoString(),r=ot(),null!==this._heartbeatsCache){e.next=7;break}return e.next=6,this._heartbeatsCachePromise;case 6:this._heartbeatsCache=e.sent;case 7:if(this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((function(e){return e.date===r}))){e.next=11;break}return e.abrupt("return");case 11:this._heartbeatsCache.heartbeats.push({date:r,agent:n});case 12:return this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((function(e){var t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),e.abrupt("return",this._storage.overwrite(this._heartbeatsCache));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getHeartbeatsHeader",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==this._heartbeatsCache){e.next=3;break}return e.next=3,this._heartbeatsCachePromise;case 3:if(null!==this._heartbeatsCache&&0!==this._heartbeatsCache.heartbeats.length){e.next=5;break}return e.abrupt("return","");case 5:if(t=ot(),n=st(this._heartbeatsCache.heartbeats),r=n.heartbeatsToSend,a=n.unsentEntries,i=T(JSON.stringify({version:2,heartbeats:r})),this._heartbeatsCache.lastSentHeartbeatDate=t,!(a.length>0)){e.next=15;break}return this._heartbeatsCache.heartbeats=a,e.next=13,this._storage.overwrite(this._heartbeatsCache);case 13:e.next=17;break;case 15:this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache);case 17:return e.abrupt("return",i);case 18:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function ot(){return(new Date).toISOString().substring(0,10)}function st(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,r=[],a=e.slice(),i=m(e);try{var o=function(){var e=t.value,i=r.find((function(t){return t.agent===e.agent}));if(i){if(i.dates.push(e.date),ht(r)>n)return i.dates.pop(),"break"}else if(r.push({agent:e.agent,dates:[e.date]}),ht(r)>n)return r.pop(),"break";a=a.slice(1)};for(i.s();!(t=i.n()).done;){var s=o();if("break"===s)break}}catch(u){i.e(u)}finally{i.f()}return{heartbeatsToSend:r,unsentEntries:a}}var ut,ct,lt=function(){function e(t){f(this,e),this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}return p(e,[{key:"runIndexedDBEnvironmentCheck",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F()){e.next=4;break}return e.abrupt("return",!1);case 4:return e.abrupt("return",new Promise((function(e,t){try{var n=!0,r="validate-browser-context-for-indexeddb-analytics-module",a=self.indexedDB.open(r);a.onsuccess=function(){a.result.close(),n||self.indexedDB.deleteDatabase(r),e(!0)},a.onupgradeneeded=function(){n=!1},a.onerror=function(){var e;t((null===(e=a.error)||void 0===e?void 0:e.message)||"")}}catch(i){t(i)}})).then((function(){return!0})).catch((function(){return!1})));case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"read",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return",{heartbeats:[]});case 7:return e.next=9,et(this.app);case 9:return t=e.sent,e.abrupt("return",t||{heartbeats:[]});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"overwrite",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.read();case 9:return r=e.sent,e.abrupt("return",nt(this.app,{lastSentHeartbeatDate:null!==(n=t.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:t.heartbeats}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"add",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._canUseIndexedDBPromise;case 2:if(e.sent){e.next=7;break}return e.abrupt("return");case 7:return e.next=9,this.read();case 9:return r=e.sent,e.abrupt("return",nt(this.app,{lastSentHeartbeatDate:null!==(n=t.lastSentHeartbeatDate)&&void 0!==n?n:r.lastSentHeartbeatDate,heartbeats:[].concat((0,H.Z)(r.heartbeats),(0,H.Z)(t.heartbeats))}));case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function ht(e){return T(JSON.stringify({version:2,heartbeats:e})).length}ut="",Oe(new q("platform-logger",(function(e){return new Se(e)}),"PRIVATE")),Oe(new q("heartbeat",(function(e){return new it(e)}),"PRIVATE")),Ke(Ce,Ee,ut),Ke(Ce,Ee,"esm2017"),Ke("fire-js","");var ft=function(){function e(t,n){var r=this;f(this,e),this._delegate=t,this.firebase=n,De(t,new q("app-compat",(function(){return r}),"PUBLIC")),this.container=t.container}return p(e,[{key:"automaticDataCollectionEnabled",get:function(){return this._delegate.automaticDataCollectionEnabled},set:function(e){this._delegate.automaticDataCollectionEnabled=e}},{key:"name",get:function(){return this._delegate.name}},{key:"options",get:function(){return this._delegate.options}},{key:"delete",value:function(){var e=this;return new Promise((function(t){e._delegate.checkDestroyed(),t()})).then((function(){return e.firebase.INTERNAL.removeApp(e.name),He(e._delegate)}))}},{key:"_getService",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ne;this._delegate.checkDestroyed();var r=this._delegate.container.getProvider(e);return r.isInitialized()||"EXPLICIT"!==(null===(t=r.getComponent())||void 0===t?void 0:t.instantiationMode)||r.initialize(),r.getImmediate({identifier:n})}},{key:"_removeServiceInstance",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Ne;this._delegate.container.getProvider(e).clearInstance(t)}},{key:"_addComponent",value:function(e){De(this._delegate,e)}},{key:"_addOrOverwriteComponent",value:function(e){Fe(this._delegate,e)}},{key:"toJSON",value:function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}}}]),e}(),dt=(ct={},(0,h.Z)(ct,"no-app","No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()"),(0,h.Z)(ct,"invalid-app-argument","firebase.{$appName}() takes either no argument or a Firebase App instance."),ct),pt=new L("app-compat","Firebase",dt);var vt=function t(){var n=function(t){var n={},r={__esModule:!0,initializeApp:function(e){var a=je(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});if(z(n,a.name))return n[a.name];var i=new t(a,r);return n[a.name]=i,i},app:a,registerVersion:Ke,setLogLevel:Qe,onLog:Xe,apps:null,SDK_VERSION:We,INTERNAL:{registerComponent:function(e){var n=e.name,i=n.replace("-compat","");if(Oe(e)&&"PUBLIC"===e.type){var o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:a();if("function"!==typeof e[i])throw pt.create("invalid-app-argument",{appName:n});return e[i]()};void 0!==e.serviceProps&&N(o,e.serviceProps),r[i]=o,t.prototype[i]=function(){for(var t=this._getService.bind(this,n),r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return t.apply(this,e.multipleInstances?a:[])}}return"PUBLIC"===e.type?r[i]:null},removeApp:function(e){delete n[e]},useAsService:function(e,t){return"serverAuth"===t?null:t},modularAPIs:e}};function a(e){if(!z(n,e=e||Ne))throw pt.create("no-app",{appName:e});return n[e]}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(n).map((function(e){return n[e]}))}}),a.App=t,r}(ft);return n.INTERNAL=Object.assign(Object.assign({},n.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(e){N(n,e)},createSubscribe:W,ErrorFactory:L,deepExtend:N}),n}(),mt=new ae("@firebase/app-compat");if("object"===typeof self&&self.self===self&&void 0!==self.firebase){mt.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var gt=self.firebase.SDK_VERSION;gt&&gt.indexOf("LITE")>=0&&mt.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var yt=vt;!function(e){Ke("@firebase/app-compat","0.1.34",e)}();function bt(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=k(e)););return e}function kt(){return kt="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=bt(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},kt.apply(this,arguments)}yt.registerVersion("firebase","9.10.0","app-compat");var Vt,xt="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:"undefined"!==typeof self?self:{},wt={},It=It||{},St=xt||self;function Ct(){}function Et(e){var t=typeof e;return"array"==(t="object"!=t?t:e?Array.isArray(e)?"array":t:"null")||"object"==t&&"number"==typeof e.length}function Tt(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}var Nt="closure_uid_"+(1e9*Math.random()>>>0),At=0;function Rt(e,t,n){return e.call.apply(e.bind,arguments)}function _t(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function Dt(e,t,n){return(Dt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Rt:_t).apply(null,arguments)}function Ft(e,t){var n=Array.prototype.slice.call(arguments,1);return function(){var t=n.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function Ot(e,t){function n(){}n.prototype=t.prototype,e.X=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.Vb=function(e,n,r){for(var a=Array(arguments.length-2),i=2;i<arguments.length;i++)a[i-2]=arguments[i];return t.prototype[n].apply(e,a)}}function Lt(){this.s=this.s,this.o=this.o}var Mt={};Lt.prototype.s=!1,Lt.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var e=function(e){return Object.prototype.hasOwnProperty.call(e,Nt)&&e[Nt]||(e[Nt]=++At)}(this);delete Mt[e]}},Lt.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Pt=Array.prototype.indexOf?function(e,t){return Array.prototype.indexOf.call(e,t,void 0)}:function(e,t){if("string"===typeof e)return"string"!==typeof t||1!=t.length?-1:e.indexOf(t,0);for(var n=0;n<e.length;n++)if(n in e&&e[n]===t)return n;return-1};function zt(e){var t=e.length;if(0<t){for(var n=Array(t),r=0;r<t;r++)n[r]=e[r];return n}return[]}function Bt(e,t){for(var n=1;n<arguments.length;n++){var r=arguments[n];if(Et(r)){var a=e.length||0,i=r.length||0;e.length=a+i;for(var o=0;o<i;o++)e[a+o]=r[o]}else e.push(r)}}function Ut(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}Ut.prototype.h=function(){this.defaultPrevented=!0};var Wt=function(){if(!St.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{St.addEventListener("test",Ct,t),St.removeEventListener("test",Ct,t)}catch(n){}return e}();function jt(e){return/^[\s\xa0]*$/.test(e)}var Zt=String.prototype.trim?function(e){return e.trim()}:function(e){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(e)[1]};function Gt(e,t){return e<t?-1:e>t?1:0}function Ht(){var e=St.navigator;return e&&(e=e.userAgent)?e:""}function qt(e){return-1!=Ht().indexOf(e)}function Kt(e){return Kt[" "](e),e}Kt[" "]=Ct;var Xt,Qt=qt("Opera"),Yt=qt("Trident")||qt("MSIE"),Jt=qt("Edge"),$t=Jt||Yt,en=qt("Gecko")&&!(-1!=Ht().toLowerCase().indexOf("webkit")&&!qt("Edge"))&&!(qt("Trident")||qt("MSIE"))&&!qt("Edge"),tn=-1!=Ht().toLowerCase().indexOf("webkit")&&!qt("Edge");function nn(){var e=St.document;return e?e.documentMode:void 0}e:{var rn="",an=function(){var e=Ht();return en?/rv:([^\);]+)(\)|;)/.exec(e):Jt?/Edge\/([\d\.]+)/.exec(e):Yt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(e):tn?/WebKit\/(\S+)/.exec(e):Qt?/(?:Version)[ \/]?(\S+)/.exec(e):void 0}();if(an&&(rn=an?an[1]:""),Yt){var on=nn();if(null!=on&&on>parseFloat(rn)){Xt=String(on);break e}}Xt=rn}var sn,un={};function cn(){return function(e){var t=un;return Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=e(9)}((function(){for(var e=0,t=Zt(String(Xt)).split("."),n=Zt("9").split("."),r=Math.max(t.length,n.length),a=0;0==e&&a<r;a++){var i=t[a]||"",o=n[a]||"";do{if(i=/(\d*)(\D*)(.*)/.exec(i)||["","","",""],o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],0==i[0].length&&0==o[0].length)break;e=Gt(0==i[1].length?0:parseInt(i[1],10),0==o[1].length?0:parseInt(o[1],10))||Gt(0==i[2].length,0==o[2].length)||Gt(i[2],o[2]),i=i[3],o=o[3]}while(0==e)}return 0<=e}))}if(St.document&&Yt){var ln=nn();sn=ln||(parseInt(Xt,10)||void 0)}else sn=void 0;var hn=sn;function fn(e,t){if(Ut.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e){var n=this.type=e.type,r=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;if(this.target=e.target||e.srcElement,this.g=t,t=e.relatedTarget){if(en){e:{try{Kt(t.nodeName);var a=!0;break e}catch(i){}a=!1}a||(t=null)}}else"mouseover"==n?t=e.fromElement:"mouseout"==n&&(t=e.toElement);this.relatedTarget=t,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType="string"===typeof e.pointerType?e.pointerType:dn[e.pointerType]||"",this.state=e.state,this.i=e,e.defaultPrevented&&fn.X.h.call(this)}}Ot(fn,Ut);var dn={2:"touch",3:"pen",4:"mouse"};fn.prototype.h=function(){fn.X.h.call(this);var e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var pn="closure_listenable_"+(1e6*Math.random()|0),vn=0;function mn(e,t,n,r,a){this.listener=e,this.proxy=null,this.src=t,this.type=n,this.capture=!!r,this.ha=a,this.key=++vn,this.ba=this.ea=!1}function gn(e){e.ba=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function yn(e,t,n){for(var r in e)t.call(n,e[r],r,e)}function bn(e){var t={};for(var n in e)t[n]=e[n];return t}var kn="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Vn(e,t){for(var n,r,a=1;a<arguments.length;a++){for(n in r=arguments[a])e[n]=r[n];for(var i=0;i<kn.length;i++)n=kn[i],Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}}function xn(e){this.src=e,this.g={},this.h=0}function wn(e,t){var n=t.type;if(n in e.g){var r,a=e.g[n],i=Pt(a,t);(r=0<=i)&&Array.prototype.splice.call(a,i,1),r&&(gn(t),0==e.g[n].length&&(delete e.g[n],e.h--))}}function In(e,t,n,r){for(var a=0;a<e.length;++a){var i=e[a];if(!i.ba&&i.listener==t&&i.capture==!!n&&i.ha==r)return a}return-1}xn.prototype.add=function(e,t,n,r,a){var i=e.toString();(e=this.g[i])||(e=this.g[i]=[],this.h++);var o=In(e,t,r,a);return-1<o?(t=e[o],n||(t.ea=!1)):((t=new mn(t,this.src,i,!!r,a)).ea=n,e.push(t)),t};var Sn="closure_lm_"+(1e6*Math.random()|0),Cn={};function En(e,t,n,r,a){if(r&&r.once)return Nn(e,t,n,r,a);if(Array.isArray(t)){for(var i=0;i<t.length;i++)En(e,t[i],n,r,a);return null}return n=Ln(n),e&&e[pn]?e.N(t,n,Tt(r)?!!r.capture:!!r,a):Tn(e,t,n,!1,r,a)}function Tn(e,t,n,r,a,i){if(!t)throw Error("Invalid event type");var o=Tt(a)?!!a.capture:!!a,s=Fn(e);if(s||(e[Sn]=s=new xn(e)),(n=s.add(t,n,r,o,i)).proxy)return n;if(r=function(){function e(n){return t.call(e.src,e.listener,n)}var t=Dn;return e}(),n.proxy=r,r.src=e,r.listener=n,e.addEventListener)Wt||(a=o),void 0===a&&(a=!1),e.addEventListener(t.toString(),r,a);else if(e.attachEvent)e.attachEvent(_n(t.toString()),r);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(r)}return n}function Nn(e,t,n,r,a){if(Array.isArray(t)){for(var i=0;i<t.length;i++)Nn(e,t[i],n,r,a);return null}return n=Ln(n),e&&e[pn]?e.O(t,n,Tt(r)?!!r.capture:!!r,a):Tn(e,t,n,!0,r,a)}function An(e,t,n,r,a){if(Array.isArray(t))for(var i=0;i<t.length;i++)An(e,t[i],n,r,a);else r=Tt(r)?!!r.capture:!!r,n=Ln(n),e&&e[pn]?(e=e.i,(t=String(t).toString())in e.g&&(-1<(n=In(i=e.g[t],n,r,a))&&(gn(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete e.g[t],e.h--)))):e&&(e=Fn(e))&&(t=e.g[t.toString()],e=-1,t&&(e=In(t,n,r,a)),(n=-1<e?t[e]:null)&&Rn(n))}function Rn(e){if("number"!==typeof e&&e&&!e.ba){var t=e.src;if(t&&t[pn])wn(t.i,e);else{var n=e.type,r=e.proxy;t.removeEventListener?t.removeEventListener(n,r,e.capture):t.detachEvent?t.detachEvent(_n(n),r):t.addListener&&t.removeListener&&t.removeListener(r),(n=Fn(t))?(wn(n,e),0==n.h&&(n.src=null,t[Sn]=null)):gn(e)}}}function _n(e){return e in Cn?Cn[e]:Cn[e]="on"+e}function Dn(e,t){if(e.ba)e=!0;else{t=new fn(t,this);var n=e.listener,r=e.ha||e.src;e.ea&&Rn(e),e=n.call(r,t)}return e}function Fn(e){return(e=e[Sn])instanceof xn?e:null}var On="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ln(e){return"function"===typeof e?e:(e[On]||(e[On]=function(t){return e.handleEvent(t)}),e[On])}function Mn(){Lt.call(this),this.i=new xn(this),this.P=this,this.I=null}function Pn(e,t){var n,r=e.I;if(r)for(n=[];r;r=r.I)n.push(r);if(e=e.P,r=t.type||t,"string"===typeof t)t=new Ut(t,e);else if(t instanceof Ut)t.target=t.target||e;else{var a=t;Vn(t=new Ut(r,e),a)}if(a=!0,n)for(var i=n.length-1;0<=i;i--){var o=t.g=n[i];a=zn(o,r,!0,t)&&a}if(a=zn(o=t.g=e,r,!0,t)&&a,a=zn(o,r,!1,t)&&a,n)for(i=0;i<n.length;i++)a=zn(o=t.g=n[i],r,!1,t)&&a}function zn(e,t,n,r){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();for(var a=!0,i=0;i<t.length;++i){var o=t[i];if(o&&!o.ba&&o.capture==n){var s=o.listener,u=o.ha||o.src;o.ea&&wn(e.i,o),a=!1!==s.call(u,r)&&a}}return a&&!r.defaultPrevented}Ot(Mn,Lt),Mn.prototype[pn]=!0,Mn.prototype.removeEventListener=function(e,t,n,r){An(this,e,t,n,r)},Mn.prototype.M=function(){if(Mn.X.M.call(this),this.i){var e,t=this.i;for(e in t.g){for(var n=t.g[e],r=0;r<n.length;r++)gn(n[r]);delete t.g[e],t.h--}}this.I=null},Mn.prototype.N=function(e,t,n,r){return this.i.add(String(e),t,!1,n,r)},Mn.prototype.O=function(e,t,n,r){return this.i.add(String(e),t,!0,n,r)};var Bn=St.JSON.stringify;function Un(){var e=Xn,t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var Wn,jn=function(){function e(){f(this,e),this.h=this.g=null}return p(e,[{key:"add",value:function(e,t){var n=Zn.get();n.set(e,t),this.h?this.h.next=n:this.g=n,this.h=n}}]),e}(),Zn=new(function(){function e(t,n){f(this,e),this.i=t,this.j=n,this.h=0,this.g=null}return p(e,[{key:"get",value:function(){var e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}]),e}())((function(){return new Gn}),(function(e){return e.reset()})),Gn=function(){function e(){f(this,e),this.next=this.g=this.h=null}return p(e,[{key:"set",value:function(e,t){this.h=e,this.g=t,this.next=null}},{key:"reset",value:function(){this.next=this.g=this.h=null}}]),e}();function Hn(e){St.setTimeout((function(){throw e}),0)}function qn(e,t){Wn||function(){var e=St.Promise.resolve(void 0);Wn=function(){e.then(Qn)}}(),Kn||(Wn(),Kn=!0),Xn.add(e,t)}var Kn=!1,Xn=new jn;function Qn(){for(var e;e=Un();){try{e.h.call(e.g)}catch(n){Hn(n)}var t=Zn;t.j(e),100>t.h&&(t.h++,e.next=t.g,t.g=e)}Kn=!1}function Yn(e,t){Mn.call(this),this.h=e||1,this.g=t||St,this.j=Dt(this.kb,this),this.l=Date.now()}function Jn(e){e.ca=!1,e.R&&(e.g.clearTimeout(e.R),e.R=null)}function $n(e,t,n){if("function"===typeof e)n&&(e=Dt(e,n));else{if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=Dt(e.handleEvent,e)}return 2147483647<Number(t)?-1:St.setTimeout(e,t||0)}function er(e){e.g=$n((function(){e.g=null,e.i&&(e.i=!1,er(e))}),e.j);var t=e.h;e.h=null,e.m.apply(null,t)}Ot(Yn,Mn),(Vt=Yn.prototype).ca=!1,Vt.R=null,Vt.kb=function(){if(this.ca){var e=Date.now()-this.l;0<e&&e<.8*this.h?this.R=this.g.setTimeout(this.j,this.h-e):(this.R&&(this.g.clearTimeout(this.R),this.R=null),Pn(this,"tick"),this.ca&&(Jn(this),this.start()))}},Vt.start=function(){this.ca=!0,this.R||(this.R=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Vt.M=function(){Yn.X.M.call(this),Jn(this),delete this.g};var tr=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).m=e,a.j=r,a.h=null,a.i=!1,a.g=null,a}return p(n,[{key:"l",value:function(e){this.h=arguments,this.g?this.i=!0:er(this)}},{key:"M",value:function(){kt(k(n.prototype),"M",this).call(this),this.g&&(St.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}]),n}(Lt);function nr(e){Lt.call(this),this.h=e,this.g={}}Ot(nr,Lt);var rr=[];function ar(e,t,n,r){Array.isArray(n)||(n&&(rr[0]=n.toString()),n=rr);for(var a=0;a<n.length;a++){var i=En(t,n[a],r||e.handleEvent,!1,e.h||e);if(!i)break;e.g[i.key]=i}}function ir(e){yn(e.g,(function(e,t){this.g.hasOwnProperty(t)&&Rn(e)}),e),e.g={}}function or(){this.g=!0}function sr(e,t,n,r){e.info((function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{var n=JSON.parse(t);if(n)for(e=0;e<n.length;e++)if(Array.isArray(n[e])){var r=n[e];if(!(2>r.length)){var a=r[1];if(Array.isArray(a)&&!(1>a.length)){var i=a[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<a.length;o++)a[o]=""}}}return Bn(n)}catch(s){return t}}(e,n)+(r?" "+r:"")}))}nr.prototype.M=function(){nr.X.M.call(this),ir(this)},nr.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},or.prototype.Aa=function(){this.g=!1},or.prototype.info=function(){};var ur={},cr=null;function lr(){return cr=cr||new Mn}function hr(e){Ut.call(this,ur.Oa,e)}function fr(e){var t=lr();Pn(t,new hr(t,e))}function dr(e,t){Ut.call(this,ur.STAT_EVENT,e),this.stat=t}function pr(e){var t=lr();Pn(t,new dr(t,e))}function vr(e,t){Ut.call(this,ur.Pa,e),this.size=t}function mr(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return St.setTimeout((function(){e()}),t)}ur.Oa="serverreachability",Ot(hr,Ut),ur.STAT_EVENT="statevent",Ot(dr,Ut),ur.Pa="timingevent",Ot(vr,Ut);var gr={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,La:7,TIMEOUT:8,Cb:9},yr={qb:"complete",Mb:"success",Ma:"error",La:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function br(){}function kr(e){return e.h||(e.h=e.i())}function Vr(){}br.prototype.h=null;var xr,wr={OPEN:"a",pb:"b",Ma:"c",Bb:"d"};function Ir(){Ut.call(this,"d")}function Sr(){Ut.call(this,"c")}function Cr(){}function Er(e,t,n,r){this.l=e,this.j=t,this.m=n,this.U=r||1,this.S=new nr(this),this.O=Nr,e=$t?125:void 0,this.T=new Yn(e),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.V=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.Y=-1,this.I=!1,this.N=0,this.L=null,this.$=this.J=this.Z=this.P=!1,this.h=new Tr}function Tr(){this.i=null,this.g="",this.h=!1}Ot(Ir,Ut),Ot(Sr,Ut),Ot(Cr,br),Cr.prototype.g=function(){return new XMLHttpRequest},Cr.prototype.i=function(){return{}},xr=new Cr;var Nr=45e3,Ar={},Rr={};function _r(e,t,n){e.K=1,e.v=Yr(Hr(t)),e.s=n,e.P=!0,Dr(e,null)}function Dr(e,t){e.F=Date.now(),Mr(e),e.A=Hr(e.v);var n=e.A,r=e.U;Array.isArray(r)||(r=[String(r)]),la(n.i,"t",r),e.C=0,n=e.l.H,e.h=new Tr,e.g=hi(e.l,n?t:null,!e.s),0<e.N&&(e.L=new tr(Dt(e.Ka,e,e.g),e.N)),ar(e.S,e.g,"readystatechange",e.hb),t=e.H?bn(e.H):{},e.s?(e.u||(e.u="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.da(e.A,e.u,e.s,t)):(e.u="GET",e.g.da(e.A,e.u,null,t)),fr(1),function(e,t,n,r,a,i){e.info((function(){if(e.g)if(i)for(var o="",s=i.split("&"),u=0;u<s.length;u++){var c=s[u].split("=");if(1<c.length){var l=c[0];c=c[1];var h=l.split("_");o=2<=h.length&&"type"==h[1]?o+(l+"=")+c+"&":o+(l+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+a+"]: "+t+"\n"+n+"\n"+o}))}(e.j,e.u,e.A,e.m,e.U,e.s)}function Fr(e){return!!e.g&&("GET"==e.u&&2!=e.K&&e.l.Da)}function Or(e,t,n){for(var r,a=!0;!e.I&&e.C<n.length;){if((r=Lr(e,n))==Rr){4==t&&(e.o=4,pr(14),a=!1),sr(e.j,e.m,null,"[Incomplete Response]");break}if(r==Ar){e.o=4,pr(15),sr(e.j,e.m,n,"[Invalid Chunk]"),a=!1;break}sr(e.j,e.m,r,null),Wr(e,r)}Fr(e)&&r!=Rr&&r!=Ar&&(e.h.g="",e.C=0),4!=t||0!=n.length||e.h.h||(e.o=1,pr(16),a=!1),e.i=e.i&&a,a?0<n.length&&!e.$&&(e.$=!0,(t=e.l).g==e&&t.$&&!t.K&&(t.j.info("Great, no buffering proxy detected. Bytes received: "+n.length),ri(t),t.K=!0,pr(11))):(sr(e.j,e.m,n,"[Invalid Chunked Response]"),Ur(e),Br(e))}function Lr(e,t){var n=e.C,r=t.indexOf("\n",n);return-1==r?Rr:(n=Number(t.substring(n,r)),isNaN(n)?Ar:(r+=1)+n>t.length?Rr:(t=t.substr(r,n),e.C=r+n,t))}function Mr(e){e.V=Date.now()+e.O,Pr(e,e.O)}function Pr(e,t){if(null!=e.B)throw Error("WatchDog timer not null");e.B=mr(Dt(e.fb,e),t)}function zr(e){e.B&&(St.clearTimeout(e.B),e.B=null)}function Br(e){0==e.l.G||e.I||oi(e.l,e)}function Ur(e){zr(e);var t=e.L;t&&"function"==typeof t.na&&t.na(),e.L=null,Jn(e.T),ir(e.S),e.g&&(t=e.g,e.g=null,t.abort(),t.na())}function Wr(e,t){try{var n=e.l;if(0!=n.G&&(n.g==e||ya(n.h,e)))if(!e.J&&ya(n.h,e)&&3==n.G){try{var r=n.Fa.g.parse(t)}catch(i){r=null}if(Array.isArray(r)&&3==r.length){var a=r;if(0==a[0]){e:if(!n.u){if(n.g){if(!(n.g.F+3e3<e.F))break e;ii(n),Xa(n)}ni(n),pr(18)}}else n.Ba=a[1],0<n.Ba-n.T&&37500>a[2]&&n.L&&0==n.A&&!n.v&&(n.v=mr(Dt(n.bb,n),6e3));if(1>=ga(n.h)&&n.ja){try{n.ja()}catch(i){}n.ja=void 0}}else ui(n,11)}else if((e.J||n.g==e)&&ii(n),!jt(t))for(a=n.Fa.g.parse(t),t=0;t<a.length;t++){var i=a[t];if(n.T=i[0],i=i[1],2==n.G)if("c"==i[0]){n.I=i[1],n.ka=i[2];var o=i[3];null!=o&&(n.ma=o,n.j.info("VER="+n.ma));var s=i[4];null!=s&&(n.Ca=s,n.j.info("SVER="+n.Ca));var u=i[5];null!=u&&"number"===typeof u&&0<u&&(r=1.5*u,n.J=r,n.j.info("backChannelRequestTimeoutMs_="+r)),r=n;var c=e.g;if(c){var l=c.g?c.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(l){var h=r.h;h.g||-1==l.indexOf("spdy")&&-1==l.indexOf("quic")&&-1==l.indexOf("h2")||(h.j=h.l,h.g=new Set,h.h&&(ba(h,h.h),h.h=null))}if(r.D){var f=c.g?c.g.getResponseHeader("X-HTTP-Session-Id"):null;f&&(r.za=f,Qr(r.F,r.D,f))}}n.G=3,n.l&&n.l.xa(),n.$&&(n.P=Date.now()-e.F,n.j.info("Handshake RTT: "+n.P+"ms"));var d=e;if((r=n).sa=li(r,r.H?r.ka:null,r.V),d.J){ka(r.h,d);var p=d,v=r.J;v&&p.setTimeout(v),p.B&&(zr(p),Mr(p)),r.g=d}else ti(r);0<n.i.length&&Ya(n)}else"stop"!=i[0]&&"close"!=i[0]||ui(n,7);else 3==n.G&&("stop"==i[0]||"close"==i[0]?"stop"==i[0]?ui(n,7):Ka(n):"noop"!=i[0]&&n.l&&n.l.wa(i),n.A=0)}fr(4)}catch(i){}}function jr(e,t){if(e.forEach&&"function"==typeof e.forEach)e.forEach(t,void 0);else if(Et(e)||"string"===typeof e)Array.prototype.forEach.call(e,t,void 0);else for(var n=function(e){if(e.oa&&"function"==typeof e.oa)return e.oa();if(!e.W||"function"!=typeof e.W){if("undefined"!==typeof Map&&e instanceof Map)return Array.from(e.keys());if(!("undefined"!==typeof Set&&e instanceof Set)){if(Et(e)||"string"===typeof e){var t=[];e=e.length;for(var n=0;n<e;n++)t.push(n);return t}for(var r in t=[],n=0,e)t[n++]=r;return t}}}(e),r=function(e){if(e.W&&"function"==typeof e.W)return e.W();if("undefined"!==typeof Map&&e instanceof Map||"undefined"!==typeof Set&&e instanceof Set)return Array.from(e.values());if("string"===typeof e)return e.split("");if(Et(e)){for(var t=[],n=e.length,r=0;r<n;r++)t.push(e[r]);return t}for(r in t=[],n=0,e)t[n++]=e[r];return t}(e),a=r.length,i=0;i<a;i++)t.call(void 0,r[i],n&&n[i],e)}(Vt=Er.prototype).setTimeout=function(e){this.O=e},Vt.hb=function(e){e=e.target;var t=this.L;t&&3==Wa(e)?t.l():this.Ka(e)},Vt.Ka=function(e){try{if(e==this.g)e:{var t=Wa(this.g),n=this.g.Ea(),r=this.g.aa();if(!(3>t)&&(3!=t||$t||this.g&&(this.h.h||this.g.fa()||ja(this.g)))){this.I||4!=t||7==n||fr(8==n||0>=r?3:2),zr(this);var a=this.g.aa();this.Y=a;t:if(Fr(this)){var i=ja(this.g);e="";var o=i.length,s=4==Wa(this.g);if(!this.h.i){if("undefined"===typeof TextDecoder){Ur(this),Br(this);var u="";break t}this.h.i=new St.TextDecoder}for(n=0;n<o;n++)this.h.h=!0,e+=this.h.i.decode(i[n],{stream:s&&n==o-1});i.splice(0,o),this.h.g+=e,this.C=0,u=this.h.g}else u=this.g.fa();if(this.i=200==a,function(e,t,n,r,a,i,o){e.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+a+"]: "+t+"\n"+n+"\n"+i+" "+o}))}(this.j,this.u,this.A,this.m,this.U,t,a),this.i){if(this.Z&&!this.J){t:{if(this.g){var c,l=this.g;if((c=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!jt(c)){var h=c;break t}}h=null}if(!(a=h)){this.i=!1,this.o=3,pr(12),Ur(this),Br(this);break e}sr(this.j,this.m,a,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,Wr(this,a)}this.P?(Or(this,t,u),$t&&this.i&&3==t&&(ar(this.S,this.T,"tick",this.gb),this.T.start())):(sr(this.j,this.m,u,null),Wr(this,u)),4==t&&Ur(this),this.i&&!this.I&&(4==t?oi(this.l,this):(this.i=!1,Mr(this)))}else 400==a&&0<u.indexOf("Unknown SID")?(this.o=3,pr(12)):(this.o=0,pr(13)),Ur(this),Br(this)}}}catch(t){}},Vt.gb=function(){if(this.g){var e=Wa(this.g),t=this.g.fa();this.C<t.length&&(zr(this),Or(this,e,t),this.i&&4!=e&&Mr(this))}},Vt.cancel=function(){this.I=!0,Ur(this)},Vt.fb=function(){this.B=null;var e=Date.now();0<=e-this.V?(function(e,t){e.info((function(){return"TIMEOUT: "+t}))}(this.j,this.A),2!=this.K&&(fr(3),pr(17)),Ur(this),this.o=2,Br(this)):Pr(this,this.V-e)};var Zr=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Gr(e,t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,e instanceof Gr){this.h=void 0!==t?t:e.h,qr(this,e.j),this.s=e.s,this.g=e.g,Kr(this,e.m),this.l=e.l,t=e.i;var n=new oa;n.i=t.i,t.g&&(n.g=new Map(t.g),n.h=t.h),Xr(this,n),this.o=e.o}else e&&(n=String(e).match(Zr))?(this.h=!!t,qr(this,n[1]||"",!0),this.s=Jr(n[2]||""),this.g=Jr(n[3]||"",!0),Kr(this,n[4]),this.l=Jr(n[5]||"",!0),Xr(this,n[6]||"",!0),this.o=Jr(n[7]||"")):(this.h=!!t,this.i=new oa(null,this.h))}function Hr(e){return new Gr(e)}function qr(e,t,n){e.j=n?Jr(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function Kr(e,t){if(t){if(t=Number(t),isNaN(t)||0>t)throw Error("Bad port number "+t);e.m=t}else e.m=null}function Xr(e,t,n){t instanceof oa?(e.i=t,function(e,t){t&&!e.j&&(sa(e),e.i=null,e.g.forEach((function(e,t){var n=t.toLowerCase();t!=n&&(ua(this,t),la(this,n,e))}),e)),e.j=t}(e.i,e.h)):(n||(t=$r(t,aa)),e.i=new oa(t,e.h))}function Qr(e,t,n){e.i.set(t,n)}function Yr(e){return Qr(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function Jr(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function $r(e,t,n){return"string"===typeof e?(e=encodeURI(e).replace(t,ea),n&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function ea(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}Gr.prototype.toString=function(){var e=[],t=this.j;t&&e.push($r(t,ta,!0),":");var n=this.g;return(n||"file"==t)&&(e.push("//"),(t=this.s)&&e.push($r(t,ta,!0),"@"),e.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&e.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&e.push("/"),e.push($r(n,"/"==n.charAt(0)?ra:na,!0))),(n=this.i.toString())&&e.push("?",n),(n=this.o)&&e.push("#",$r(n,ia)),e.join("")};var ta=/[#\/\?@]/g,na=/[#\?:]/g,ra=/[#\?]/g,aa=/[#\?@]/g,ia=/#/g;function oa(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function sa(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(var n=0;n<e.length;n++){var r=e[n].indexOf("="),a=null;if(0<=r){var i=e[n].substring(0,r);a=e[n].substring(r+1)}else i=e[n];t(i,a?decodeURIComponent(a.replace(/\+/g," ")):"")}}}(e.i,(function(t,n){e.add(decodeURIComponent(t.replace(/\+/g," ")),n)})))}function ua(e,t){sa(e),t=ha(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function ca(e,t){return sa(e),t=ha(e,t),e.g.has(t)}function la(e,t,n){ua(e,t),0<n.length&&(e.i=null,e.g.set(ha(e,t),zt(n)),e.h+=n.length)}function ha(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}(Vt=oa.prototype).add=function(e,t){sa(this),this.i=null,e=ha(this,e);var n=this.g.get(e);return n||this.g.set(e,n=[]),n.push(t),this.h+=1,this},Vt.forEach=function(e,t){sa(this),this.g.forEach((function(n,r){n.forEach((function(n){e.call(t,n,r,this)}),this)}),this)},Vt.oa=function(){sa(this);for(var e=Array.from(this.g.values()),t=Array.from(this.g.keys()),n=[],r=0;r<t.length;r++)for(var a=e[r],i=0;i<a.length;i++)n.push(t[r]);return n},Vt.W=function(e){sa(this);var t=[];if("string"===typeof e)ca(this,e)&&(t=t.concat(this.g.get(ha(this,e))));else{e=Array.from(this.g.values());for(var n=0;n<e.length;n++)t=t.concat(e[n])}return t},Vt.set=function(e,t){return sa(this),this.i=null,ca(this,e=ha(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},Vt.get=function(e,t){return e&&0<(e=this.W(e)).length?String(e[0]):t},Vt.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var e=[],t=Array.from(this.g.keys()),n=0;n<t.length;n++){var r=t[n],a=encodeURIComponent(String(r)),i=this.W(r);for(r=0;r<i.length;r++){var o=a;""!==i[r]&&(o+="="+encodeURIComponent(String(i[r]))),e.push(o)}}return this.i=e.join("&")};var fa=p((function e(t,n){f(this,e),this.h=t,this.g=n}));function da(e){this.l=e||va,St.PerformanceNavigationTiming?e=0<(e=St.performance.getEntriesByType("navigation")).length&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(St.g&&St.g.Ga&&St.g.Ga()&&St.g.Ga().Zb),this.j=e?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var pa,va=10;function ma(e){return!!e.h||!!e.g&&e.g.size>=e.j}function ga(e){return e.h?1:e.g?e.g.size:0}function ya(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function ba(e,t){e.g?e.g.add(t):e.h=t}function ka(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Va(e){if(null!=e.h)return e.i.concat(e.h.D);if(null!=e.g&&0!==e.g.size){var t,n=e.i,r=m(e.g.values());try{for(r.s();!(t=r.n()).done;){var a=t.value;n=n.concat(a.D)}}catch(i){r.e(i)}finally{r.f()}return n}return zt(e.i)}function xa(){}function wa(){this.g=new xa}function Ia(e,t,n){var r=n||"";try{jr(e,(function(e,n){var a=e;Tt(e)&&(a=Bn(e)),t.push(r+n+"="+encodeURIComponent(a))}))}catch(a){throw t.push(r+"type="+encodeURIComponent("_badmap")),a}}function Sa(e,t,n,r,a){try{t.onload=null,t.onerror=null,t.onabort=null,t.ontimeout=null,a(r)}catch(i){}}function Ca(e){this.l=e.$b||null,this.j=e.ib||!1}function Ea(e,t){Mn.call(this),this.D=e,this.u=t,this.m=void 0,this.readyState=Ta,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}da.prototype.cancel=function(){if(this.i=Va(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){var e,t=m(this.g.values());try{for(t.s();!(e=t.n()).done;){e.value.cancel()}}catch(n){t.e(n)}finally{t.f()}this.g.clear()}},xa.prototype.stringify=function(e){return St.JSON.stringify(e,void 0)},xa.prototype.parse=function(e){return St.JSON.parse(e,void 0)},Ot(Ca,br),Ca.prototype.g=function(){return new Ea(this.l,this.j)},Ca.prototype.i=(pa={},function(){return pa}),Ot(Ea,Mn);var Ta=0;function Na(e){e.j.read().then(e.Sa.bind(e)).catch(e.ga.bind(e))}function Aa(e){e.readyState=4,e.l=null,e.j=null,e.A=null,Ra(e)}function Ra(e){e.onreadystatechange&&e.onreadystatechange.call(e)}(Vt=Ea.prototype).open=function(e,t){if(this.readyState!=Ta)throw this.abort(),Error("Error reopening a connection");this.C=e,this.B=t,this.readyState=1,Ra(this)},Vt.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var t={headers:this.v,method:this.C,credentials:this.m,cache:void 0};e&&(t.body=e),(this.D||St).fetch(new Request(this.B,t)).then(this.Va.bind(this),this.ga.bind(this))},Vt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((function(){})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Aa(this)),this.readyState=Ta},Vt.Va=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,Ra(this)),this.g&&(this.readyState=3,Ra(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Ta.bind(this),this.ga.bind(this));else if("undefined"!==typeof St.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;Na(this)}else e.text().then(this.Ua.bind(this),this.ga.bind(this))},Vt.Sa=function(e){if(this.g){if(this.u&&e.value)this.response.push(e.value);else if(!this.u){var t=e.value?e.value:new Uint8Array(0);(t=this.A.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Aa(this):Ra(this),3==this.readyState&&Na(this)}},Vt.Ua=function(e){this.g&&(this.response=this.responseText=e,Aa(this))},Vt.Ta=function(e){this.g&&(this.response=e,Aa(this))},Vt.ga=function(){this.g&&Aa(this)},Vt.setRequestHeader=function(e,t){this.v.append(e,t)},Vt.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},Vt.getAllResponseHeaders=function(){if(!this.h)return"";for(var e=[],t=this.h.entries(),n=t.next();!n.done;)n=n.value,e.push(n[0]+": "+n[1]),n=t.next();return e.join("\r\n")},Object.defineProperty(Ea.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}});var _a=St.JSON.parse;function Da(e){Mn.call(this),this.headers=new Map,this.u=e||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Fa,this.K=this.L=!1}Ot(Da,Mn);var Fa="",Oa=/^https?$/i,La=["POST","PUT"];function Ma(e,t){e.h=!1,e.g&&(e.l=!0,e.g.abort(),e.l=!1),e.j=t,e.m=5,Pa(e),Ba(e)}function Pa(e){e.D||(e.D=!0,Pn(e,"complete"),Pn(e,"error"))}function za(e){if(e.h&&"undefined"!=typeof It&&(!e.C[1]||4!=Wa(e)||2!=e.aa()))if(e.v&&4==Wa(e))$n(e.Ha,0,e);else if(Pn(e,"readystatechange"),4==Wa(e)){e.h=!1;try{var t,n=e.aa();e:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break e;default:r=!1}if(!(t=r)){var a;if(a=0===n){var i=String(e.H).match(Zr)[1]||null;if(!i&&St.self&&St.self.location){var o=St.self.location.protocol;i=o.substr(0,o.length-1)}a=!Oa.test(i?i.toLowerCase():"")}t=a}if(t)Pn(e,"complete"),Pn(e,"success");else{e.m=6;try{var s=2<Wa(e)?e.g.statusText:""}catch(u){s=""}e.j=s+" ["+e.aa()+"]",Pa(e)}}finally{Ba(e)}}}function Ba(e,t){if(e.g){Ua(e);var n=e.g,r=e.C[0]?Ct:null;e.g=null,e.C=null,t||Pn(e,"ready");try{n.onreadystatechange=r}catch(a){}}}function Ua(e){e.g&&e.K&&(e.g.ontimeout=null),e.A&&(St.clearTimeout(e.A),e.A=null)}function Wa(e){return e.g?e.g.readyState:0}function ja(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.J){case Fa:case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(Ti){return null}}function Za(e){var t="";return yn(e,(function(e,n){t+=n,t+=":",t+=e,t+="\r\n"})),t}function Ga(e,t,n){e:{for(r in n){var r=!1;break e}r=!0}r||(n=Za(n),"string"===typeof e?null!=n&&encodeURIComponent(String(n)):Qr(e,t,n))}function Ha(e,t,n){return n&&n.internalChannelParams&&n.internalChannelParams[e]||t}function qa(e){this.Ca=0,this.i=[],this.j=new or,this.ka=this.sa=this.F=this.V=this.g=this.za=this.D=this.ia=this.o=this.S=this.s=null,this.$a=this.U=0,this.Ya=Ha("failFast",!1,e),this.L=this.v=this.u=this.m=this.l=null,this.Y=!0,this.pa=this.Ba=this.T=-1,this.Z=this.A=this.C=0,this.Wa=Ha("baseRetryDelayMs",5e3,e),this.ab=Ha("retryDelaySeedMs",1e4,e),this.Za=Ha("forwardChannelMaxRetries",2,e),this.ta=Ha("forwardChannelRequestTimeoutMs",2e4,e),this.ra=e&&e.xmlHttpFactory||void 0,this.Da=e&&e.Yb||!1,this.J=void 0,this.H=e&&e.supportsCrossDomainXhr||!1,this.I="",this.h=new da(e&&e.concurrentRequestLimit),this.Fa=new wa,this.O=e&&e.fastHandshake||!1,this.N=e&&e.encodeInitMessageHeaders||!1,this.O&&this.N&&(this.N=!1),this.Xa=e&&e.Wb||!1,e&&e.Aa&&this.j.Aa(),e&&e.forceLongPolling&&(this.Y=!1),this.$=!this.O&&this.Y&&e&&e.detectBufferingProxy||!1,this.ja=void 0,this.P=0,this.K=!1,this.la=this.B=null}function Ka(e){if(Qa(e),3==e.G){var t=e.U++,n=Hr(e.F);Qr(n,"SID",e.I),Qr(n,"RID",t),Qr(n,"TYPE","terminate"),$a(e,n),(t=new Er(e,e.j,t,void 0)).K=2,t.v=Yr(Hr(n)),n=!1,St.navigator&&St.navigator.sendBeacon&&(n=St.navigator.sendBeacon(t.v.toString(),"")),!n&&St.Image&&((new Image).src=t.v,n=!0),n||(t.g=hi(t.l,null),t.g.da(t.v)),t.F=Date.now(),Mr(t)}ci(e)}function Xa(e){e.g&&(ri(e),e.g.cancel(),e.g=null)}function Qa(e){Xa(e),e.u&&(St.clearTimeout(e.u),e.u=null),ii(e),e.h.cancel(),e.m&&("number"===typeof e.m&&St.clearTimeout(e.m),e.m=null)}function Ya(e){ma(e.h)||e.m||(e.m=!0,qn(e.Ja,e),e.C=0)}function Ja(e,t){var n;n=t?t.m:e.U++;var r=Hr(e.F);Qr(r,"SID",e.I),Qr(r,"RID",n),Qr(r,"AID",e.T),$a(e,r),e.o&&e.s&&Ga(r,e.o,e.s),n=new Er(e,e.j,n,e.C+1),null===e.o&&(n.H=e.s),t&&(e.i=t.D.concat(e.i)),t=ei(e,n,1e3),n.setTimeout(Math.round(.5*e.ta)+Math.round(.5*e.ta*Math.random())),ba(e.h,n),_r(n,r,t)}function $a(e,t){e.ia&&yn(e.ia,(function(e,n){Qr(t,n,e)})),e.l&&jr({},(function(e,n){Qr(t,n,e)}))}function ei(e,t,n){n=Math.min(e.i.length,n);var r=e.l?Dt(e.l.Qa,e.l,e):null;e:for(var a=e.i,i=-1;;){var o=["count="+n];-1==i?0<n?(i=a[0].h,o.push("ofs="+i)):i=0:o.push("ofs="+i);for(var s=!0,u=0;u<n;u++){var c=a[u].h,l=a[u].g;if(0>(c-=i))i=Math.max(0,a[u].h-100),s=!1;else try{Ia(l,o,"req"+c+"_")}catch(Pi){r&&r(l)}}if(s){r=o.join("&");break e}}return e=e.i.splice(0,n),t.D=e,r}function ti(e){e.g||e.u||(e.Z=1,qn(e.Ia,e),e.A=0)}function ni(e){return!(e.g||e.u||3<=e.A)&&(e.Z++,e.u=mr(Dt(e.Ia,e),si(e,e.A)),e.A++,!0)}function ri(e){null!=e.B&&(St.clearTimeout(e.B),e.B=null)}function ai(e){e.g=new Er(e,e.j,"rpc",e.Z),null===e.o&&(e.g.H=e.s),e.g.N=0;var t=Hr(e.sa);Qr(t,"RID","rpc"),Qr(t,"SID",e.I),Qr(t,"CI",e.L?"0":"1"),Qr(t,"AID",e.T),Qr(t,"TYPE","xmlhttp"),$a(e,t),e.o&&e.s&&Ga(t,e.o,e.s),e.J&&e.g.setTimeout(e.J);var n=e.g;e=e.ka,n.K=1,n.v=Yr(Hr(t)),n.s=null,n.P=!0,Dr(n,e)}function ii(e){null!=e.v&&(St.clearTimeout(e.v),e.v=null)}function oi(e,t){var n=null;if(e.g==t){ii(e),ri(e),e.g=null;var r=2}else{if(!ya(e.h,t))return;n=t.D,ka(e.h,t),r=1}if(0!=e.G)if(e.pa=t.Y,t.i)if(1==r){n=t.s?t.s.length:0,t=Date.now()-t.F;var a=e.C;Pn(r=lr(),new vr(r,n,t,a)),Ya(e)}else ti(e);else if(3==(a=t.o)||0==a&&0<e.pa||!(1==r&&function(e,t){return!(ga(e.h)>=e.h.j-(e.m?1:0))&&(e.m?(e.i=t.D.concat(e.i),!0):!(1==e.G||2==e.G||e.C>=(e.Ya?0:e.Za))&&(e.m=mr(Dt(e.Ja,e,t),si(e,e.C)),e.C++,!0))}(e,t)||2==r&&ni(e)))switch(n&&0<n.length&&(t=e.h,t.i=t.i.concat(n)),a){case 1:ui(e,5);break;case 4:ui(e,10);break;case 3:ui(e,6);break;default:ui(e,2)}}function si(e,t){var n=e.Wa+Math.floor(Math.random()*e.ab);return e.l||(n*=2),n*t}function ui(e,t){if(e.j.info("Error code "+t),2==t){var n=null;e.l&&(n=null);var r=Dt(e.jb,e);n||(n=new Gr("//www.google.com/images/cleardot.gif"),St.location&&"http"==St.location.protocol||qr(n,"https"),Yr(n)),function(e,t){var n=new or;if(St.Image){var r=new Image;r.onload=Ft(Sa,n,r,"TestLoadImage: loaded",!0,t),r.onerror=Ft(Sa,n,r,"TestLoadImage: error",!1,t),r.onabort=Ft(Sa,n,r,"TestLoadImage: abort",!1,t),r.ontimeout=Ft(Sa,n,r,"TestLoadImage: timeout",!1,t),St.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=e}else t(!1)}(n.toString(),r)}else pr(2);e.G=0,e.l&&e.l.va(t),ci(e),Qa(e)}function ci(e){if(e.G=0,e.la=[],e.l){var t=Va(e.h);0==t.length&&0==e.i.length||(Bt(e.la,t),Bt(e.la,e.i),e.h.i.length=0,zt(e.i),e.i.length=0),e.l.ua()}}function li(e,t,n){var r=n instanceof Gr?Hr(n):new Gr(n,void 0);if(""!=r.g)t&&(r.g=t+"."+r.g),Kr(r,r.m);else{var a=St.location;r=a.protocol,t=t?t+"."+a.hostname:a.hostname,a=+a.port;var i=new Gr(null,void 0);r&&qr(i,r),t&&(i.g=t),a&&Kr(i,a),n&&(i.l=n),r=i}return n=e.D,t=e.za,n&&t&&Qr(r,n,t),Qr(r,"VER",e.ma),$a(e,r),r}function hi(e,t,n){if(t&&!e.H)throw Error("Can't create secondary domain capable XhrIo object.");return(t=n&&e.Da&&!e.ra?new Da(new Ca({ib:!0})):new Da(e.ra)).L=e.H,t}function fi(){}function di(){if(Yt&&!(10<=Number(hn)))throw Error("Environmental error: no available transport.")}function pi(e,t){Mn.call(this),this.g=new qa(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.s=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.ya&&(e?e["X-WebChannel-Client-Profile"]=t.ya:e={"X-WebChannel-Client-Profile":t.ya}),this.g.S=e,(e=t&&t.Xb)&&!jt(e)&&(this.g.o=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!jt(t)&&(this.g.D=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new gi(this)}function vi(e){Ir.call(this);var t=e.__sm__;if(t){e:{for(var n in t){e=n;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function mi(){Sr.call(this),this.status=1}function gi(e){this.g=e}(Vt=Da.prototype).da=function(e,t,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+e);t=t?t.toUpperCase():"GET",this.H=e,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():xr.g(),this.C=this.u?kr(this.u):kr(xr),this.g.onreadystatechange=Dt(this.Ha,this);try{this.F=!0,this.g.open(t,String(e),!0),this.F=!1}catch(s){return void Ma(this,s)}if(e=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var a in r)n.set(a,r[a]);else{if("function"!==typeof r.keys||"function"!==typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));var i,o=m(r.keys());try{for(o.s();!(i=o.n()).done;){var s=i.value;n.set(s,r.get(s))}}catch(p){o.e(p)}finally{o.f()}}r=Array.from(n.keys()).find((function(e){return"content-type"==e.toLowerCase()})),a=St.FormData&&e instanceof St.FormData,!(0<=Pt(La,t))||r||a||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");var u,c=m(n);try{for(c.s();!(u=c.n()).done;){var h=(0,l.Z)(u.value,2),f=h[0],d=h[1];this.g.setRequestHeader(f,d)}}catch(p){c.e(p)}finally{c.f()}this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{Ua(this),0<this.B&&((this.K=function(e){return Yt&&cn()&&"number"===typeof e.timeout&&void 0!==e.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Dt(this.qa,this)):this.A=$n(this.qa,this.B,this)),this.v=!0,this.g.send(e),this.v=!1}catch(s){Ma(this,s)}},Vt.qa=function(){"undefined"!=typeof It&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Pn(this,"timeout"),this.abort(8))},Vt.abort=function(e){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=e||7,Pn(this,"complete"),Pn(this,"abort"),Ba(this))},Vt.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Ba(this,!0)),Da.X.M.call(this)},Vt.Ha=function(){this.s||(this.F||this.v||this.l?za(this):this.eb())},Vt.eb=function(){za(this)},Vt.aa=function(){try{return 2<Wa(this)?this.g.status:-1}catch(pa){return-1}},Vt.fa=function(){try{return this.g?this.g.responseText:""}catch(pa){return""}},Vt.Ra=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),_a(t)}},Vt.Ea=function(){return this.m},Vt.Na=function(){return"string"===typeof this.j?this.j:String(this.j)},(Vt=qa.prototype).ma=8,Vt.G=1,Vt.Ja=function(e){if(this.m)if(this.m=null,1==this.G){if(!e){this.U=Math.floor(1e5*Math.random()),e=this.U++;var t=new Er(this,this.j,e,void 0),n=this.s;if(this.S&&(n?Vn(n=bn(n),this.S):n=this.S),null!==this.o||this.N||(t.H=n,n=null),this.O)e:{for(var r=0,a=0;a<this.i.length;a++){var i=this.i[a];if(void 0===(i="__data__"in i.g&&"string"===typeof(i=i.g.__data__)?i.length:void 0))break;if(4096<(r+=i)){r=a;break e}if(4096===r||a===this.i.length-1){r=a+1;break e}}r=1e3}else r=1e3;r=ei(this,t,r),Qr(a=Hr(this.F),"RID",e),Qr(a,"CVER",22),this.D&&Qr(a,"X-HTTP-Session-Id",this.D),$a(this,a),n&&(this.N?r="headers="+encodeURIComponent(String(Za(n)))+"&"+r:this.o&&Ga(a,this.o,n)),ba(this.h,t),this.Xa&&Qr(a,"TYPE","init"),this.O?(Qr(a,"$req",r),Qr(a,"SID","null"),t.Z=!0,_r(t,a,null)):_r(t,a,r),this.G=2}}else 3==this.G&&(e?Ja(this,e):0==this.i.length||ma(this.h)||Ja(this))},Vt.Ia=function(){if(this.u=null,ai(this),this.$&&!(this.K||null==this.g||0>=this.P)){var e=2*this.P;this.j.info("BP detection timer enabled: "+e),this.B=mr(Dt(this.cb,this),e)}},Vt.cb=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.L=!1,this.K=!0,pr(10),Xa(this),ai(this))},Vt.bb=function(){null!=this.v&&(this.v=null,Xa(this),ni(this),pr(19))},Vt.jb=function(e){e?(this.j.info("Successfully pinged google.com"),pr(2)):(this.j.info("Failed to ping google.com"),pr(1))},(Vt=fi.prototype).xa=function(){},Vt.wa=function(){},Vt.va=function(){},Vt.ua=function(){},Vt.Qa=function(){},di.prototype.g=function(e,t){return new pi(e,t)},Ot(pi,Mn),pi.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.H=!0);var e=this.g,t=this.l,n=this.h||void 0;pr(0),e.V=t,e.ia=n||{},e.L=e.Y,e.F=li(e,null,e.V),Ya(e)},pi.prototype.close=function(){Ka(this.g)},pi.prototype.u=function(e){var t=this.g;if("string"===typeof e){var n={};n.__data__=e,e=n}else this.v&&((n={}).__data__=Bn(e),e=n);t.i.push(new fa(t.$a++,e)),3==t.G&&Ya(t)},pi.prototype.M=function(){this.g.l=null,delete this.j,Ka(this.g),delete this.g,pi.X.M.call(this)},Ot(vi,Ir),Ot(mi,Sr),Ot(gi,fi),gi.prototype.xa=function(){Pn(this.g,"a")},gi.prototype.wa=function(e){Pn(this.g,new vi(e))},gi.prototype.va=function(e){Pn(this.g,new mi(e))},gi.prototype.ua=function(){Pn(this.g,"b")},di.prototype.createWebChannel=di.prototype.g,pi.prototype.send=pi.prototype.u,pi.prototype.open=pi.prototype.m,pi.prototype.close=pi.prototype.close,gr.NO_ERROR=0,gr.TIMEOUT=8,gr.HTTP_ERROR=6,yr.COMPLETE="complete",Vr.EventType=wr,wr.OPEN="a",wr.CLOSE="b",wr.ERROR="c",wr.MESSAGE="d",Mn.prototype.listen=Mn.prototype.N,Da.prototype.listenOnce=Da.prototype.O,Da.prototype.getLastError=Da.prototype.Na,Da.prototype.getLastErrorCode=Da.prototype.Ea,Da.prototype.getStatus=Da.prototype.aa,Da.prototype.getResponseJson=Da.prototype.Ra,Da.prototype.getResponseText=Da.prototype.fa,Da.prototype.send=Da.prototype.da;var yi=wt.createWebChannelTransport=function(){return new di},bi=wt.getStatEventTarget=function(){return lr()},ki=wt.ErrorCode=gr,Vi=wt.EventType=yr,xi=wt.Event=ur,wi=wt.Stat={rb:0,ub:1,vb:2,Ob:3,Tb:4,Qb:5,Rb:6,Pb:7,Nb:8,Sb:9,PROXY:10,NOPROXY:11,Lb:12,Hb:13,Ib:14,Gb:15,Jb:16,Kb:17,nb:18,mb:19,ob:20},Ii=wt.FetchXmlHttpFactory=Ca,Si=wt.WebChannel=Vr,Ci=wt.XhrIo=Da,Ei="@firebase/firestore",Ti=function(){function e(t){f(this,e),this.uid=t}return p(e,[{key:"isAuthenticated",value:function(){return null!=this.uid}},{key:"toKey",value:function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}},{key:"isEqual",value:function(e){return e.uid===this.uid}}]),e}();Ti.UNAUTHENTICATED=new Ti(null),Ti.GOOGLE_CREDENTIALS=new Ti("google-credentials-uid"),Ti.FIRST_PARTY=new Ti("first-party-uid"),Ti.MOCK_USER=new Ti("mock-user");var Ni="9.10.0",Ai=new ae("@firebase/firestore");function Ri(){return Ai.logLevel}function _i(e){if(Ai.logLevel<=Y.DEBUG){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map(Oi);Ai.debug.apply(Ai,["Firestore (".concat(Ni,"): ").concat(e)].concat((0,H.Z)(a)))}}function Di(e){if(Ai.logLevel<=Y.ERROR){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map(Oi);Ai.error.apply(Ai,["Firestore (".concat(Ni,"): ").concat(e)].concat((0,H.Z)(a)))}}function Fi(e){if(Ai.logLevel<=Y.WARN){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=n.map(Oi);Ai.warn.apply(Ai,["Firestore (".concat(Ni,"): ").concat(e)].concat((0,H.Z)(a)))}}function Oi(e){if("string"==typeof e)return e;try{return t=e,JSON.stringify(t)}catch(t){return e}var t}function Li(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"Unexpected state",t="FIRESTORE (".concat(Ni,") INTERNAL ASSERTION FAILED: ")+e;throw Di(t),new Error(t)}function Mi(e,t){e||Li()}function Pi(e,t){return e}var zi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Bi=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this,e,r)).code=e,a.message=r,a.toString=function(){return"".concat(a.name,": [code=").concat(a.code,"]: ").concat(a.message)},a}return p(n)}(O),Ui=p((function e(){var t=this;f(this,e),this.promise=new Promise((function(e,n){t.resolve=e,t.reject=n}))})),Wi=p((function e(t,n){f(this,e),this.user=n,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(t))})),ji=function(){function e(){f(this,e)}return p(e,[{key:"getToken",value:function(){return Promise.resolve(null)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Ti.UNAUTHENTICATED)}))}},{key:"shutdown",value:function(){}}]),e}(),Zi=function(){function e(t){f(this,e),this.token=t,this.changeListener=null}return p(e,[{key:"getToken",value:function(){return Promise.resolve(this.token)}},{key:"invalidateToken",value:function(){}},{key:"start",value:function(e,t){var n=this;this.changeListener=t,e.enqueueRetryable((function(){return t(n.token.user)}))}},{key:"shutdown",value:function(){this.changeListener=null}}]),e}(),Gi=function(){function e(t){f(this,e),this.t=t,this.currentUser=Ti.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}return p(e,[{key:"start",value:function(e,t){var n=this,r=this.i,a=function(e){return n.i!==r?(r=n.i,t(e)):Promise.resolve()},i=new Ui;this.o=function(){n.i++,n.currentUser=n.u(),i.resolve(),i=new Ui,e.enqueueRetryable((function(){return a(n.currentUser)}))};var o=function(){var t=i;e.enqueueRetryable(c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.promise;case 2:return e.next=4,a(n.currentUser);case 4:case"end":return e.stop()}}),e)}))))},u=function(e){_i("FirebaseAuthCredentialsProvider","Auth detected"),n.auth=e,n.auth.addAuthTokenListener(n.o),o()};this.t.onInit((function(e){return u(e)})),setTimeout((function(){if(!n.auth){var e=n.t.getImmediate({optional:!0});e?u(e):(_i("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Ui)}}),0),o()}},{key:"getToken",value:function(){var e=this,t=this.i,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then((function(n){return e.i!==t?(_i("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),e.getToken()):n?(Mi("string"==typeof n.accessToken),new Wi(n.accessToken,e.currentUser)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.auth&&this.auth.removeAuthTokenListener(this.o)}},{key:"u",value:function(){var e=this.auth&&this.auth.getUid();return Mi(null===e||"string"==typeof e),new Ti(e)}}]),e}(),Hi=function(){function e(t,n,r,a){f(this,e),this.h=t,this.l=n,this.m=r,this.g=a,this.type="FirstParty",this.user=Ti.FIRST_PARTY,this.p=new Map}return p(e,[{key:"I",value:function(){return this.g?this.g():(Mi(!("object"!=typeof this.h||null===this.h||!this.h.auth||!this.h.auth.getAuthHeaderValueForFirstParty)),this.h.auth.getAuthHeaderValueForFirstParty([]))}},{key:"headers",get:function(){this.p.set("X-Goog-AuthUser",this.l);var e=this.I();return e&&this.p.set("Authorization",e),this.m&&this.p.set("X-Goog-Iam-Authorization-Token",this.m),this.p}}]),e}(),qi=function(){function e(t,n,r,a){f(this,e),this.h=t,this.l=n,this.m=r,this.g=a}return p(e,[{key:"getToken",value:function(){return Promise.resolve(new Hi(this.h,this.l,this.m,this.g))}},{key:"start",value:function(e,t){e.enqueueRetryable((function(){return t(Ti.FIRST_PARTY)}))}},{key:"shutdown",value:function(){}},{key:"invalidateToken",value:function(){}}]),e}(),Ki=p((function e(t){f(this,e),this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)})),Xi=function(){function e(t){f(this,e),this.T=t,this.forceRefresh=!1,this.appCheck=null,this.A=null}return p(e,[{key:"start",value:function(e,t){var n=this,r=function(e){null!=e.error&&_i("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));var r=e.token!==n.A;return n.A=e.token,_i("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()};this.o=function(t){e.enqueueRetryable((function(){return r(t)}))};var a=function(e){_i("FirebaseAppCheckTokenProvider","AppCheck detected"),n.appCheck=e,n.appCheck.addTokenListener(n.o)};this.T.onInit((function(e){return a(e)})),setTimeout((function(){if(!n.appCheck){var e=n.T.getImmediate({optional:!0});e?a(e):_i("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}},{key:"getToken",value:function(){var e=this,t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((function(t){return t?(Mi("string"==typeof t.token),e.A=t.token,new Ki(t.token)):null})):Promise.resolve(null)}},{key:"invalidateToken",value:function(){this.forceRefresh=!0}},{key:"shutdown",value:function(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}]),e}();function Qi(e){var t="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(n);else for(var r=0;r<e;r++)n[r]=Math.floor(256*Math.random());return n}var Yi=function(){function e(){f(this,e)}return p(e,null,[{key:"R",value:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,n="";n.length<20;)for(var r=Qi(40),a=0;a<r.length;++a)n.length<20&&r[a]<t&&(n+=e.charAt(r[a]%e.length));return n}}]),e}();function Ji(e,t){return e<t?-1:e>t?1:0}function $i(e,t,n){return e.length===t.length&&e.every((function(e,r){return n(e,t[r])}))}function eo(e){return e+"\0"}var to=function(){function e(t,n){if(f(this,e),this.seconds=t,this.nanoseconds=n,n<0)throw new Bi(zi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(n>=1e9)throw new Bi(zi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+n);if(t<-62135596800)throw new Bi(zi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Bi(zi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return p(e,[{key:"toDate",value:function(){return new Date(this.toMillis())}},{key:"toMillis",value:function(){return 1e3*this.seconds+this.nanoseconds/1e6}},{key:"_compareTo",value:function(e){return this.seconds===e.seconds?Ji(this.nanoseconds,e.nanoseconds):Ji(this.seconds,e.seconds)}},{key:"isEqual",value:function(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}},{key:"toString",value:function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}},{key:"toJSON",value:function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}},{key:"valueOf",value:function(){var e=this.seconds- -62135596800;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}],[{key:"now",value:function(){return e.fromMillis(Date.now())}},{key:"fromDate",value:function(t){return e.fromMillis(t.getTime())}},{key:"fromMillis",value:function(t){var n=Math.floor(t/1e3);return new e(n,Math.floor(1e6*(t-1e3*n)))}}]),e}(),no=function(){function e(t){f(this,e),this.timestamp=t}return p(e,[{key:"compareTo",value:function(e){return this.timestamp._compareTo(e.timestamp)}},{key:"isEqual",value:function(e){return this.timestamp.isEqual(e.timestamp)}},{key:"toMicroseconds",value:function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}},{key:"toString",value:function(){return"SnapshotVersion("+this.timestamp.toString()+")"}},{key:"toTimestamp",value:function(){return this.timestamp}}],[{key:"fromTimestamp",value:function(t){return new e(t)}},{key:"min",value:function(){return new e(new to(0,0))}},{key:"max",value:function(){return new e(new to(253402300799,999999999))}}]),e}(),ro=function(){function e(t,n,r){f(this,e),void 0===n?n=0:n>t.length&&Li(),void 0===r?r=t.length-n:r>t.length-n&&Li(),this.segments=t,this.offset=n,this.len=r}return p(e,[{key:"length",get:function(){return this.len}},{key:"isEqual",value:function(t){return 0===e.comparator(this,t)}},{key:"child",value:function(t){var n=this.segments.slice(this.offset,this.limit());return t instanceof e?t.forEach((function(e){n.push(e)})):n.push(t),this.construct(n)}},{key:"limit",value:function(){return this.offset+this.length}},{key:"popFirst",value:function(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}},{key:"popLast",value:function(){return this.construct(this.segments,this.offset,this.length-1)}},{key:"firstSegment",value:function(){return this.segments[this.offset]}},{key:"lastSegment",value:function(){return this.get(this.length-1)}},{key:"get",value:function(e){return this.segments[this.offset+e]}},{key:"isEmpty",value:function(){return 0===this.length}},{key:"isPrefixOf",value:function(e){if(e.length<this.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"isImmediateParentOf",value:function(e){if(this.length+1!==e.length)return!1;for(var t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}},{key:"forEach",value:function(e){for(var t=this.offset,n=this.limit();t<n;t++)e(this.segments[t])}},{key:"toArray",value:function(){return this.segments.slice(this.offset,this.limit())}}],[{key:"comparator",value:function(e,t){for(var n=Math.min(e.length,t.length),r=0;r<n;r++){var a=e.get(r),i=t.get(r);if(a<i)return-1;if(a>i)return 1}return e.length<t.length?-1:e.length>t.length?1:0}}]),e}(),ao=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().join("/")}},{key:"toString",value:function(){return this.canonicalString()}}],[{key:"fromString",value:function(){for(var e=[],t=arguments.length,r=new Array(t),a=0;a<t;a++)r[a]=arguments[a];for(var i=0,o=r;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new Bi(zi.INVALID_ARGUMENT,"Invalid segment (".concat(s,"). Paths must not contain // in them."));e.push.apply(e,(0,H.Z)(s.split("/").filter((function(e){return e.length>0}))))}return new n(e)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(ro),io=/^[_a-zA-Z][_a-zA-Z0-9]*$/,oo=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"construct",value:function(e,t,r){return new n(e,t,r)}},{key:"canonicalString",value:function(){return this.toArray().map((function(e){return e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e})).join(".")}},{key:"toString",value:function(){return this.canonicalString()}},{key:"isKeyField",value:function(){return 1===this.length&&"__name__"===this.get(0)}}],[{key:"isValidIdentifier",value:function(e){return io.test(e)}},{key:"keyField",value:function(){return new n(["__name__"])}},{key:"fromServerFormat",value:function(e){for(var t=[],r="",a=0,i=function(){if(0===r.length)throw new Bi(zi.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""},o=!1;a<e.length;){var s=e[a];if("\\"===s){if(a+1===e.length)throw new Bi(zi.INVALID_ARGUMENT,"Path has trailing escape character: "+e);var u=e[a+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Bi(zi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=u,a+=2}else"`"===s?(o=!o,a++):"."!==s||o?(r+=s,a++):(i(),a++)}if(i(),o)throw new Bi(zi.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}},{key:"emptyPath",value:function(){return new n([])}}]),n}(ro),so=function(){function e(t){f(this,e),this.path=t}return p(e,[{key:"collectionGroup",get:function(){return this.path.popLast().lastSegment()}},{key:"hasCollectionId",value:function(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}},{key:"getCollectionGroup",value:function(){return this.path.get(this.path.length-2)}},{key:"getCollectionPath",value:function(){return this.path.popLast()}},{key:"isEqual",value:function(e){return null!==e&&0===ao.comparator(this.path,e.path)}},{key:"toString",value:function(){return this.path.toString()}}],[{key:"fromPath",value:function(t){return new e(ao.fromString(t))}},{key:"fromName",value:function(t){return new e(ao.fromString(t).popFirst(5))}},{key:"empty",value:function(){return new e(ao.emptyPath())}},{key:"comparator",value:function(e,t){return ao.comparator(e.path,t.path)}},{key:"isDocumentKey",value:function(e){return e.length%2==0}},{key:"fromSegments",value:function(t){return new e(new ao(t.slice()))}}]),e}(),uo=p((function e(t,n,r,a){f(this,e),this.indexId=t,this.collectionGroup=n,this.fields=r,this.indexState=a}));function co(e){return e.fields.find((function(e){return 2===e.kind}))}function lo(e){return e.fields.filter((function(e){return 2!==e.kind}))}uo.UNKNOWN_ID=-1;var ho=p((function e(t,n){f(this,e),this.fieldPath=t,this.kind=n}));var fo=function(){function e(t,n){f(this,e),this.sequenceNumber=t,this.offset=n}return p(e,null,[{key:"empty",value:function(){return new e(0,mo.min())}}]),e}();function po(e,t){var n=e.toTimestamp().seconds,r=e.toTimestamp().nanoseconds+1,a=no.fromTimestamp(1e9===r?new to(n+1,0):new to(n,r));return new mo(a,so.empty(),t)}function vo(e){return new mo(e.readTime,e.key,-1)}var mo=function(){function e(t,n,r){f(this,e),this.readTime=t,this.documentKey=n,this.largestBatchId=r}return p(e,null,[{key:"min",value:function(){return new e(no.min(),so.empty(),-1)}},{key:"max",value:function(){return new e(no.max(),so.empty(),-1)}}]),e}();function go(e,t){var n=e.readTime.compareTo(t.readTime);return 0!==n?n:0!==(n=so.comparator(e.documentKey,t.documentKey))?n:Ji(e.largestBatchId,t.largestBatchId)}var yo="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",bo=function(){function e(){f(this,e),this.onCommittedListeners=[]}return p(e,[{key:"addOnCommittedListener",value:function(e){this.onCommittedListeners.push(e)}},{key:"raiseOnCommittedEvent",value:function(){this.onCommittedListeners.forEach((function(e){return e()}))}}]),e}();function ko(e){return Vo.apply(this,arguments)}function Vo(){return Vo=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.code===zi.FAILED_PRECONDITION&&t.message===yo){e.next=2;break}throw t;case 2:_i("LocalStore","Unexpectedly lost primary lease");case 3:case"end":return e.stop()}}),e)}))),Vo.apply(this,arguments)}var xo=function(){function e(t){var n=this;f(this,e),this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((function(e){n.isDone=!0,n.result=e,n.nextCallback&&n.nextCallback(e)}),(function(e){n.isDone=!0,n.error=e,n.catchCallback&&n.catchCallback(e)}))}return p(e,[{key:"catch",value:function(e){return this.next(void 0,e)}},{key:"next",value:function(t,n){var r=this;return this.callbackAttached&&Li(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(t,this.result):new e((function(e,a){r.nextCallback=function(n){r.wrapSuccess(t,n).next(e,a)},r.catchCallback=function(t){r.wrapFailure(n,t).next(e,a)}}))}},{key:"toPromise",value:function(){var e=this;return new Promise((function(t,n){e.next(t,n)}))}},{key:"wrapUserFunction",value:function(t){try{var n=t();return n instanceof e?n:e.resolve(n)}catch(t){return e.reject(t)}}},{key:"wrapSuccess",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.resolve(n)}},{key:"wrapFailure",value:function(t,n){return t?this.wrapUserFunction((function(){return t(n)})):e.reject(n)}}],[{key:"resolve",value:function(t){return new e((function(e,n){e(t)}))}},{key:"reject",value:function(t){return new e((function(e,n){n(t)}))}},{key:"waitFor",value:function(t){return new e((function(e,n){var r=0,a=0,i=!1;t.forEach((function(t){++r,t.next((function(){++a,i&&a===r&&e()}),(function(e){return n(e)}))})),i=!0,a===r&&e()}))}},{key:"or",value:function(t){var n,r=e.resolve(!1),a=m(t);try{var i=function(){var t=n.value;r=r.next((function(n){return n?e.resolve(n):t()}))};for(a.s();!(n=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}return r}},{key:"forEach",value:function(e,t){var n=this,r=[];return e.forEach((function(e,a){r.push(t.call(n,e,a))})),this.waitFor(r)}},{key:"mapArray",value:function(t,n){return new e((function(e,r){for(var a=t.length,i=new Array(a),o=0,s=function(s){var u=s;n(t[u]).next((function(t){i[u]=t,++o===a&&e(i)}),(function(e){return r(e)}))},u=0;u<a;u++)s(u)}))}},{key:"doWhile",value:function(t,n){return new e((function(e,r){!function a(){!0===t()?n().next((function(){a()}),r):e()}()}))}}]),e}(),wo=function(){function e(t,n){var r=this;f(this,e),this.action=t,this.transaction=n,this.aborted=!1,this.P=new Ui,this.transaction.oncomplete=function(){r.P.resolve()},this.transaction.onabort=function(){n.error?r.P.reject(new Co(t,n.error)):r.P.resolve()},this.transaction.onerror=function(e){var n=Ro(e.target.error);r.P.reject(new Co(t,n))}}return p(e,[{key:"v",get:function(){return this.P.promise}},{key:"abort",value:function(e){e&&this.P.reject(e),this.aborted||(_i("SimpleDb","Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}},{key:"V",value:function(){var e=this.transaction;this.aborted||"function"!=typeof e.commit||e.commit()}},{key:"store",value:function(e){var t=this.transaction.objectStore(e);return new To(t)}}],[{key:"open",value:function(t,n,r,a){try{return new e(n,t.transaction(a,r))}catch(t){throw new Co(n,t)}}}]),e}(),Io=function(){function e(t,n,r){f(this,e),this.name=t,this.version=n,this.S=r,12.2===e.D(_())&&Di("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return p(e,[{key:"F",value:function(){var e=c(s().mark((function e(t){var n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.db,e.t0){e.next=6;break}return _i("SimpleDb","Opening database:",this.name),e.next=5,new Promise((function(e,r){var a=indexedDB.open(n.name,n.version);a.onsuccess=function(t){var n=t.target.result;e(n)},a.onblocked=function(){r(new Co(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=function(e){var n=e.target.error;"VersionError"===n.name?r(new Bi(zi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===n.name?r(new Bi(zi.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+n)):r(new Co(t,n))},a.onupgradeneeded=function(e){_i("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',e.oldVersion);var t=e.target.result;n.S.$(t,a.transaction,e.oldVersion,n.version).next((function(){_i("SimpleDb","Database upgrade to version "+n.version+" complete")}))}}));case 5:this.db=e.sent;case 6:return this.B&&(this.db.onversionchange=function(e){return n.B(e)}),e.abrupt("return",this.db);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"L",value:function(e){this.B=e,this.db&&(this.db.onversionchange=function(t){return e(t)})}},{key:"runTransaction",value:function(){var e=c(s().mark((function e(t,n,r,a){var i,o,u,c,l,h=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i="readonly"===n,o=0;case 2:return++o,e.prev=3,e.delegateYield(s().mark((function e(){var n,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,h.F(t);case 2:return h.db=e.sent,n=wo.open(h.db,t,i?"readonly":"readwrite",r),o=a(n).next((function(e){return n.V(),e})).catch((function(e){return n.abort(e),xo.reject(e)})).toPromise(),o.catch((function(){})),e.next=7,n.v;case 7:return e.t0=o,e.abrupt("return",{v:e.t0});case 9:case"end":return e.stop()}}),e)}))(),"t0",5);case 5:if("object"!==typeof(u=e.t0)){e.next=8;break}return e.abrupt("return",u.v);case 8:e.next=15;break;case 10:if(e.prev=10,e.t1=e.catch(3),c=e.t1,l="FirebaseError"!==c.name&&o<3,_i("SimpleDb","Transaction failed with error:",c.message,"Retrying:",l),this.close(),l){e.next=15;break}return e.abrupt("return",Promise.reject(c));case 15:e.next=2;break;case 17:case"end":return e.stop()}}),e,this,[[3,10]])})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"close",value:function(){this.db&&this.db.close(),this.db=void 0}}],[{key:"delete",value:function(e){return _i("SimpleDb","Removing database:",e),No(window.indexedDB.deleteDatabase(e)).toPromise()}},{key:"C",value:function(){if(!F())return!1;if(e.N())return!0;var t=_(),n=e.D(t),r=0<n&&n<10,a=e.k(t),i=0<a&&a<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||r||i)}},{key:"N",value:function(){var e;return"undefined"!=typeof process&&"YES"===(null===(e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0})||void 0===e?void 0:e.M)}},{key:"O",value:function(e,t){return e.store(t)}},{key:"D",value:function(e){var t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(n)}},{key:"k",value:function(e){var t=e.match(/Android ([\d.]+)/i),n=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(n)}}]),e}(),So=function(){function e(t){f(this,e),this.U=t,this.q=!1,this.K=null}return p(e,[{key:"isDone",get:function(){return this.q}},{key:"G",get:function(){return this.K}},{key:"cursor",set:function(e){this.U=e}},{key:"done",value:function(){this.q=!0}},{key:"j",value:function(e){this.K=e}},{key:"delete",value:function(){return No(this.U.delete())}}]),e}(),Co=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this,zi.UNAVAILABLE,"IndexedDB transaction '".concat(e,"' failed: ").concat(r))).name="IndexedDbTransactionError",a}return p(n)}(Bi);function Eo(e){return"IndexedDbTransactionError"===e.name}var To=function(){function e(t){f(this,e),this.store=t}return p(e,[{key:"put",value:function(e,t){var n;return void 0!==t?(_i("SimpleDb","PUT",this.store.name,e,t),n=this.store.put(t,e)):(_i("SimpleDb","PUT",this.store.name,"<auto-key>",e),n=this.store.put(e)),No(n)}},{key:"add",value:function(e){return _i("SimpleDb","ADD",this.store.name,e,e),No(this.store.add(e))}},{key:"get",value:function(e){var t=this;return No(this.store.get(e)).next((function(n){return void 0===n&&(n=null),_i("SimpleDb","GET",t.store.name,e,n),n}))}},{key:"delete",value:function(e){return _i("SimpleDb","DELETE",this.store.name,e),No(this.store.delete(e))}},{key:"count",value:function(){return _i("SimpleDb","COUNT",this.store.name),No(this.store.count())}},{key:"W",value:function(e,t){var n=this.options(e,t);if(n.index||"function"!=typeof this.store.getAll){var r=this.cursor(n),a=[];return this.H(r,(function(e,t){a.push(t)})).next((function(){return a}))}var i=this.store.getAll(n.range);return new xo((function(e,t){i.onerror=function(e){t(e.target.error)},i.onsuccess=function(t){e(t.target.result)}}))}},{key:"J",value:function(e,t){var n=this.store.getAll(e,null===t?void 0:t);return new xo((function(e,t){n.onerror=function(e){t(e.target.error)},n.onsuccess=function(t){e(t.target.result)}}))}},{key:"Y",value:function(e,t){_i("SimpleDb","DELETE ALL",this.store.name);var n=this.options(e,t);n.X=!1;var r=this.cursor(n);return this.H(r,(function(e,t,n){return n.delete()}))}},{key:"Z",value:function(e,t){var n;t?n=e:(n={},t=e);var r=this.cursor(n);return this.H(r,t)}},{key:"tt",value:function(e){var t=this.cursor({});return new xo((function(n,r){t.onerror=function(e){var t=Ro(e.target.error);r(t)},t.onsuccess=function(t){var r=t.target.result;r?e(r.primaryKey,r.value).next((function(e){e?r.continue():n()})):n()}}))}},{key:"H",value:function(e,t){var n=[];return new xo((function(r,a){e.onerror=function(e){a(e.target.error)},e.onsuccess=function(e){var a=e.target.result;if(a){var i=new So(a),o=t(a.primaryKey,a.value,i);if(o instanceof xo){var s=o.catch((function(e){return i.done(),xo.reject(e)}));n.push(s)}i.isDone?r():null===i.G?a.continue():a.continue(i.G)}else r()}})).next((function(){return xo.waitFor(n)}))}},{key:"options",value:function(e,t){var n;return void 0!==e&&("string"==typeof e?n=e:t=e),{index:n,range:t}}},{key:"cursor",value:function(e){var t="next";if(e.reverse&&(t="prev"),e.index){var n=this.store.index(e.index);return e.X?n.openKeyCursor(e.range,t):n.openCursor(e.range,t)}return this.store.openCursor(e.range,t)}}]),e}();function No(e){return new xo((function(t,n){e.onsuccess=function(e){var n=e.target.result;t(n)},e.onerror=function(e){var t=Ro(e.target.error);n(t)}}))}var Ao=!1;function Ro(e){var t=Io.D(_());if(t>=12.2&&t<13){var n="An internal error was encountered in the Indexed Database server";if(e.message.indexOf(n)>=0){var r=new Bi("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '".concat(n,"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround."));return Ao||(Ao=!0,setTimeout((function(){throw r}),0)),r}}return e}var _o=function(){function e(t,n){f(this,e),this.asyncQueue=t,this.et=n,this.task=null}return p(e,[{key:"start",value:function(){this.nt(15e3)}},{key:"stop",value:function(){this.task&&(this.task.cancel(),this.task=null)}},{key:"started",get:function(){return null!==this.task}},{key:"nt",value:function(e){var t=this;_i("IndexBackiller","Scheduled in ".concat(e,"ms")),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.task=null,e.prev=1,e.t0=_i,e.t1="Documents written: ",e.next=6,t.et.st();case 6:e.t2=e.sent,e.t3=e.t1.concat.call(e.t1,e.t2),(0,e.t0)("IndexBackiller",e.t3),e.next=19;break;case 11:if(e.prev=11,e.t4=e.catch(1),!Eo(e.t4)){e.next=17;break}_i("IndexBackiller","Ignoring IndexedDB error during index backfill: ",e.t4),e.next=19;break;case 17:return e.next=19,ko(e.t4);case 19:return e.next=21,t.nt(6e4);case 21:case"end":return e.stop()}}),e,null,[[1,11]])}))))}}]),e}(),Do=function(){function e(t,n){f(this,e),this.localStore=t,this.persistence=n}return p(e,[{key:"st",value:function(){var e=c(s().mark((function e(){var t,n=this,r=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.length>0&&void 0!==r[0]?r[0]:50,e.abrupt("return",this.persistence.runTransaction("Backfill Indexes","readwrite-primary",(function(e){return n.it(e,t)})));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"it",value:function(e,t){var n=this,r=new Set,a=t,i=!0;return xo.doWhile((function(){return!0===i&&a>0}),(function(){return n.localStore.indexManager.getNextCollectionGroupToUpdate(e).next((function(t){if(null!==t&&!r.has(t))return _i("IndexBackiller","Processing collection: ".concat(t)),n.rt(e,t,a).next((function(e){a-=e,r.add(t)}));i=!1}))})).next((function(){return t-a}))}},{key:"rt",value:function(e,t,n){var r=this;return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next((function(a){return r.localStore.localDocuments.getNextDocuments(e,t,a,n).next((function(n){var i=n.changes;return r.localStore.indexManager.updateIndexEntries(e,i).next((function(){return r.ot(a,n)})).next((function(n){return _i("IndexBackiller","Updating offset: ".concat(n)),r.localStore.indexManager.updateCollectionGroup(e,t,n)})).next((function(){return i.size}))}))}))}},{key:"ot",value:function(e,t){var n=e;return t.changes.forEach((function(e,t){var r=vo(t);go(r,n)>0&&(n=r)})),new mo(n.readTime,n.documentKey,Math.max(t.batchId,e.largestBatchId))}}]),e}(),Fo=function(){function e(t,n){var r=this;f(this,e),this.previousValue=t,n&&(n.sequenceNumberHandler=function(e){return r.ut(e)},this.ct=function(e){return n.writeSequenceNumber(e)})}return p(e,[{key:"ut",value:function(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}},{key:"next",value:function(){var e=++this.previousValue;return this.ct&&this.ct(e),e}}]),e}();function Oo(e){var t=0;for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t++;return t}function Lo(e,t){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t(n,e[n])}function Mo(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}Fo.at=-1;var Po=function(){function e(t,n){f(this,e),this.comparator=t,this.root=n||Bo.EMPTY}return p(e,[{key:"insert",value:function(t,n){return new e(this.comparator,this.root.insert(t,n,this.comparator).copy(null,null,Bo.BLACK,null,null))}},{key:"remove",value:function(t){return new e(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Bo.BLACK,null,null))}},{key:"get",value:function(e){for(var t=this.root;!t.isEmpty();){var n=this.comparator(e,t.key);if(0===n)return t.value;n<0?t=t.left:n>0&&(t=t.right)}return null}},{key:"indexOf",value:function(e){for(var t=0,n=this.root;!n.isEmpty();){var r=this.comparator(e,n.key);if(0===r)return t+n.left.size;r<0?n=n.left:(t+=n.left.size+1,n=n.right)}return-1}},{key:"isEmpty",value:function(){return this.root.isEmpty()}},{key:"size",get:function(){return this.root.size}},{key:"minKey",value:function(){return this.root.minKey()}},{key:"maxKey",value:function(){return this.root.maxKey()}},{key:"inorderTraversal",value:function(e){return this.root.inorderTraversal(e)}},{key:"forEach",value:function(e){this.inorderTraversal((function(t,n){return e(t,n),!1}))}},{key:"toString",value:function(){var e=[];return this.inorderTraversal((function(t,n){return e.push("".concat(t,":").concat(n)),!1})),"{".concat(e.join(", "),"}")}},{key:"reverseTraversal",value:function(e){return this.root.reverseTraversal(e)}},{key:"getIterator",value:function(){return new zo(this.root,null,this.comparator,!1)}},{key:"getIteratorFrom",value:function(e){return new zo(this.root,e,this.comparator,!1)}},{key:"getReverseIterator",value:function(){return new zo(this.root,null,this.comparator,!0)}},{key:"getReverseIteratorFrom",value:function(e){return new zo(this.root,e,this.comparator,!0)}}]),e}(),zo=function(){function e(t,n,r,a){f(this,e),this.isReverse=a,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=n?r(t.key,n):1,n&&a&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return p(e,[{key:"getNext",value:function(){var e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}},{key:"hasNext",value:function(){return this.nodeStack.length>0}},{key:"peek",value:function(){if(0===this.nodeStack.length)return null;var e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}]),e}(),Bo=function(){function e(t,n,r,a,i){f(this,e),this.key=t,this.value=n,this.color=null!=r?r:e.RED,this.left=null!=a?a:e.EMPTY,this.right=null!=i?i:e.EMPTY,this.size=this.left.size+1+this.right.size}return p(e,[{key:"copy",value:function(t,n,r,a,i){return new e(null!=t?t:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=a?a:this.left,null!=i?i:this.right)}},{key:"isEmpty",value:function(){return!1}},{key:"inorderTraversal",value:function(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}},{key:"reverseTraversal",value:function(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}},{key:"min",value:function(){return this.left.isEmpty()?this:this.left.min()}},{key:"minKey",value:function(){return this.min().key}},{key:"maxKey",value:function(){return this.right.isEmpty()?this.key:this.right.maxKey()}},{key:"insert",value:function(e,t,n){var r=this,a=n(e,r.key);return(r=a<0?r.copy(null,null,null,r.left.insert(e,t,n),null):0===a?r.copy(null,t,null,null,null):r.copy(null,null,null,null,r.right.insert(e,t,n))).fixUp()}},{key:"removeMin",value:function(){if(this.left.isEmpty())return e.EMPTY;var t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),(t=t.copy(null,null,null,t.left.removeMin(),null)).fixUp()}},{key:"remove",value:function(t,n){var r,a=this;if(n(t,a.key)<0)a.left.isEmpty()||a.left.isRed()||a.left.left.isRed()||(a=a.moveRedLeft()),a=a.copy(null,null,null,a.left.remove(t,n),null);else{if(a.left.isRed()&&(a=a.rotateRight()),a.right.isEmpty()||a.right.isRed()||a.right.left.isRed()||(a=a.moveRedRight()),0===n(t,a.key)){if(a.right.isEmpty())return e.EMPTY;r=a.right.min(),a=a.copy(r.key,r.value,null,null,a.right.removeMin())}a=a.copy(null,null,null,null,a.right.remove(t,n))}return a.fixUp()}},{key:"isRed",value:function(){return this.color}},{key:"fixUp",value:function(){var e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}},{key:"moveRedLeft",value:function(){var e=this.colorFlip();return e.right.left.isRed()&&(e=(e=(e=e.copy(null,null,null,null,e.right.rotateRight())).rotateLeft()).colorFlip()),e}},{key:"moveRedRight",value:function(){var e=this.colorFlip();return e.left.left.isRed()&&(e=(e=e.rotateRight()).colorFlip()),e}},{key:"rotateLeft",value:function(){var t=this.copy(null,null,e.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}},{key:"rotateRight",value:function(){var t=this.copy(null,null,e.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}},{key:"colorFlip",value:function(){var e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}},{key:"checkMaxDepth",value:function(){var e=this.check();return Math.pow(2,e)<=this.size+1}},{key:"check",value:function(){if(this.isRed()&&this.left.isRed())throw Li();if(this.right.isRed())throw Li();var e=this.left.check();if(e!==this.right.check())throw Li();return e+(this.isRed()?0:1)}}]),e}();Bo.EMPTY=null,Bo.RED=!0,Bo.BLACK=!1,Bo.EMPTY=new(function(){function e(){f(this,e),this.size=0}return p(e,[{key:"key",get:function(){throw Li()}},{key:"value",get:function(){throw Li()}},{key:"color",get:function(){throw Li()}},{key:"left",get:function(){throw Li()}},{key:"right",get:function(){throw Li()}},{key:"copy",value:function(e,t,n,r,a){return this}},{key:"insert",value:function(e,t,n){return new Bo(e,t)}},{key:"remove",value:function(e,t){return this}},{key:"isEmpty",value:function(){return!0}},{key:"inorderTraversal",value:function(e){return!1}},{key:"reverseTraversal",value:function(e){return!1}},{key:"minKey",value:function(){return null}},{key:"maxKey",value:function(){return null}},{key:"isRed",value:function(){return!1}},{key:"checkMaxDepth",value:function(){return!0}},{key:"check",value:function(){return 0}}]),e}());var Uo=function(){function e(t){f(this,e),this.comparator=t,this.data=new Po(this.comparator)}return p(e,[{key:"has",value:function(e){return null!==this.data.get(e)}},{key:"first",value:function(){return this.data.minKey()}},{key:"last",value:function(){return this.data.maxKey()}},{key:"size",get:function(){return this.data.size}},{key:"indexOf",value:function(e){return this.data.indexOf(e)}},{key:"forEach",value:function(e){this.data.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"forEachInRange",value:function(e,t){for(var n=this.data.getIteratorFrom(e[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,e[1])>=0)return;t(r.key)}}},{key:"forEachWhile",value:function(e,t){var n;for(n=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();n.hasNext();)if(!e(n.getNext().key))return}},{key:"firstAfterOrEqual",value:function(e){var t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}},{key:"getIterator",value:function(){return new Wo(this.data.getIterator())}},{key:"getIteratorFrom",value:function(e){return new Wo(this.data.getIteratorFrom(e))}},{key:"add",value:function(e){return this.copy(this.data.remove(e).insert(e,!0))}},{key:"delete",value:function(e){return this.has(e)?this.copy(this.data.remove(e)):this}},{key:"isEmpty",value:function(){return this.data.isEmpty()}},{key:"unionWith",value:function(e){var t=this;return t.size<e.size&&(t=e,e=this),e.forEach((function(e){t=t.add(e)})),t}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.data.getIterator(),r=t.data.getIterator();n.hasNext();){var a=n.getNext().key,i=r.getNext().key;if(0!==this.comparator(a,i))return!1}return!0}},{key:"toArray",value:function(){var e=[];return this.forEach((function(t){e.push(t)})),e}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){return e.push(t)})),"SortedSet("+e.toString()+")"}},{key:"copy",value:function(t){var n=new e(this.comparator);return n.data=t,n}}]),e}(),Wo=function(){function e(t){f(this,e),this.iter=t}return p(e,[{key:"getNext",value:function(){return this.iter.getNext().key}},{key:"hasNext",value:function(){return this.iter.hasNext()}}]),e}();function jo(e){return e.hasNext()?e.getNext():void 0}var Zo=function(){function e(t){f(this,e),this.fields=t,t.sort(oo.comparator)}return p(e,[{key:"unionWith",value:function(t){var n,r=new Uo(oo.comparator),a=m(this.fields);try{for(a.s();!(n=a.n()).done;){var i=n.value;r=r.add(i)}}catch(c){a.e(c)}finally{a.f()}var o,s=m(t);try{for(s.s();!(o=s.n()).done;){var u=o.value;r=r.add(u)}}catch(c){s.e(c)}finally{s.f()}return new e(r.toArray())}},{key:"covers",value:function(e){var t,n=m(this.fields);try{for(n.s();!(t=n.n()).done;){if(t.value.isPrefixOf(e))return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"isEqual",value:function(e){return $i(this.fields,e.fields,(function(e,t){return e.isEqual(t)}))}}],[{key:"empty",value:function(){return new e([])}}]),e}();var Go=function(e){function t(e){f(this,t),this.binaryString=e}return p(t,[{key:Symbol.iterator,value:function(){var e=this,t=0;return{next:function(){return t<e.binaryString.length?{value:e.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}}},{key:"toBase64",value:function(){return e=this.binaryString,btoa(e);var e}},{key:"toUint8Array",value:function(){return function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=e.charCodeAt(n);return t}(this.binaryString)}},{key:"approximateByteSize",value:function(){return 2*this.binaryString.length}},{key:"compareTo",value:function(e){return Ji(this.binaryString,e.binaryString)}},{key:"isEqual",value:function(e){return this.binaryString===e.binaryString}}],[{key:"fromBase64String",value:function(e){return new t(atob(e))}},{key:"fromUint8Array",value:function(e){var n=function(e){for(var t="",n=0;n<e.length;++n)t+=String.fromCharCode(e[n]);return t}(e);return new t(n)}}]),t}();Go.EMPTY_BYTE_STRING=new Go("");var Ho=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function qo(e){if(Mi(!!e),"string"==typeof e){var t=0,n=Ho.exec(e);if(Mi(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),t=Number(r)}var a=new Date(e);return{seconds:Math.floor(a.getTime()/1e3),nanos:t}}return{seconds:Ko(e.seconds),nanos:Ko(e.nanos)}}function Ko(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function Xo(e){return"string"==typeof e?Go.fromBase64String(e):Go.fromUint8Array(e)}function Qo(e){var t,n;return"server_timestamp"===(null===(n=((null===(t=null==e?void 0:e.mapValue)||void 0===t?void 0:t.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Yo(e){var t=e.mapValue.fields.__previous_value__;return Qo(t)?Yo(t):t}function Jo(e){var t=qo(e.mapValue.fields.__local_write_time__.timestampValue);return new to(t.seconds,t.nanos)}var $o=p((function e(t,n,r,a,i,o,s,u){f(this,e),this.databaseId=t,this.appId=n,this.persistenceKey=r,this.host=a,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=u})),es=function(){function e(t,n){f(this,e),this.projectId=t,this.database=n||"(default)"}return p(e,[{key:"isDefaultDatabase",get:function(){return"(default)"===this.database}},{key:"isEqual",value:function(t){return t instanceof e&&t.projectId===this.projectId&&t.database===this.database}}],[{key:"empty",value:function(){return new e("","")}}]),e}();function ts(e){return null==e}function ns(e){return 0===e&&1/e==-1/0}function rs(e){return"number"==typeof e&&Number.isInteger(e)&&!ns(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}var as={mapValue:{fields:{__type__:{stringValue:"__max__"}}}},is={nullValue:"NULL_VALUE"};function os(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?Qo(e)?4:ks(e)?9007199254740991:10:Li()}function ss(e,t){if(e===t)return!0;var n=os(e);if(n!==os(t))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Jo(e).isEqual(Jo(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;var n=qo(e.timestampValue),r=qo(t.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return Xo(e.bytesValue).isEqual(Xo(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return Ko(e.geoPointValue.latitude)===Ko(t.geoPointValue.latitude)&&Ko(e.geoPointValue.longitude)===Ko(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return Ko(e.integerValue)===Ko(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){var n=Ko(e.doubleValue),r=Ko(t.doubleValue);return n===r?ns(n)===ns(r):isNaN(n)&&isNaN(r)}return!1}(e,t);case 9:return $i(e.arrayValue.values||[],t.arrayValue.values||[],ss);case 10:return function(e,t){var n=e.mapValue.fields||{},r=t.mapValue.fields||{};if(Oo(n)!==Oo(r))return!1;for(var a in n)if(n.hasOwnProperty(a)&&(void 0===r[a]||!ss(n[a],r[a])))return!1;return!0}(e,t);default:return Li()}}function us(e,t){return void 0!==(e.values||[]).find((function(e){return ss(e,t)}))}function cs(e,t){if(e===t)return 0;var n=os(e),r=os(t);if(n!==r)return Ji(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return Ji(e.booleanValue,t.booleanValue);case 2:return function(e,t){var n=Ko(e.integerValue||e.doubleValue),r=Ko(t.integerValue||t.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(e,t);case 3:return ls(e.timestampValue,t.timestampValue);case 4:return ls(Jo(e),Jo(t));case 5:return Ji(e.stringValue,t.stringValue);case 6:return function(e,t){var n=Xo(e),r=Xo(t);return n.compareTo(r)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){for(var n=e.split("/"),r=t.split("/"),a=0;a<n.length&&a<r.length;a++){var i=Ji(n[a],r[a]);if(0!==i)return i}return Ji(n.length,r.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){var n=Ji(Ko(e.latitude),Ko(t.latitude));return 0!==n?n:Ji(Ko(e.longitude),Ko(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return function(e,t){for(var n=e.values||[],r=t.values||[],a=0;a<n.length&&a<r.length;++a){var i=cs(n[a],r[a]);if(i)return i}return Ji(n.length,r.length)}(e.arrayValue,t.arrayValue);case 10:return function(e,t){if(e===as.mapValue&&t===as.mapValue)return 0;if(e===as.mapValue)return 1;if(t===as.mapValue)return-1;var n=e.fields||{},r=Object.keys(n),a=t.fields||{},i=Object.keys(a);r.sort(),i.sort();for(var o=0;o<r.length&&o<i.length;++o){var s=Ji(r[o],i[o]);if(0!==s)return s;var u=cs(n[r[o]],a[i[o]]);if(0!==u)return u}return Ji(r.length,i.length)}(e.mapValue,t.mapValue);default:throw Li()}}function ls(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ji(e,t);var n=qo(e),r=qo(t),a=Ji(n.seconds,r.seconds);return 0!==a?a:Ji(n.nanos,r.nanos)}function hs(e){return fs(e)}function fs(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){var t=qo(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?Xo(e.bytesValue).toBase64():"referenceValue"in e?(n=e.referenceValue,so.fromName(n).toString()):"geoPointValue"in e?"geo(".concat((t=e.geoPointValue).latitude,",").concat(t.longitude,")"):"arrayValue"in e?function(e){var t,n="[",r=!0,a=m(e.values||[]);try{for(a.s();!(t=a.n()).done;){var i=t.value;r?r=!1:n+=",",n+=fs(i)}}catch(o){a.e(o)}finally{a.f()}return n+"]"}(e.arrayValue):"mapValue"in e?function(e){var t,n="{",r=!0,a=m(Object.keys(e.fields||{}).sort());try{for(a.s();!(t=a.n()).done;){var i=t.value;r?r=!1:n+=",",n+="".concat(i,":").concat(fs(e.fields[i]))}}catch(o){a.e(o)}finally{a.f()}return n+"}"}(e.mapValue):Li();var t,n}function ds(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function ps(e){return!!e&&"integerValue"in e}function vs(e){return!!e&&"arrayValue"in e}function ms(e){return!!e&&"nullValue"in e}function gs(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function ys(e){return!!e&&"mapValue"in e}function bs(e){if(e.geoPointValue)return{geoPointValue:Object.assign({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:Object.assign({},e.timestampValue)};if(e.mapValue){var t={mapValue:{fields:{}}};return Lo(e.mapValue.fields,(function(e,n){return t.mapValue.fields[e]=bs(n)})),t}if(e.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(e.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=bs(e.arrayValue.values[r]);return n}return Object.assign({},e)}function ks(e){return"__max__"===(((e.mapValue||{}).fields||{}).__type__||{}).stringValue}function Vs(e){return"nullValue"in e?is:"booleanValue"in e?{booleanValue:!1}:"integerValue"in e||"doubleValue"in e?{doubleValue:NaN}:"timestampValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in e?{stringValue:""}:"bytesValue"in e?{bytesValue:""}:"referenceValue"in e?ds(es.empty(),so.empty()):"geoPointValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in e?{arrayValue:{}}:"mapValue"in e?{mapValue:{}}:Li()}function xs(e){return"nullValue"in e?{booleanValue:!1}:"booleanValue"in e?{doubleValue:NaN}:"integerValue"in e||"doubleValue"in e?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in e?{stringValue:""}:"stringValue"in e?{bytesValue:""}:"bytesValue"in e?ds(es.empty(),so.empty()):"referenceValue"in e?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in e?{arrayValue:{}}:"arrayValue"in e?{mapValue:{}}:"mapValue"in e?as:Li()}function ws(e,t){var n=cs(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?-1:!e.inclusive&&t.inclusive?1:0}function Is(e,t){var n=cs(e.value,t.value);return 0!==n?n:e.inclusive&&!t.inclusive?1:!e.inclusive&&t.inclusive?-1:0}var Ss=function(){function e(t){f(this,e),this.value=t}return p(e,[{key:"field",value:function(e){if(e.isEmpty())return this.value;for(var t=this.value,n=0;n<e.length-1;++n)if(!ys(t=(t.mapValue.fields||{})[e.get(n)]))return null;return(t=(t.mapValue.fields||{})[e.lastSegment()])||null}},{key:"set",value:function(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=bs(t)}},{key:"setAll",value:function(e){var t=this,n=oo.emptyPath(),r={},a=[];e.forEach((function(e,i){if(!n.isImmediateParentOf(i)){var o=t.getFieldsMap(n);t.applyChanges(o,r,a),r={},a=[],n=i.popLast()}e?r[i.lastSegment()]=bs(e):a.push(i.lastSegment())}));var i=this.getFieldsMap(n);this.applyChanges(i,r,a)}},{key:"delete",value:function(e){var t=this.field(e.popLast());ys(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}},{key:"isEqual",value:function(e){return ss(this.value,e.value)}},{key:"getFieldsMap",value:function(e){var t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(var n=0;n<e.length;++n){var r=t.mapValue.fields[e.get(n)];ys(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},t.mapValue.fields[e.get(n)]=r),t=r}return t.mapValue.fields}},{key:"applyChanges",value:function(e,t,n){Lo(t,(function(t,n){return e[t]=n}));var r,a=m(n);try{for(a.s();!(r=a.n()).done;){var i=r.value;delete e[i]}}catch(o){a.e(o)}finally{a.f()}}},{key:"clone",value:function(){return new e(bs(this.value))}}],[{key:"empty",value:function(){return new e({mapValue:{}})}}]),e}();function Cs(e){var t=[];return Lo(e.fields,(function(e,n){var r=new oo([e]);if(ys(n)){var a=Cs(n.mapValue).fields;if(0===a.length)t.push(r);else{var i,o=m(a);try{for(o.s();!(i=o.n()).done;){var s=i.value;t.push(r.child(s))}}catch(u){o.e(u)}finally{o.f()}}}else t.push(r)})),new Zo(t)}var Es=function(){function e(t,n,r,a,i,o){f(this,e),this.key=t,this.documentType=n,this.version=r,this.readTime=a,this.data=i,this.documentState=o}return p(e,[{key:"convertToFoundDocument",value:function(e,t){return this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}},{key:"convertToNoDocument",value:function(e){return this.version=e,this.documentType=2,this.data=Ss.empty(),this.documentState=0,this}},{key:"convertToUnknownDocument",value:function(e){return this.version=e,this.documentType=3,this.data=Ss.empty(),this.documentState=2,this}},{key:"setHasCommittedMutations",value:function(){return this.documentState=2,this}},{key:"setHasLocalMutations",value:function(){return this.documentState=1,this.version=no.min(),this}},{key:"setReadTime",value:function(e){return this.readTime=e,this}},{key:"hasLocalMutations",get:function(){return 1===this.documentState}},{key:"hasCommittedMutations",get:function(){return 2===this.documentState}},{key:"hasPendingWrites",get:function(){return this.hasLocalMutations||this.hasCommittedMutations}},{key:"isValidDocument",value:function(){return 0!==this.documentType}},{key:"isFoundDocument",value:function(){return 1===this.documentType}},{key:"isNoDocument",value:function(){return 2===this.documentType}},{key:"isUnknownDocument",value:function(){return 3===this.documentType}},{key:"isEqual",value:function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}},{key:"mutableCopy",value:function(){return new e(this.key,this.documentType,this.version,this.readTime,this.data.clone(),this.documentState)}},{key:"toString",value:function(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}],[{key:"newInvalidDocument",value:function(t){return new e(t,0,no.min(),no.min(),Ss.empty(),0)}},{key:"newFoundDocument",value:function(t,n,r){return new e(t,1,n,no.min(),r,0)}},{key:"newNoDocument",value:function(t,n){return new e(t,2,n,no.min(),Ss.empty(),0)}},{key:"newUnknownDocument",value:function(t,n){return new e(t,3,n,no.min(),Ss.empty(),2)}}]),e}(),Ts=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;f(this,e),this.path=t,this.collectionGroup=n,this.orderBy=r,this.filters=a,this.limit=i,this.startAt=o,this.endAt=s,this.ht=null}));function Ns(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return new Ts(e,t,n,r,a,i,o)}function As(e){var t=Pi(e);if(null===t.ht){var n=t.path.canonicalString();null!==t.collectionGroup&&(n+="|cg:"+t.collectionGroup),n+="|f:",n+=t.filters.map((function(e){return(t=e).field.canonicalString()+t.op.toString()+hs(t.value);var t})).join(","),n+="|ob:",n+=t.orderBy.map((function(e){return function(e){return e.field.canonicalString()+e.dir}(e)})).join(","),ts(t.limit)||(n+="|l:",n+=t.limit),t.startAt&&(n+="|lb:",n+=t.startAt.inclusive?"b:":"a:",n+=t.startAt.position.map((function(e){return hs(e)})).join(",")),t.endAt&&(n+="|ub:",n+=t.endAt.inclusive?"a:":"b:",n+=t.endAt.position.map((function(e){return hs(e)})).join(",")),t.ht=n}return t.ht}function Rs(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(var n=0;n<e.orderBy.length;n++)if(!qs(e.orderBy[n],t.orderBy[n]))return!1;if(e.filters.length!==t.filters.length)return!1;for(var r=0;r<e.filters.length;r++)if(a=e.filters[r],i=t.filters[r],a.op!==i.op||!a.field.isEqual(i.field)||!ss(a.value,i.value))return!1;var a,i;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!Xs(e.startAt,t.startAt)&&Xs(e.endAt,t.endAt)}function _s(e){return so.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}function Ds(e,t){return e.filters.filter((function(e){return e instanceof Ls&&e.field.isEqual(t)}))}function Fs(e,t,n){var r,a=is,i=!0,o=m(Ds(e,t));try{for(o.s();!(r=o.n()).done;){var s=r.value,u=is,c=!0;switch(s.op){case"<":case"<=":u=Vs(s.value);break;case"==":case"in":case">=":u=s.value;break;case">":u=s.value,c=!1;break;case"!=":case"not-in":u=is}ws({value:a,inclusive:i},{value:u,inclusive:c})<0&&(a=u,i=c)}}catch(f){o.e(f)}finally{o.f()}if(null!==n)for(var l=0;l<e.orderBy.length;++l)if(e.orderBy[l].field.isEqual(t)){var h=n.position[l];ws({value:a,inclusive:i},{value:h,inclusive:n.inclusive})<0&&(a=h,i=n.inclusive);break}return{value:a,inclusive:i}}function Os(e,t,n){var r,a=as,i=!0,o=m(Ds(e,t));try{for(o.s();!(r=o.n()).done;){var s=r.value,u=as,c=!0;switch(s.op){case">=":case">":u=xs(s.value),c=!1;break;case"==":case"in":case"<=":u=s.value;break;case"<":u=s.value,c=!1;break;case"!=":case"not-in":u=as}Is({value:a,inclusive:i},{value:u,inclusive:c})>0&&(a=u,i=c)}}catch(f){o.e(f)}finally{o.f()}if(null!==n)for(var l=0;l<e.orderBy.length;++l)if(e.orderBy[l].field.isEqual(t)){var h=n.position[l];Is({value:a,inclusive:i},{value:h,inclusive:n.inclusive})>0&&(a=h,i=n.inclusive);break}return{value:a,inclusive:i}}var Ls=function(e){b(n,e);var t=w(n);function n(e,r,a){var i;return f(this,n),(i=t.call(this)).field=e,i.op=r,i.value=a,i}return p(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return"!="===this.op?null!==t&&this.ft(cs(t,this.value)):null!==t&&os(this.value)===os(t)&&this.ft(cs(t,this.value))}},{key:"ft",value:function(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Li()}}},{key:"dt",value:function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}}],[{key:"create",value:function(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.lt(e,t,r):new Ms(e,t,r):"array-contains"===t?new Us(e,r):"in"===t?new Ws(e,r):"not-in"===t?new js(e,r):"array-contains-any"===t?new Zs(e,r):new n(e,t,r)}},{key:"lt",value:function(e,t,n){return"in"===t?new Ps(e,n):new zs(e,n)}}]),n}(function(){return p((function e(){f(this,e)}))}()),Ms=function(e){b(n,e);var t=w(n);function n(e,r,a){var i;return f(this,n),(i=t.call(this,e,r,a)).key=so.fromName(a.referenceValue),i}return p(n,[{key:"matches",value:function(e){var t=so.comparator(e.key,this.key);return this.ft(t)}}]),n}(Ls),Ps=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this,e,"in",r)).keys=Bs("in",r),a}return p(n,[{key:"matches",value:function(e){return this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(Ls),zs=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this,e,"not-in",r)).keys=Bs("not-in",r),a}return p(n,[{key:"matches",value:function(e){return!this.keys.some((function(t){return t.isEqual(e.key)}))}}]),n}(Ls);function Bs(e,t){var n;return((null===(n=t.arrayValue)||void 0===n?void 0:n.values)||[]).map((function(e){return so.fromName(e.referenceValue)}))}var Us=function(e){b(n,e);var t=w(n);function n(e,r){return f(this,n),t.call(this,e,"array-contains",r)}return p(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return vs(t)&&us(t.arrayValue,this.value)}}]),n}(Ls),Ws=function(e){b(n,e);var t=w(n);function n(e,r){return f(this,n),t.call(this,e,"in",r)}return p(n,[{key:"matches",value:function(e){var t=e.data.field(this.field);return null!==t&&us(this.value.arrayValue,t)}}]),n}(Ls),js=function(e){b(n,e);var t=w(n);function n(e,r){return f(this,n),t.call(this,e,"not-in",r)}return p(n,[{key:"matches",value:function(e){if(us(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var t=e.data.field(this.field);return null!==t&&!us(this.value.arrayValue,t)}}]),n}(Ls),Zs=function(e){b(n,e);var t=w(n);function n(e,r){return f(this,n),t.call(this,e,"array-contains-any",r)}return p(n,[{key:"matches",value:function(e){var t=this,n=e.data.field(this.field);return!(!vs(n)||!n.arrayValue.values)&&n.arrayValue.values.some((function(e){return us(t.value.arrayValue,e)}))}}]),n}(Ls),Gs=p((function e(t,n){f(this,e),this.position=t,this.inclusive=n})),Hs=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";f(this,e),this.field=t,this.dir=n}));function qs(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}function Ks(e,t,n){for(var r=0,a=0;a<e.position.length;a++){var i=t[a],o=e.position[a];if(r=i.field.isKeyField()?so.comparator(so.fromName(o.referenceValue),n.key):cs(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Xs(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(var n=0;n<e.position.length;n++)if(!ss(e.position[n],t.position[n]))return!1;return!0}var Qs=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;f(this,e),this.path=t,this.collectionGroup=n,this.explicitOrderBy=r,this.filters=a,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=u,this._t=null,this.wt=null,this.startAt,this.endAt}));function Ys(e,t,n,r,a,i,o,s){return new Qs(e,t,n,r,a,i,o,s)}function Js(e){return new Qs(e)}function $s(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function eu(e){return e.explicitOrderBy.length>0?e.explicitOrderBy[0].field:null}function tu(e){var t,n=m(e.filters);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(r.dt())return r.field}}catch(a){n.e(a)}finally{n.f()}return null}function nu(e){return null!==e.collectionGroup}function ru(e){var t=Pi(e);if(null===t._t){t._t=[];var n=tu(t),r=eu(t);if(null!==n&&null===r)n.isKeyField()||t._t.push(new Hs(n)),t._t.push(new Hs(oo.keyField(),"asc"));else{var a,i=!1,o=m(t.explicitOrderBy);try{for(o.s();!(a=o.n()).done;){var s=a.value;t._t.push(s),s.field.isKeyField()&&(i=!0)}}catch(c){o.e(c)}finally{o.f()}if(!i){var u=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";t._t.push(new Hs(oo.keyField(),u))}}}return t._t}function au(e){var t=Pi(e);if(!t.wt)if("F"===t.limitType)t.wt=Ns(t.path,t.collectionGroup,ru(t),t.filters,t.limit,t.startAt,t.endAt);else{var n,r=[],a=m(ru(t));try{for(a.s();!(n=a.n()).done;){var i=n.value,o="desc"===i.dir?"asc":"desc";r.push(new Hs(i.field,o))}}catch(c){a.e(c)}finally{a.f()}var s=t.endAt?new Gs(t.endAt.position,t.endAt.inclusive):null,u=t.startAt?new Gs(t.startAt.position,t.startAt.inclusive):null;t.wt=Ns(t.path,t.collectionGroup,r,t.filters,t.limit,s,u)}return t.wt}function iu(e,t,n){return new Qs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,n,e.startAt,e.endAt)}function ou(e,t){return Rs(au(e),au(t))&&e.limitType===t.limitType}function su(e){return"".concat(As(au(e)),"|lt:").concat(e.limitType)}function uu(e){return"Query(target=".concat(function(e){var t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map((function(e){return"".concat((t=e).field.canonicalString()," ").concat(t.op," ").concat(hs(t.value));var t})).join(", "),"]")),ts(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map((function(e){return function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)})).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((function(e){return hs(e)})).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((function(e){return hs(e)})).join(",")),"Target(".concat(t,")")}(au(e)),"; limitType=").concat(e.limitType,")")}function cu(e,t){return t.isFoundDocument()&&function(e,t){var n=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(n):so.isDocumentKey(e.path)?e.path.isEqual(n):e.path.isImmediateParentOf(n)}(e,t)&&function(e,t){var n,r=m(e.explicitOrderBy);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(!a.field.isKeyField()&&null===t.data.field(a.field))return!1}}catch(i){r.e(i)}finally{r.f()}return!0}(e,t)&&function(e,t){var n,r=m(e.filters);try{for(r.s();!(n=r.n()).done;){if(!n.value.matches(t))return!1}}catch(a){r.e(a)}finally{r.f()}return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,n){var r=Ks(e,t,n);return e.inclusive?r<=0:r<0}(e.startAt,ru(e),t))&&!(e.endAt&&!function(e,t,n){var r=Ks(e,t,n);return e.inclusive?r>=0:r>0}(e.endAt,ru(e),t))}(e,t)}function lu(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function hu(e){return function(t,n){var r,a=!1,i=m(ru(e));try{for(i.s();!(r=i.n()).done;){var o=r.value,s=fu(o,t,n);if(0!==s)return s;a=a||o.field.isKeyField()}}catch(u){i.e(u)}finally{i.f()}return 0}}function fu(e,t,n){var r=e.field.isKeyField()?so.comparator(t.key,n.key):function(e,t,n){var r=t.data.field(e),a=n.data.field(e);return null!==r&&null!==a?cs(r,a):Li()}(e.field,t,n);switch(e.dir){case"asc":return r;case"desc":return-1*r;default:return Li()}}function du(e,t){if(e.gt){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ns(t)?"-0":t}}function pu(e){return{integerValue:""+e}}function vu(e,t){return rs(t)?pu(t):du(e,t)}var mu=p((function e(){f(this,e),this._=void 0}));function gu(e,t,n){return e instanceof ku?function(e,t){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&(n.fields.__previous_value__=t),{mapValue:n}}(n,t):e instanceof Vu?xu(e,t):e instanceof wu?Iu(e,t):function(e,t){var n=bu(e,t),r=Cu(n)+Cu(e.yt);return ps(n)&&ps(e.yt)?pu(r):du(e.It,r)}(e,t)}function yu(e,t,n){return e instanceof Vu?xu(e,t):e instanceof wu?Iu(e,t):n}function bu(e,t){return e instanceof Su?ps(n=t)||function(e){return!!e&&"doubleValue"in e}(n)?t:{integerValue:0}:null;var n}var ku=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n)}(mu),Vu=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).elements=e,r}return p(n)}(mu);function xu(e,t){var n,r=Eu(t),a=m(e.elements);try{var i=function(){var e=n.value;r.some((function(t){return ss(t,e)}))||r.push(e)};for(a.s();!(n=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}return{arrayValue:{values:r}}}var wu=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).elements=e,r}return p(n)}(mu);function Iu(e,t){var n,r=Eu(t),a=m(e.elements);try{var i=function(){var e=n.value;r=r.filter((function(t){return!ss(t,e)}))};for(a.s();!(n=a.n()).done;)i()}catch(o){a.e(o)}finally{a.f()}return{arrayValue:{values:r}}}var Su=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).It=e,a.yt=r,a}return p(n)}(mu);function Cu(e){return Ko(e.integerValue||e.doubleValue)}function Eu(e){return vs(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}var Tu=p((function e(t,n){f(this,e),this.field=t,this.transform=n}));var Nu=p((function e(t,n){f(this,e),this.version=t,this.transformResults=n})),Au=function(){function e(t,n){f(this,e),this.updateTime=t,this.exists=n}return p(e,[{key:"isNone",get:function(){return void 0===this.updateTime&&void 0===this.exists}},{key:"isEqual",value:function(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}],[{key:"none",value:function(){return new e}},{key:"exists",value:function(t){return new e(void 0,t)}},{key:"updateTime",value:function(t){return new e(t)}}]),e}();function Ru(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}var _u=p((function e(){f(this,e)}));function Du(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Gu(e.key,Au.none()):new Pu(e.key,e.data,Au.none());var n,r=e.data,a=Ss.empty(),i=new Uo(oo.comparator),o=m(t.fields);try{for(o.s();!(n=o.n()).done;){var s=n.value;if(!i.has(s)){var u=r.field(s);null===u&&s.length>1&&(s=s.popLast(),u=r.field(s)),null===u?a.delete(s):a.set(s,u),i=i.add(s)}}}catch(c){o.e(c)}finally{o.f()}return new zu(e.key,a,new Zo(i.toArray()),Au.none())}function Fu(e,t,n){e instanceof Pu?function(e,t,n){var r=e.value.clone(),a=Uu(e.fieldTransforms,t,n.transformResults);r.setAll(a),t.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(e,t,n):e instanceof zu?function(e,t,n){if(Ru(e.precondition,t)){var r=Uu(e.fieldTransforms,t,n.transformResults),a=t.data;a.setAll(Bu(e)),a.setAll(r),t.convertToFoundDocument(n.version,a).setHasCommittedMutations()}else t.convertToUnknownDocument(n.version)}(e,t,n):function(e,t,n){t.convertToNoDocument(n.version).setHasCommittedMutations()}(0,t,n)}function Ou(e,t,n,r){return e instanceof Pu?function(e,t,n,r){if(!Ru(e.precondition,t))return n;var a=e.value.clone(),i=Wu(e.fieldTransforms,r,t);return a.setAll(i),t.convertToFoundDocument(t.version,a).setHasLocalMutations(),null}(e,t,n,r):e instanceof zu?function(e,t,n,r){if(!Ru(e.precondition,t))return n;var a=Wu(e.fieldTransforms,r,t),i=t.data;return i.setAll(Bu(e)),i.setAll(a),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null===n?null:n.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map((function(e){return e.field})))}(e,t,n,r):function(e,t,n){return Ru(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):n}(e,t,n)}function Lu(e,t){var n,r=null,a=m(e.fieldTransforms);try{for(a.s();!(n=a.n()).done;){var i=n.value,o=t.data.field(i.field),s=bu(i.transform,o||null);null!=s&&(null===r&&(r=Ss.empty()),r.set(i.field,s))}}catch(u){a.e(u)}finally{a.f()}return r||null}function Mu(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&$i(e,t,(function(e,t){return function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof Vu&&t instanceof Vu||e instanceof wu&&t instanceof wu?$i(e.elements,t.elements,ss):e instanceof Su&&t instanceof Su?ss(e.yt,t.yt):e instanceof ku&&t instanceof ku}(e.transform,t.transform)}(e,t)}))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}var Pu=function(e){b(n,e);var t=w(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];return f(this,n),(i=t.call(this)).key=e,i.value=r,i.precondition=a,i.fieldTransforms=o,i.type=0,i}return p(n,[{key:"getFieldMask",value:function(){return null}}]),n}(_u),zu=function(e){b(n,e);var t=w(n);function n(e,r,a,i){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];return f(this,n),(o=t.call(this)).key=e,o.data=r,o.fieldMask=a,o.precondition=i,o.fieldTransforms=s,o.type=1,o}return p(n,[{key:"getFieldMask",value:function(){return this.fieldMask}}]),n}(_u);function Bu(e){var t=new Map;return e.fieldMask.fields.forEach((function(n){if(!n.isEmpty()){var r=e.data.field(n);t.set(n,r)}})),t}function Uu(e,t,n){var r=new Map;Mi(e.length===n.length);for(var a=0;a<n.length;a++){var i=e[a],o=i.transform,s=t.data.field(i.field);r.set(i.field,yu(o,s,n[a]))}return r}function Wu(e,t,n){var r,a=new Map,i=m(e);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=o.transform,u=n.data.field(o.field);a.set(o.field,gu(s,u,t))}}catch(c){i.e(c)}finally{i.f()}return a}var ju,Zu,Gu=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).key=e,a.precondition=r,a.type=2,a.fieldTransforms=[],a}return p(n,[{key:"getFieldMask",value:function(){return null}}]),n}(_u),Hu=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).key=e,a.precondition=r,a.type=3,a.fieldTransforms=[],a}return p(n,[{key:"getFieldMask",value:function(){return null}}]),n}(_u),qu=p((function e(t){f(this,e),this.count=t}));function Ku(e){switch(e){default:return Li();case zi.CANCELLED:case zi.UNKNOWN:case zi.DEADLINE_EXCEEDED:case zi.RESOURCE_EXHAUSTED:case zi.INTERNAL:case zi.UNAVAILABLE:case zi.UNAUTHENTICATED:return!1;case zi.INVALID_ARGUMENT:case zi.NOT_FOUND:case zi.ALREADY_EXISTS:case zi.PERMISSION_DENIED:case zi.FAILED_PRECONDITION:case zi.ABORTED:case zi.OUT_OF_RANGE:case zi.UNIMPLEMENTED:case zi.DATA_LOSS:return!0}}function Xu(e){if(void 0===e)return Di("GRPC error has no .code"),zi.UNKNOWN;switch(e){case ju.OK:return zi.OK;case ju.CANCELLED:return zi.CANCELLED;case ju.UNKNOWN:return zi.UNKNOWN;case ju.DEADLINE_EXCEEDED:return zi.DEADLINE_EXCEEDED;case ju.RESOURCE_EXHAUSTED:return zi.RESOURCE_EXHAUSTED;case ju.INTERNAL:return zi.INTERNAL;case ju.UNAVAILABLE:return zi.UNAVAILABLE;case ju.UNAUTHENTICATED:return zi.UNAUTHENTICATED;case ju.INVALID_ARGUMENT:return zi.INVALID_ARGUMENT;case ju.NOT_FOUND:return zi.NOT_FOUND;case ju.ALREADY_EXISTS:return zi.ALREADY_EXISTS;case ju.PERMISSION_DENIED:return zi.PERMISSION_DENIED;case ju.FAILED_PRECONDITION:return zi.FAILED_PRECONDITION;case ju.ABORTED:return zi.ABORTED;case ju.OUT_OF_RANGE:return zi.OUT_OF_RANGE;case ju.UNIMPLEMENTED:return zi.UNIMPLEMENTED;case ju.DATA_LOSS:return zi.DATA_LOSS;default:return Li()}}(Zu=ju||(ju={}))[Zu.OK=0]="OK",Zu[Zu.CANCELLED=1]="CANCELLED",Zu[Zu.UNKNOWN=2]="UNKNOWN",Zu[Zu.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Zu[Zu.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Zu[Zu.NOT_FOUND=5]="NOT_FOUND",Zu[Zu.ALREADY_EXISTS=6]="ALREADY_EXISTS",Zu[Zu.PERMISSION_DENIED=7]="PERMISSION_DENIED",Zu[Zu.UNAUTHENTICATED=16]="UNAUTHENTICATED",Zu[Zu.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Zu[Zu.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Zu[Zu.ABORTED=10]="ABORTED",Zu[Zu.OUT_OF_RANGE=11]="OUT_OF_RANGE",Zu[Zu.UNIMPLEMENTED=12]="UNIMPLEMENTED",Zu[Zu.INTERNAL=13]="INTERNAL",Zu[Zu.UNAVAILABLE=14]="UNAVAILABLE",Zu[Zu.DATA_LOSS=15]="DATA_LOSS";var Qu=function(){function e(t,n){f(this,e),this.mapKeyFn=t,this.equalsFn=n,this.inner={},this.innerSize=0}return p(e,[{key:"get",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0!==n){var r,a=m(n);try{for(a.s();!(r=a.n()).done;){var i=(0,l.Z)(r.value,2),o=i[0],s=i[1];if(this.equalsFn(o,e))return s}}catch(u){a.e(u)}finally{a.f()}}}},{key:"has",value:function(e){return void 0!==this.get(e)}},{key:"set",value:function(e,t){var n=this.mapKeyFn(e),r=this.inner[n];if(void 0===r)return this.inner[n]=[[e,t]],void this.innerSize++;for(var a=0;a<r.length;a++)if(this.equalsFn(r[a][0],e))return void(r[a]=[e,t]);r.push([e,t]),this.innerSize++}},{key:"delete",value:function(e){var t=this.mapKeyFn(e),n=this.inner[t];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],e))return 1===n.length?delete this.inner[t]:n.splice(r,1),this.innerSize--,!0;return!1}},{key:"forEach",value:function(e){Lo(this.inner,(function(t,n){var r,a=m(n);try{for(a.s();!(r=a.n()).done;){var i=(0,l.Z)(r.value,2),o=i[0],s=i[1];e(o,s)}}catch(u){a.e(u)}finally{a.f()}}))}},{key:"isEmpty",value:function(){return Mo(this.inner)}},{key:"size",value:function(){return this.innerSize}}]),e}(),Yu=new Po(so.comparator);function Ju(){return Yu}var $u=new Po(so.comparator);function ec(){for(var e=$u,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];e=e.insert(o.key,o)}return e}function tc(e){var t=$u;return e.forEach((function(e,n){return t=t.insert(e,n.overlayedDocument)})),t}function nc(){return ac()}function rc(){return ac()}function ac(){return new Qu((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)}))}var ic=new Po(so.comparator),oc=new Uo(so.comparator);function sc(){for(var e=oc,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];e=e.add(o)}return e}var uc=new Uo(Ji);function cc(){return uc}var lc=function(){function e(t,n,r,a,i){f(this,e),this.snapshotVersion=t,this.targetChanges=n,this.targetMismatches=r,this.documentUpdates=a,this.resolvedLimboDocuments=i}return p(e,null,[{key:"createSynthesizedRemoteEventForCurrentChange",value:function(t,n){var r=new Map;return r.set(t,hc.createSynthesizedTargetChangeForCurrentChange(t,n)),new e(no.min(),r,cc(),Ju(),sc())}}]),e}(),hc=function(){function e(t,n,r,a,i){f(this,e),this.resumeToken=t,this.current=n,this.addedDocuments=r,this.modifiedDocuments=a,this.removedDocuments=i}return p(e,null,[{key:"createSynthesizedTargetChangeForCurrentChange",value:function(t,n){return new e(Go.EMPTY_BYTE_STRING,n,sc(),sc(),sc())}}]),e}(),fc=p((function e(t,n,r,a){f(this,e),this.Tt=t,this.removedTargetIds=n,this.key=r,this.Et=a})),dc=p((function e(t,n){f(this,e),this.targetId=t,this.At=n})),pc=p((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Go.EMPTY_BYTE_STRING,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;f(this,e),this.state=t,this.targetIds=n,this.resumeToken=r,this.cause=a})),vc=function(){function e(){f(this,e),this.Rt=0,this.bt=yc(),this.Pt=Go.EMPTY_BYTE_STRING,this.vt=!1,this.Vt=!0}return p(e,[{key:"current",get:function(){return this.vt}},{key:"resumeToken",get:function(){return this.Pt}},{key:"St",get:function(){return 0!==this.Rt}},{key:"Dt",get:function(){return this.Vt}},{key:"Ct",value:function(e){e.approximateByteSize()>0&&(this.Vt=!0,this.Pt=e)}},{key:"xt",value:function(){var e=sc(),t=sc(),n=sc();return this.bt.forEach((function(r,a){switch(a){case 0:e=e.add(r);break;case 2:t=t.add(r);break;case 1:n=n.add(r);break;default:Li()}})),new hc(this.Pt,this.vt,e,t,n)}},{key:"Nt",value:function(){this.Vt=!1,this.bt=yc()}},{key:"kt",value:function(e,t){this.Vt=!0,this.bt=this.bt.insert(e,t)}},{key:"Mt",value:function(e){this.Vt=!0,this.bt=this.bt.remove(e)}},{key:"Ot",value:function(){this.Rt+=1}},{key:"Ft",value:function(){this.Rt-=1}},{key:"$t",value:function(){this.Vt=!0,this.vt=!0}}]),e}(),mc=function(){function e(t){f(this,e),this.Bt=t,this.Lt=new Map,this.Ut=Ju(),this.qt=gc(),this.Kt=new Uo(Ji)}return p(e,[{key:"Gt",value:function(e){var t,n=m(e.Tt);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.Et&&e.Et.isFoundDocument()?this.Qt(r,e.Et):this.jt(r,e.key,e.Et)}}catch(s){n.e(s)}finally{n.f()}var a,i=m(e.removedTargetIds);try{for(i.s();!(a=i.n()).done;){var o=a.value;this.jt(o,e.key,e.Et)}}catch(s){i.e(s)}finally{i.f()}}},{key:"Wt",value:function(e){var t=this;this.forEachTarget(e,(function(n){var r=t.zt(n);switch(e.state){case 0:t.Ht(n)&&r.Ct(e.resumeToken);break;case 1:r.Ft(),r.St||r.Nt(),r.Ct(e.resumeToken);break;case 2:r.Ft(),r.St||t.removeTarget(n);break;case 3:t.Ht(n)&&(r.$t(),r.Ct(e.resumeToken));break;case 4:t.Ht(n)&&(t.Jt(n),r.Ct(e.resumeToken));break;default:Li()}}))}},{key:"forEachTarget",value:function(e,t){var n=this;e.targetIds.length>0?e.targetIds.forEach(t):this.Lt.forEach((function(e,r){n.Ht(r)&&t(r)}))}},{key:"Yt",value:function(e){var t=e.targetId,n=e.At.count,r=this.Xt(t);if(r){var a=r.target;if(_s(a))if(0===n){var i=new so(a.path);this.jt(t,i,Es.newNoDocument(i,no.min()))}else Mi(1===n);else this.Zt(t)!==n&&(this.Jt(t),this.Kt=this.Kt.add(t))}}},{key:"te",value:function(e){var t=this,n=new Map;this.Lt.forEach((function(r,a){var i=t.Xt(a);if(i){if(r.current&&_s(i.target)){var o=new so(i.target.path);null!==t.Ut.get(o)||t.ee(a,o)||t.jt(a,o,Es.newNoDocument(o,e))}r.Dt&&(n.set(a,r.xt()),r.Nt())}}));var r=sc();this.qt.forEach((function(e,n){var a=!0;n.forEachWhile((function(e){var n=t.Xt(e);return!n||2===n.purpose||(a=!1,!1)})),a&&(r=r.add(e))})),this.Ut.forEach((function(t,n){return n.setReadTime(e)}));var a=new lc(e,n,this.Kt,this.Ut,r);return this.Ut=Ju(),this.qt=gc(),this.Kt=new Uo(Ji),a}},{key:"Qt",value:function(e,t){if(this.Ht(e)){var n=this.ee(e,t.key)?2:0;this.zt(e).kt(t.key,n),this.Ut=this.Ut.insert(t.key,t),this.qt=this.qt.insert(t.key,this.ne(t.key).add(e))}}},{key:"jt",value:function(e,t,n){if(this.Ht(e)){var r=this.zt(e);this.ee(e,t)?r.kt(t,1):r.Mt(t),this.qt=this.qt.insert(t,this.ne(t).delete(e)),n&&(this.Ut=this.Ut.insert(t,n))}}},{key:"removeTarget",value:function(e){this.Lt.delete(e)}},{key:"Zt",value:function(e){var t=this.zt(e).xt();return this.Bt.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}},{key:"Ot",value:function(e){this.zt(e).Ot()}},{key:"zt",value:function(e){var t=this.Lt.get(e);return t||(t=new vc,this.Lt.set(e,t)),t}},{key:"ne",value:function(e){var t=this.qt.get(e);return t||(t=new Uo(Ji),this.qt=this.qt.insert(e,t)),t}},{key:"Ht",value:function(e){var t=null!==this.Xt(e);return t||_i("WatchChangeAggregator","Detected inactive target",e),t}},{key:"Xt",value:function(e){var t=this.Lt.get(e);return t&&t.St?null:this.Bt.se(e)}},{key:"Jt",value:function(e){var t=this;this.Lt.set(e,new vc),this.Bt.getRemoteKeysForTarget(e).forEach((function(n){t.jt(e,n,null)}))}},{key:"ee",value:function(e,t){return this.Bt.getRemoteKeysForTarget(e).has(t)}}]),e}();function gc(){return new Po(so.comparator)}function yc(){return new Po(so.comparator)}var bc={asc:"ASCENDING",desc:"DESCENDING"},kc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Vc=p((function e(t,n){f(this,e),this.databaseId=t,this.gt=n}));function xc(e,t){return e.gt?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function wc(e,t){return e.gt?t.toBase64():t.toUint8Array()}function Ic(e,t){return xc(e,t.toTimestamp())}function Sc(e){return Mi(!!e),no.fromTimestamp(function(e){var t=qo(e);return new to(t.seconds,t.nanos)}(e))}function Cc(e,t){return function(e){return new ao(["projects",e.projectId,"databases",e.database])}(e).child("documents").child(t).canonicalString()}function Ec(e){var t=ao.fromString(e);return Mi(Qc(t)),t}function Tc(e,t){return Cc(e.databaseId,t.path)}function Nc(e,t){var n=Ec(t);if(n.get(1)!==e.databaseId.projectId)throw new Bi(zi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+e.databaseId.projectId);if(n.get(3)!==e.databaseId.database)throw new Bi(zi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+e.databaseId.database);return new so(Dc(n))}function Ac(e,t){return Cc(e.databaseId,t)}function Rc(e){var t=Ec(e);return 4===t.length?ao.emptyPath():Dc(t)}function _c(e){return new ao(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function Dc(e){return Mi(e.length>4&&"documents"===e.get(4)),e.popFirst(5)}function Fc(e,t,n){return{name:Tc(e,t),fields:n.value.mapValue.fields}}function Oc(e,t,n){var r=Nc(e,t.name),a=Sc(t.updateTime),i=new Ss({mapValue:{fields:t.fields}}),o=Es.newFoundDocument(r,a,i);return n&&o.setHasCommittedMutations(),n?o.setHasCommittedMutations():o}function Lc(e,t){return"found"in t?function(e,t){Mi(!!t.found),t.found.name,t.found.updateTime;var n=Nc(e,t.found.name),r=Sc(t.found.updateTime),a=new Ss({mapValue:{fields:t.found.fields}});return Es.newFoundDocument(n,r,a)}(e,t):"missing"in t?function(e,t){Mi(!!t.missing),Mi(!!t.readTime);var n=Nc(e,t.missing),r=Sc(t.readTime);return Es.newNoDocument(n,r)}(e,t):Li()}function Mc(e,t){var n;if(t instanceof Pu)n={update:Fc(e,t.key,t.value)};else if(t instanceof Gu)n={delete:Tc(e,t.key)};else if(t instanceof zu)n={update:Fc(e,t.key,t.data),updateMask:Xc(t.fieldMask)};else{if(!(t instanceof Hu))return Li();n={verify:Tc(e,t.key)}}return t.fieldTransforms.length>0&&(n.updateTransforms=t.fieldTransforms.map((function(e){return function(e,t){var n=t.transform;if(n instanceof ku)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Vu)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof wu)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Su)return{fieldPath:t.field.canonicalString(),increment:n.yt};throw Li()}(0,e)}))),t.precondition.isNone||(n.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:Ic(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Li()}(e,t.precondition)),n}function Pc(e,t){var n=t.currentDocument?function(e){return void 0!==e.updateTime?Au.updateTime(Sc(e.updateTime)):void 0!==e.exists?Au.exists(e.exists):Au.none()}(t.currentDocument):Au.none(),r=t.updateTransforms?t.updateTransforms.map((function(t){return function(e,t){var n=null;if("setToServerValue"in t)Mi("REQUEST_TIME"===t.setToServerValue),n=new ku;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new Vu(r)}else if("removeAllFromArray"in t){var a=t.removeAllFromArray.values||[];n=new wu(a)}else"increment"in t?n=new Su(e,t.increment):Li();var i=oo.fromServerFormat(t.fieldPath);return new Tu(i,n)}(e,t)})):[];if(t.update){t.update.name;var a=Nc(e,t.update.name),i=new Ss({mapValue:{fields:t.update.fields}});if(t.updateMask){var o=function(e){var t=e.fieldPaths||[];return new Zo(t.map((function(e){return oo.fromServerFormat(e)})))}(t.updateMask);return new zu(a,i,o,n,r)}return new Pu(a,i,n,r)}if(t.delete){var s=Nc(e,t.delete);return new Gu(s,n)}if(t.verify){var u=Nc(e,t.verify);return new Hu(u,n)}return Li()}function zc(e,t){return{documents:[Ac(e,t.path)]}}function Bc(e,t){var n={structuredQuery:{}},r=t.path;null!==t.collectionGroup?(n.parent=Ac(e,r),n.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(n.parent=Ac(e,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var a=function(e){if(0!==e.length){var t=e.map((function(e){return function(e){if("=="===e.op){if(gs(e.value))return{unaryFilter:{field:Gc(e.field),op:"IS_NAN"}};if(ms(e.value))return{unaryFilter:{field:Gc(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(gs(e.value))return{unaryFilter:{field:Gc(e.field),op:"IS_NOT_NAN"}};if(ms(e.value))return{unaryFilter:{field:Gc(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Gc(e.field),op:Zc(e.op),value:e.value}}}(e)}));return 1===t.length?t[0]:{compositeFilter:{op:"AND",filters:t}}}}(t.filters);a&&(n.structuredQuery.where=a);var i=function(e){if(0!==e.length)return e.map((function(e){return function(e){return{field:Gc(e.field),direction:jc(e.dir)}}(e)}))}(t.orderBy);i&&(n.structuredQuery.orderBy=i);var o,s=function(e,t){return e.gt||ts(t)?t:{value:t}}(e,t.limit);return null!==s&&(n.structuredQuery.limit=s),t.startAt&&(n.structuredQuery.startAt={before:(o=t.startAt).inclusive,values:o.position}),t.endAt&&(n.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),n}function Uc(e){var t=Rc(e.parent),n=e.structuredQuery,r=n.from?n.from.length:0,a=null;if(r>0){Mi(1===r);var i=n.from[0];i.allDescendants?a=i.collectionId:t=t.child(i.collectionId)}var o=[];n.where&&(o=Wc(n.where));var s=[];n.orderBy&&(s=n.orderBy.map((function(e){return function(e){return new Hs(Hc(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e)})));var u=null;n.limit&&(u=function(e){var t;return ts(t="object"==typeof e?e.value:e)?null:t}(n.limit));var c=null;n.startAt&&(c=function(e){var t=!!e.before,n=e.values||[];return new Gs(n,t)}(n.startAt));var l=null;return n.endAt&&(l=function(e){var t=!e.before,n=e.values||[];return new Gs(n,t)}(n.endAt)),Ys(t,a,s,o,u,"F",c,l)}function Wc(e){return e?void 0!==e.unaryFilter?[Kc(e)]:void 0!==e.fieldFilter?[qc(e)]:void 0!==e.compositeFilter?e.compositeFilter.filters.map((function(e){return Wc(e)})).reduce((function(e,t){return e.concat(t)})):Li():[]}function jc(e){return bc[e]}function Zc(e){return kc[e]}function Gc(e){return{fieldPath:e.canonicalString()}}function Hc(e){return oo.fromServerFormat(e.fieldPath)}function qc(e){return Ls.create(Hc(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Li()}}(e.fieldFilter.op),e.fieldFilter.value)}function Kc(e){switch(e.unaryFilter.op){case"IS_NAN":var t=Hc(e.unaryFilter.field);return Ls.create(t,"==",{doubleValue:NaN});case"IS_NULL":var n=Hc(e.unaryFilter.field);return Ls.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=Hc(e.unaryFilter.field);return Ls.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var a=Hc(e.unaryFilter.field);return Ls.create(a,"!=",{nullValue:"NULL_VALUE"});default:return Li()}}function Xc(e){var t=[];return e.fields.forEach((function(e){return t.push(e.canonicalString())})),{fieldPaths:t}}function Qc(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}function Yc(e){for(var t="",n=0;n<e.length;n++)t.length>0&&(t=$c(t)),t=Jc(e.get(n),t);return $c(t)}function Jc(e,t){for(var n=t,r=e.length,a=0;a<r;a++){var i=e.charAt(a);switch(i){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=i}}return n}function $c(e){return e+"\x01\x01"}function el(e){var t=e.length;if(Mi(t>=2),2===t)return Mi("\x01"===e.charAt(0)&&"\x01"===e.charAt(1)),ao.emptyPath();for(var n=t-2,r=[],a="",i=0;i<t;){var o=e.indexOf("\x01",i);switch((o<0||o>n)&&Li(),e.charAt(o+1)){case"\x01":var s=e.substring(i,o),u=void 0;0===a.length?u=s:(u=a+=s,a=""),r.push(u);break;case"\x10":a+=e.substring(i,o),a+="\0";break;case"\x11":a+=e.substring(i,o+1);break;default:Li()}i=o+2}return new ao(r)}var tl=["userId","batchId"];function nl(e,t){return[e,Yc(t)]}function rl(e,t,n){return[e,Yc(t),n]}var al={},il=["prefixPath","collectionGroup","readTime","documentId"],ol=["prefixPath","collectionGroup","documentId"],sl=["collectionGroup","readTime","prefixPath","documentId"],ul=["canonicalId","targetId"],cl=["targetId","path"],ll=["path","targetId"],hl=["collectionId","parent"],fl=["indexId","uid"],dl=["uid","sequenceNumber"],pl=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],vl=["indexId","uid","orderedDocumentKey"],ml=["userId","collectionPath","documentId"],gl=["userId","collectionPath","largestBatchId"],yl=["userId","collectionGroup","largestBatchId"],bl=["mutationQueues","mutations","documentMutations","remoteDocuments","targets","owner","targetGlobal","targetDocuments"].concat(["clientMetadata"]).concat(["remoteDocumentGlobal"]).concat(["collectionParents"]).concat(["bundles","namedQueries"]),kl=[].concat((0,H.Z)(bl),["documentOverlays"]),Vl=["mutationQueues","mutations","documentMutations","remoteDocumentsV14","targets","owner","targetGlobal","targetDocuments","clientMetadata","remoteDocumentGlobal","collectionParents","bundles","namedQueries","documentOverlays"],xl=Vl,wl=[].concat(xl,["indexConfiguration","indexState","indexEntries"]),Il=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).ie=e,a.currentSequenceNumber=r,a}return p(n)}(bo);function Sl(e,t){var n=Pi(e);return Io.O(n.ie,t)}var Cl=function(){function e(t,n,r,a){f(this,e),this.batchId=t,this.localWriteTime=n,this.baseMutations=r,this.mutations=a}return p(e,[{key:"applyToRemoteDocument",value:function(e,t){for(var n=t.mutationResults,r=0;r<this.mutations.length;r++){var a=this.mutations[r];a.key.isEqual(e.key)&&Fu(a,e,n[r])}}},{key:"applyToLocalView",value:function(e,t){var n,r=m(this.baseMutations);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.key.isEqual(e.key)&&(t=Ou(a,e,t,this.localWriteTime))}}catch(u){r.e(u)}finally{r.f()}var i,o=m(this.mutations);try{for(o.s();!(i=o.n()).done;){var s=i.value;s.key.isEqual(e.key)&&(t=Ou(s,e,t,this.localWriteTime))}}catch(u){o.e(u)}finally{o.f()}return t}},{key:"applyToLocalDocumentSet",value:function(e,t){var n=this,r=rc();return this.mutations.forEach((function(a){var i=e.get(a.key),o=i.overlayedDocument,s=n.applyToLocalView(o,i.mutatedFields),u=Du(o,s=t.has(a.key)?null:s);null!==u&&r.set(a.key,u),o.isValidDocument()||o.convertToNoDocument(no.min())})),r}},{key:"keys",value:function(){return this.mutations.reduce((function(e,t){return e.add(t.key)}),sc())}},{key:"isEqual",value:function(e){return this.batchId===e.batchId&&$i(this.mutations,e.mutations,(function(e,t){return Mu(e,t)}))&&$i(this.baseMutations,e.baseMutations,(function(e,t){return Mu(e,t)}))}}]),e}(),El=function(){function e(t,n,r,a){f(this,e),this.batch=t,this.commitVersion=n,this.mutationResults=r,this.docVersions=a}return p(e,null,[{key:"from",value:function(t,n,r){Mi(t.mutations.length===r.length);for(var a=ic,i=t.mutations,o=0;o<i.length;o++)a=a.insert(i[o].key,r[o].version);return new e(t,n,r,a)}}]),e}(),Tl=function(){function e(t,n){f(this,e),this.largestBatchId=t,this.mutation=n}return p(e,[{key:"getKey",value:function(){return this.mutation.key}},{key:"isEqual",value:function(e){return null!==e&&this.mutation===e.mutation}},{key:"toString",value:function(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}]),e}(),Nl=function(){function e(t,n,r,a){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:no.min(),o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:no.min(),s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Go.EMPTY_BYTE_STRING;f(this,e),this.target=t,this.targetId=n,this.purpose=r,this.sequenceNumber=a,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return p(e,[{key:"withSequenceNumber",value:function(t){return new e(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)}},{key:"withResumeToken",value:function(t,n){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,t)}},{key:"withLastLimboFreeSnapshotVersion",value:function(t){return new e(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken)}}]),e}(),Al=p((function e(t){f(this,e),this.re=t}));function Rl(e,t){var n=t.key,r={prefixPath:n.getCollectionPath().popLast().toArray(),collectionGroup:n.collectionGroup,documentId:n.path.lastSegment(),readTime:_l(t.readTime),hasCommittedMutations:t.hasCommittedMutations};if(t.isFoundDocument())r.document=function(e,t){return{name:Tc(e,t.key),fields:t.data.value.mapValue.fields,updateTime:xc(e,t.version.toTimestamp())}}(e.re,t);else if(t.isNoDocument())r.noDocument={path:n.path.toArray(),readTime:Dl(t.version)};else{if(!t.isUnknownDocument())return Li();r.unknownDocument={path:n.path.toArray(),version:Dl(t.version)}}return r}function _l(e){var t=e.toTimestamp();return[t.seconds,t.nanoseconds]}function Dl(e){var t=e.toTimestamp();return{seconds:t.seconds,nanoseconds:t.nanoseconds}}function Fl(e){var t=new to(e.seconds,e.nanoseconds);return no.fromTimestamp(t)}function Ol(e,t){for(var n=(t.baseMutations||[]).map((function(t){return Pc(e.re,t)})),r=0;r<t.mutations.length-1;++r){var a=t.mutations[r];if(r+1<t.mutations.length&&void 0!==t.mutations[r+1].transform){var i=t.mutations[r+1];a.updateTransforms=i.transform.fieldTransforms,t.mutations.splice(r+1,1),++r}}var o=t.mutations.map((function(t){return Pc(e.re,t)})),s=to.fromMillis(t.localWriteTimeMs);return new Cl(t.batchId,s,n,o)}function Ll(e){var t,n,r=Fl(e.readTime),a=void 0!==e.lastLimboFreeSnapshotVersion?Fl(e.lastLimboFreeSnapshotVersion):no.min();return void 0!==e.query.documents?(Mi(1===(n=e.query).documents.length),t=au(Js(Rc(n.documents[0])))):t=function(e){return au(Uc(e))}(e.query),new Nl(t,e.targetId,0,e.lastListenSequenceNumber,r,a,Go.fromBase64String(e.resumeToken))}function Ml(e,t){var n,r=Dl(t.snapshotVersion),a=Dl(t.lastLimboFreeSnapshotVersion);n=_s(t.target)?zc(e.re,t.target):Bc(e.re,t.target);var i=t.resumeToken.toBase64();return{targetId:t.targetId,canonicalId:As(t.target),readTime:r,resumeToken:i,lastListenSequenceNumber:t.sequenceNumber,lastLimboFreeSnapshotVersion:a,query:n}}function Pl(e){var t=Uc({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?iu(t,t.limit,"L"):t}function zl(e,t){return new Tl(t.largestBatchId,Pc(e.re,t.overlayMutation))}function Bl(e,t){var n=t.path.lastSegment();return[e,Yc(t.path.popLast()),n]}function Ul(e,t,n,r){return{indexId:e,uid:t.uid||"",sequenceNumber:n,readTime:Dl(r.readTime),documentKey:Yc(r.documentKey.path),largestBatchId:r.largestBatchId}}var Wl=function(){function e(){f(this,e)}return p(e,[{key:"getBundleMetadata",value:function(e,t){return jl(e).get(t).next((function(e){if(e)return{id:(t=e).bundleId,createTime:Fl(t.createTime),version:t.version};var t}))}},{key:"saveBundleMetadata",value:function(e,t){return jl(e).put({bundleId:(n=t).id,createTime:Dl(Sc(n.createTime)),version:n.version});var n}},{key:"getNamedQuery",value:function(e,t){return Zl(e).get(t).next((function(e){if(e)return{name:(t=e).name,query:Pl(t.bundledQuery),readTime:Fl(t.readTime)};var t}))}},{key:"saveNamedQuery",value:function(e,t){return Zl(e).put(function(e){return{name:e.name,readTime:Dl(Sc(e.readTime)),bundledQuery:e.bundledQuery}}(t))}}]),e}();function jl(e){return Sl(e,"bundles")}function Zl(e){return Sl(e,"namedQueries")}var Gl=function(){function e(t,n){f(this,e),this.It=t,this.userId=n}return p(e,[{key:"getOverlay",value:function(e,t){var n=this;return Hl(e).get(Bl(this.userId,t)).next((function(e){return e?zl(n.It,e):null}))}},{key:"getOverlays",value:function(e,t){var n=this,r=nc();return xo.forEach(t,(function(t){return n.getOverlay(e,t).next((function(e){null!==e&&r.set(t,e)}))})).next((function(){return r}))}},{key:"saveOverlays",value:function(e,t,n){var r=this,a=[];return n.forEach((function(n,i){var o=new Tl(t,i);a.push(r.ue(e,o))})),xo.waitFor(a)}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,a=new Set;t.forEach((function(e){return a.add(Yc(e.getCollectionPath()))}));var i=[];return a.forEach((function(t){var a=IDBKeyRange.bound([r.userId,t,n],[r.userId,t,n+1],!1,!0);i.push(Hl(e).Y("collectionPathOverlayIndex",a))})),xo.waitFor(i)}},{key:"getOverlaysForCollection",value:function(e,t,n){var r=this,a=nc(),i=Yc(t),o=IDBKeyRange.bound([this.userId,i,n],[this.userId,i,Number.POSITIVE_INFINITY],!0);return Hl(e).W("collectionPathOverlayIndex",o).next((function(e){var t,n=m(e);try{for(n.s();!(t=n.n()).done;){var i=t.value,o=zl(r.It,i);a.set(o.getKey(),o)}}catch(s){n.e(s)}finally{n.f()}return a}))}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){var a,i=this,o=nc(),s=IDBKeyRange.bound([this.userId,t,n],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Hl(e).Z({index:"collectionGroupOverlayIndex",range:s},(function(e,t,n){var s=zl(i.It,t);o.size()<r||s.largestBatchId===a?(o.set(s.getKey(),s),a=s.largestBatchId):n.done()})).next((function(){return o}))}},{key:"ue",value:function(e,t){return Hl(e).put(function(e,t,n){var r=Bl(t,n.mutation.key),a=(0,l.Z)(r,3);a[0];return{userId:t,collectionPath:a[1],documentId:a[2],collectionGroup:n.mutation.key.getCollectionGroup(),largestBatchId:n.largestBatchId,overlayMutation:Mc(e.re,n.mutation)}}(this.It,this.userId,t))}}],[{key:"oe",value:function(t,n){return new e(t,n.uid||"")}}]),e}();function Hl(e){return Sl(e,"documentOverlays")}var ql=function(){function e(){f(this,e)}return p(e,[{key:"ce",value:function(e,t){this.ae(e,t),t.he()}},{key:"ae",value:function(e,t){if("nullValue"in e)this.le(t,5);else if("booleanValue"in e)this.le(t,10),t.fe(e.booleanValue?1:0);else if("integerValue"in e)this.le(t,15),t.fe(Ko(e.integerValue));else if("doubleValue"in e){var n=Ko(e.doubleValue);isNaN(n)?this.le(t,13):(this.le(t,15),ns(n)?t.fe(0):t.fe(n))}else if("timestampValue"in e){var r=e.timestampValue;this.le(t,20),"string"==typeof r?t.de(r):(t.de("".concat(r.seconds||"")),t.fe(r.nanos||0))}else if("stringValue"in e)this._e(e.stringValue,t),this.we(t);else if("bytesValue"in e)this.le(t,30),t.me(Xo(e.bytesValue)),this.we(t);else if("referenceValue"in e)this.ge(e.referenceValue,t);else if("geoPointValue"in e){var a=e.geoPointValue;this.le(t,45),t.fe(a.latitude||0),t.fe(a.longitude||0)}else"mapValue"in e?ks(e)?this.le(t,Number.MAX_SAFE_INTEGER):(this.ye(e.mapValue,t),this.we(t)):"arrayValue"in e?(this.pe(e.arrayValue,t),this.we(t)):Li()}},{key:"_e",value:function(e,t){this.le(t,25),this.Ie(e,t)}},{key:"Ie",value:function(e,t){t.de(e)}},{key:"ye",value:function(e,t){var n=e.fields||{};this.le(t,55);for(var r=0,a=Object.keys(n);r<a.length;r++){var i=a[r];this._e(i,t),this.ae(n[i],t)}}},{key:"pe",value:function(e,t){var n=e.values||[];this.le(t,50);var r,a=m(n);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.ae(i,t)}}catch(o){a.e(o)}finally{a.f()}}},{key:"ge",value:function(e,t){var n=this;this.le(t,37),so.fromName(e).path.forEach((function(e){n.le(t,60),n.Ie(e,t)}))}},{key:"le",value:function(e,t){e.fe(t)}},{key:"we",value:function(e){e.fe(2)}}]),e}();function Kl(e){if(0===e)return 8;var t=0;return e>>4==0&&(t+=4,e<<=4),e>>6==0&&(t+=2,e<<=2),e>>7==0&&(t+=1),t}function Xl(e){var t=64-function(e){for(var t=0,n=0;n<8;++n){var r=Kl(255&e[n]);if(t+=r,8!==r)break}return t}(e);return Math.ceil(t/8)}ql.Te=new ql;var Ql=function(){function e(){f(this,e),this.buffer=new Uint8Array(1024),this.position=0}return p(e,[{key:"Ee",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.Ae(n.value),n=t.next();this.Re()}},{key:"be",value:function(e){for(var t=e[Symbol.iterator](),n=t.next();!n.done;)this.Pe(n.value),n=t.next();this.ve()}},{key:"Ve",value:function(e){var t,n=m(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r.charCodeAt(0);if(a<128)this.Ae(a);else if(a<2048)this.Ae(960|a>>>6),this.Ae(128|63&a);else if(r<"\ud800"||"\udbff"<r)this.Ae(480|a>>>12),this.Ae(128|63&a>>>6),this.Ae(128|63&a);else{var i=r.codePointAt(0);this.Ae(240|i>>>18),this.Ae(128|63&i>>>12),this.Ae(128|63&i>>>6),this.Ae(128|63&i)}}}catch(o){n.e(o)}finally{n.f()}this.Re()}},{key:"Se",value:function(e){var t,n=m(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a=r.charCodeAt(0);if(a<128)this.Pe(a);else if(a<2048)this.Pe(960|a>>>6),this.Pe(128|63&a);else if(r<"\ud800"||"\udbff"<r)this.Pe(480|a>>>12),this.Pe(128|63&a>>>6),this.Pe(128|63&a);else{var i=r.codePointAt(0);this.Pe(240|i>>>18),this.Pe(128|63&i>>>12),this.Pe(128|63&i>>>6),this.Pe(128|63&i)}}}catch(o){n.e(o)}finally{n.f()}this.ve()}},{key:"De",value:function(e){var t=this.Ce(e),n=Xl(t);this.xe(1+n),this.buffer[this.position++]=255&n;for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=255&t[r]}},{key:"Ne",value:function(e){var t=this.Ce(e),n=Xl(t);this.xe(1+n),this.buffer[this.position++]=~(255&n);for(var r=t.length-n;r<t.length;++r)this.buffer[this.position++]=~(255&t[r])}},{key:"ke",value:function(){this.Me(255),this.Me(255)}},{key:"Oe",value:function(){this.Fe(255),this.Fe(255)}},{key:"reset",value:function(){this.position=0}},{key:"seed",value:function(e){this.xe(e.length),this.buffer.set(e,this.position),this.position+=e.length}},{key:"$e",value:function(){return this.buffer.slice(0,this.position)}},{key:"Ce",value:function(e){var t=function(e){var t=new DataView(new ArrayBuffer(8));return t.setFloat64(0,e,!1),new Uint8Array(t.buffer)}(e),n=0!=(128&t[0]);t[0]^=n?255:128;for(var r=1;r<t.length;++r)t[r]^=n?255:0;return t}},{key:"Ae",value:function(e){var t=255&e;0===t?(this.Me(0),this.Me(255)):255===t?(this.Me(255),this.Me(0)):this.Me(t)}},{key:"Pe",value:function(e){var t=255&e;0===t?(this.Fe(0),this.Fe(255)):255===t?(this.Fe(255),this.Fe(0)):this.Fe(e)}},{key:"Re",value:function(){this.Me(0),this.Me(1)}},{key:"ve",value:function(){this.Fe(0),this.Fe(1)}},{key:"Me",value:function(e){this.xe(1),this.buffer[this.position++]=e}},{key:"Fe",value:function(e){this.xe(1),this.buffer[this.position++]=~e}},{key:"xe",value:function(e){var t=e+this.position;if(!(t<=this.buffer.length)){var n=2*this.buffer.length;n<t&&(n=t);var r=new Uint8Array(n);r.set(this.buffer),this.buffer=r}}}]),e}(),Yl=function(){function e(t){f(this,e),this.Be=t}return p(e,[{key:"me",value:function(e){this.Be.Ee(e)}},{key:"de",value:function(e){this.Be.Ve(e)}},{key:"fe",value:function(e){this.Be.De(e)}},{key:"he",value:function(){this.Be.ke()}}]),e}(),Jl=function(){function e(t){f(this,e),this.Be=t}return p(e,[{key:"me",value:function(e){this.Be.be(e)}},{key:"de",value:function(e){this.Be.Se(e)}},{key:"fe",value:function(e){this.Be.Ne(e)}},{key:"he",value:function(){this.Be.Oe()}}]),e}(),$l=function(){function e(){f(this,e),this.Be=new Ql,this.Le=new Yl(this.Be),this.Ue=new Jl(this.Be)}return p(e,[{key:"seed",value:function(e){this.Be.seed(e)}},{key:"qe",value:function(e){return 0===e?this.Le:this.Ue}},{key:"$e",value:function(){return this.Be.$e()}},{key:"reset",value:function(){this.Be.reset()}}]),e}(),eh=function(){function e(t,n,r,a){f(this,e),this.indexId=t,this.documentKey=n,this.arrayValue=r,this.directionalValue=a}return p(e,[{key:"Ke",value:function(){var t=this.directionalValue.length,n=0===t||255===this.directionalValue[t-1]?t+1:t,r=new Uint8Array(n);return r.set(this.directionalValue,0),n!==t?r.set([0],this.directionalValue.length):++r[r.length-1],new e(this.indexId,this.documentKey,this.arrayValue,r)}}]),e}();function th(e,t){var n=e.indexId-t.indexId;return 0!==n?n:0!==(n=nh(e.arrayValue,t.arrayValue))?n:0!==(n=nh(e.directionalValue,t.directionalValue))?n:so.comparator(e.documentKey,t.documentKey)}function nh(e,t){for(var n=0;n<e.length&&n<t.length;++n){var r=e[n]-t[n];if(0!==r)return r}return e.length-t.length}var rh=function(){function e(t){f(this,e),this.collectionId=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment(),this.Ge=t.orderBy,this.Qe=[];var n,r=m(t.filters);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.dt()?this.je=a:this.Qe.push(a)}}catch(i){r.e(i)}finally{r.f()}}return p(e,[{key:"We",value:function(e){var t=co(e);if(void 0!==t&&!this.ze(t))return!1;for(var n=lo(e),r=0,a=0;r<n.length&&this.ze(n[r]);++r);if(r===n.length)return!0;if(void 0!==this.je){var i=n[r];if(!this.He(this.je,i)||!this.Je(this.Ge[a++],i))return!1;++r}for(;r<n.length;++r){var o=n[r];if(a>=this.Ge.length||!this.Je(this.Ge[a++],o))return!1}return!0}},{key:"ze",value:function(e){var t,n=m(this.Qe);try{for(n.s();!(t=n.n()).done;){var r=t.value;if(this.He(r,e))return!0}}catch(a){n.e(a)}finally{n.f()}return!1}},{key:"He",value:function(e,t){if(void 0===e||!e.field.isEqual(t.fieldPath))return!1;var n="array-contains"===e.op||"array-contains-any"===e.op;return 2===t.kind===n}},{key:"Je",value:function(e,t){return!!e.field.isEqual(t.fieldPath)&&(0===t.kind&&"asc"===e.dir||1===t.kind&&"desc"===e.dir)}}]),e}(),ah=function(){function e(){f(this,e),this.Ye=new ih}return p(e,[{key:"addToCollectionParentIndex",value:function(e,t){return this.Ye.add(t),xo.resolve()}},{key:"getCollectionParents",value:function(e,t){return xo.resolve(this.Ye.getEntries(t))}},{key:"addFieldIndex",value:function(e,t){return xo.resolve()}},{key:"deleteFieldIndex",value:function(e,t){return xo.resolve()}},{key:"getDocumentsMatchingTarget",value:function(e,t){return xo.resolve(null)}},{key:"getIndexType",value:function(e,t){return xo.resolve(0)}},{key:"getFieldIndexes",value:function(e,t){return xo.resolve([])}},{key:"getNextCollectionGroupToUpdate",value:function(e){return xo.resolve(null)}},{key:"getMinOffset",value:function(e,t){return xo.resolve(mo.min())}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return xo.resolve(mo.min())}},{key:"updateCollectionGroup",value:function(e,t,n){return xo.resolve()}},{key:"updateIndexEntries",value:function(e,t){return xo.resolve()}}]),e}(),ih=function(){function e(){f(this,e),this.index={}}return p(e,[{key:"add",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t]||new Uo(ao.comparator),a=!r.has(n);return this.index[t]=r.add(n),a}},{key:"has",value:function(e){var t=e.lastSegment(),n=e.popLast(),r=this.index[t];return r&&r.has(n)}},{key:"getEntries",value:function(e){return(this.index[e]||new Uo(ao.comparator)).toArray()}}]),e}(),oh=new Uint8Array(0),sh=function(){function e(t,n){f(this,e),this.user=t,this.databaseId=n,this.Xe=new ih,this.Ze=new Qu((function(e){return As(e)}),(function(e,t){return Rs(e,t)})),this.uid=t.uid||""}return p(e,[{key:"addToCollectionParentIndex",value:function(e,t){var n=this;if(!this.Xe.has(t)){var r=t.lastSegment(),a=t.popLast();e.addOnCommittedListener((function(){n.Xe.add(t)}));var i={collectionId:r,parent:Yc(a)};return uh(e).put(i)}return xo.resolve()}},{key:"getCollectionParents",value:function(e,t){var n=[],r=IDBKeyRange.bound([t,""],[eo(t),""],!1,!0);return uh(e).W(r).next((function(e){var r,a=m(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i.collectionId!==t)break;n.push(el(i.parent))}}catch(o){a.e(o)}finally{a.f()}return n}))}},{key:"addFieldIndex",value:function(e,t){var n=this,r=lh(e),a=function(e){return{indexId:e.indexId,collectionGroup:e.collectionGroup,fields:e.fields.map((function(e){return[e.fieldPath.canonicalString(),e.kind]}))}}(t);delete a.indexId;var i=r.add(a);if(t.indexState){var o=hh(e);return i.next((function(e){o.put(Ul(e,n.user,t.indexState.sequenceNumber,t.indexState.offset))}))}return i.next()}},{key:"deleteFieldIndex",value:function(e,t){var n=lh(e),r=hh(e),a=ch(e);return n.delete(t.indexId).next((function(){return r.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))})).next((function(){return a.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))}))}},{key:"getDocumentsMatchingTarget",value:function(e,t){var n=this,r=ch(e),a=!0,i=new Map;return xo.forEach(this.tn(t),(function(t){return n.en(e,t).next((function(e){a&&(a=!!e),i.set(t,e)}))})).next((function(){if(a){var e=sc(),o=[];return xo.forEach(i,(function(a,i){var s;_i("IndexedDbIndexManager","Using index ".concat((s=a,"id=".concat(s.indexId,"|cg=").concat(s.collectionGroup,"|f=").concat(s.fields.map((function(e){return"".concat(e.fieldPath,":").concat(e.kind)})).join(",")))," to execute ").concat(As(t)));var u=function(e,t){var n=co(t);if(void 0===n)return null;var r,a=m(Ds(e,n.fieldPath));try{for(a.s();!(r=a.n()).done;){var i=r.value;switch(i.op){case"array-contains-any":return i.value.arrayValue.values||[];case"array-contains":return[i.value]}}}catch(o){a.e(o)}finally{a.f()}return null}(i,a),c=function(e,t){var n,r=new Map,a=m(lo(t));try{for(a.s();!(n=a.n()).done;){var i,o=n.value,s=m(Ds(e,o.fieldPath));try{for(s.s();!(i=s.n()).done;){var u=i.value;switch(u.op){case"==":case"in":r.set(o.fieldPath.canonicalString(),u.value);break;case"not-in":case"!=":return r.set(o.fieldPath.canonicalString(),u.value),Array.from(r.values())}}}catch(c){s.e(c)}finally{s.f()}}}catch(c){a.e(c)}finally{a.f()}return null}(i,a),l=function(e,t){var n,r=[],a=!0,i=m(lo(t));try{for(i.s();!(n=i.n()).done;){var o=n.value,s=0===o.kind?Fs(e,o.fieldPath,e.startAt):Os(e,o.fieldPath,e.startAt);r.push(s.value),a&&(a=s.inclusive)}}catch(u){i.e(u)}finally{i.f()}return new Gs(r,a)}(i,a),h=function(e,t){var n,r=[],a=!0,i=m(lo(t));try{for(i.s();!(n=i.n()).done;){var o=n.value,s=0===o.kind?Os(e,o.fieldPath,e.endAt):Fs(e,o.fieldPath,e.endAt);r.push(s.value),a&&(a=s.inclusive)}}catch(u){i.e(u)}finally{i.f()}return new Gs(r,a)}(i,a),f=n.nn(a,i,l),d=n.nn(a,i,h),p=n.sn(a,i,c),v=n.rn(a.indexId,u,f,l.inclusive,d,h.inclusive,p);return xo.forEach(v,(function(n){return r.J(n,t.limit).next((function(t){t.forEach((function(t){var n=so.fromSegments(t.documentKey);e.has(n)||(e=e.add(n),o.push(n))}))}))}))})).next((function(){return o}))}return xo.resolve(null)}))}},{key:"tn",value:function(e){var t=this.Ze.get(e);return t||(t=[e],this.Ze.set(e,t),t)}},{key:"rn",value:function(e,t,n,r,a,i,o){for(var s=this,u=(null!=t?t.length:1)*Math.max(n.length,a.length),c=u/(null!=t?t.length:1),l=[],h=function(u){var h=t?s.on(t[u/c]):oh,f=s.un(e,h,n[u%c],r),d=s.cn(e,h,a[u%c],i),p=o.map((function(t){return s.un(e,h,t,!0)}));l.push.apply(l,(0,H.Z)(s.createRange(f,d,p)))},f=0;f<u;++f)h(f);return l}},{key:"un",value:function(e,t,n,r){var a=new eh(e,so.empty(),t,n);return r?a:a.Ke()}},{key:"cn",value:function(e,t,n,r){var a=new eh(e,so.empty(),t,n);return r?a.Ke():a}},{key:"en",value:function(e,t){var n=new rh(t),r=null!=t.collectionGroup?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,r).next((function(e){var t,r=null,a=m(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;n.We(i)&&(!r||i.fields.length>r.fields.length)&&(r=i)}}catch(o){a.e(o)}finally{a.f()}return r}))}},{key:"getIndexType",value:function(e,t){var n=this,r=2;return xo.forEach(this.tn(t),(function(t){return n.en(e,t).next((function(e){e?0!==r&&e.fields.length<function(e){var t,n=new Uo(oo.comparator),r=!1,a=m(e.filters);try{for(a.s();!(t=a.n()).done;){var i=t.value;i.field.isKeyField()||("array-contains"===i.op||"array-contains-any"===i.op?r=!0:n=n.add(i.field))}}catch(c){a.e(c)}finally{a.f()}var o,s=m(e.orderBy);try{for(s.s();!(o=s.n()).done;){var u=o.value;u.field.isKeyField()||(n=n.add(u.field))}}catch(c){s.e(c)}finally{s.f()}return n.size+(r?1:0)}(t)&&(r=1):r=0}))})).next((function(){return r}))}},{key:"an",value:function(e,t){var n,r=new $l,a=m(lo(e));try{for(a.s();!(n=a.n()).done;){var i=n.value,o=t.data.field(i.fieldPath);if(null==o)return null;var s=r.qe(i.kind);ql.Te.ce(o,s)}}catch(u){a.e(u)}finally{a.f()}return r.$e()}},{key:"on",value:function(e){var t=new $l;return ql.Te.ce(e,t.qe(0)),t.$e()}},{key:"hn",value:function(e,t){var n=new $l;return ql.Te.ce(ds(this.databaseId,t),n.qe(function(e){var t=lo(e);return 0===t.length?0:t[t.length-1].kind}(e))),n.$e()}},{key:"sn",value:function(e,t,n){if(null===n)return[];var r=[];r.push(new $l);var a,i=0,o=m(lo(e));try{for(o.s();!(a=o.n()).done;){var s,u=a.value,c=n[i++],l=m(r);try{for(l.s();!(s=l.n()).done;){var h=s.value;if(this.ln(t,u.fieldPath)&&vs(c))r=this.fn(r,u,c);else{var f=h.qe(u.kind);ql.Te.ce(c,f)}}}catch(d){l.e(d)}finally{l.f()}}}catch(d){o.e(d)}finally{o.f()}return this.dn(r)}},{key:"nn",value:function(e,t,n){return this.sn(e,t,n.position)}},{key:"dn",value:function(e){for(var t=[],n=0;n<e.length;++n)t[n]=e[n].$e();return t}},{key:"fn",value:function(e,t,n){var r,a=(0,H.Z)(e),i=[],o=m(n.arrayValue.values||[]);try{for(o.s();!(r=o.n()).done;){var s,u=r.value,c=m(a);try{for(c.s();!(s=c.n()).done;){var l=s.value,h=new $l;h.seed(l.$e()),ql.Te.ce(u,h.qe(t.kind)),i.push(h)}}catch(f){c.e(f)}finally{c.f()}}}catch(f){o.e(f)}finally{o.f()}return i}},{key:"ln",value:function(e,t){return!!e.filters.find((function(e){return e instanceof Ls&&e.field.isEqual(t)&&("in"===e.op||"not-in"===e.op)}))}},{key:"getFieldIndexes",value:function(e,t){var n=this,r=lh(e),a=hh(e);return(t?r.W("collectionGroupIndex",IDBKeyRange.bound(t,t)):r.W()).next((function(e){var t=[];return xo.forEach(e,(function(e){return a.get([e.indexId,n.uid]).next((function(n){t.push(function(e,t){var n=t?new fo(t.sequenceNumber,new mo(Fl(t.readTime),new so(el(t.documentKey)),t.largestBatchId)):fo.empty(),r=e.fields.map((function(e){var t=(0,l.Z)(e,2),n=t[0],r=t[1];return new ho(oo.fromServerFormat(n),r)}));return new uo(e.indexId,e.collectionGroup,r,n)}(e,n))}))})).next((function(){return t}))}))}},{key:"getNextCollectionGroupToUpdate",value:function(e){return this.getFieldIndexes(e).next((function(e){return 0===e.length?null:(e.sort((function(e,t){var n=e.indexState.sequenceNumber-t.indexState.sequenceNumber;return 0!==n?n:Ji(e.collectionGroup,t.collectionGroup)})),e[0].collectionGroup)}))}},{key:"updateCollectionGroup",value:function(e,t,n){var r=this,a=lh(e),i=hh(e);return this._n(e).next((function(e){return a.W("collectionGroupIndex",IDBKeyRange.bound(t,t)).next((function(t){return xo.forEach(t,(function(t){return i.put(Ul(t.indexId,r.user,e,n))}))}))}))}},{key:"updateIndexEntries",value:function(e,t){var n=this,r=new Map;return xo.forEach(t,(function(t,a){var i=r.get(t.collectionGroup);return(i?xo.resolve(i):n.getFieldIndexes(e,t.collectionGroup)).next((function(i){return r.set(t.collectionGroup,i),xo.forEach(i,(function(r){return n.wn(e,t,r).next((function(t){var i=n.mn(a,r);return t.isEqual(i)?xo.resolve():n.gn(e,a,r,t,i)}))}))}))}))}},{key:"yn",value:function(e,t,n,r){return ch(e).put({indexId:r.indexId,uid:this.uid,arrayValue:r.arrayValue,directionalValue:r.directionalValue,orderedDocumentKey:this.hn(n,t.key),documentKey:t.key.path.toArray()})}},{key:"pn",value:function(e,t,n,r){return ch(e).delete([r.indexId,this.uid,r.arrayValue,r.directionalValue,this.hn(n,t.key),t.key.path.toArray()])}},{key:"wn",value:function(e,t,n){var r=ch(e),a=new Uo(th);return r.Z({index:"documentKeyIndex",range:IDBKeyRange.only([n.indexId,this.uid,this.hn(n,t)])},(function(e,r){a=a.add(new eh(n.indexId,t,r.arrayValue,r.directionalValue))})).next((function(){return a}))}},{key:"mn",value:function(e,t){var n=new Uo(th),r=this.an(t,e);if(null==r)return n;var a=co(t);if(null!=a){var i=e.data.field(a.fieldPath);if(vs(i)){var o,s=m(i.arrayValue.values||[]);try{for(s.s();!(o=s.n()).done;){var u=o.value;n=n.add(new eh(t.indexId,e.key,this.on(u),r))}}catch(c){s.e(c)}finally{s.f()}}}else n=n.add(new eh(t.indexId,e.key,oh,r));return n}},{key:"gn",value:function(e,t,n,r,a){var i=this;_i("IndexedDbIndexManager","Updating index entries for document '%s'",t.key);var o=[];return function(e,t,n,r,a){for(var i=e.getIterator(),o=t.getIterator(),s=jo(i),u=jo(o);s||u;){var c=!1,l=!1;if(s&&u){var h=n(s,u);h<0?l=!0:h>0&&(c=!0)}else null!=s?l=!0:c=!0;c?(r(u),u=jo(o)):l?(a(s),s=jo(i)):(s=jo(i),u=jo(o))}}(r,a,th,(function(r){o.push(i.yn(e,t,n,r))}),(function(r){o.push(i.pn(e,t,n,r))})),xo.waitFor(o)}},{key:"_n",value:function(e){var t=1;return hh(e).Z({index:"sequenceNumberIndex",reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(function(e,n,r){r.done(),t=n.sequenceNumber+1})).next((function(){return t}))}},{key:"createRange",value:function(e,t,n){n=n.sort((function(e,t){return th(e,t)})).filter((function(e,t,n){return!t||0!==th(e,n[t-1])}));var r=[];r.push(e);var a,i=m(n);try{for(i.s();!(a=i.n()).done;){var o=a.value,s=th(o,e),u=th(o,t);if(0===s)r[0]=e.Ke();else if(s>0&&u<0)r.push(o),r.push(o.Ke());else if(u>0)break}}catch(h){i.e(h)}finally{i.f()}r.push(t);for(var c=[],l=0;l<r.length;l+=2)c.push(IDBKeyRange.bound([r[l].indexId,this.uid,r[l].arrayValue,r[l].directionalValue,oh,[]],[r[l+1].indexId,this.uid,r[l+1].arrayValue,r[l+1].directionalValue,oh,[]]));return c}},{key:"getMinOffsetFromCollectionGroup",value:function(e,t){return this.getFieldIndexes(e,t).next(fh)}},{key:"getMinOffset",value:function(e,t){var n=this;return xo.mapArray(this.tn(t),(function(t){return n.en(e,t).next((function(e){return e||Li()}))})).next(fh)}}]),e}();function uh(e){return Sl(e,"collectionParents")}function ch(e){return Sl(e,"indexEntries")}function lh(e){return Sl(e,"indexConfiguration")}function hh(e){return Sl(e,"indexState")}function fh(e){Mi(0!==e.length);for(var t=e[0].indexState.offset,n=t.largestBatchId,r=1;r<e.length;r++){var a=e[r].indexState.offset;go(a,t)<0&&(t=a),n<a.largestBatchId&&(n=a.largestBatchId)}return new mo(t.readTime,t.documentKey,n)}var dh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},ph=function(){function e(t,n,r){f(this,e),this.cacheSizeCollectionThreshold=t,this.percentileToCollect=n,this.maximumSequenceNumbersToCollect=r}return p(e,null,[{key:"withCacheSize",value:function(t){return new e(t,e.DEFAULT_COLLECTION_PERCENTILE,e.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}]),e}();function vh(e,t,n){var r=e.store("mutations"),a=e.store("documentMutations"),i=[],o=IDBKeyRange.only(n.batchId),s=0,u=r.Z({range:o},(function(e,t,n){return s++,n.delete()}));i.push(u.next((function(){Mi(1===s)})));var c,l=[],h=m(n.mutations);try{for(h.s();!(c=h.n()).done;){var f=c.value,d=rl(t,f.key.path,n.batchId);i.push(a.delete(d)),l.push(f.key)}}catch(p){h.e(p)}finally{h.f()}return xo.waitFor(i).next((function(){return l}))}function mh(e){if(!e)return 0;var t;if(e.document)t=e.document;else if(e.unknownDocument)t=e.unknownDocument;else{if(!e.noDocument)throw Li();t=e.noDocument}return JSON.stringify(t).length}ph.DEFAULT_COLLECTION_PERCENTILE=10,ph.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,ph.DEFAULT=new ph(41943040,ph.DEFAULT_COLLECTION_PERCENTILE,ph.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),ph.DISABLED=new ph(-1,0,0);var gh=function(){function e(t,n,r,a){f(this,e),this.userId=t,this.It=n,this.indexManager=r,this.referenceDelegate=a,this.In={}}return p(e,[{key:"checkEmpty",value:function(e){var t=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return bh(e).Z({index:"userMutationsIndex",range:n},(function(e,n,r){t=!1,r.done()})).next((function(){return t}))}},{key:"addMutationBatch",value:function(e,t,n,r){var a=this,i=kh(e),o=bh(e);return o.add({}).next((function(s){Mi("number"==typeof s);var u,c=new Cl(s,t,n,r),l=function(e,t,n){var r=n.baseMutations.map((function(t){return Mc(e.re,t)})),a=n.mutations.map((function(t){return Mc(e.re,t)}));return{userId:t,batchId:n.batchId,localWriteTimeMs:n.localWriteTime.toMillis(),baseMutations:r,mutations:a}}(a.It,a.userId,c),h=[],f=new Uo((function(e,t){return Ji(e.canonicalString(),t.canonicalString())})),d=m(r);try{for(d.s();!(u=d.n()).done;){var p=u.value,v=rl(a.userId,p.key.path,s);f=f.add(p.key.path.popLast()),h.push(o.put(l)),h.push(i.put(v,al))}}catch(g){d.e(g)}finally{d.f()}return f.forEach((function(t){h.push(a.indexManager.addToCollectionParentIndex(e,t))})),e.addOnCommittedListener((function(){a.In[s]=c.keys()})),xo.waitFor(h).next((function(){return c}))}))}},{key:"lookupMutationBatch",value:function(e,t){var n=this;return bh(e).get(t).next((function(e){return e?(Mi(e.userId===n.userId),Ol(n.It,e)):null}))}},{key:"Tn",value:function(e,t){var n=this;return this.In[t]?xo.resolve(this.In[t]):this.lookupMutationBatch(e,t).next((function(e){if(e){var r=e.keys();return n.In[t]=r,r}return null}))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=this,r=t+1,a=IDBKeyRange.lowerBound([this.userId,r]),i=null;return bh(e).Z({index:"userMutationsIndex",range:a},(function(e,t,a){t.userId===n.userId&&(Mi(t.batchId>=r),i=Ol(n.It,t)),a.done()})).next((function(){return i}))}},{key:"getHighestUnacknowledgedBatchId",value:function(e){var t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return bh(e).Z({index:"userMutationsIndex",range:t,reverse:!0},(function(e,t,r){n=t.batchId,r.done()})).next((function(){return n}))}},{key:"getAllMutationBatches",value:function(e){var t=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return bh(e).W("userMutationsIndex",n).next((function(e){return e.map((function(e){return Ol(t.It,e)}))}))}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=nl(this.userId,t.path),a=IDBKeyRange.lowerBound(r),i=[];return kh(e).Z({range:a},(function(r,a,o){var s=(0,l.Z)(r,3),u=s[0],c=s[1],h=s[2],f=el(c);if(u===n.userId&&t.path.isEqual(f))return bh(e).get(h).next((function(e){if(!e)throw Li();Mi(e.userId===n.userId),i.push(Ol(n.It,e))}));o.done()})).next((function(){return i}))}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Uo(Ji),a=[];return t.forEach((function(t){var i=nl(n.userId,t.path),o=IDBKeyRange.lowerBound(i),s=kh(e).Z({range:o},(function(e,a,i){var o=(0,l.Z)(e,3),s=o[0],u=o[1],c=o[2],h=el(u);s===n.userId&&t.path.isEqual(h)?r=r.add(c):i.done()}));a.push(s)})),xo.waitFor(a).next((function(){return n.En(e,r)}))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=this,r=t.path,a=r.length+1,i=nl(this.userId,r),o=IDBKeyRange.lowerBound(i),s=new Uo(Ji);return kh(e).Z({range:o},(function(e,t,i){var o=(0,l.Z)(e,3),u=o[0],c=o[1],h=o[2],f=el(c);u===n.userId&&r.isPrefixOf(f)?f.length===a&&(s=s.add(h)):i.done()})).next((function(){return n.En(e,s)}))}},{key:"En",value:function(e,t){var n=this,r=[],a=[];return t.forEach((function(t){a.push(bh(e).get(t).next((function(e){if(null===e)throw Li();Mi(e.userId===n.userId),r.push(Ol(n.It,e))})))})),xo.waitFor(a).next((function(){return r}))}},{key:"removeMutationBatch",value:function(e,t){var n=this;return vh(e.ie,this.userId,t).next((function(r){return e.addOnCommittedListener((function(){n.An(t.batchId)})),xo.forEach(r,(function(t){return n.referenceDelegate.markPotentiallyOrphaned(e,t)}))}))}},{key:"An",value:function(e){delete this.In[e]}},{key:"performConsistencyCheck",value:function(e){var t=this;return this.checkEmpty(e).next((function(n){if(!n)return xo.resolve();var r=IDBKeyRange.lowerBound([t.userId]),a=[];return kh(e).Z({range:r},(function(e,n,r){if(e[0]===t.userId){var i=el(e[1]);a.push(i)}else r.done()})).next((function(){Mi(0===a.length)}))}))}},{key:"containsKey",value:function(e,t){return yh(e,this.userId,t)}},{key:"Rn",value:function(e){var t=this;return Vh(e).get(this.userId).next((function(e){return e||{userId:t.userId,lastAcknowledgedBatchId:-1,lastStreamToken:""}}))}}],[{key:"oe",value:function(t,n,r,a){return Mi(""!==t.uid),new e(t.isAuthenticated()?t.uid:"",n,r,a)}}]),e}();function yh(e,t,n){var r=nl(t,n.path),a=r[1],i=IDBKeyRange.lowerBound(r),o=!1;return kh(e).Z({range:i,X:!0},(function(e,n,r){var i=(0,l.Z)(e,3),s=i[0],u=i[1];i[2];s===t&&u===a&&(o=!0),r.done()})).next((function(){return o}))}function bh(e){return Sl(e,"mutations")}function kh(e){return Sl(e,"documentMutations")}function Vh(e){return Sl(e,"mutationQueues")}var xh=function(){function e(t){f(this,e),this.bn=t}return p(e,[{key:"next",value:function(){return this.bn+=2,this.bn}}],[{key:"Pn",value:function(){return new e(0)}},{key:"vn",value:function(){return new e(-1)}}]),e}(),wh=function(){function e(t,n){f(this,e),this.referenceDelegate=t,this.It=n}return p(e,[{key:"allocateTargetId",value:function(e){var t=this;return this.Vn(e).next((function(n){var r=new xh(n.highestTargetId);return n.highestTargetId=r.next(),t.Sn(e,n).next((function(){return n.highestTargetId}))}))}},{key:"getLastRemoteSnapshotVersion",value:function(e){return this.Vn(e).next((function(e){return no.fromTimestamp(new to(e.lastRemoteSnapshotVersion.seconds,e.lastRemoteSnapshotVersion.nanoseconds))}))}},{key:"getHighestSequenceNumber",value:function(e){return this.Vn(e).next((function(e){return e.highestListenSequenceNumber}))}},{key:"setTargetsMetadata",value:function(e,t,n){var r=this;return this.Vn(e).next((function(a){return a.highestListenSequenceNumber=t,n&&(a.lastRemoteSnapshotVersion=n.toTimestamp()),t>a.highestListenSequenceNumber&&(a.highestListenSequenceNumber=t),r.Sn(e,a)}))}},{key:"addTargetData",value:function(e,t){var n=this;return this.Dn(e,t).next((function(){return n.Vn(e).next((function(r){return r.targetCount+=1,n.Cn(t,r),n.Sn(e,r)}))}))}},{key:"updateTargetData",value:function(e,t){return this.Dn(e,t)}},{key:"removeTargetData",value:function(e,t){var n=this;return this.removeMatchingKeysForTargetId(e,t.targetId).next((function(){return Ih(e).delete(t.targetId)})).next((function(){return n.Vn(e)})).next((function(t){return Mi(t.targetCount>0),t.targetCount-=1,n.Sn(e,t)}))}},{key:"removeTargets",value:function(e,t,n){var r=this,a=0,i=[];return Ih(e).Z((function(o,s){var u=Ll(s);u.sequenceNumber<=t&&null===n.get(u.targetId)&&(a++,i.push(r.removeTargetData(e,u)))})).next((function(){return xo.waitFor(i)})).next((function(){return a}))}},{key:"forEachTarget",value:function(e,t){return Ih(e).Z((function(e,n){var r=Ll(n);t(r)}))}},{key:"Vn",value:function(e){return Sh(e).get("targetGlobalKey").next((function(e){return Mi(null!==e),e}))}},{key:"Sn",value:function(e,t){return Sh(e).put("targetGlobalKey",t)}},{key:"Dn",value:function(e,t){return Ih(e).put(Ml(this.It,t))}},{key:"Cn",value:function(e,t){var n=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,n=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,n=!0),n}},{key:"getTargetCount",value:function(e){return this.Vn(e).next((function(e){return e.targetCount}))}},{key:"getTargetData",value:function(e,t){var n=As(t),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),a=null;return Ih(e).Z({range:r,index:"queryTargetsIndex"},(function(e,n,r){var i=Ll(n);Rs(t,i.target)&&(a=i,r.done())})).next((function(){return a}))}},{key:"addMatchingKeys",value:function(e,t,n){var r=this,a=[],i=Ch(e);return t.forEach((function(t){var o=Yc(t.path);a.push(i.put({targetId:n,path:o})),a.push(r.referenceDelegate.addReference(e,n,t))})),xo.waitFor(a)}},{key:"removeMatchingKeys",value:function(e,t,n){var r=this,a=Ch(e);return xo.forEach(t,(function(t){var i=Yc(t.path);return xo.waitFor([a.delete([n,i]),r.referenceDelegate.removeReference(e,n,t)])}))}},{key:"removeMatchingKeysForTargetId",value:function(e,t){var n=Ch(e),r=IDBKeyRange.bound([t],[t+1],!1,!0);return n.delete(r)}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=IDBKeyRange.bound([t],[t+1],!1,!0),r=Ch(e),a=sc();return r.Z({range:n,X:!0},(function(e,t,n){var r=el(e[1]),i=new so(r);a=a.add(i)})).next((function(){return a}))}},{key:"containsKey",value:function(e,t){var n=Yc(t.path),r=IDBKeyRange.bound([n],[eo(n)],!1,!0),a=0;return Ch(e).Z({index:"documentTargetsIndex",X:!0,range:r},(function(e,t,n){var r=(0,l.Z)(e,2),i=r[0];r[1];0!==i&&(a++,n.done())})).next((function(){return a>0}))}},{key:"se",value:function(e,t){return Ih(e).get(t).next((function(e){return e?Ll(e):null}))}}]),e}();function Ih(e){return Sl(e,"targets")}function Sh(e){return Sl(e,"targetGlobal")}function Ch(e){return Sl(e,"targetDocuments")}function Eh(e,t){var n=(0,l.Z)(e,2),r=n[0],a=n[1],i=(0,l.Z)(t,2),o=i[0],s=i[1],u=Ji(r,o);return 0===u?Ji(a,s):u}var Th=function(){function e(t){f(this,e),this.xn=t,this.buffer=new Uo(Eh),this.Nn=0}return p(e,[{key:"kn",value:function(){return++this.Nn}},{key:"Mn",value:function(e){var t=[e,this.kn()];if(this.buffer.size<this.xn)this.buffer=this.buffer.add(t);else{var n=this.buffer.last();Eh(t,n)<0&&(this.buffer=this.buffer.delete(n).add(t))}}},{key:"maxValue",get:function(){return this.buffer.last()[0]}}]),e}(),Nh=function(){function e(t,n,r){f(this,e),this.garbageCollector=t,this.asyncQueue=n,this.localStore=r,this.On=null}return p(e,[{key:"start",value:function(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Fn(6e4)}},{key:"stop",value:function(){this.On&&(this.On.cancel(),this.On=null)}},{key:"started",get:function(){return null!==this.On}},{key:"Fn",value:function(e){var t=this;_i("LruGarbageCollector","Garbage collection scheduled in ".concat(e,"ms")),this.On=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.On=null,e.prev=1,e.next=4,t.localStore.collectGarbage(t.garbageCollector);case 4:e.next=14;break;case 6:if(e.prev=6,e.t0=e.catch(1),!Eo(e.t0)){e.next=12;break}_i("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e.t0),e.next=14;break;case 12:return e.next=14,ko(e.t0);case 14:return e.next=16,t.Fn(3e5);case 16:case"end":return e.stop()}}),e,null,[[1,6]])}))))}}]),e}(),Ah=function(){function e(t,n){f(this,e),this.$n=t,this.params=n}return p(e,[{key:"calculateTargetCount",value:function(e,t){return this.$n.Bn(e).next((function(e){return Math.floor(t/100*e)}))}},{key:"nthSequenceNumber",value:function(e,t){var n=this;if(0===t)return xo.resolve(Fo.at);var r=new Th(t);return this.$n.forEachTarget(e,(function(e){return r.Mn(e.sequenceNumber)})).next((function(){return n.$n.Ln(e,(function(e){return r.Mn(e)}))})).next((function(){return r.maxValue}))}},{key:"removeTargets",value:function(e,t,n){return this.$n.removeTargets(e,t,n)}},{key:"removeOrphanedDocuments",value:function(e,t){return this.$n.removeOrphanedDocuments(e,t)}},{key:"collect",value:function(e,t){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(_i("LruGarbageCollector","Garbage collection skipped; disabled"),xo.resolve(dh)):this.getCacheSize(e).next((function(r){return r<n.params.cacheSizeCollectionThreshold?(_i("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(n.params.cacheSizeCollectionThreshold)),dh):n.Un(e,t)}))}},{key:"getCacheSize",value:function(e){return this.$n.getCacheSize(e)}},{key:"Un",value:function(e,t){var n,r,a,i,o,s,u,c=this,l=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next((function(t){return t>c.params.maximumSequenceNumbersToCollect?(_i("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(c.params.maximumSequenceNumbersToCollect," from ").concat(t)),r=c.params.maximumSequenceNumbersToCollect):r=t,i=Date.now(),c.nthSequenceNumber(e,r)})).next((function(r){return n=r,o=Date.now(),c.removeTargets(e,n,t)})).next((function(t){return a=t,s=Date.now(),c.removeOrphanedDocuments(e,n)})).next((function(e){return u=Date.now(),Ri()<=Y.DEBUG&&_i("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(i-l,"ms\n\tDetermined least recently used ").concat(r," in ")+(o-i)+"ms\n"+"\tRemoved ".concat(a," targets in ")+(s-o)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(u-s)+"ms\n"+"Total Duration: ".concat(u-l,"ms")),xo.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:a,documentsRemoved:e})}))}}]),e}(),Rh=function(){function e(t,n){f(this,e),this.db=t,this.garbageCollector=function(e,t){return new Ah(e,t)}(this,n)}return p(e,[{key:"Bn",value:function(e){var t=this.qn(e);return this.db.getTargetCache().getTargetCount(e).next((function(e){return t.next((function(t){return e+t}))}))}},{key:"qn",value:function(e){var t=0;return this.Ln(e,(function(e){t++})).next((function(){return t}))}},{key:"forEachTarget",value:function(e,t){return this.db.getTargetCache().forEachTarget(e,t)}},{key:"Ln",value:function(e,t){return this.Kn(e,(function(e,n){return t(n)}))}},{key:"addReference",value:function(e,t,n){return _h(e,n)}},{key:"removeReference",value:function(e,t,n){return _h(e,n)}},{key:"removeTargets",value:function(e,t,n){return this.db.getTargetCache().removeTargets(e,t,n)}},{key:"markPotentiallyOrphaned",value:function(e,t){return _h(e,t)}},{key:"Gn",value:function(e,t){return function(e,t){var n=!1;return Vh(e).tt((function(r){return yh(e,r,t).next((function(e){return e&&(n=!0),xo.resolve(!e)}))})).next((function(){return n}))}(e,t)}},{key:"removeOrphanedDocuments",value:function(e,t){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),a=[],i=0;return this.Kn(e,(function(o,s){if(s<=t){var u=n.Gn(e,o).next((function(t){if(!t)return i++,r.getEntry(e,o).next((function(){return r.removeEntry(o,no.min()),Ch(e).delete([0,Yc(o.path)])}))}));a.push(u)}})).next((function(){return xo.waitFor(a)})).next((function(){return r.apply(e)})).next((function(){return i}))}},{key:"removeTarget",value:function(e,t){var n=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,n)}},{key:"updateLimboDocument",value:function(e,t){return _h(e,t)}},{key:"Kn",value:function(e,t){var n,r=Ch(e),a=Fo.at;return r.Z({index:"documentTargetsIndex"},(function(e,r){var i=(0,l.Z)(e,2),o=i[0],s=(i[1],r.path),u=r.sequenceNumber;0===o?(a!==Fo.at&&t(new so(el(n)),a),a=u,n=s):a=Fo.at})).next((function(){a!==Fo.at&&t(new so(el(n)),a)}))}},{key:"getCacheSize",value:function(e){return this.db.getRemoteDocumentCache().getSize(e)}}]),e}();function _h(e,t){return Ch(e).put(function(e,t){return{targetId:0,path:Yc(e.path),sequenceNumber:t}}(t,e.currentSequenceNumber))}var Dh=function(){function e(){f(this,e),this.changes=new Qu((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),this.changesApplied=!1}return p(e,[{key:"addEntry",value:function(e){this.assertNotApplied(),this.changes.set(e.key,e)}},{key:"removeEntry",value:function(e,t){this.assertNotApplied(),this.changes.set(e,Es.newInvalidDocument(e).setReadTime(t))}},{key:"getEntry",value:function(e,t){this.assertNotApplied();var n=this.changes.get(t);return void 0!==n?xo.resolve(n):this.getFromCache(e,t)}},{key:"getEntries",value:function(e,t){return this.getAllFromCache(e,t)}},{key:"apply",value:function(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}},{key:"assertNotApplied",value:function(){}}]),e}(),Fh=function(){function e(t){f(this,e),this.It=t}return p(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t,n){return Ph(e).put(n)}},{key:"removeEntry",value:function(e,t,n){return Ph(e).delete(function(e,t){var n=e.path.toArray();return[n.slice(0,n.length-2),n[n.length-2],_l(t),n[n.length-1]]}(t,n))}},{key:"updateMetadata",value:function(e,t){var n=this;return this.getMetadata(e).next((function(r){return r.byteSize+=t,n.Qn(e,r)}))}},{key:"getEntry",value:function(e,t){var n=this,r=Es.newInvalidDocument(t);return Ph(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(zh(t))},(function(e,a){r=n.jn(t,a)})).next((function(){return r}))}},{key:"Wn",value:function(e,t){var n=this,r={size:0,document:Es.newInvalidDocument(t)};return Ph(e).Z({index:"documentKeyIndex",range:IDBKeyRange.only(zh(t))},(function(e,a){r={document:n.jn(t,a),size:mh(a)}})).next((function(){return r}))}},{key:"getEntries",value:function(e,t){var n=this,r=Ju();return this.zn(e,t,(function(e,t){var a=n.jn(e,t);r=r.insert(e,a)})).next((function(){return r}))}},{key:"Hn",value:function(e,t){var n=this,r=Ju(),a=new Po(so.comparator);return this.zn(e,t,(function(e,t){var i=n.jn(e,t);r=r.insert(e,i),a=a.insert(e,mh(t))})).next((function(){return{documents:r,Jn:a}}))}},{key:"zn",value:function(e,t,n){if(t.isEmpty())return xo.resolve();var r=new Uo(Uh);t.forEach((function(e){return r=r.add(e)}));var a=IDBKeyRange.bound(zh(r.first()),zh(r.last())),i=r.getIterator(),o=i.getNext();return Ph(e).Z({index:"documentKeyIndex",range:a},(function(e,t,r){for(var a=so.fromSegments([].concat((0,H.Z)(t.prefixPath),[t.collectionGroup,t.documentId]));o&&Uh(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,t),o=i.hasNext()?i.getNext():null),o?r.j(zh(o)):r.done()})).next((function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null}))}},{key:"getAllFromCollection",value:function(e,t,n){var r=this,a=[t.popLast().toArray(),t.lastSegment(),_l(n.readTime),n.documentKey.path.isEmpty()?"":n.documentKey.path.lastSegment()],i=[t.popLast().toArray(),t.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return Ph(e).W(IDBKeyRange.bound(a,i,!0)).next((function(e){var t,n=Ju(),a=m(e);try{for(a.s();!(t=a.n()).done;){var i=t.value,o=r.jn(so.fromSegments(i.prefixPath.concat(i.collectionGroup,i.documentId)),i);n=n.insert(o.key,o)}}catch(s){a.e(s)}finally{a.f()}return n}))}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){var a=this,i=Ju(),o=Bh(t,n),s=Bh(t,mo.max());return Ph(e).Z({index:"collectionGroupIndex",range:IDBKeyRange.bound(o,s,!0)},(function(e,t,n){var o=a.jn(so.fromSegments(t.prefixPath.concat(t.collectionGroup,t.documentId)),t);(i=i.insert(o.key,o)).size===r&&n.done()})).next((function(){return i}))}},{key:"newChangeBuffer",value:function(e){return new Lh(this,!!e&&e.trackRemovals)}},{key:"getSize",value:function(e){return this.getMetadata(e).next((function(e){return e.byteSize}))}},{key:"getMetadata",value:function(e){return Mh(e).get("remoteDocumentGlobalKey").next((function(e){return Mi(!!e),e}))}},{key:"Qn",value:function(e,t){return Mh(e).put("remoteDocumentGlobalKey",t)}},{key:"jn",value:function(e,t){if(t){var n=function(e,t){var n;if(t.document)n=Oc(e.re,t.document,!!t.hasCommittedMutations);else if(t.noDocument){var r=so.fromSegments(t.noDocument.path),a=Fl(t.noDocument.readTime);n=Es.newNoDocument(r,a),t.hasCommittedMutations&&n.setHasCommittedMutations()}else{if(!t.unknownDocument)return Li();var i=so.fromSegments(t.unknownDocument.path),o=Fl(t.unknownDocument.version);n=Es.newUnknownDocument(i,o)}return t.readTime&&n.setReadTime(function(e){var t=new to(e[0],e[1]);return no.fromTimestamp(t)}(t.readTime)),n}(this.It,t);if(!n.isNoDocument()||!n.version.isEqual(no.min()))return n}return Es.newInvalidDocument(e)}}]),e}();function Oh(e){return new Fh(e)}var Lh=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).Yn=e,a.trackRemovals=r,a.Xn=new Qu((function(e){return e.toString()}),(function(e,t){return e.isEqual(t)})),a}return p(n,[{key:"applyChanges",value:function(e){var t=this,n=[],r=0,a=new Uo((function(e,t){return Ji(e.canonicalString(),t.canonicalString())}));return this.changes.forEach((function(i,o){var s=t.Xn.get(i);if(n.push(t.Yn.removeEntry(e,i,s.readTime)),o.isValidDocument()){var u=Rl(t.Yn.It,o);a=a.add(i.path.popLast());var c=mh(u);r+=c-s.size,n.push(t.Yn.addEntry(e,i,u))}else if(r-=s.size,t.trackRemovals){var l=Rl(t.Yn.It,o.convertToNoDocument(no.min()));n.push(t.Yn.addEntry(e,i,l))}})),a.forEach((function(r){n.push(t.Yn.indexManager.addToCollectionParentIndex(e,r))})),n.push(this.Yn.updateMetadata(e,r)),xo.waitFor(n)}},{key:"getFromCache",value:function(e,t){var n=this;return this.Yn.Wn(e,t).next((function(e){return n.Xn.set(t,{size:e.size,readTime:e.document.readTime}),e.document}))}},{key:"getAllFromCache",value:function(e,t){var n=this;return this.Yn.Hn(e,t).next((function(e){var t=e.documents;return e.Jn.forEach((function(e,r){n.Xn.set(e,{size:r,readTime:t.get(e).readTime})})),t}))}}]),n}(Dh);function Mh(e){return Sl(e,"remoteDocumentGlobal")}function Ph(e){return Sl(e,"remoteDocumentsV14")}function zh(e){var t=e.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],t[t.length-1]]}function Bh(e,t){var n=t.documentKey.path.toArray();return[e,_l(t.readTime),n.slice(0,n.length-2),n.length>0?n[n.length-1]:""]}function Uh(e,t){for(var n=e.path.toArray(),r=t.path.toArray(),a=0,i=0;i<n.length-2&&i<r.length-2;++i)if(a=Ji(n[i],r[i]))return a;return(a=Ji(n.length,r.length))||((a=Ji(n[n.length-2],r[r.length-2]))||Ji(n[n.length-1],r[r.length-1]))}var Wh=p((function e(t,n){f(this,e),this.overlayedDocument=t,this.mutatedFields=n})),jh=function(){function e(t,n,r,a){f(this,e),this.remoteDocumentCache=t,this.mutationQueue=n,this.documentOverlayCache=r,this.indexManager=a}return p(e,[{key:"getDocument",value:function(e,t){var n=this,r=null;return this.documentOverlayCache.getOverlay(e,t).next((function(a){return r=a,n.getBaseDocument(e,t,r)})).next((function(e){return null!==r&&Ou(r.mutation,e,Zo.empty(),to.now()),e}))}},{key:"getDocuments",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.getLocalViewOfDocuments(e,t,sc()).next((function(){return t}))}))}},{key:"getLocalViewOfDocuments",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:sc(),a=nc();return this.populateOverlays(e,a,t).next((function(){return n.computeViews(e,t,a,r).next((function(e){var t=ec();return e.forEach((function(e,n){t=t.insert(e,n.overlayedDocument)})),t}))}))}},{key:"getOverlayedDocuments",value:function(e,t){var n=this,r=nc();return this.populateOverlays(e,r,t).next((function(){return n.computeViews(e,t,r,sc())}))}},{key:"populateOverlays",value:function(e,t,n){var r=[];return n.forEach((function(e){t.has(e)||r.push(e)})),this.documentOverlayCache.getOverlays(e,r).next((function(e){e.forEach((function(e,n){t.set(e,n)}))}))}},{key:"computeViews",value:function(e,t,n,r){var a=Ju(),i=ac(),o=ac();return t.forEach((function(e,t){var o=n.get(t.key);r.has(t.key)&&(void 0===o||o.mutation instanceof zu)?a=a.insert(t.key,t):void 0!==o&&(i.set(t.key,o.mutation.getFieldMask()),Ou(o.mutation,t,o.mutation.getFieldMask(),to.now()))})),this.recalculateAndSaveOverlays(e,a).next((function(e){return e.forEach((function(e,t){return i.set(e,t)})),t.forEach((function(e,t){var n;return o.set(e,new Wh(t,null!==(n=i.get(e))&&void 0!==n?n:null))})),o}))}},{key:"recalculateAndSaveOverlays",value:function(e,t){var n=this,r=ac(),a=new Po((function(e,t){return e-t})),i=sc();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next((function(e){var n,i=m(e);try{var o=function(){var e=n.value;e.keys().forEach((function(n){var i=t.get(n);if(null!==i){var o=r.get(n)||Zo.empty();o=e.applyToLocalView(i,o),r.set(n,o);var s=(a.get(e.batchId)||sc()).add(n);a=a.insert(e.batchId,s)}}))};for(i.s();!(n=i.n()).done;)o()}catch(s){i.e(s)}finally{i.f()}})).next((function(){for(var o=[],s=a.getReverseIterator(),u=function(){var a=s.getNext(),u=a.key,c=a.value,l=rc();c.forEach((function(e){if(!i.has(e)){var n=Du(t.get(e),r.get(e));null!==n&&l.set(e,n),i=i.add(e)}})),o.push(n.documentOverlayCache.saveOverlays(e,u,l))};s.hasNext();)u();return xo.waitFor(o)})).next((function(){return r}))}},{key:"recalculateAndSaveOverlaysForDocumentKeys",value:function(e,t){var n=this;return this.remoteDocumentCache.getEntries(e,t).next((function(t){return n.recalculateAndSaveOverlays(e,t)}))}},{key:"getDocumentsMatchingQuery",value:function(e,t,n){return function(e){return so.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):nu(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,n):this.getDocumentsMatchingCollectionQuery(e,t,n)}},{key:"getNextDocuments",value:function(e,t,n,r){var a=this;return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,n,r).next((function(i){var o=r-i.size>0?a.documentOverlayCache.getOverlaysForCollectionGroup(e,t,n.largestBatchId,r-i.size):xo.resolve(nc()),s=-1,u=i;return o.next((function(t){return xo.forEach(t,(function(t,n){return s<n.largestBatchId&&(s=n.largestBatchId),i.get(t)?xo.resolve():a.getBaseDocument(e,t,n).next((function(e){u=u.insert(t,e)}))})).next((function(){return a.populateOverlays(e,t,i)})).next((function(){return a.computeViews(e,u,t,sc())})).next((function(e){return{batchId:s,changes:tc(e)}}))}))}))}},{key:"getDocumentsMatchingDocumentQuery",value:function(e,t){return this.getDocument(e,new so(t)).next((function(e){var t=ec();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t}))}},{key:"getDocumentsMatchingCollectionGroupQuery",value:function(e,t,n){var r=this,a=t.collectionGroup,i=ec();return this.indexManager.getCollectionParents(e,a).next((function(o){return xo.forEach(o,(function(o){var s=function(e,t){return new Qs(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(a));return r.getDocumentsMatchingCollectionQuery(e,s,n).next((function(e){e.forEach((function(e,t){i=i.insert(e,t)}))}))})).next((function(){return i}))}))}},{key:"getDocumentsMatchingCollectionQuery",value:function(e,t,n){var r,a=this;return this.remoteDocumentCache.getAllFromCollection(e,t.path,n).next((function(i){return r=i,a.documentOverlayCache.getOverlaysForCollection(e,t.path,n.largestBatchId)})).next((function(e){e.forEach((function(e,t){var n=t.getKey();null===r.get(n)&&(r=r.insert(n,Es.newInvalidDocument(n)))}));var n=ec();return r.forEach((function(r,a){var i=e.get(r);void 0!==i&&Ou(i.mutation,a,Zo.empty(),to.now()),cu(t,a)&&(n=n.insert(r,a))})),n}))}},{key:"getBaseDocument",value:function(e,t,n){return null===n||1===n.mutation.type?this.remoteDocumentCache.getEntry(e,t):xo.resolve(Es.newInvalidDocument(t))}}]),e}(),Zh=function(){function e(t){f(this,e),this.It=t,this.Zn=new Map,this.ts=new Map}return p(e,[{key:"getBundleMetadata",value:function(e,t){return xo.resolve(this.Zn.get(t))}},{key:"saveBundleMetadata",value:function(e,t){var n;return this.Zn.set(t.id,{id:(n=t).id,version:n.version,createTime:Sc(n.createTime)}),xo.resolve()}},{key:"getNamedQuery",value:function(e,t){return xo.resolve(this.ts.get(t))}},{key:"saveNamedQuery",value:function(e,t){return this.ts.set(t.name,function(e){return{name:e.name,query:Pl(e.bundledQuery),readTime:Sc(e.readTime)}}(t)),xo.resolve()}}]),e}(),Gh=function(){function e(){f(this,e),this.overlays=new Po(so.comparator),this.es=new Map}return p(e,[{key:"getOverlay",value:function(e,t){return xo.resolve(this.overlays.get(t))}},{key:"getOverlays",value:function(e,t){var n=this,r=nc();return xo.forEach(t,(function(t){return n.getOverlay(e,t).next((function(e){null!==e&&r.set(t,e)}))})).next((function(){return r}))}},{key:"saveOverlays",value:function(e,t,n){var r=this;return n.forEach((function(n,a){r.ue(e,t,a)})),xo.resolve()}},{key:"removeOverlaysForBatchId",value:function(e,t,n){var r=this,a=this.es.get(n);return void 0!==a&&(a.forEach((function(e){return r.overlays=r.overlays.remove(e)})),this.es.delete(n)),xo.resolve()}},{key:"getOverlaysForCollection",value:function(e,t,n){for(var r=nc(),a=t.length+1,i=new so(t.child("")),o=this.overlays.getIteratorFrom(i);o.hasNext();){var s=o.getNext().value,u=s.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===a&&s.largestBatchId>n&&r.set(s.getKey(),s)}return xo.resolve(r)}},{key:"getOverlaysForCollectionGroup",value:function(e,t,n,r){for(var a=new Po((function(e,t){return e-t})),i=this.overlays.getIterator();i.hasNext();){var o=i.getNext().value;if(o.getKey().getCollectionGroup()===t&&o.largestBatchId>n){var s=a.get(o.largestBatchId);null===s&&(s=nc(),a=a.insert(o.largestBatchId,s)),s.set(o.getKey(),o)}}for(var u=nc(),c=a.getIterator();c.hasNext()&&(c.getNext().value.forEach((function(e,t){return u.set(e,t)})),!(u.size()>=r)););return xo.resolve(u)}},{key:"ue",value:function(e,t,n){var r=this.overlays.get(n.key);if(null!==r){var a=this.es.get(r.largestBatchId).delete(n.key);this.es.set(r.largestBatchId,a)}this.overlays=this.overlays.insert(n.key,new Tl(t,n));var i=this.es.get(t);void 0===i&&(i=sc(),this.es.set(t,i)),this.es.set(t,i.add(n.key))}}]),e}(),Hh=function(){function e(){f(this,e),this.ns=new Uo(qh.ss),this.rs=new Uo(qh.os)}return p(e,[{key:"isEmpty",value:function(){return this.ns.isEmpty()}},{key:"addReference",value:function(e,t){var n=new qh(e,t);this.ns=this.ns.add(n),this.rs=this.rs.add(n)}},{key:"us",value:function(e,t){var n=this;e.forEach((function(e){return n.addReference(e,t)}))}},{key:"removeReference",value:function(e,t){this.cs(new qh(e,t))}},{key:"hs",value:function(e,t){var n=this;e.forEach((function(e){return n.removeReference(e,t)}))}},{key:"ls",value:function(e){var t=this,n=new so(new ao([])),r=new qh(n,e),a=new qh(n,e+1),i=[];return this.rs.forEachInRange([r,a],(function(e){t.cs(e),i.push(e.key)})),i}},{key:"fs",value:function(){var e=this;this.ns.forEach((function(t){return e.cs(t)}))}},{key:"cs",value:function(e){this.ns=this.ns.delete(e),this.rs=this.rs.delete(e)}},{key:"ds",value:function(e){var t=new so(new ao([])),n=new qh(t,e),r=new qh(t,e+1),a=sc();return this.rs.forEachInRange([n,r],(function(e){a=a.add(e.key)})),a}},{key:"containsKey",value:function(e){var t=new qh(e,0),n=this.ns.firstAfterOrEqual(t);return null!==n&&e.isEqual(n.key)}}]),e}(),qh=function(){function e(t,n){f(this,e),this.key=t,this._s=n}return p(e,null,[{key:"ss",value:function(e,t){return so.comparator(e.key,t.key)||Ji(e._s,t._s)}},{key:"os",value:function(e,t){return Ji(e._s,t._s)||so.comparator(e.key,t.key)}}]),e}(),Kh=function(){function e(t,n){f(this,e),this.indexManager=t,this.referenceDelegate=n,this.mutationQueue=[],this.ws=1,this.gs=new Uo(qh.ss)}return p(e,[{key:"checkEmpty",value:function(e){return xo.resolve(0===this.mutationQueue.length)}},{key:"addMutationBatch",value:function(e,t,n,r){var a=this.ws;this.ws++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];var i=new Cl(a,t,n,r);this.mutationQueue.push(i);var o,s=m(r);try{for(s.s();!(o=s.n()).done;){var u=o.value;this.gs=this.gs.add(new qh(u.key,a)),this.indexManager.addToCollectionParentIndex(e,u.key.path.popLast())}}catch(c){s.e(c)}finally{s.f()}return xo.resolve(i)}},{key:"lookupMutationBatch",value:function(e,t){return xo.resolve(this.ys(t))}},{key:"getNextMutationBatchAfterBatchId",value:function(e,t){var n=t+1,r=this.ps(n),a=r<0?0:r;return xo.resolve(this.mutationQueue.length>a?this.mutationQueue[a]:null)}},{key:"getHighestUnacknowledgedBatchId",value:function(){return xo.resolve(0===this.mutationQueue.length?-1:this.ws-1)}},{key:"getAllMutationBatches",value:function(e){return xo.resolve(this.mutationQueue.slice())}},{key:"getAllMutationBatchesAffectingDocumentKey",value:function(e,t){var n=this,r=new qh(t,0),a=new qh(t,Number.POSITIVE_INFINITY),i=[];return this.gs.forEachInRange([r,a],(function(e){var t=n.ys(e._s);i.push(t)})),xo.resolve(i)}},{key:"getAllMutationBatchesAffectingDocumentKeys",value:function(e,t){var n=this,r=new Uo(Ji);return t.forEach((function(e){var t=new qh(e,0),a=new qh(e,Number.POSITIVE_INFINITY);n.gs.forEachInRange([t,a],(function(e){r=r.add(e._s)}))})),xo.resolve(this.Is(r))}},{key:"getAllMutationBatchesAffectingQuery",value:function(e,t){var n=t.path,r=n.length+1,a=n;so.isDocumentKey(a)||(a=a.child(""));var i=new qh(new so(a),0),o=new Uo(Ji);return this.gs.forEachWhile((function(e){var t=e.key.path;return!!n.isPrefixOf(t)&&(t.length===r&&(o=o.add(e._s)),!0)}),i),xo.resolve(this.Is(o))}},{key:"Is",value:function(e){var t=this,n=[];return e.forEach((function(e){var r=t.ys(e);null!==r&&n.push(r)})),n}},{key:"removeMutationBatch",value:function(e,t){var n=this;Mi(0===this.Ts(t.batchId,"removed")),this.mutationQueue.shift();var r=this.gs;return xo.forEach(t.mutations,(function(a){var i=new qh(a.key,t.batchId);return r=r.delete(i),n.referenceDelegate.markPotentiallyOrphaned(e,a.key)})).next((function(){n.gs=r}))}},{key:"An",value:function(e){}},{key:"containsKey",value:function(e,t){var n=new qh(t,0),r=this.gs.firstAfterOrEqual(n);return xo.resolve(t.isEqual(r&&r.key))}},{key:"performConsistencyCheck",value:function(e){return this.mutationQueue.length,xo.resolve()}},{key:"Ts",value:function(e,t){return this.ps(e)}},{key:"ps",value:function(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}},{key:"ys",value:function(e){var t=this.ps(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}]),e}(),Xh=function(){function e(t){f(this,e),this.Es=t,this.docs=new Po(so.comparator),this.size=0}return p(e,[{key:"setIndexManager",value:function(e){this.indexManager=e}},{key:"addEntry",value:function(e,t){var n=t.key,r=this.docs.get(n),a=r?r.size:0,i=this.Es(t);return this.docs=this.docs.insert(n,{document:t.mutableCopy(),size:i}),this.size+=i-a,this.indexManager.addToCollectionParentIndex(e,n.path.popLast())}},{key:"removeEntry",value:function(e){var t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}},{key:"getEntry",value:function(e,t){var n=this.docs.get(t);return xo.resolve(n?n.document.mutableCopy():Es.newInvalidDocument(t))}},{key:"getEntries",value:function(e,t){var n=this,r=Ju();return t.forEach((function(e){var t=n.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():Es.newInvalidDocument(e))})),xo.resolve(r)}},{key:"getAllFromCollection",value:function(e,t,n){for(var r=Ju(),a=new so(t.child("")),i=this.docs.getIteratorFrom(a);i.hasNext();){var o=i.getNext(),s=o.key,u=o.value.document;if(!t.isPrefixOf(s.path))break;s.path.length>t.length+1||go(vo(u),n)<=0||(r=r.insert(u.key,u.mutableCopy()))}return xo.resolve(r)}},{key:"getAllFromCollectionGroup",value:function(e,t,n,r){Li()}},{key:"As",value:function(e,t){return xo.forEach(this.docs,(function(e){return t(e)}))}},{key:"newChangeBuffer",value:function(e){return new Qh(this)}},{key:"getSize",value:function(e){return xo.resolve(this.size)}}]),e}(),Qh=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).Yn=e,r}return p(n,[{key:"applyChanges",value:function(e){var t=this,n=[];return this.changes.forEach((function(r,a){a.isValidDocument()?n.push(t.Yn.addEntry(e,a)):t.Yn.removeEntry(r)})),xo.waitFor(n)}},{key:"getFromCache",value:function(e,t){return this.Yn.getEntry(e,t)}},{key:"getAllFromCache",value:function(e,t){return this.Yn.getEntries(e,t)}}]),n}(Dh),Yh=function(){function e(t){f(this,e),this.persistence=t,this.Rs=new Qu((function(e){return As(e)}),Rs),this.lastRemoteSnapshotVersion=no.min(),this.highestTargetId=0,this.bs=0,this.Ps=new Hh,this.targetCount=0,this.vs=xh.Pn()}return p(e,[{key:"forEachTarget",value:function(e,t){return this.Rs.forEach((function(e,n){return t(n)})),xo.resolve()}},{key:"getLastRemoteSnapshotVersion",value:function(e){return xo.resolve(this.lastRemoteSnapshotVersion)}},{key:"getHighestSequenceNumber",value:function(e){return xo.resolve(this.bs)}},{key:"allocateTargetId",value:function(e){return this.highestTargetId=this.vs.next(),xo.resolve(this.highestTargetId)}},{key:"setTargetsMetadata",value:function(e,t,n){return n&&(this.lastRemoteSnapshotVersion=n),t>this.bs&&(this.bs=t),xo.resolve()}},{key:"Dn",value:function(e){this.Rs.set(e.target,e);var t=e.targetId;t>this.highestTargetId&&(this.vs=new xh(t),this.highestTargetId=t),e.sequenceNumber>this.bs&&(this.bs=e.sequenceNumber)}},{key:"addTargetData",value:function(e,t){return this.Dn(t),this.targetCount+=1,xo.resolve()}},{key:"updateTargetData",value:function(e,t){return this.Dn(t),xo.resolve()}},{key:"removeTargetData",value:function(e,t){return this.Rs.delete(t.target),this.Ps.ls(t.targetId),this.targetCount-=1,xo.resolve()}},{key:"removeTargets",value:function(e,t,n){var r=this,a=0,i=[];return this.Rs.forEach((function(o,s){s.sequenceNumber<=t&&null===n.get(s.targetId)&&(r.Rs.delete(o),i.push(r.removeMatchingKeysForTargetId(e,s.targetId)),a++)})),xo.waitFor(i).next((function(){return a}))}},{key:"getTargetCount",value:function(e){return xo.resolve(this.targetCount)}},{key:"getTargetData",value:function(e,t){var n=this.Rs.get(t)||null;return xo.resolve(n)}},{key:"addMatchingKeys",value:function(e,t,n){return this.Ps.us(t,n),xo.resolve()}},{key:"removeMatchingKeys",value:function(e,t,n){this.Ps.hs(t,n);var r=this.persistence.referenceDelegate,a=[];return r&&t.forEach((function(t){a.push(r.markPotentiallyOrphaned(e,t))})),xo.waitFor(a)}},{key:"removeMatchingKeysForTargetId",value:function(e,t){return this.Ps.ls(t),xo.resolve()}},{key:"getMatchingKeysForTargetId",value:function(e,t){var n=this.Ps.ds(t);return xo.resolve(n)}},{key:"containsKey",value:function(e,t){return xo.resolve(this.Ps.containsKey(t))}}]),e}(),Jh=function(){function e(t,n){var r=this;f(this,e),this.Vs={},this.overlays={},this.Ss=new Fo(0),this.Ds=!1,this.Ds=!0,this.referenceDelegate=t(this),this.Cs=new Yh(this),this.indexManager=new ah,this.remoteDocumentCache=new Xh((function(e){return r.referenceDelegate.xs(e)})),this.It=new Al(n),this.Ns=new Zh(this.It)}return p(e,[{key:"start",value:function(){return Promise.resolve()}},{key:"shutdown",value:function(){return this.Ds=!1,Promise.resolve()}},{key:"started",get:function(){return this.Ds}},{key:"setDatabaseDeletedListener",value:function(){}},{key:"setNetworkEnabled",value:function(){}},{key:"getIndexManager",value:function(e){return this.indexManager}},{key:"getDocumentOverlayCache",value:function(e){var t=this.overlays[e.toKey()];return t||(t=new Gh,this.overlays[e.toKey()]=t),t}},{key:"getMutationQueue",value:function(e,t){var n=this.Vs[e.toKey()];return n||(n=new Kh(t,this.referenceDelegate),this.Vs[e.toKey()]=n),n}},{key:"getTargetCache",value:function(){return this.Cs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getBundleCache",value:function(){return this.Ns}},{key:"runTransaction",value:function(e,t,n){var r=this;_i("MemoryPersistence","Starting transaction:",e);var a=new $h(this.Ss.next());return this.referenceDelegate.ks(),n(a).next((function(e){return r.referenceDelegate.Ms(a).next((function(){return e}))})).toPromise().then((function(e){return a.raiseOnCommittedEvent(),e}))}},{key:"Os",value:function(e,t){return xo.or(Object.values(this.Vs).map((function(n){return function(){return n.containsKey(e,t)}})))}}]),e}(),$h=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).currentSequenceNumber=e,r}return p(n)}(bo),ef=function(){function e(t){f(this,e),this.persistence=t,this.Fs=new Hh,this.$s=null}return p(e,[{key:"Ls",get:function(){if(this.$s)return this.$s;throw Li()}},{key:"addReference",value:function(e,t,n){return this.Fs.addReference(n,t),this.Ls.delete(n.toString()),xo.resolve()}},{key:"removeReference",value:function(e,t,n){return this.Fs.removeReference(n,t),this.Ls.add(n.toString()),xo.resolve()}},{key:"markPotentiallyOrphaned",value:function(e,t){return this.Ls.add(t.toString()),xo.resolve()}},{key:"removeTarget",value:function(e,t){var n=this;this.Fs.ls(t.targetId).forEach((function(e){return n.Ls.add(e.toString())}));var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next((function(e){e.forEach((function(e){return n.Ls.add(e.toString())}))})).next((function(){return r.removeTargetData(e,t)}))}},{key:"ks",value:function(){this.$s=new Set}},{key:"Ms",value:function(e){var t=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return xo.forEach(this.Ls,(function(r){var a=so.fromPath(r);return t.Us(e,a).next((function(e){e||n.removeEntry(a,no.min())}))})).next((function(){return t.$s=null,n.apply(e)}))}},{key:"updateLimboDocument",value:function(e,t){var n=this;return this.Us(e,t).next((function(e){e?n.Ls.delete(t.toString()):n.Ls.add(t.toString())}))}},{key:"xs",value:function(e){return 0}},{key:"Us",value:function(e,t){var n=this;return xo.or([function(){return xo.resolve(n.Fs.containsKey(t))},function(){return n.persistence.getTargetCache().containsKey(e,t)},function(){return n.persistence.Os(e,t)}])}}],[{key:"Bs",value:function(t){return new e(t)}}]),e}(),tf=function(){function e(t){f(this,e),this.It=t}return p(e,[{key:"$",value:function(e,t,n,r){var a=this,i=new wo("createOrUpgrade",t);n<1&&r>=1&&(function(e){e.createObjectStore("owner")}(e),function(e){e.createObjectStore("mutationQueues",{keyPath:"userId"}),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",tl,{unique:!0}),e.createObjectStore("documentMutations")}(e),nf(e),function(e){e.createObjectStore("remoteDocuments")}(e));var o=xo.resolve();return n<3&&r>=3&&(0!==n&&(function(e){e.deleteObjectStore("targetDocuments"),e.deleteObjectStore("targets"),e.deleteObjectStore("targetGlobal")}(e),nf(e)),o=o.next((function(){return function(e){var t=e.store("targetGlobal"),n={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:no.min().toTimestamp(),targetCount:0};return t.put("targetGlobalKey",n)}(i)}))),n<4&&r>=4&&(0!==n&&(o=o.next((function(){return function(e,t){return t.store("mutations").W().next((function(n){e.deleteObjectStore("mutations"),e.createObjectStore("mutations",{keyPath:"batchId",autoIncrement:!0}).createIndex("userMutationsIndex",tl,{unique:!0});var r=t.store("mutations"),a=n.map((function(e){return r.put(e)}));return xo.waitFor(a)}))}(e,i)}))),o=o.next((function(){!function(e){e.createObjectStore("clientMetadata",{keyPath:"clientId"})}(e)}))),n<5&&r>=5&&(o=o.next((function(){return a.qs(i)}))),n<6&&r>=6&&(o=o.next((function(){return function(e){e.createObjectStore("remoteDocumentGlobal")}(e),a.Ks(i)}))),n<7&&r>=7&&(o=o.next((function(){return a.Gs(i)}))),n<8&&r>=8&&(o=o.next((function(){return a.Qs(e,i)}))),n<9&&r>=9&&(o=o.next((function(){!function(e){e.objectStoreNames.contains("remoteDocumentChanges")&&e.deleteObjectStore("remoteDocumentChanges")}(e)}))),n<10&&r>=10&&(o=o.next((function(){return a.js(i)}))),n<11&&r>=11&&(o=o.next((function(){!function(e){e.createObjectStore("bundles",{keyPath:"bundleId"})}(e),function(e){e.createObjectStore("namedQueries",{keyPath:"name"})}(e)}))),n<12&&r>=12&&(o=o.next((function(){!function(e){var t=e.createObjectStore("documentOverlays",{keyPath:ml});t.createIndex("collectionPathOverlayIndex",gl,{unique:!1}),t.createIndex("collectionGroupOverlayIndex",yl,{unique:!1})}(e)}))),n<13&&r>=13&&(o=o.next((function(){return function(e){var t=e.createObjectStore("remoteDocumentsV14",{keyPath:il});t.createIndex("documentKeyIndex",ol),t.createIndex("collectionGroupIndex",sl)}(e)})).next((function(){return a.Ws(e,i)})).next((function(){return e.deleteObjectStore("remoteDocuments")}))),n<14&&r>=14&&(o=o.next((function(){return a.zs(e,i)}))),n<15&&r>=15&&(o=o.next((function(){return function(e){e.createObjectStore("indexConfiguration",{keyPath:"indexId",autoIncrement:!0}).createIndex("collectionGroupIndex","collectionGroup",{unique:!1}),e.createObjectStore("indexState",{keyPath:fl}).createIndex("sequenceNumberIndex",dl,{unique:!1}),e.createObjectStore("indexEntries",{keyPath:pl}).createIndex("documentKeyIndex",vl,{unique:!1})}(e)}))),o}},{key:"Ks",value:function(e){var t=0;return e.store("remoteDocuments").Z((function(e,n){t+=mh(n)})).next((function(){var n={byteSize:t};return e.store("remoteDocumentGlobal").put("remoteDocumentGlobalKey",n)}))}},{key:"qs",value:function(e){var t=this,n=e.store("mutationQueues"),r=e.store("mutations");return n.W().next((function(n){return xo.forEach(n,(function(n){var a=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.W("userMutationsIndex",a).next((function(r){return xo.forEach(r,(function(r){Mi(r.userId===n.userId);var a=Ol(t.It,r);return vh(e,n.userId,a).next((function(){}))}))}))}))}))}},{key:"Gs",value:function(e){var t=e.store("targetDocuments"),n=e.store("remoteDocuments");return e.store("targetGlobal").get("targetGlobalKey").next((function(e){var r=[];return n.Z((function(n,a){var i=new ao(n),o=function(e){return[0,Yc(e)]}(i);r.push(t.get(o).next((function(n){return n?xo.resolve():function(n){return t.put({targetId:0,path:Yc(n),sequenceNumber:e.highestListenSequenceNumber})}(i)})))})).next((function(){return xo.waitFor(r)}))}))}},{key:"Qs",value:function(e,t){e.createObjectStore("collectionParents",{keyPath:hl});var n=t.store("collectionParents"),r=new ih,a=function(e){if(r.add(e)){var t=e.lastSegment(),a=e.popLast();return n.put({collectionId:t,parent:Yc(a)})}};return t.store("remoteDocuments").Z({X:!0},(function(e,t){var n=new ao(e);return a(n.popLast())})).next((function(){return t.store("documentMutations").Z({X:!0},(function(e,t){var n=(0,l.Z)(e,3),r=(n[0],n[1]),i=(n[2],el(r));return a(i.popLast())}))}))}},{key:"js",value:function(e){var t=this,n=e.store("targets");return n.Z((function(e,r){var a=Ll(r),i=Ml(t.It,a);return n.put(i)}))}},{key:"Ws",value:function(e,t){var n=t.store("remoteDocuments"),r=[];return n.Z((function(e,n){var a,i=t.store("remoteDocumentsV14"),o=(a=n,a.document?new so(ao.fromString(a.document.name).popFirst(5)):a.noDocument?so.fromSegments(a.noDocument.path):a.unknownDocument?so.fromSegments(a.unknownDocument.path):Li()).path.toArray(),s={prefixPath:o.slice(0,o.length-2),collectionGroup:o[o.length-2],documentId:o[o.length-1],readTime:n.readTime||[0,0],unknownDocument:n.unknownDocument,noDocument:n.noDocument,document:n.document,hasCommittedMutations:!!n.hasCommittedMutations};r.push(i.put(s))})).next((function(){return xo.waitFor(r)}))}},{key:"zs",value:function(e,t){var n=this,r=t.store("mutations"),a=Oh(this.It),i=new Jh(ef.Bs,this.It.re);return r.W().next((function(e){var r=new Map;return e.forEach((function(e){var t,a=null!==(t=r.get(e.userId))&&void 0!==t?t:sc();Ol(n.It,e).keys().forEach((function(e){return a=a.add(e)})),r.set(e.userId,a)})),xo.forEach(r,(function(e,r){var o=new Ti(r),s=Gl.oe(n.It,o),u=i.getIndexManager(o),c=gh.oe(o,n.It,u,i.referenceDelegate);return new jh(a,c,s,u).recalculateAndSaveOverlaysForDocumentKeys(new Il(t,Fo.at),e).next()}))}))}}]),e}();function nf(e){e.createObjectStore("targetDocuments",{keyPath:cl}).createIndex("documentTargetsIndex",ll,{unique:!0}),e.createObjectStore("targets",{keyPath:"targetId"}).createIndex("queryTargetsIndex",ul,{unique:!0}),e.createObjectStore("targetGlobal")}var rf="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",af=function(){function e(t,n,r,a,i,o,s,u,c,l){var h=arguments.length>10&&void 0!==arguments[10]?arguments[10]:15;if(f(this,e),this.allowTabSynchronization=t,this.persistenceKey=n,this.clientId=r,this.Hs=i,this.window=o,this.document=s,this.Js=c,this.Ys=l,this.Xs=h,this.Ss=null,this.Ds=!1,this.isPrimary=!1,this.networkEnabled=!0,this.Zs=null,this.inForeground=!1,this.ti=null,this.ei=null,this.ni=Number.NEGATIVE_INFINITY,this.si=function(e){return Promise.resolve()},!e.C())throw new Bi(zi.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Rh(this,a),this.ii=n+"main",this.It=new Al(u),this.ri=new Io(this.ii,this.Xs,new tf(this.It)),this.Cs=new wh(this.referenceDelegate,this.It),this.remoteDocumentCache=Oh(this.It),this.Ns=new Wl,this.window&&this.window.localStorage?this.oi=this.window.localStorage:(this.oi=null,!1===l&&Di("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return p(e,[{key:"start",value:function(){var e=this;return this.ui().then((function(){if(!e.isPrimary&&!e.allowTabSynchronization)throw new Bi(zi.FAILED_PRECONDITION,rf);return e.ci(),e.ai(),e.hi(),e.runTransaction("getHighestListenSequenceNumber","readonly",(function(t){return e.Cs.getHighestSequenceNumber(t)}))})).then((function(t){e.Ss=new Fo(t,e.Js)})).then((function(){e.Ds=!0})).catch((function(t){return e.ri&&e.ri.close(),Promise.reject(t)}))}},{key:"li",value:function(e){var t=this;return this.si=function(){var n=c(s().mark((function n(r){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!t.started){n.next=2;break}return n.abrupt("return",e(r));case 2:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),e(this.isPrimary)}},{key:"setDatabaseDeletedListener",value:function(e){this.ri.L(function(){var t=c(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.t0=null===n.newVersion,!t.t0){t.next=4;break}return t.next=4,e();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}},{key:"setNetworkEnabled",value:function(e){var t=this;this.networkEnabled!==e&&(this.networkEnabled=e,this.Hs.enqueueAndForget(c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.started,!e.t0){e.next=4;break}return e.next=4,t.ui();case 4:case"end":return e.stop()}}),e)})))))}},{key:"ui",value:function(){var e=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",(function(t){return sf(t).put({clientId:e.clientId,updateTimeMs:Date.now(),networkEnabled:e.networkEnabled,inForeground:e.inForeground}).next((function(){if(e.isPrimary)return e.fi(t).next((function(t){t||(e.isPrimary=!1,e.Hs.enqueueRetryable((function(){return e.si(!1)})))}))})).next((function(){return e.di(t)})).next((function(n){return e.isPrimary&&!n?e._i(t).next((function(){return!1})):!!n&&e.wi(t).next((function(){return!0}))}))})).catch((function(t){if(Eo(t))return _i("IndexedDbPersistence","Failed to extend owner lease: ",t),e.isPrimary;if(!e.allowTabSynchronization)throw t;return _i("IndexedDbPersistence","Releasing owner lease after error during lease refresh",t),!1})).then((function(t){e.isPrimary!==t&&e.Hs.enqueueRetryable((function(){return e.si(t)})),e.isPrimary=t}))}},{key:"fi",value:function(e){var t=this;return of(e).get("owner").next((function(e){return xo.resolve(t.mi(e))}))}},{key:"gi",value:function(e){return sf(e).delete(this.clientId)}},{key:"yi",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.isPrimary||this.pi(this.ni,18e5)){e.next=6;break}return this.ni=Date.now(),e.next=4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",(function(e){var t=Sl(e,"clientMetadata");return t.W().next((function(e){var n=i.Ii(e,18e5),r=e.filter((function(e){return-1===n.indexOf(e)}));return xo.forEach(r,(function(e){return t.delete(e.clientId)})).next((function(){return r}))}))})).catch((function(){return[]}));case 4:if(t=e.sent,this.oi){n=m(t);try{for(n.s();!(r=n.n()).done;)a=r.value,this.oi.removeItem(this.Ti(a.clientId))}catch(o){n.e(o)}finally{n.f()}}case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"hi",value:function(){var e=this;this.ei=this.Hs.enqueueAfterDelay("client_metadata_refresh",4e3,(function(){return e.ui().then((function(){return e.yi()})).then((function(){return e.hi()}))}))}},{key:"mi",value:function(e){return!!e&&e.ownerId===this.clientId}},{key:"di",value:function(e){var t=this;return this.Ys?xo.resolve(!0):of(e).get("owner").next((function(n){if(null!==n&&t.pi(n.leaseTimestampMs,5e3)&&!t.Ei(n.ownerId)){if(t.mi(n)&&t.networkEnabled)return!0;if(!t.mi(n)){if(!n.allowTabSynchronization)throw new Bi(zi.FAILED_PRECONDITION,rf);return!1}}return!(!t.networkEnabled||!t.inForeground)||sf(e).W().next((function(e){return void 0===t.Ii(e,5e3).find((function(e){if(t.clientId!==e.clientId){var n=!t.networkEnabled&&e.networkEnabled,r=!t.inForeground&&e.inForeground,a=t.networkEnabled===e.networkEnabled;if(n||r&&a)return!0}return!1}))}))})).next((function(e){return t.isPrimary!==e&&_i("IndexedDbPersistence","Client ".concat(e?"is":"is not"," eligible for a primary lease.")),e}))}},{key:"shutdown",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.Ds=!1,this.Ai(),this.ei&&(this.ei.cancel(),this.ei=null),this.Ri(),this.bi(),e.next=7,this.ri.runTransaction("shutdown","readwrite",["owner","clientMetadata"],(function(e){var n=new Il(e,Fo.at);return t._i(n).next((function(){return t.gi(n)}))}));case 7:this.ri.close(),this.Pi();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Ii",value:function(e,t){var n=this;return e.filter((function(e){return n.pi(e.updateTimeMs,t)&&!n.Ei(e.clientId)}))}},{key:"vi",value:function(){var e=this;return this.runTransaction("getActiveClients","readonly",(function(t){return sf(t).W().next((function(t){return e.Ii(t,18e5).map((function(e){return e.clientId}))}))}))}},{key:"started",get:function(){return this.Ds}},{key:"getMutationQueue",value:function(e,t){return gh.oe(e,this.It,t,this.referenceDelegate)}},{key:"getTargetCache",value:function(){return this.Cs}},{key:"getRemoteDocumentCache",value:function(){return this.remoteDocumentCache}},{key:"getIndexManager",value:function(e){return new sh(e,this.It.re.databaseId)}},{key:"getDocumentOverlayCache",value:function(e){return Gl.oe(this.It,e)}},{key:"getBundleCache",value:function(){return this.Ns}},{key:"runTransaction",value:function(e,t,n){var r=this;_i("IndexedDbPersistence","Starting transaction:",e);var a,i,o="readonly"===t?"readonly":"readwrite",s=15===(a=this.Xs)?wl:14===a?xl:13===a?Vl:12===a?kl:11===a?bl:void Li();return this.ri.runTransaction(e,o,s,(function(a){return i=new Il(a,r.Ss?r.Ss.next():Fo.at),"readwrite-primary"===t?r.fi(i).next((function(e){return!!e||r.di(i)})).next((function(t){if(!t)throw Di("Failed to obtain primary lease for action '".concat(e,"'.")),r.isPrimary=!1,r.Hs.enqueueRetryable((function(){return r.si(!1)})),new Bi(zi.FAILED_PRECONDITION,yo);return n(i)})).next((function(e){return r.wi(i).next((function(){return e}))})):r.Vi(i).next((function(){return n(i)}))})).then((function(e){return i.raiseOnCommittedEvent(),e}))}},{key:"Vi",value:function(e){var t=this;return of(e).get("owner").next((function(e){if(null!==e&&t.pi(e.leaseTimestampMs,5e3)&&!t.Ei(e.ownerId)&&!t.mi(e)&&!(t.Ys||t.allowTabSynchronization&&e.allowTabSynchronization))throw new Bi(zi.FAILED_PRECONDITION,rf)}))}},{key:"wi",value:function(e){var t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return of(e).put("owner",t)}},{key:"_i",value:function(e){var t=this,n=of(e);return n.get("owner").next((function(e){return t.mi(e)?(_i("IndexedDbPersistence","Releasing primary lease."),n.delete("owner")):xo.resolve()}))}},{key:"pi",value:function(e,t){var n=Date.now();return!(e<n-t)&&(!(e>n)||(Di("Detected an update time that is in the future: ".concat(e," > ").concat(n)),!1))}},{key:"ci",value:function(){var e=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.ti=function(){e.Hs.enqueueAndForget((function(){return e.inForeground="visible"===e.document.visibilityState,e.ui()}))},this.document.addEventListener("visibilitychange",this.ti),this.inForeground="visible"===this.document.visibilityState)}},{key:"Ri",value:function(){this.ti&&(this.document.removeEventListener("visibilitychange",this.ti),this.ti=null)}},{key:"ai",value:function(){var e,t=this;"function"==typeof(null===(e=this.window)||void 0===e?void 0:e.addEventListener)&&(this.Zs=function(){t.Ai(),D()&&navigator.appVersion.match(/Version\/1[45]/)&&t.Hs.enterRestrictedMode(!0),t.Hs.enqueueAndForget((function(){return t.shutdown()}))},this.window.addEventListener("pagehide",this.Zs))}},{key:"bi",value:function(){this.Zs&&(this.window.removeEventListener("pagehide",this.Zs),this.Zs=null)}},{key:"Ei",value:function(e){var t;try{var n=null!==(null===(t=this.oi)||void 0===t?void 0:t.getItem(this.Ti(e)));return _i("IndexedDbPersistence","Client '".concat(e,"' ").concat(n?"is":"is not"," zombied in LocalStorage")),n}catch(e){return Di("IndexedDbPersistence","Failed to get zombied client id.",e),!1}}},{key:"Ai",value:function(){if(this.oi)try{this.oi.setItem(this.Ti(this.clientId),String(Date.now()))}catch(Ot){Di("Failed to set zombie client id.",Ot)}}},{key:"Pi",value:function(){if(this.oi)try{this.oi.removeItem(this.Ti(this.clientId))}catch(Ot){}}},{key:"Ti",value:function(e){return"firestore_zombie_".concat(this.persistenceKey,"_").concat(e)}}],[{key:"C",value:function(){return Io.C()}}]),e}();function of(e){return Sl(e,"owner")}function sf(e){return Sl(e,"clientMetadata")}function uf(e,t){var n=e.projectId;return e.isDefaultDatabase||(n+="."+e.database),"firestore/"+t+"/"+n+"/"}var cf=function(){function e(t,n,r,a){f(this,e),this.targetId=t,this.fromCache=n,this.Si=r,this.Di=a}return p(e,null,[{key:"Ci",value:function(t,n){var r,a=sc(),i=sc(),o=m(n.docChanges);try{for(o.s();!(r=o.n()).done;){var s=r.value;switch(s.type){case 0:a=a.add(s.doc.key);break;case 1:i=i.add(s.doc.key)}}}catch(u){o.e(u)}finally{o.f()}return new e(t,n.fromCache,a,i)}}]),e}(),lf=function(){function e(){f(this,e),this.xi=!1}return p(e,[{key:"initialize",value:function(e,t){this.Ni=e,this.indexManager=t,this.xi=!0}},{key:"getDocumentsMatchingQuery",value:function(e,t,n,r){var a=this;return this.ki(e,t).next((function(i){return i||a.Mi(e,t,r,n)})).next((function(n){return n||a.Oi(e,t)}))}},{key:"ki",value:function(e,t){var n=this;if($s(t))return xo.resolve(null);var r=au(t);return this.indexManager.getIndexType(e,r).next((function(a){return 0===a?null:(null!==t.limit&&1===a&&(t=iu(t,null,"F"),r=au(t)),n.indexManager.getDocumentsMatchingTarget(e,r).next((function(a){var i=sc.apply(void 0,(0,H.Z)(a));return n.Ni.getDocuments(e,i).next((function(a){return n.indexManager.getMinOffset(e,r).next((function(r){var o=n.Fi(t,a);return n.$i(t,o,i,r.readTime)?n.ki(e,iu(t,null,"F")):n.Bi(e,o,t,r)}))}))})))}))}},{key:"Mi",value:function(e,t,n,r){var a=this;return $s(t)||r.isEqual(no.min())?this.Oi(e,t):this.Ni.getDocuments(e,n).next((function(i){var o=a.Fi(t,i);return a.$i(t,o,n,r)?a.Oi(e,t):(Ri()<=Y.DEBUG&&_i("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),uu(t)),a.Bi(e,o,t,po(r,-1)))}))}},{key:"Fi",value:function(e,t){var n=new Uo(hu(e));return t.forEach((function(t,r){cu(e,r)&&(n=n.add(r))})),n}},{key:"$i",value:function(e,t,n,r){if(null===e.limit)return!1;if(n.size!==t.size)return!0;var a="F"===e.limitType?t.last():t.first();return!!a&&(a.hasPendingWrites||a.version.compareTo(r)>0)}},{key:"Oi",value:function(e,t){return Ri()<=Y.DEBUG&&_i("QueryEngine","Using full collection scan to execute query:",uu(t)),this.Ni.getDocumentsMatchingQuery(e,t,mo.min())}},{key:"Bi",value:function(e,t,n,r){return this.Ni.getDocumentsMatchingQuery(e,n,r).next((function(e){return t.forEach((function(t){e=e.insert(t.key,t)})),e}))}}]),e}(),hf=function(){function e(t,n,r,a){f(this,e),this.persistence=t,this.Li=n,this.It=a,this.Ui=new Po(Ji),this.qi=new Qu((function(e){return As(e)}),Rs),this.Ki=new Map,this.Gi=t.getRemoteDocumentCache(),this.Cs=t.getTargetCache(),this.Ns=t.getBundleCache(),this.Qi(r)}return p(e,[{key:"Qi",value:function(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new jh(this.Gi,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Gi.setIndexManager(this.indexManager),this.Li.initialize(this.localDocuments,this.indexManager)}},{key:"collectGarbage",value:function(e){var t=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",(function(n){return e.collect(n,t.Ui)}))}}]),e}();function ff(e,t,n,r){return new hf(e,t,n,r)}function df(e,t){return pf.apply(this,arguments)}function pf(){return pf=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Pi(t),e.next=3,r.persistence.runTransaction("Handle user change","readonly",(function(e){var t;return r.mutationQueue.getAllMutationBatches(e).next((function(a){return t=a,r.Qi(n),r.mutationQueue.getAllMutationBatches(e)})).next((function(n){var a,i=[],o=[],s=sc(),u=m(t);try{for(u.s();!(a=u.n()).done;){var c=a.value;i.push(c.batchId);var l,h=m(c.mutations);try{for(h.s();!(l=h.n()).done;){var f=l.value;s=s.add(f.key)}}catch(k){h.e(k)}finally{h.f()}}}catch(k){u.e(k)}finally{u.f()}var d,p=m(n);try{for(p.s();!(d=p.n()).done;){var v=d.value;o.push(v.batchId);var g,y=m(v.mutations);try{for(y.s();!(g=y.n()).done;){var b=g.value;s=s.add(b.key)}}catch(k){y.e(k)}finally{y.f()}}}catch(k){p.e(k)}finally{p.f()}return r.localDocuments.getDocuments(e,s).next((function(e){return{ji:e,removedBatchIds:i,addedBatchIds:o}}))}))}));case 3:return e.abrupt("return",e.sent);case 4:case"end":return e.stop()}}),e)}))),pf.apply(this,arguments)}function vf(e,t){var n=Pi(e);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(function(e){var r=t.batch.keys(),a=n.Gi.newChangeBuffer({trackRemovals:!0});return function(e,t,n,r){var a=n.batch,i=a.keys(),o=xo.resolve();return i.forEach((function(e){o=o.next((function(){return r.getEntry(t,e)})).next((function(t){var i=n.docVersions.get(e);Mi(null!==i),t.version.compareTo(i)<0&&(a.applyToRemoteDocument(t,n),t.isValidDocument()&&(t.setReadTime(n.commitVersion),r.addEntry(t)))}))})),o.next((function(){return e.mutationQueue.removeMutationBatch(t,a)}))}(n,e,t,a).next((function(){return a.apply(e)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t.batch.batchId)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){for(var t=sc(),n=0;n<e.mutationResults.length;++n)e.mutationResults[n].transformResults.length>0&&(t=t.add(e.batch.mutations[n].key));return t}(t))})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}function mf(e){var t=Pi(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(function(e){return t.Cs.getLastRemoteSnapshotVersion(e)}))}function gf(e,t){var n=Pi(e),r=t.snapshotVersion,a=n.Ui;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(function(e){var i=n.Gi.newChangeBuffer({trackRemovals:!0});a=n.Ui;var o=[];t.targetChanges.forEach((function(i,s){var u=a.get(s);if(u){o.push(n.Cs.removeMatchingKeys(e,i.removedDocuments,s).next((function(){return n.Cs.addMatchingKeys(e,i.addedDocuments,s)})));var c=u.withSequenceNumber(e.currentSequenceNumber);t.targetMismatches.has(s)?c=c.withResumeToken(Go.EMPTY_BYTE_STRING,no.min()).withLastLimboFreeSnapshotVersion(no.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,r)),a=a.insert(s,c),function(e,t,n){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)}(u,c,i)&&o.push(n.Cs.updateTargetData(e,c))}}));var s=Ju(),u=sc();if(t.documentUpdates.forEach((function(r){t.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(e,r))})),o.push(yf(e,i,t.documentUpdates).next((function(e){s=e.Wi,u=e.zi}))),!r.isEqual(no.min())){var c=n.Cs.getLastRemoteSnapshotVersion(e).next((function(t){return n.Cs.setTargetsMetadata(e,e.currentSequenceNumber,r)}));o.push(c)}return xo.waitFor(o).next((function(){return i.apply(e)})).next((function(){return n.localDocuments.getLocalViewOfDocuments(e,s,u)})).next((function(){return s}))})).then((function(e){return n.Ui=a,e}))}function yf(e,t,n){var r=sc(),a=sc();return n.forEach((function(e){return r=r.add(e)})),t.getEntries(e,r).next((function(e){var r=Ju();return n.forEach((function(n,i){var o=e.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(a=a.add(n)),i.isNoDocument()&&i.version.isEqual(no.min())?(t.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(i),r=r.insert(n,i)):_i("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{Wi:r,zi:a}}))}function bf(e,t){var n=Pi(e);return n.persistence.runTransaction("Get next mutation batch","readonly",(function(e){return void 0===t&&(t=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(e,t)}))}function kf(e,t){var n=Pi(e);return n.persistence.runTransaction("Allocate target","readwrite",(function(e){var r;return n.Cs.getTargetData(e,t).next((function(a){return a?(r=a,xo.resolve(r)):n.Cs.allocateTargetId(e).next((function(a){return r=new Nl(t,a,0,e.currentSequenceNumber),n.Cs.addTargetData(e,r).next((function(){return r}))}))}))})).then((function(e){var r=n.Ui.get(e.targetId);return(null===r||e.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.Ui=n.Ui.insert(e.targetId,e),n.qi.set(t,e.targetId)),e}))}function Vf(e,t,n){return xf.apply(this,arguments)}function xf(){return xf=c(s().mark((function e(t,n,r){var a,i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Pi(t),i=a.Ui.get(n),o=r?"readwrite":"readwrite-primary",e.prev=1,e.t0=r,e.t0){e.next=6;break}return e.next=6,a.persistence.runTransaction("Release target",o,(function(e){return a.persistence.referenceDelegate.removeTarget(e,i)}));case 6:e.next=13;break;case 8:if(e.prev=8,e.t1=e.catch(1),Eo(e.t1)){e.next=12;break}throw e.t1;case 12:_i("LocalStore","Failed to update sequence numbers for target ".concat(n,": ").concat(e.t1));case 13:a.Ui=a.Ui.remove(n),a.qi.delete(i.target);case 14:case"end":return e.stop()}}),e,null,[[1,8]])}))),xf.apply(this,arguments)}function wf(e,t,n){var r=Pi(e),a=no.min(),i=sc();return r.persistence.runTransaction("Execute query","readonly",(function(e){return function(e,t,n){var r=Pi(e),a=r.qi.get(n);return void 0!==a?xo.resolve(r.Ui.get(a)):r.Cs.getTargetData(t,n)}(r,e,au(t)).next((function(t){if(t)return a=t.lastLimboFreeSnapshotVersion,r.Cs.getMatchingKeysForTargetId(e,t.targetId).next((function(e){i=e}))})).next((function(){return r.Li.getDocumentsMatchingQuery(e,t,n?a:no.min(),n?i:sc())})).next((function(e){return Cf(r,lu(t),e),{documents:e,Hi:i}}))}))}function If(e,t){var n=Pi(e),r=Pi(n.Cs),a=n.Ui.get(t);return a?Promise.resolve(a.target):n.persistence.runTransaction("Get target data","readonly",(function(e){return r.se(e,t).next((function(e){return e?e.target:null}))}))}function Sf(e,t){var n=Pi(e),r=n.Ki.get(t)||no.min();return n.persistence.runTransaction("Get new document changes","readonly",(function(e){return n.Gi.getAllFromCollectionGroup(e,t,po(r,-1),Number.MAX_SAFE_INTEGER)})).then((function(e){return Cf(n,t,e),e}))}function Cf(e,t,n){var r=no.min();n.forEach((function(e,t){t.readTime.compareTo(r)>0&&(r=t.readTime)})),e.Ki.set(t,r)}function Ef(e,t,n,r){return Tf.apply(this,arguments)}function Tf(){return Tf=c(s().mark((function e(t,n,r,a){var i,o,u,c,l,h,f,d,p,v;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i=Pi(t),o=sc(),u=Ju(),c=m(r);try{for(c.s();!(l=c.n()).done;)h=l.value,f=n.Ji(h.metadata.name),h.document&&(o=o.add(f)),(d=n.Yi(h)).setReadTime(n.Xi(h.metadata.readTime)),u=u.insert(f,d)}catch(s){c.e(s)}finally{c.f()}return p=i.Gi.newChangeBuffer({trackRemovals:!0}),e.next=7,kf(i,function(e){return au(Js(ao.fromString("__bundle__/docs/".concat(e))))}(a));case 7:return v=e.sent,e.abrupt("return",i.persistence.runTransaction("Apply bundle documents","readwrite",(function(e){return yf(e,p,u).next((function(t){return p.apply(e),t})).next((function(t){return i.Cs.removeMatchingKeysForTargetId(e,v.targetId).next((function(){return i.Cs.addMatchingKeys(e,o,v.targetId)})).next((function(){return i.localDocuments.getLocalViewOfDocuments(e,t.Wi,t.zi)})).next((function(){return t.Wi}))}))})));case 9:case"end":return e.stop()}}),e)}))),Tf.apply(this,arguments)}function Nf(e,t){return Af.apply(this,arguments)}function Af(){return Af=c(s().mark((function e(t,n){var r,a,i,o=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>2&&void 0!==o[2]?o[2]:sc(),e.next=3,kf(t,au(Pl(n.bundledQuery)));case 3:return a=e.sent,i=Pi(t),e.abrupt("return",i.persistence.runTransaction("Save named query","readwrite",(function(e){var t=Sc(n.readTime);if(a.snapshotVersion.compareTo(t)>=0)return i.Ns.saveNamedQuery(e,n);var o=a.withResumeToken(Go.EMPTY_BYTE_STRING,t);return i.Ui=i.Ui.insert(o.targetId,o),i.Cs.updateTargetData(e,o).next((function(){return i.Cs.removeMatchingKeysForTargetId(e,a.targetId)})).next((function(){return i.Cs.addMatchingKeys(e,r,a.targetId)})).next((function(){return i.Ns.saveNamedQuery(e,n)}))})));case 6:case"end":return e.stop()}}),e)}))),Af.apply(this,arguments)}function Rf(e,t){return"firestore_clients_".concat(e,"_").concat(t)}function _f(e,t,n){var r="firestore_mutations_".concat(e,"_").concat(n);return t.isAuthenticated()&&(r+="_".concat(t.uid)),r}function Df(e,t){return"firestore_targets_".concat(e,"_").concat(t)}var Ff=function(){function e(t,n,r,a){f(this,e),this.user=t,this.batchId=n,this.state=r,this.error=a}return p(e,[{key:"tr",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Zi",value:function(t,n,r){var a,i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&((o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(a=new Bi(i.error.code,i.error.message))),o?new e(t,n,i.state,a):(Di("SharedClientState","Failed to parse mutation state for ID '".concat(n,"': ").concat(r)),null)}}]),e}(),Of=function(){function e(t,n,r){f(this,e),this.targetId=t,this.state=n,this.error=r}return p(e,[{key:"tr",value:function(){var e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}}],[{key:"Zi",value:function(t,n){var r,a=JSON.parse(n),i="object"==typeof a&&-1!==["not-current","current","rejected"].indexOf(a.state)&&(void 0===a.error||"object"==typeof a.error);return i&&a.error&&((i="string"==typeof a.error.message&&"string"==typeof a.error.code)&&(r=new Bi(a.error.code,a.error.message))),i?new e(t,a.state,r):(Di("SharedClientState","Failed to parse target state for ID '".concat(t,"': ").concat(n)),null)}}]),e}(),Lf=function(){function e(t,n){f(this,e),this.clientId=t,this.activeTargetIds=n}return p(e,null,[{key:"Zi",value:function(t,n){for(var r=JSON.parse(n),a="object"==typeof r&&r.activeTargetIds instanceof Array,i=cc(),o=0;a&&o<r.activeTargetIds.length;++o)a=rs(r.activeTargetIds[o]),i=i.add(r.activeTargetIds[o]);return a?new e(t,i):(Di("SharedClientState","Failed to parse client data for instance '".concat(t,"': ").concat(n)),null)}}]),e}(),Mf=function(){function e(t,n){f(this,e),this.clientId=t,this.onlineState=n}return p(e,null,[{key:"Zi",value:function(t){var n=JSON.parse(t);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new e(n.clientId,n.onlineState):(Di("SharedClientState","Failed to parse online state: ".concat(t)),null)}}]),e}(),Pf=function(){function e(){f(this,e),this.activeTargetIds=cc()}return p(e,[{key:"er",value:function(e){this.activeTargetIds=this.activeTargetIds.add(e)}},{key:"nr",value:function(e){this.activeTargetIds=this.activeTargetIds.delete(e)}},{key:"tr",value:function(){var e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}]),e}(),zf=function(){function e(t,n,r,a,i){f(this,e),this.window=t,this.Hs=n,this.persistenceKey=r,this.sr=a,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.ir=this.rr.bind(this),this.ur=new Po(Ji),this.started=!1,this.cr=[];var o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.ar=Rf(this.persistenceKey,this.sr),this.hr=function(e){return"firestore_sequence_number_".concat(e)}(this.persistenceKey),this.ur=this.ur.insert(this.sr,new Pf),this.lr=new RegExp("^firestore_clients_".concat(o,"_([^_]*)$")),this.dr=new RegExp("^firestore_mutations_".concat(o,"_(\\d+)(?:_(.*))?$")),this._r=new RegExp("^firestore_targets_".concat(o,"_(\\d+)$")),this.wr=function(e){return"firestore_online_state_".concat(e)}(this.persistenceKey),this.mr=function(e){return"firestore_bundle_loaded_v2_".concat(e)}(this.persistenceKey),this.window.addEventListener("storage",this.ir)}return p(e,[{key:"start",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i,o,u,c,l,h,f,d=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.syncEngine.vi();case 2:t=e.sent,n=m(t),e.prev=4,n.s();case 6:if((r=n.n()).done){e.next=14;break}if((a=r.value)!==this.sr){e.next=10;break}return e.abrupt("continue",12);case 10:(i=this.getItem(Rf(this.persistenceKey,a)))&&(o=Lf.Zi(a,i))&&(this.ur=this.ur.insert(o.clientId,o));case 12:e.next=6;break;case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(4),n.e(e.t0);case 19:return e.prev=19,n.f(),e.finish(19);case 22:this.gr(),(u=this.storage.getItem(this.wr))&&(c=this.yr(u))&&this.pr(c),l=m(this.cr);try{for(l.s();!(h=l.n()).done;)f=h.value,this.rr(f)}catch(s){l.e(s)}finally{l.f()}this.cr=[],this.window.addEventListener("pagehide",(function(){return d.shutdown()})),this.started=!0;case 28:case"end":return e.stop()}}),e,this,[[4,16,19,22]])})));return function(){return e.apply(this,arguments)}}()},{key:"writeSequenceNumber",value:function(e){this.setItem(this.hr,JSON.stringify(e))}},{key:"getAllActiveQueryTargets",value:function(){return this.Ir(this.ur)}},{key:"isActiveQueryTarget",value:function(e){var t=!1;return this.ur.forEach((function(n,r){r.activeTargetIds.has(e)&&(t=!0)})),t}},{key:"addPendingMutation",value:function(e){this.Tr(e,"pending")}},{key:"updateMutationState",value:function(e,t,n){this.Tr(e,t,n),this.Er(e)}},{key:"addLocalQueryTarget",value:function(e){var t="not-current";if(this.isActiveQueryTarget(e)){var n=this.storage.getItem(Df(this.persistenceKey,e));if(n){var r=Of.Zi(e,n);r&&(t=r.state)}}return this.Ar.er(e),this.gr(),t}},{key:"removeLocalQueryTarget",value:function(e){this.Ar.nr(e),this.gr()}},{key:"isLocalQueryTarget",value:function(e){return this.Ar.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){this.removeItem(Df(this.persistenceKey,e))}},{key:"updateQueryState",value:function(e,t,n){this.Rr(e,t,n)}},{key:"handleUserChange",value:function(e,t,n){var r=this;t.forEach((function(e){r.Er(e)})),this.currentUser=e,n.forEach((function(e){r.addPendingMutation(e)}))}},{key:"setOnlineState",value:function(e){this.br(e)}},{key:"notifyBundleLoaded",value:function(e){this.Pr(e)}},{key:"shutdown",value:function(){this.started&&(this.window.removeEventListener("storage",this.ir),this.removeItem(this.ar),this.started=!1)}},{key:"getItem",value:function(e){var t=this.storage.getItem(e);return _i("SharedClientState","READ",e,t),t}},{key:"setItem",value:function(e,t){_i("SharedClientState","SET",e,t),this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){_i("SharedClientState","REMOVE",e),this.storage.removeItem(e)}},{key:"rr",value:function(e){var t=this,n=e;if(n.storageArea===this.storage){if(_i("SharedClientState","EVENT",n.key,n.newValue),n.key===this.ar)return void Di("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Hs.enqueueRetryable(c(s().mark((function e(){var r,a,i,o,u,c,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.started){e.next=43;break}if(null===n.key){e.next=41;break}if(!t.lr.test(n.key)){e.next=11;break}if(null!=n.newValue){e.next=6;break}return r=t.vr(n.key),e.abrupt("return",t.Vr(r,null));case 6:if(!(a=t.Sr(n.key,n.newValue))){e.next=9;break}return e.abrupt("return",t.Vr(a.clientId,a));case 9:e.next=41;break;case 11:if(!t.dr.test(n.key)){e.next=18;break}if(null===n.newValue){e.next=16;break}if(!(i=t.Dr(n.key,n.newValue))){e.next=16;break}return e.abrupt("return",t.Cr(i));case 16:e.next=41;break;case 18:if(!t._r.test(n.key)){e.next=25;break}if(null===n.newValue){e.next=23;break}if(!(o=t.Nr(n.key,n.newValue))){e.next=23;break}return e.abrupt("return",t.kr(o));case 23:e.next=41;break;case 25:if(n.key!==t.wr){e.next=32;break}if(null===n.newValue){e.next=30;break}if(!(u=t.yr(n.newValue))){e.next=30;break}return e.abrupt("return",t.pr(u));case 30:e.next=41;break;case 32:if(n.key!==t.hr){e.next=37;break}c=function(e){var t=Fo.at;if(null!=e)try{var n=JSON.parse(e);Mi("number"==typeof n),t=n}catch(e){Di("SharedClientState","Failed to read sequence number from WebStorage",e)}return t}(n.newValue),c!==Fo.at&&t.sequenceNumberHandler(c),e.next=41;break;case 37:if(n.key!==t.mr){e.next=41;break}return l=t.Mr(n.newValue),e.next=41,Promise.all(l.map((function(e){return t.syncEngine.Or(e)})));case 41:e.next=44;break;case 43:t.cr.push(n);case 44:case"end":return e.stop()}}),e)}))))}}},{key:"Ar",get:function(){return this.ur.get(this.sr)}},{key:"gr",value:function(){this.setItem(this.ar,this.Ar.tr())}},{key:"Tr",value:function(e,t,n){var r=new Ff(this.currentUser,e,t,n),a=_f(this.persistenceKey,this.currentUser,e);this.setItem(a,r.tr())}},{key:"Er",value:function(e){var t=_f(this.persistenceKey,this.currentUser,e);this.removeItem(t)}},{key:"br",value:function(e){var t={clientId:this.sr,onlineState:e};this.storage.setItem(this.wr,JSON.stringify(t))}},{key:"Rr",value:function(e,t,n){var r=Df(this.persistenceKey,e),a=new Of(e,t,n);this.setItem(r,a.tr())}},{key:"Pr",value:function(e){var t=JSON.stringify(Array.from(e));this.setItem(this.mr,t)}},{key:"vr",value:function(e){var t=this.lr.exec(e);return t?t[1]:null}},{key:"Sr",value:function(e,t){var n=this.vr(e);return Lf.Zi(n,t)}},{key:"Dr",value:function(e,t){var n=this.dr.exec(e),r=Number(n[1]),a=void 0!==n[2]?n[2]:null;return Ff.Zi(new Ti(a),r,t)}},{key:"Nr",value:function(e,t){var n=this._r.exec(e),r=Number(n[1]);return Of.Zi(r,t)}},{key:"yr",value:function(e){return Mf.Zi(e)}},{key:"Mr",value:function(e){return JSON.parse(e)}},{key:"Cr",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.user.uid!==this.currentUser.uid){e.next=2;break}return e.abrupt("return",this.syncEngine.Fr(t.batchId,t.state,t.error));case 2:_i("SharedClientState","Ignoring mutation for non-active user ".concat(t.user.uid));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"kr",value:function(e){return this.syncEngine.$r(e.targetId,e.state,e.error)}},{key:"Vr",value:function(e,t){var n=this,r=t?this.ur.insert(e,t):this.ur.remove(e),a=this.Ir(this.ur),i=this.Ir(r),o=[],s=[];return i.forEach((function(e){a.has(e)||o.push(e)})),a.forEach((function(e){i.has(e)||s.push(e)})),this.syncEngine.Br(o,s).then((function(){n.ur=r}))}},{key:"pr",value:function(e){this.ur.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}},{key:"Ir",value:function(e){var t=cc();return e.forEach((function(e,n){t=t.unionWith(n.activeTargetIds)})),t}}],[{key:"C",value:function(e){return!(!e||!e.localStorage)}}]),e}(),Bf=function(){function e(){f(this,e),this.Lr=new Pf,this.Ur={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return p(e,[{key:"addPendingMutation",value:function(e){}},{key:"updateMutationState",value:function(e,t,n){}},{key:"addLocalQueryTarget",value:function(e){return this.Lr.er(e),this.Ur[e]||"not-current"}},{key:"updateQueryState",value:function(e,t,n){this.Ur[e]=t}},{key:"removeLocalQueryTarget",value:function(e){this.Lr.nr(e)}},{key:"isLocalQueryTarget",value:function(e){return this.Lr.activeTargetIds.has(e)}},{key:"clearQueryState",value:function(e){delete this.Ur[e]}},{key:"getAllActiveQueryTargets",value:function(){return this.Lr.activeTargetIds}},{key:"isActiveQueryTarget",value:function(e){return this.Lr.activeTargetIds.has(e)}},{key:"start",value:function(){return this.Lr=new Pf,Promise.resolve()}},{key:"handleUserChange",value:function(e,t,n){}},{key:"setOnlineState",value:function(e){}},{key:"shutdown",value:function(){}},{key:"writeSequenceNumber",value:function(e){}},{key:"notifyBundleLoaded",value:function(e){}}]),e}(),Uf=function(){function e(){f(this,e)}return p(e,[{key:"qr",value:function(e){}},{key:"shutdown",value:function(){}}]),e}(),Wf=function(){function e(){var t=this;f(this,e),this.Kr=function(){return t.Gr()},this.Qr=function(){return t.jr()},this.Wr=[],this.zr()}return p(e,[{key:"qr",value:function(e){this.Wr.push(e)}},{key:"shutdown",value:function(){window.removeEventListener("online",this.Kr),window.removeEventListener("offline",this.Qr)}},{key:"zr",value:function(){window.addEventListener("online",this.Kr),window.addEventListener("offline",this.Qr)}},{key:"Gr",value:function(){_i("ConnectivityMonitor","Network connectivity changed: AVAILABLE");var e,t=m(this.Wr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(0)}}catch(n){t.e(n)}finally{t.f()}}},{key:"jr",value:function(){_i("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");var e,t=m(this.Wr);try{for(t.s();!(e=t.n()).done;){(0,e.value)(1)}}catch(n){t.e(n)}finally{t.f()}}}],[{key:"C",value:function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}]),e}(),jf={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Zf=function(){function e(t){f(this,e),this.Hr=t.Hr,this.Jr=t.Jr}return p(e,[{key:"Yr",value:function(e){this.Xr=e}},{key:"Zr",value:function(e){this.eo=e}},{key:"onMessage",value:function(e){this.no=e}},{key:"close",value:function(){this.Jr()}},{key:"send",value:function(e){this.Hr(e)}},{key:"so",value:function(){this.Xr()}},{key:"io",value:function(e){this.eo(e)}},{key:"ro",value:function(e){this.no(e)}}]),e}(),Gf=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).forceLongPolling=e.forceLongPolling,r.autoDetectLongPolling=e.autoDetectLongPolling,r.useFetchStreams=e.useFetchStreams,r}return p(n,[{key:"lo",value:function(e,t,n,r){return new Promise((function(a,i){var o=new Ci;o.listenOnce(Vi.COMPLETE,(function(){try{switch(o.getLastErrorCode()){case ki.NO_ERROR:var t=o.getResponseJson();_i("Connection","XHR received:",JSON.stringify(t)),a(t);break;case ki.TIMEOUT:_i("Connection",'RPC "'+e+'" timed out'),i(new Bi(zi.DEADLINE_EXCEEDED,"Request time out"));break;case ki.HTTP_ERROR:var n=o.getStatus();if(_i("Connection",'RPC "'+e+'" failed with status:',n,"response text:",o.getResponseText()),n>0){var r=o.getResponseJson().error;if(r&&r.status&&r.message){var s=function(e){var t=e.toLowerCase().replace(/_/g,"-");return Object.values(zi).indexOf(t)>=0?t:zi.UNKNOWN}(r.status);i(new Bi(s,r.message))}else i(new Bi(zi.UNKNOWN,"Server responded with status "+o.getStatus()))}else i(new Bi(zi.UNAVAILABLE,"Connection failed."));break;default:Li()}}finally{_i("Connection",'RPC "'+e+'" completed.')}}));var s=JSON.stringify(r);o.send(t,"POST",s,n,15)}))}},{key:"_o",value:function(e,t,n){var r=[this.oo,"/","google.firestore.v1.Firestore","/",e,"/channel"],a=yi(),i=bi(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new Ii({})),this.ho(o.initMessageHeaders,t,n),o.encodeInitMessageHeaders=!0;var s=r.join("");_i("Connection","Creating WebChannel: "+s,o);var u=a.createWebChannel(s,o),c=!1,l=!1,h=new Zf({Hr:function(e){l?_i("Connection","Not sending because WebChannel is closed:",e):(c||(_i("Connection","Opening WebChannel transport."),u.open(),c=!0),_i("Connection","WebChannel sending:",e),u.send(e))},Jr:function(){return u.close()}}),f=function(e,t,n){e.listen(t,(function(e){try{n(e)}catch(e){setTimeout((function(){throw e}),0)}}))};return f(u,Si.EventType.OPEN,(function(){l||_i("Connection","WebChannel transport opened.")})),f(u,Si.EventType.CLOSE,(function(){l||(l=!0,_i("Connection","WebChannel transport closed"),h.io())})),f(u,Si.EventType.ERROR,(function(e){l||(l=!0,Fi("Connection","WebChannel transport errored:",e),h.io(new Bi(zi.UNAVAILABLE,"The operation could not be completed")))})),f(u,Si.EventType.MESSAGE,(function(e){var t;if(!l){var n=e.data[0];Mi(!!n);var r=n,a=r.error||(null===(t=r[0])||void 0===t?void 0:t.error);if(a){_i("Connection","WebChannel received error:",a);var i=a.status,o=function(e){var t=ju[e];if(void 0!==t)return Xu(t)}(i),s=a.message;void 0===o&&(o=zi.INTERNAL,s="Unknown error status: "+i+" with message "+a.message),l=!0,h.io(new Bi(o,s)),u.close()}else _i("Connection","WebChannel received:",n),h.ro(n)}})),f(i,xi.STAT_EVENT,(function(e){e.stat===wi.PROXY?_i("Connection","Detected buffering proxy"):e.stat===wi.NOPROXY&&_i("Connection","Detected no buffering proxy")})),setTimeout((function(){h.so()}),0),h}}]),n}(function(){function e(t){f(this,e),this.databaseInfo=t,this.databaseId=t.databaseId;var n=t.ssl?"https":"http";this.oo=n+"://"+t.host,this.uo="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return p(e,[{key:"co",value:function(e,t,n,r,a){var i=this.ao(e,t);_i("RestConnection","Sending: ",i,n);var o={};return this.ho(o,r,a),this.lo(e,i,o,n).then((function(e){return _i("RestConnection","Received: ",e),e}),(function(t){throw Fi("RestConnection","".concat(e," failed with error: "),t,"url: ",i,"request:",n),t}))}},{key:"fo",value:function(e,t,n,r,a,i){return this.co(e,t,n,r,a)}},{key:"ho",value:function(e,t,n){e["X-Goog-Api-Client"]="gl-js/ fire/"+Ni,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((function(t,n){return e[n]=t})),n&&n.headers.forEach((function(t,n){return e[n]=t}))}},{key:"ao",value:function(e,t){var n=jf[e];return"".concat(this.oo,"/v1/").concat(t,":").concat(n)}}]),e}());function Hf(){return"undefined"!=typeof window?window:null}function qf(){return"undefined"!=typeof document?document:null}function Kf(e){return new Vc(e,!0)}var Xf=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;f(this,e),this.Hs=t,this.timerId=n,this.wo=r,this.mo=a,this.yo=i,this.po=0,this.Io=null,this.To=Date.now(),this.reset()}return p(e,[{key:"reset",value:function(){this.po=0}},{key:"Eo",value:function(){this.po=this.yo}},{key:"Ao",value:function(e){var t=this;this.cancel();var n=Math.floor(this.po+this.Ro()),r=Math.max(0,Date.now()-this.To),a=Math.max(0,n-r);a>0&&_i("ExponentialBackoff","Backing off for ".concat(a," ms (base delay: ").concat(this.po," ms, delay with jitter: ").concat(n," ms, last attempt: ").concat(r," ms ago)")),this.Io=this.Hs.enqueueAfterDelay(this.timerId,a,(function(){return t.To=Date.now(),e()})),this.po*=this.mo,this.po<this.wo&&(this.po=this.wo),this.po>this.yo&&(this.po=this.yo)}},{key:"bo",value:function(){null!==this.Io&&(this.Io.skipDelay(),this.Io=null)}},{key:"cancel",value:function(){null!==this.Io&&(this.Io.cancel(),this.Io=null)}},{key:"Ro",value:function(){return(Math.random()-.5)*this.po}}]),e}(),Qf=function(){function e(t,n,r,a,i,o,s,u){f(this,e),this.Hs=t,this.Po=r,this.vo=a,this.Vo=i,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=s,this.listener=u,this.state=0,this.So=0,this.Do=null,this.Co=null,this.stream=null,this.xo=new Xf(t,n)}return p(e,[{key:"No",value:function(){return 1===this.state||5===this.state||this.ko()}},{key:"ko",value:function(){return 2===this.state||3===this.state}},{key:"start",value:function(){4!==this.state?this.auth():this.Mo()}},{key:"stop",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.No(),!e.t0){e.next=4;break}return e.next=4,this.close(0);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Oo",value:function(){this.state=0,this.xo.reset()}},{key:"Fo",value:function(){var e=this;this.ko()&&null===this.Do&&(this.Do=this.Hs.enqueueAfterDelay(this.Po,6e4,(function(){return e.$o()})))}},{key:"Bo",value:function(e){this.Lo(),this.stream.send(e)}},{key:"$o",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.ko()){e.next=2;break}return e.abrupt("return",this.close(0));case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Lo",value:function(){this.Do&&(this.Do.cancel(),this.Do=null)}},{key:"Uo",value:function(){this.Co&&(this.Co.cancel(),this.Co=null)}},{key:"close",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.Lo(),this.Uo(),this.xo.cancel(),this.So++,4!==t?this.xo.reset():n&&n.code===zi.RESOURCE_EXHAUSTED?(Di(n.toString()),Di("Using maximum backoff delay to prevent overloading the backend."),this.xo.Eo()):n&&n.code===zi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.qo(),this.stream.close(),this.stream=null),this.state=t,e.next=9,this.listener.Zr(n);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"qo",value:function(){}},{key:"auth",value:function(){var e=this;this.state=1;var t=this.Ko(this.So),n=this.So;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((function(t){var r=(0,l.Z)(t,2),a=r[0],i=r[1];e.So===n&&e.Go(a,i)}),(function(n){t((function(){var t=new Bi(zi.UNKNOWN,"Fetching auth token failed: "+n.message);return e.Qo(t)}))}))}},{key:"Go",value:function(e,t){var n=this,r=this.Ko(this.So);this.stream=this.jo(e,t),this.stream.Yr((function(){r((function(){return n.state=2,n.Co=n.Hs.enqueueAfterDelay(n.vo,1e4,(function(){return n.ko()&&(n.state=3),Promise.resolve()})),n.listener.Yr()}))})),this.stream.Zr((function(e){r((function(){return n.Qo(e)}))})),this.stream.onMessage((function(e){r((function(){return n.onMessage(e)}))}))}},{key:"Mo",value:function(){var e=this;this.state=5,this.xo.Ao(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:e.state=0,e.start();case 1:case"end":return t.stop()}}),t)}))))}},{key:"Qo",value:function(e){return _i("PersistentStream","close with error: ".concat(e)),this.stream=null,this.close(4,e)}},{key:"Ko",value:function(e){var t=this;return function(n){t.Hs.enqueueAndForget((function(){return t.So===e?n():(_i("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())}))}}}]),e}(),Yf=function(e){b(n,e);var t=w(n);function n(e,r,a,i,o,s){var u;return f(this,n),(u=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",r,a,i,s)).It=o,u}return p(n,[{key:"jo",value:function(e,t){return this.Vo._o("Listen",e,t)}},{key:"onMessage",value:function(e){this.xo.reset();var t=function(e,t){var n;if("targetChange"in t){t.targetChange;var r=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Li()}(t.targetChange.targetChangeType||"NO_CHANGE"),a=t.targetChange.targetIds||[],i=function(e,t){return e.gt?(Mi(void 0===t||"string"==typeof t),Go.fromBase64String(t||"")):(Mi(void 0===t||t instanceof Uint8Array),Go.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,s=o&&function(e){var t=void 0===e.code?zi.UNKNOWN:Xu(e.code);return new Bi(t,e.message||"")}(o);n=new pc(r,a,i,s||null)}else if("documentChange"in t){t.documentChange;var u=t.documentChange;u.document,u.document.name,u.document.updateTime;var c=Nc(e,u.document.name),l=Sc(u.document.updateTime),h=new Ss({mapValue:{fields:u.document.fields}}),f=Es.newFoundDocument(c,l,h),d=u.targetIds||[],p=u.removedTargetIds||[];n=new fc(d,p,f.key,f)}else if("documentDelete"in t){t.documentDelete;var v=t.documentDelete;v.document;var m=Nc(e,v.document),g=v.readTime?Sc(v.readTime):no.min(),y=Es.newNoDocument(m,g),b=v.removedTargetIds||[];n=new fc([],b,y.key,y)}else if("documentRemove"in t){t.documentRemove;var k=t.documentRemove;k.document;var V=Nc(e,k.document),x=k.removedTargetIds||[];n=new fc([],x,V,null)}else{if(!("filter"in t))return Li();t.filter;var w=t.filter;w.targetId;var I=w.count||0,S=new qu(I),C=w.targetId;n=new dc(C,S)}return n}(this.It,e),n=function(e){if(!("targetChange"in e))return no.min();var t=e.targetChange;return t.targetIds&&t.targetIds.length?no.min():t.readTime?Sc(t.readTime):no.min()}(e);return this.listener.Wo(t,n)}},{key:"zo",value:function(e){var t={};t.database=_c(this.It),t.addTarget=function(e,t){var n,r=t.target;return(n=_s(r)?{documents:zc(e,r)}:{query:Bc(e,r)}).targetId=t.targetId,t.resumeToken.approximateByteSize()>0?n.resumeToken=wc(e,t.resumeToken):t.snapshotVersion.compareTo(no.min())>0&&(n.readTime=xc(e,t.snapshotVersion.toTimestamp())),n}(this.It,e);var n=function(e,t){var n=function(e,t){switch(t){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Li()}}(0,t.purpose);return null==n?null:{"goog-listen-tags":n}}(this.It,e);n&&(t.labels=n),this.Bo(t)}},{key:"Ho",value:function(e){var t={};t.database=_c(this.It),t.removeTarget=e,this.Bo(t)}}]),n}(Qf),Jf=function(e){b(n,e);var t=w(n);function n(e,r,a,i,o,s){var u;return f(this,n),(u=t.call(this,e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",r,a,i,s)).It=o,u.Jo=!1,u}return p(n,[{key:"Yo",get:function(){return this.Jo}},{key:"start",value:function(){this.Jo=!1,this.lastStreamToken=void 0,kt(k(n.prototype),"start",this).call(this)}},{key:"qo",value:function(){this.Jo&&this.Xo([])}},{key:"jo",value:function(e,t){return this.Vo._o("Write",e,t)}},{key:"onMessage",value:function(e){if(Mi(!!e.streamToken),this.lastStreamToken=e.streamToken,this.Jo){this.xo.reset();var t=function(e,t){return e&&e.length>0?(Mi(void 0!==t),e.map((function(e){return function(e,t){var n=e.updateTime?Sc(e.updateTime):Sc(t);return n.isEqual(no.min())&&(n=Sc(t)),new Nu(n,e.transformResults||[])}(e,t)}))):[]}(e.writeResults,e.commitTime),n=Sc(e.commitTime);return this.listener.Zo(n,t)}return Mi(!e.writeResults||0===e.writeResults.length),this.Jo=!0,this.listener.tu()}},{key:"eu",value:function(){var e={};e.database=_c(this.It),this.Bo(e)}},{key:"Xo",value:function(e){var t=this,n={streamToken:this.lastStreamToken,writes:e.map((function(e){return Mc(t.It,e)}))};this.Bo(n)}}]),n}(Qf),$f=function(e){b(n,e);var t=w(n);function n(e,r,a,i){var o;return f(this,n),(o=t.call(this)).authCredentials=e,o.appCheckCredentials=r,o.Vo=a,o.It=i,o.nu=!1,o}return p(n,[{key:"su",value:function(){if(this.nu)throw new Bi(zi.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"co",value:function(e,t,n){var r=this;return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(a){var i=(0,l.Z)(a,2),o=i[0],s=i[1];return r.Vo.co(e,t,n,o,s)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===zi.UNAUTHENTICATED&&(r.authCredentials.invalidateToken(),r.appCheckCredentials.invalidateToken()),e):new Bi(zi.UNKNOWN,e.toString())}))}},{key:"fo",value:function(e,t,n,r){var a=this;return this.su(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((function(i){var o=(0,l.Z)(i,2),s=o[0],u=o[1];return a.Vo.fo(e,t,n,s,u,r)})).catch((function(e){throw"FirebaseError"===e.name?(e.code===zi.UNAUTHENTICATED&&(a.authCredentials.invalidateToken(),a.appCheckCredentials.invalidateToken()),e):new Bi(zi.UNKNOWN,e.toString())}))}},{key:"terminate",value:function(){this.nu=!0}}]),n}(function(){return p((function e(){f(this,e)}))}()),ed=function(){function e(t,n){f(this,e),this.asyncQueue=t,this.onlineStateHandler=n,this.state="Unknown",this.iu=0,this.ru=null,this.ou=!0}return p(e,[{key:"uu",value:function(){var e=this;0===this.iu&&(this.cu("Unknown"),this.ru=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(function(){return e.ru=null,e.au("Backend didn't respond within 10 seconds."),e.cu("Offline"),Promise.resolve()})))}},{key:"hu",value:function(e){"Online"===this.state?this.cu("Unknown"):(this.iu++,this.iu>=1&&(this.lu(),this.au("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.cu("Offline")))}},{key:"set",value:function(e){this.lu(),this.iu=0,"Online"===e&&(this.ou=!1),this.cu(e)}},{key:"cu",value:function(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}},{key:"au",value:function(e){var t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.ou?(Di(t),this.ou=!1):_i("OnlineStateTracker",t)}},{key:"lu",value:function(){null!==this.ru&&(this.ru.cancel(),this.ru=null)}}]),e}(),td=p((function e(t,n,r,a,i){var o=this;f(this,e),this.localStore=t,this.datastore=n,this.asyncQueue=r,this.remoteSyncer={},this.fu=[],this.du=new Map,this._u=new Set,this.wu=[],this.mu=i,this.mu.qr((function(e){r.enqueueAndForget(c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=fd(o),!e.t0){e.next=5;break}return _i("RemoteStore","Restarting streams for network reachability change."),e.next=5,function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Pi(t))._u.add(4),e.next=4,ad(n);case 4:return n.gu.set("Unknown"),n._u.delete(4),e.next=8,nd(n);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(o);case 5:case"end":return e.stop()}}),e)}))))})),this.gu=new ed(r,a)}));function nd(e){return rd.apply(this,arguments)}function rd(){return rd=c(s().mark((function e(t){var n,r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!fd(t)){e.next=18;break}n=m(t.wu),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a(!0);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[2,12,15,18]])}))),rd.apply(this,arguments)}function ad(e){return id.apply(this,arguments)}function id(){return id=c(s().mark((function e(t){var n,r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=m(t.wu),e.prev=1,n.s();case 3:if((r=n.n()).done){e.next=9;break}return a=r.value,e.next=7,a(!1);case 7:e.next=3;break;case 9:e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),n.e(e.t0);case 14:return e.prev=14,n.f(),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])}))),id.apply(this,arguments)}function od(e,t){var n=Pi(e);n.du.has(t.targetId)||(n.du.set(t.targetId,t),hd(n)?ld(n):Ud(n).ko()&&ud(n,t))}function sd(e,t){var n=Pi(e),r=Ud(n);n.du.delete(t),r.ko()&&cd(n,t),0===n.du.size&&(r.ko()?r.Fo():fd(n)&&n.gu.set("Unknown"))}function ud(e,t){e.yu.Ot(t.targetId),Ud(e).zo(t)}function cd(e,t){e.yu.Ot(t),Ud(e).Ho(t)}function ld(e){e.yu=new mc({getRemoteKeysForTarget:function(t){return e.remoteSyncer.getRemoteKeysForTarget(t)},se:function(t){return e.du.get(t)||null}}),Ud(e).start(),e.gu.uu()}function hd(e){return fd(e)&&!Ud(e).No()&&e.du.size>0}function fd(e){return 0===Pi(e)._u.size}function dd(e){e.yu=void 0}function pd(e){return vd.apply(this,arguments)}function vd(){return vd=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.du.forEach((function(e,n){ud(t,e)}));case 1:case"end":return e.stop()}}),e)}))),vd.apply(this,arguments)}function md(e,t){return gd.apply(this,arguments)}function gd(){return gd=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:dd(t),hd(t)?(t.gu.hu(n),ld(t)):t.gu.set("Unknown");case 1:case"end":return e.stop()}}),e)}))),gd.apply(this,arguments)}function yd(e,t,n){return bd.apply(this,arguments)}function bd(){return bd=c(s().mark((function e(t,n,r){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.gu.set("Online"),!(n instanceof pc&&2===n.state&&n.cause)){e.next=13;break}return e.prev=1,e.next=4,function(){var e=c(s().mark((function e(t,n){var r,a,i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=n.cause,a=m(n.targetIds),e.prev=2,a.s();case 4:if((i=a.n()).done){e.next=14;break}if(o=i.value,e.t0=t.du.has(o),!e.t0){e.next=12;break}return e.next=10,t.remoteSyncer.rejectListen(o,r);case 10:t.du.delete(o),t.yu.removeTarget(o);case 12:e.next=4;break;case 14:e.next=19;break;case 16:e.prev=16,e.t1=e.catch(2),a.e(e.t1);case 19:return e.prev=19,a.f(),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[2,16,19,22]])})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:e.next=11;break;case 6:return e.prev=6,e.t0=e.catch(1),_i("RemoteStore","Failed to remove targets %s: %s ",n.targetIds.join(","),e.t0),e.next=11,kd(t,e.t0);case 11:case 22:e.next=29;break;case 13:if(n instanceof fc?t.yu.Gt(n):n instanceof dc?t.yu.Yt(n):t.yu.Wt(n),r.isEqual(no.min())){e.next=29;break}return e.prev=14,e.next=17,mf(t.localStore);case 17:if(a=e.sent,e.t1=r.compareTo(a)>=0,!e.t1){e.next=22;break}return e.next=22,function(e,t){var n=e.yu.te(t);return n.targetChanges.forEach((function(n,r){if(n.resumeToken.approximateByteSize()>0){var a=e.du.get(r);a&&e.du.set(r,a.withResumeToken(n.resumeToken,t))}})),n.targetMismatches.forEach((function(t){var n=e.du.get(t);if(n){e.du.set(t,n.withResumeToken(Go.EMPTY_BYTE_STRING,n.snapshotVersion)),cd(e,t);var r=new Nl(n.target,t,1,n.sequenceNumber);ud(e,r)}})),e.remoteSyncer.applyRemoteEvent(n)}(t,r);case 24:return e.prev=24,e.t2=e.catch(14),_i("RemoteStore","Failed to raise snapshot:",e.t2),e.next=29,kd(t,e.t2);case 29:case"end":return e.stop()}}),e,null,[[1,6],[14,24]])}))),bd.apply(this,arguments)}function kd(e,t,n){return Vd.apply(this,arguments)}function Vd(){return Vd=c(s().mark((function e(t,n,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Eo(n)){e.next=2;break}throw n;case 2:return t._u.add(1),e.next=5,ad(t);case 5:t.gu.set("Offline"),r||(r=function(){return mf(t.localStore)}),t.asyncQueue.enqueueRetryable(c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _i("RemoteStore","Retrying IndexedDB access"),e.next=3,r();case 3:return t._u.delete(1),e.next=6,nd(t);case 6:case"end":return e.stop()}}),e)}))));case 8:case"end":return e.stop()}}),e)}))),Vd.apply(this,arguments)}function xd(e,t){return t().catch((function(n){return kd(e,n,t)}))}function wd(e){return Id.apply(this,arguments)}function Id(){return Id=c(s().mark((function e(t){var n,r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Pi(t),r=Wd(n),a=n.fu.length>0?n.fu[n.fu.length-1].batchId:-1;case 2:if(!Sd(n)){e.next=19;break}return e.prev=3,e.next=6,bf(n.localStore,a);case 6:if(null!==(i=e.sent)){e.next=10;break}return 0===n.fu.length&&r.Fo(),e.abrupt("break",19);case 10:a=i.batchId,Cd(n,i),e.next=17;break;case 13:return e.prev=13,e.t0=e.catch(3),e.next=17,kd(n,e.t0);case 17:e.next=2;break;case 19:Ed(n)&&Td(n);case 20:case"end":return e.stop()}}),e,null,[[3,13]])}))),Id.apply(this,arguments)}function Sd(e){return fd(e)&&e.fu.length<10}function Cd(e,t){e.fu.push(t);var n=Wd(e);n.ko()&&n.Yo&&n.Xo(t.mutations)}function Ed(e){return fd(e)&&!Wd(e).No()&&e.fu.length>0}function Td(e){Wd(e).start()}function Nd(e){return Ad.apply(this,arguments)}function Ad(){return Ad=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Wd(t).eu();case 1:case"end":return e.stop()}}),e)}))),Ad.apply(this,arguments)}function Rd(e){return _d.apply(this,arguments)}function _d(){return _d=c(s().mark((function e(t){var n,r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Wd(t),r=m(t.fu);try{for(r.s();!(a=r.n()).done;)i=a.value,n.Xo(i.mutations)}catch(o){r.e(o)}finally{r.f()}case 3:case"end":return e.stop()}}),e)}))),_d.apply(this,arguments)}function Dd(e,t,n){return Fd.apply(this,arguments)}function Fd(){return Fd=c(s().mark((function e(t,n,r){var a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.fu.shift(),i=El.from(a,n,r),e.next=3,xd(t,(function(){return t.remoteSyncer.applySuccessfulWrite(i)}));case 3:return e.next=5,wd(t);case 5:case"end":return e.stop()}}),e)}))),Fd.apply(this,arguments)}function Od(e,t){return Ld.apply(this,arguments)}function Ld(){return Ld=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=n&&Wd(t).Yo,!e.t0){e.next=4;break}return e.next=4,function(){var e=c(s().mark((function e(t,n){var r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!Ku(a=n.code)||a===zi.ABORTED){e.next=7;break}return r=t.fu.shift(),Wd(t).Oo(),e.next=5,xd(t,(function(){return t.remoteSyncer.rejectFailedWrite(r.batchId,n)}));case 5:return e.next=7,wd(t);case 7:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(t,n);case 4:Ed(t)&&Td(t);case 5:case"end":return e.stop()}}),e)}))),Ld.apply(this,arguments)}function Md(e,t){return Pd.apply(this,arguments)}function Pd(){return Pd=c(s().mark((function e(t,n){var r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(r=Pi(t)).asyncQueue.verifyOperationInProgress(),_i("RemoteStore","RemoteStore received new credentials"),a=fd(r),r._u.add(3),e.next=6,ad(r);case 6:return a&&r.gu.set("Unknown"),e.next=9,r.remoteSyncer.handleCredentialChange(n);case 9:return r._u.delete(3),e.next=12,nd(r);case 12:case"end":return e.stop()}}),e)}))),Pd.apply(this,arguments)}function zd(e,t){return Bd.apply(this,arguments)}function Bd(){return Bd=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Pi(t),!n){e.next=7;break}return r._u.delete(2),e.next=5,nd(r);case 5:e.next=13;break;case 7:if(e.t0=n,e.t0){e.next=13;break}return r._u.add(2),e.next=12,ad(r);case 12:r.gu.set("Unknown");case 13:case"end":return e.stop()}}),e)}))),Bd.apply(this,arguments)}function Ud(e){return e.pu||(e.pu=function(e,t,n){var r=Pi(e);return r.su(),new Yf(t,r.Vo,r.authCredentials,r.appCheckCredentials,r.It,n)}(e.datastore,e.asyncQueue,{Yr:pd.bind(null,e),Zr:md.bind(null,e),Wo:yd.bind(null,e)}),e.wu.push(function(){var t=c(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=4;break}e.pu.Oo(),hd(e)?ld(e):e.gu.set("Unknown"),t.next=7;break;case 4:return t.next=6,e.pu.stop();case 6:dd(e);case 7:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.pu}function Wd(e){return e.Iu||(e.Iu=function(e,t,n){var r=Pi(e);return r.su(),new Jf(t,r.Vo,r.authCredentials,r.appCheckCredentials,r.It,n)}(e.datastore,e.asyncQueue,{Yr:Nd.bind(null,e),Zr:Od.bind(null,e),tu:Rd.bind(null,e),Zo:Dd.bind(null,e)}),e.wu.push(function(){var t=c(s().mark((function t(n){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!n){t.next=6;break}return e.Iu.Oo(),t.next=4,wd(e);case 4:t.next=9;break;case 6:return t.next=8,e.Iu.stop();case 8:e.fu.length>0&&(_i("RemoteStore","Stopping write stream with ".concat(e.fu.length," pending writes")),e.fu=[]);case 9:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())),e.Iu}var jd=function(){function e(t,n,r,a,i){f(this,e),this.asyncQueue=t,this.timerId=n,this.targetTimeMs=r,this.op=a,this.removalCallback=i,this.deferred=new Ui,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((function(e){}))}return p(e,[{key:"start",value:function(e){var t=this;this.timerHandle=setTimeout((function(){return t.handleDelayElapsed()}),e)}},{key:"skipDelay",value:function(){return this.handleDelayElapsed()}},{key:"cancel",value:function(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Bi(zi.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}},{key:"handleDelayElapsed",value:function(){var e=this;this.asyncQueue.enqueueAndForget((function(){return null!==e.timerHandle?(e.clearTimeout(),e.op().then((function(t){return e.deferred.resolve(t)}))):Promise.resolve()}))}},{key:"clearTimeout",value:function(e){function t(){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}))}],[{key:"createAndSchedule",value:function(t,n,r,a,i){var o=new e(t,n,Date.now()+r,a,i);return o.start(r),o}}]),e}();function Zd(e,t){if(Di("AsyncQueue","".concat(t,": ").concat(e)),Eo(e))return new Bi(zi.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}var Gd=function(){function e(t){f(this,e),this.comparator=t?function(e,n){return t(e,n)||so.comparator(e.key,n.key)}:function(e,t){return so.comparator(e.key,t.key)},this.keyedMap=ec(),this.sortedSet=new Po(this.comparator)}return p(e,[{key:"has",value:function(e){return null!=this.keyedMap.get(e)}},{key:"get",value:function(e){return this.keyedMap.get(e)}},{key:"first",value:function(){return this.sortedSet.minKey()}},{key:"last",value:function(){return this.sortedSet.maxKey()}},{key:"isEmpty",value:function(){return this.sortedSet.isEmpty()}},{key:"indexOf",value:function(e){var t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}},{key:"size",get:function(){return this.sortedSet.size}},{key:"forEach",value:function(e){this.sortedSet.inorderTraversal((function(t,n){return e(t),!1}))}},{key:"add",value:function(e){var t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}},{key:"delete",value:function(e){var t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}},{key:"isEqual",value:function(t){if(!(t instanceof e))return!1;if(this.size!==t.size)return!1;for(var n=this.sortedSet.getIterator(),r=t.sortedSet.getIterator();n.hasNext();){var a=n.getNext().key,i=r.getNext().key;if(!a.isEqual(i))return!1}return!0}},{key:"toString",value:function(){var e=[];return this.forEach((function(t){e.push(t.toString())})),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}},{key:"copy",value:function(t,n){var r=new e;return r.comparator=this.comparator,r.keyedMap=t,r.sortedSet=n,r}}],[{key:"emptySet",value:function(t){return new e(t.comparator)}}]),e}(),Hd=function(){function e(){f(this,e),this.Tu=new Po(so.comparator)}return p(e,[{key:"track",value:function(e){var t=e.doc.key,n=this.Tu.get(t);n?0!==e.type&&3===n.type?this.Tu=this.Tu.insert(t,e):3===e.type&&1!==n.type?this.Tu=this.Tu.insert(t,{type:n.type,doc:e.doc}):2===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):2===e.type&&0===n.type?this.Tu=this.Tu.insert(t,{type:0,doc:e.doc}):1===e.type&&0===n.type?this.Tu=this.Tu.remove(t):1===e.type&&2===n.type?this.Tu=this.Tu.insert(t,{type:1,doc:n.doc}):0===e.type&&1===n.type?this.Tu=this.Tu.insert(t,{type:2,doc:e.doc}):Li():this.Tu=this.Tu.insert(t,e)}},{key:"Eu",value:function(){var e=[];return this.Tu.inorderTraversal((function(t,n){e.push(n)})),e}}]),e}(),qd=function(){function e(t,n,r,a,i,o,s,u){f(this,e),this.query=t,this.docs=n,this.oldDocs=r,this.docChanges=a,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=u}return p(e,[{key:"hasPendingWrites",get:function(){return!this.mutatedKeys.isEmpty()}},{key:"isEqual",value:function(e){if(!(this.fromCache===e.fromCache&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&ou(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;var t=this.docChanges,n=e.docChanges;if(t.length!==n.length)return!1;for(var r=0;r<t.length;r++)if(t[r].type!==n[r].type||!t[r].doc.isEqual(n[r].doc))return!1;return!0}}],[{key:"fromInitialDocuments",value:function(t,n,r,a){var i=[];return n.forEach((function(e){i.push({type:0,doc:e})})),new e(t,n,Gd.emptySet(n),i,r,a,!0,!1)}}]),e}(),Kd=p((function e(){f(this,e),this.Au=void 0,this.listeners=[]})),Xd=p((function e(){f(this,e),this.queries=new Qu((function(e){return su(e)}),ou),this.onlineState="Unknown",this.Ru=new Set}));function Qd(e,t){return Yd.apply(this,arguments)}function Yd(){return Yd=c(s().mark((function e(t,n){var r,a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Pi(t),a=n.query,i=!1,(o=r.queries.get(a))||(i=!0,o=new Kd),!i){e.next=13;break}return e.prev=3,e.next=6,r.onListen(a);case 6:o.Au=e.sent,e.next=13;break;case 9:return e.prev=9,e.t0=e.catch(3),u=Zd(e.t0,"Initialization of query '".concat(uu(n.query),"' failed")),e.abrupt("return",void n.onError(u));case 13:r.queries.set(a,o),o.listeners.push(n),n.bu(r.onlineState),o.Au&&n.Pu(o.Au)&&np(r);case 14:case"end":return e.stop()}}),e,null,[[3,9]])}))),Yd.apply(this,arguments)}function Jd(e,t){return $d.apply(this,arguments)}function $d(){return $d=c(s().mark((function e(t,n){var r,a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Pi(t),a=n.query,i=!1,(o=r.queries.get(a))&&(u=o.listeners.indexOf(n))>=0&&(o.listeners.splice(u,1),i=0===o.listeners.length),!i){e.next=6;break}return e.abrupt("return",(r.queries.delete(a),r.onUnlisten(a)));case 6:case"end":return e.stop()}}),e)}))),$d.apply(this,arguments)}function ep(e,t){var n,r=Pi(e),a=!1,i=m(t);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=o.query,u=r.queries.get(s);if(u){var c,l=m(u.listeners);try{for(l.s();!(c=l.n()).done;){c.value.Pu(o)&&(a=!0)}}catch(h){l.e(h)}finally{l.f()}u.Au=o}}}catch(h){i.e(h)}finally{i.f()}a&&np(r)}function tp(e,t,n){var r=Pi(e),a=r.queries.get(t);if(a){var i,o=m(a.listeners);try{for(o.s();!(i=o.n()).done;){i.value.onError(n)}}catch(s){o.e(s)}finally{o.f()}}r.queries.delete(t)}function np(e){e.Ru.forEach((function(e){e.next()}))}var rp=function(){function e(t,n,r){f(this,e),this.query=t,this.vu=n,this.Vu=!1,this.Su=null,this.onlineState="Unknown",this.options=r||{}}return p(e,[{key:"Pu",value:function(e){if(!this.options.includeMetadataChanges){var t,n=[],r=m(e.docChanges);try{for(r.s();!(t=r.n()).done;){var a=t.value;3!==a.type&&n.push(a)}}catch(o){r.e(o)}finally{r.f()}e=new qd(e.query,e.docs,e.oldDocs,n,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0)}var i=!1;return this.Vu?this.Du(e)&&(this.vu.next(e),i=!0):this.Cu(e,this.onlineState)&&(this.xu(e),i=!0),this.Su=e,i}},{key:"onError",value:function(e){this.vu.error(e)}},{key:"bu",value:function(e){this.onlineState=e;var t=!1;return this.Su&&!this.Vu&&this.Cu(this.Su,e)&&(this.xu(this.Su),t=!0),t}},{key:"Cu",value:function(e,t){if(!e.fromCache)return!0;var n="Offline"!==t;return(!this.options.Nu||!n)&&(!e.docs.isEmpty()||"Offline"===t)}},{key:"Du",value:function(e){if(e.docChanges.length>0)return!0;var t=this.Su&&this.Su.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}},{key:"xu",value:function(e){e=qd.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache),this.Vu=!0,this.vu.next(e)}}]),e}(),ap=function(){function e(t,n){f(this,e),this.payload=t,this.byteLength=n}return p(e,[{key:"ku",value:function(){return"metadata"in this.payload}}]),e}(),ip=function(){function e(t){f(this,e),this.It=t}return p(e,[{key:"Ji",value:function(e){return Nc(this.It,e)}},{key:"Yi",value:function(e){return e.metadata.exists?Oc(this.It,e.document,!1):Es.newNoDocument(this.Ji(e.metadata.name),this.Xi(e.metadata.readTime))}},{key:"Xi",value:function(e){return Sc(e)}}]),e}(),op=function(){function e(t,n,r){f(this,e),this.Mu=t,this.localStore=n,this.It=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=sp(t)}return p(e,[{key:"Ou",value:function(e){this.progress.bytesLoaded+=e.byteLength;var t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;var n=ao.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(n.get(n.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}},{key:"Fu",value:function(e){var t,n=new Map,r=new ip(this.It),a=m(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(i.metadata.queries){var o,s=r.Ji(i.metadata.name),u=m(i.metadata.queries);try{for(u.s();!(o=u.n()).done;){var c=o.value,l=(n.get(c)||sc()).add(s);n.set(c,l)}}catch(h){u.e(h)}finally{u.f()}}}}catch(h){a.e(h)}finally{a.f()}return n}},{key:"complete",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Ef(this.localStore,new ip(this.It),this.documents,this.Mu.id);case 2:t=e.sent,n=this.Fu(this.documents),r=m(this.queries),e.prev=5,r.s();case 7:if((a=r.n()).done){e.next=13;break}return i=a.value,e.next=11,Nf(this.localStore,i,n.get(i.name));case 11:e.next=7;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(5),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",(this.progress.taskState="Success",{progress:this.progress,$u:this.collectionGroups,Bu:t}));case 22:case"end":return e.stop()}}),e,this,[[5,15,18,21]])})));return function(){return e.apply(this,arguments)}}()}]),e}();function sp(e){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}var up=p((function e(t){f(this,e),this.key=t})),cp=p((function e(t){f(this,e),this.key=t})),lp=function(){function e(t,n){f(this,e),this.query=t,this.Lu=n,this.Uu=null,this.current=!1,this.qu=sc(),this.mutatedKeys=sc(),this.Ku=hu(t),this.Gu=new Gd(this.Ku)}return p(e,[{key:"Qu",get:function(){return this.Lu}},{key:"ju",value:function(e,t){var n=this,r=t?t.Wu:new Hd,a=t?t.Gu:this.Gu,i=t?t.mutatedKeys:this.mutatedKeys,o=a,s=!1,u="F"===this.query.limitType&&a.size===this.query.limit?a.last():null,c="L"===this.query.limitType&&a.size===this.query.limit?a.first():null;if(e.inorderTraversal((function(e,t){var l=a.get(e),h=cu(n.query,t)?t:null,f=!!l&&n.mutatedKeys.has(l.key),d=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;l&&h?l.data.isEqual(h.data)?f!==d&&(r.track({type:3,doc:h}),p=!0):n.zu(l,h)||(r.track({type:2,doc:h}),p=!0,(u&&n.Ku(h,u)>0||c&&n.Ku(h,c)<0)&&(s=!0)):!l&&h?(r.track({type:0,doc:h}),p=!0):l&&!h&&(r.track({type:1,doc:l}),p=!0,(u||c)&&(s=!0)),p&&(h?(o=o.add(h),i=d?i.add(e):i.delete(e)):(o=o.delete(e),i=i.delete(e)))})),null!==this.query.limit)for(;o.size>this.query.limit;){var l="F"===this.query.limitType?o.last():o.first();o=o.delete(l.key),i=i.delete(l.key),r.track({type:1,doc:l})}return{Gu:o,Wu:r,$i:s,mutatedKeys:i}}},{key:"zu",value:function(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}},{key:"applyChanges",value:function(e,t,n){var r=this,a=this.Gu;this.Gu=e.Gu,this.mutatedKeys=e.mutatedKeys;var i=e.Wu.Eu();i.sort((function(e,t){return function(e,t){var n=function(e){switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Li()}};return n(e)-n(t)}(e.type,t.type)||r.Ku(e.doc,t.doc)})),this.Hu(n);var o=t?this.Ju():[],s=0===this.qu.size&&this.current?1:0,u=s!==this.Uu;return this.Uu=s,0!==i.length||u?{snapshot:new qd(this.query,e.Gu,a,i,e.mutatedKeys,0===s,u,!1),Yu:o}:{Yu:o}}},{key:"bu",value:function(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({Gu:this.Gu,Wu:new Hd,mutatedKeys:this.mutatedKeys,$i:!1},!1)):{Yu:[]}}},{key:"Xu",value:function(e){return!this.Lu.has(e)&&!!this.Gu.has(e)&&!this.Gu.get(e).hasLocalMutations}},{key:"Hu",value:function(e){var t=this;e&&(e.addedDocuments.forEach((function(e){return t.Lu=t.Lu.add(e)})),e.modifiedDocuments.forEach((function(e){})),e.removedDocuments.forEach((function(e){return t.Lu=t.Lu.delete(e)})),this.current=e.current)}},{key:"Ju",value:function(){var e=this;if(!this.current)return[];var t=this.qu;this.qu=sc(),this.Gu.forEach((function(t){e.Xu(t.key)&&(e.qu=e.qu.add(t.key))}));var n=[];return t.forEach((function(t){e.qu.has(t)||n.push(new cp(t))})),this.qu.forEach((function(e){t.has(e)||n.push(new up(e))})),n}},{key:"Zu",value:function(e){this.Lu=e.Hi,this.qu=sc();var t=this.ju(e.documents);return this.applyChanges(t,!0)}},{key:"tc",value:function(){return qd.fromInitialDocuments(this.query,this.Gu,this.mutatedKeys,0===this.Uu)}}]),e}(),hp=p((function e(t,n,r){f(this,e),this.query=t,this.targetId=n,this.view=r})),fp=p((function e(t){f(this,e),this.key=t,this.ec=!1})),dp=function(){function e(t,n,r,a,i,o){f(this,e),this.localStore=t,this.remoteStore=n,this.eventManager=r,this.sharedClientState=a,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.nc={},this.sc=new Qu((function(e){return su(e)}),ou),this.ic=new Map,this.rc=new Set,this.oc=new Po(so.comparator),this.uc=new Map,this.cc=new Hh,this.ac={},this.hc=new Map,this.lc=xh.vn(),this.onlineState="Unknown",this.fc=void 0}return p(e,[{key:"isPrimaryClient",get:function(){return!0===this.fc}}]),e}();function pp(e,t){return vp.apply(this,arguments)}function vp(){return vp=c(s().mark((function e(t,n){var r,a,i,o,u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=sv(t),!(o=r.sc.get(n))){e.next=6;break}a=o.targetId,r.sharedClientState.addLocalQueryTarget(a),i=o.view.tc(),e.next=15;break;case 6:return e.next=8,kf(r.localStore,au(n));case 8:return u=e.sent,r.isPrimaryClient&&od(r.remoteStore,u),c=r.sharedClientState.addLocalQueryTarget(u.targetId),a=u.targetId,e.next=14,mp(r,n,a,"current"===c);case 14:i=e.sent;case 15:return e.abrupt("return",i);case 16:case"end":return e.stop()}}),e)}))),vp.apply(this,arguments)}function mp(e,t,n,r){return gp.apply(this,arguments)}function gp(){return gp=c(s().mark((function e(t,n,r,a){var i,o,u,l,h,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.dc=function(e,n,r){return function(){var e=c(s().mark((function e(t,n,r,a){var i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=n.view.ju(r),e.t0=i.$i,!e.t0){e.next=6;break}return e.next=5,wf(t.localStore,n.query,!1).then((function(e){var t=e.documents;return n.view.ju(t,i)}));case 5:i=e.sent;case 6:return o=a&&a.targetChanges.get(n.targetId),u=n.view.applyChanges(i,t.isPrimaryClient,o),e.abrupt("return",(Mp(t,n.targetId,u.Yu),u.snapshot));case 8:case"end":return e.stop()}}),e)})));return function(t,n,r,a){return e.apply(this,arguments)}}()(t,e,n,r)},e.next=3,wf(t.localStore,n,!0);case 3:return i=e.sent,o=new lp(n,i.Hi),u=o.ju(i.documents),l=hc.createSynthesizedTargetChangeForCurrentChange(r,a&&"Offline"!==t.onlineState),h=o.applyChanges(u,t.isPrimaryClient,l),Mp(t,r,h.Yu),f=new hp(n,r,o),e.abrupt("return",(t.sc.set(n,f),t.ic.has(r)?t.ic.get(r).push(n):t.ic.set(r,[n]),h.snapshot));case 11:case"end":return e.stop()}}),e)}))),gp.apply(this,arguments)}function yp(e,t){return bp.apply(this,arguments)}function bp(){return bp=c(s().mark((function e(t,n){var r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=Pi(t),a=r.sc.get(n),!((i=r.ic.get(a.targetId)).length>1)){e.next=3;break}return e.abrupt("return",(r.ic.set(a.targetId,i.filter((function(e){return!ou(e,n)}))),void r.sc.delete(n)));case 3:if(!r.isPrimaryClient){e.next=11;break}if(r.sharedClientState.removeLocalQueryTarget(a.targetId),e.t0=r.sharedClientState.isActiveQueryTarget(a.targetId),e.t0){e.next=9;break}return e.next=9,Vf(r.localStore,a.targetId,!1).then((function(){r.sharedClientState.clearQueryState(a.targetId),sd(r.remoteStore,a.targetId),Op(r,a.targetId)})).catch(ko);case 9:e.next=14;break;case 11:return Op(r,a.targetId),e.next=14,Vf(r.localStore,a.targetId,!0);case 14:case"end":return e.stop()}}),e)}))),bp.apply(this,arguments)}function kp(e,t,n){return Vp.apply(this,arguments)}function Vp(){return Vp=c(s().mark((function e(t,n,r){var a,i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=uv(t),e.prev=1,e.next=4,function(e,t){var n,r,a=Pi(e),i=to.now(),o=t.reduce((function(e,t){return e.add(t.key)}),sc());return a.persistence.runTransaction("Locally write mutations","readwrite",(function(e){var s=Ju(),u=sc();return a.Gi.getEntries(e,o).next((function(e){(s=e).forEach((function(e,t){t.isValidDocument()||(u=u.add(e))}))})).next((function(){return a.localDocuments.getOverlayedDocuments(e,s)})).next((function(r){n=r;var o,s=[],u=m(t);try{for(u.s();!(o=u.n()).done;){var c=o.value,l=Lu(c,n.get(c.key).overlayedDocument);null!=l&&s.push(new zu(c.key,l,Cs(l.value.mapValue),Au.exists(!0)))}}catch(h){u.e(h)}finally{u.f()}return a.mutationQueue.addMutationBatch(e,i,s,t)})).next((function(t){r=t;var i=t.applyToLocalDocumentSet(n,u);return a.documentOverlayCache.saveOverlays(e,t.batchId,i)}))})).then((function(){return{batchId:r.batchId,changes:tc(n)}}))}(a.localStore,n);case 4:return i=e.sent,a.sharedClientState.addPendingMutation(i.batchId),function(e,t,n){var r=e.ac[e.currentUser.toKey()];r||(r=new Po(Ji)),r=r.insert(t,n),e.ac[e.currentUser.toKey()]=r}(a,i.batchId,r),e.next=9,Bp(a,i.changes);case 9:return e.next=11,wd(a.remoteStore);case 11:e.next=17;break;case 13:e.prev=13,e.t0=e.catch(1),o=Zd(e.t0,"Failed to persist write"),r.reject(o);case 17:case"end":return e.stop()}}),e,null,[[1,13]])}))),Vp.apply(this,arguments)}function xp(e,t){return wp.apply(this,arguments)}function wp(){return wp=c(s().mark((function e(t,n){var r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Pi(t),e.prev=1,e.next=4,gf(r.localStore,n);case 4:return a=e.sent,n.targetChanges.forEach((function(e,t){var n=r.uc.get(t);n&&(Mi(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1),e.addedDocuments.size>0?n.ec=!0:e.modifiedDocuments.size>0?Mi(n.ec):e.removedDocuments.size>0&&(Mi(n.ec),n.ec=!1))})),e.next=8,Bp(r,a,n);case 8:e.next=14;break;case 10:return e.prev=10,e.t0=e.catch(1),e.next=14,ko(e.t0);case 14:case"end":return e.stop()}}),e,null,[[1,10]])}))),wp.apply(this,arguments)}function Ip(e,t,n){var r=Pi(e);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var a=[];r.sc.forEach((function(e,n){var r=n.view.bu(t);r.snapshot&&a.push(r.snapshot)})),function(e,t){var n=Pi(e);n.onlineState=t;var r=!1;n.queries.forEach((function(e,n){var a,i=m(n.listeners);try{for(i.s();!(a=i.n()).done;){a.value.bu(t)&&(r=!0)}}catch(o){i.e(o)}finally{i.f()}})),r&&np(n)}(r.eventManager,t),a.length&&r.nc.Wo(a),r.onlineState=t,r.isPrimaryClient&&r.sharedClientState.setOnlineState(t)}}function Sp(e,t,n){return Cp.apply(this,arguments)}function Cp(){return Cp=c(s().mark((function e(t,n,r){var a,i,o,u,c,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((a=Pi(t)).sharedClientState.updateQueryState(n,"rejected",r),i=a.uc.get(n),!(o=i&&i.key)){e.next=14;break}return u=(u=new Po(so.comparator)).insert(o,Es.newNoDocument(o,no.min())),c=sc().add(o),l=new lc(no.min(),new Map,new Uo(Ji),u,c),e.next=9,xp(a,l);case 9:a.oc=a.oc.remove(o),a.uc.delete(n),zp(a),e.next=16;break;case 14:return e.next=16,Vf(a.localStore,n,!1).then((function(){return Op(a,n,r)})).catch(ko);case 16:case"end":return e.stop()}}),e)}))),Cp.apply(this,arguments)}function Ep(e,t){return Tp.apply(this,arguments)}function Tp(){return Tp=c(s().mark((function e(t,n){var r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Pi(t),a=n.batch.batchId,e.prev=1,e.next=4,vf(r.localStore,n);case 4:return i=e.sent,Fp(r,a,null),Dp(r,a),r.sharedClientState.updateMutationState(a,"acknowledged"),e.next=10,Bp(r,i);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,ko(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Tp.apply(this,arguments)}function Np(e,t,n){return Ap.apply(this,arguments)}function Ap(){return Ap=c(s().mark((function e(t,n,r){var a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Pi(t),e.prev=1,e.next=4,function(e,t){var n=Pi(e);return n.persistence.runTransaction("Reject batch","readwrite-primary",(function(e){var r;return n.mutationQueue.lookupMutationBatch(e,t).next((function(t){return Mi(null!==t),r=t.keys(),n.mutationQueue.removeMutationBatch(e,t)})).next((function(){return n.mutationQueue.performConsistencyCheck(e)})).next((function(){return n.documentOverlayCache.removeOverlaysForBatchId(e,r,t)})).next((function(){return n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,r)})).next((function(){return n.localDocuments.getDocuments(e,r)}))}))}(a.localStore,n);case 4:return i=e.sent,Fp(a,n,r),Dp(a,n),a.sharedClientState.updateMutationState(n,"rejected",r),e.next=10,Bp(a,i);case 10:e.next=16;break;case 12:return e.prev=12,e.t0=e.catch(1),e.next=16,ko(e.t0);case 16:case"end":return e.stop()}}),e,null,[[1,12]])}))),Ap.apply(this,arguments)}function Rp(e,t){return _p.apply(this,arguments)}function _p(){return _p=c(s().mark((function e(t,n){var r,a,i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return fd((r=Pi(t)).remoteStore)||_i("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),e.prev=2,e.next=5,function(e){var t=Pi(e);return t.persistence.runTransaction("Get highest unacknowledged batch id","readonly",(function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)}))}(r.localStore);case 5:if(-1!==(a=e.sent)){e.next=8;break}return e.abrupt("return",void n.resolve());case 8:(i=r.hc.get(a)||[]).push(n),r.hc.set(a,i),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),o=Zd(e.t0,"Initialization of waitForPendingWrites() operation failed"),n.reject(o);case 16:case"end":return e.stop()}}),e,null,[[2,12]])}))),_p.apply(this,arguments)}function Dp(e,t){(e.hc.get(t)||[]).forEach((function(e){e.resolve()})),e.hc.delete(t)}function Fp(e,t,n){var r=Pi(e),a=r.ac[r.currentUser.toKey()];if(a){var i=a.get(t);i&&(n?i.reject(n):i.resolve(),a=a.remove(t)),r.ac[r.currentUser.toKey()]=a}}function Op(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);var r,a=m(e.ic.get(t));try{for(a.s();!(r=a.n()).done;){var i=r.value;e.sc.delete(i),n&&e.nc._c(i,n)}}catch(o){a.e(o)}finally{a.f()}e.ic.delete(t),e.isPrimaryClient&&e.cc.ls(t).forEach((function(t){e.cc.containsKey(t)||Lp(e,t)}))}function Lp(e,t){e.rc.delete(t.path.canonicalString());var n=e.oc.get(t);null!==n&&(sd(e.remoteStore,n),e.oc=e.oc.remove(t),e.uc.delete(n),zp(e))}function Mp(e,t,n){var r,a=m(n);try{for(a.s();!(r=a.n()).done;){var i=r.value;i instanceof up?(e.cc.addReference(i.key,t),Pp(e,i)):i instanceof cp?(_i("SyncEngine","Document no longer in limbo: "+i.key),e.cc.removeReference(i.key,t),e.cc.containsKey(i.key)||Lp(e,i.key)):Li()}}catch(o){a.e(o)}finally{a.f()}}function Pp(e,t){var n=t.key,r=n.path.canonicalString();e.oc.get(n)||e.rc.has(r)||(_i("SyncEngine","New document in limbo: "+n),e.rc.add(r),zp(e))}function zp(e){for(;e.rc.size>0&&e.oc.size<e.maxConcurrentLimboResolutions;){var t=e.rc.values().next().value;e.rc.delete(t);var n=new so(ao.fromString(t)),r=e.lc.next();e.uc.set(r,new fp(n)),e.oc=e.oc.insert(n,r),od(e.remoteStore,new Nl(au(Js(n.path)),r,2,Fo.at))}}function Bp(e,t,n){return Up.apply(this,arguments)}function Up(){return Up=c(s().mark((function e(t,n,r){var a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=Pi(t),i=[],o=[],u=[],e.t0=a.sc.isEmpty(),e.t0){e.next=9;break}return a.sc.forEach((function(e,t){u.push(a.dc(t,n,r).then((function(e){if(e){a.isPrimaryClient&&a.sharedClientState.updateQueryState(t.targetId,e.fromCache?"not-current":"current"),i.push(e);var n=cf.Ci(t.targetId,e);o.push(n)}})))})),e.next=6,Promise.all(u);case 6:return a.nc.Wo(i),e.next=9,function(){var e=c(s().mark((function e(t,n){var r,a,i,o,u,c,l,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Pi(t),e.prev=1,e.next=4,r.persistence.runTransaction("notifyLocalViewChanges","readwrite",(function(e){return xo.forEach(n,(function(t){return xo.forEach(t.Si,(function(n){return r.persistence.referenceDelegate.addReference(e,t.targetId,n)})).next((function(){return xo.forEach(t.Di,(function(n){return r.persistence.referenceDelegate.removeReference(e,t.targetId,n)}))}))}))}));case 4:e.next=11;break;case 6:if(e.prev=6,e.t0=e.catch(1),Eo(e.t0)){e.next=10;break}throw e.t0;case 10:_i("LocalStore","Failed to update sequence numbers: "+e.t0);case 11:a=m(n);try{for(a.s();!(i=a.n()).done;)o=i.value,u=o.targetId,o.fromCache||(c=r.Ui.get(u),l=c.snapshotVersion,h=c.withLastLimboFreeSnapshotVersion(l),r.Ui=r.Ui.insert(u,h))}catch(s){a.e(s)}finally{a.f()}case 13:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(t,n){return e.apply(this,arguments)}}()(a.localStore,o);case 9:case"end":return e.stop()}}),e)}))),Up.apply(this,arguments)}function Wp(e,t){return jp.apply(this,arguments)}function jp(){return jp=c(s().mark((function e(t,n){var r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=Pi(t)).currentUser.isEqual(n)){e.next=11;break}return _i("SyncEngine","User change. New user:",n.toKey()),e.next=5,df(r.localStore,n);case 5:return a=e.sent,r.currentUser=n,function(e,t){e.hc.forEach((function(e){e.forEach((function(e){e.reject(new Bi(zi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),e.hc.clear()}(r),r.sharedClientState.handleUserChange(n,a.removedBatchIds,a.addedBatchIds),e.next=11,Bp(r,a.ji);case 11:case"end":return e.stop()}}),e)}))),jp.apply(this,arguments)}function Zp(e,t){var n=Pi(e),r=n.uc.get(t);if(r&&r.ec)return sc().add(r.key);var a=sc(),i=n.ic.get(t);if(!i)return a;var o,s=m(i);try{for(s.s();!(o=s.n()).done;){var u=o.value,c=n.sc.get(u);a=a.unionWith(c.view.Qu)}}catch(l){s.e(l)}finally{s.f()}return a}function Gp(e,t){return Hp.apply(this,arguments)}function Hp(){return Hp=c(s().mark((function e(t,n){var r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Pi(t),e.next=3,wf(r.localStore,n.query,!0);case 3:return a=e.sent,i=n.view.Zu(a),e.abrupt("return",(r.isPrimaryClient&&Mp(r,n.targetId,i.Yu),i));case 6:case"end":return e.stop()}}),e)}))),Hp.apply(this,arguments)}function qp(e,t){return Kp.apply(this,arguments)}function Kp(){return Kp=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Pi(t),e.abrupt("return",Sf(r.localStore,n).then((function(e){return Bp(r,e)})));case 2:case"end":return e.stop()}}),e)}))),Kp.apply(this,arguments)}function Xp(e,t,n,r){return Qp.apply(this,arguments)}function Qp(){return Qp=c(s().mark((function e(t,n,r,a){var i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=Pi(t),e.next=3,function(e,t){var n=Pi(e),r=Pi(n.mutationQueue);return n.persistence.runTransaction("Lookup mutation documents","readonly",(function(e){return r.Tn(e,t).next((function(t){return t?n.localDocuments.getDocuments(e,t):xo.resolve(null)}))}))}(i.localStore,n);case 3:if(null===(o=e.sent)){e.next=15;break}if("pending"!==r){e.next=10;break}return e.next=8,wd(i.remoteStore);case 8:e.next=11;break;case 10:"acknowledged"===r||"rejected"===r?(Fp(i,n,a||null),Dp(i,n),function(e,t){Pi(Pi(e).mutationQueue).An(t)}(i.localStore,n)):Li();case 11:return e.next=13,Bp(i,o);case 13:e.next=16;break;case 15:_i("SyncEngine","Cannot apply mutation batch with id: "+n);case 16:case"end":return e.stop()}}),e)}))),Qp.apply(this,arguments)}function Yp(e,t){return Jp.apply(this,arguments)}function Jp(){return Jp=c(s().mark((function e(t,n){var r,a,i,o,u,c,l,h;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(sv(r=Pi(t)),uv(r),!0!==n||!0===r.fc){e.next=13;break}return a=r.sharedClientState.getAllActiveQueryTargets(),e.next=5,$p(r,a.toArray());case 5:return i=e.sent,r.fc=!0,e.next=9,zd(r.remoteStore,!0);case 9:o=m(i);try{for(o.s();!(u=o.n()).done;)c=u.value,od(r.remoteStore,c)}catch(s){o.e(s)}finally{o.f()}e.next=25;break;case 13:if(!1!==n||!1===r.fc){e.next=25;break}return l=[],h=Promise.resolve(),r.ic.forEach((function(e,t){r.sharedClientState.isLocalQueryTarget(t)?l.push(t):h=h.then((function(){return Op(r,t),Vf(r.localStore,t,!0)})),sd(r.remoteStore,t)})),e.next=19,h;case 19:return e.next=21,$p(r,l);case 21:return function(e){var t=Pi(e);t.uc.forEach((function(e,n){sd(t.remoteStore,n)})),t.cc.fs(),t.uc=new Map,t.oc=new Po(so.comparator)}(r),r.fc=!1,e.next=25,zd(r.remoteStore,!1);case 25:case"end":return e.stop()}}),e)}))),Jp.apply(this,arguments)}function $p(e,t,n){return ev.apply(this,arguments)}function ev(){return ev=c(s().mark((function e(t,n,r){var a,i,o,u,c,l,h,f,d,p,v,g,y,b;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Pi(t),i=[],o=[],u=m(n),e.prev=2,u.s();case 4:if((c=u.n()).done){e.next=45;break}if(l=c.value,h=void 0,!(f=a.ic.get(l))||0===f.length){e.next=34;break}return e.next=11,kf(a.localStore,au(f[0]));case 11:h=e.sent,d=m(f),e.prev=13,d.s();case 15:if((p=d.n()).done){e.next=24;break}return v=p.value,g=a.sc.get(v),e.next=20,Gp(a,g);case 20:(y=e.sent).snapshot&&o.push(y.snapshot);case 22:e.next=15;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(13),d.e(e.t0);case 29:return e.prev=29,d.f(),e.finish(29);case 32:e.next=42;break;case 34:return e.next=36,If(a.localStore,l);case 36:return b=e.sent,e.next=39,kf(a.localStore,b);case 39:return h=e.sent,e.next=42,mp(a,tv(b),l,!1);case 42:i.push(h);case 43:e.next=4;break;case 45:e.next=50;break;case 47:e.prev=47,e.t1=e.catch(2),u.e(e.t1);case 50:return e.prev=50,u.f(),e.finish(50);case 53:return e.abrupt("return",(a.nc.Wo(o),i));case 54:case"end":return e.stop()}}),e,null,[[2,47,50,53],[13,26,29,32]])}))),ev.apply(this,arguments)}function tv(e){return Ys(e.path,e.collectionGroup,e.orderBy,e.filters,e.limit,"F",e.startAt,e.endAt)}function nv(e){var t=Pi(e);return Pi(Pi(t.localStore).persistence).vi()}function rv(e,t,n,r){return av.apply(this,arguments)}function av(){return av=c(s().mark((function e(t,n,r,a){var i,o,u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(i=Pi(t)).fc){e.next=3;break}return e.abrupt("return",void _i("SyncEngine","Ignoring unexpected query state notification."));case 3:if(!((o=i.ic.get(n))&&o.length>0)){e.next=20;break}e.t0=r,e.next="current"===e.t0||"not-current"===e.t0?8:"rejected"===e.t0?15:19;break;case 8:return e.next=10,Sf(i.localStore,lu(o[0]));case 10:return u=e.sent,c=lc.createSynthesizedRemoteEventForCurrentChange(n,"current"===r),e.next=14,Bp(i,u,c);case 14:return e.abrupt("break",20);case 15:return e.next=17,Vf(i.localStore,n,!0);case 17:return Op(i,n,a),e.abrupt("break",20);case 19:Li();case 20:case"end":return e.stop()}}),e)}))),av.apply(this,arguments)}function iv(e,t,n){return ov.apply(this,arguments)}function ov(){return ov=c(s().mark((function e(t,n,r){var a,i,o,u,c,l,h,f,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(a=sv(t)).fc){e.next=45;break}i=m(n),e.prev=3,i.s();case 5:if((o=i.n()).done){e.next=21;break}if(u=o.value,!a.ic.has(u)){e.next=10;break}return _i("SyncEngine","Adding an already active target "+u),e.abrupt("continue",19);case 10:return e.next=12,If(a.localStore,u);case 12:return c=e.sent,e.next=15,kf(a.localStore,c);case 15:return l=e.sent,e.next=18,mp(a,tv(c),l.targetId,!1);case 18:od(a.remoteStore,l);case 19:e.next=5;break;case 21:e.next=26;break;case 23:e.prev=23,e.t0=e.catch(3),i.e(e.t0);case 26:return e.prev=26,i.f(),e.finish(26);case 29:h=m(r),e.prev=30,d=s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=f.value,e.t0=a.ic.has(t),!e.t0){e.next=5;break}return e.next=5,Vf(a.localStore,t,!1).then((function(){sd(a.remoteStore,t),Op(a,t)})).catch(ko);case 5:case"end":return e.stop()}}),e)})),h.s();case 33:if((f=h.n()).done){e.next=37;break}return e.delegateYield(d(),"t1",35);case 35:e.next=33;break;case 37:e.next=42;break;case 39:e.prev=39,e.t2=e.catch(30),h.e(e.t2);case 42:return e.prev=42,h.f(),e.finish(42);case 45:case"end":return e.stop()}}),e,null,[[3,23,26,29],[30,39,42,45]])}))),ov.apply(this,arguments)}function sv(e){var t=Pi(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=xp.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=Zp.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=Sp.bind(null,t),t.nc.Wo=ep.bind(null,t.eventManager),t.nc._c=tp.bind(null,t.eventManager),t}function uv(e){var t=Pi(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=Ep.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=Np.bind(null,t),t}function cv(e,t,n){var r=Pi(e);(function(){var e=c(s().mark((function e(t,n,r){var a,i,o,u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.getMetadata();case 3:return a=e.sent,e.next=6,function(e,t){var n=Pi(e),r=Sc(t.createTime);return n.persistence.runTransaction("hasNewerBundle","readonly",(function(e){return n.Ns.getBundleMetadata(e,t.id)})).then((function(e){return!!e&&e.createTime.compareTo(r)>=0}))}(t.localStore,a);case 6:if(!e.sent){e.next=11;break}return e.next=9,n.close();case 9:return r._completeWith(function(e){return{taskState:"Success",documentsLoaded:e.totalDocuments,bytesLoaded:e.totalBytes,totalDocuments:e.totalDocuments,totalBytes:e.totalBytes}}(a)),e.abrupt("return",Promise.resolve(new Set));case 11:return r._updateProgress(sp(a)),i=new op(a,t.localStore,n.It),e.next=15,n.wc();case 15:o=e.sent;case 16:if(!o){e.next=26;break}return e.next=19,i.Ou(o);case 19:return(u=e.sent)&&r._updateProgress(u),e.next=23,n.wc();case 23:o=e.sent;case 24:e.next=16;break;case 26:return e.next=28,i.complete();case 28:return c=e.sent,e.next=31,Bp(t,c.Bu,void 0);case 31:return e.next=33,function(e,t){var n=Pi(e);return n.persistence.runTransaction("Save bundle","readwrite",(function(e){return n.Ns.saveBundleMetadata(e,t)}))}(t.localStore,a);case 33:return r._completeWith(c.progress),e.abrupt("return",Promise.resolve(c.$u));case 37:return e.prev=37,e.t0=e.catch(0),e.abrupt("return",(Fi("SyncEngine","Loading bundle failed with ".concat(e.t0)),r._failWith(e.t0),Promise.resolve(new Set)));case 40:case"end":return e.stop()}}),e,null,[[0,37]])})));return function(t,n,r){return e.apply(this,arguments)}})()(r,t,n).then((function(e){r.sharedClientState.notifyBundleLoaded(e)}))}var lv=function(){function e(){f(this,e),this.synchronizeTabs=!1}return p(e,[{key:"initialize",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.It=Kf(t.databaseInfo.databaseId),this.sharedClientState=this.mc(t),this.persistence=this.gc(t),e.next=5,this.persistence.start();case 5:this.localStore=this.yc(t),this.gcScheduler=this.Ic(t,this.localStore),this.indexBackfillerScheduler=this.Tc(t,this.localStore);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Ic",value:function(e,t){return null}},{key:"Tc",value:function(e,t){return null}},{key:"yc",value:function(e){return ff(this.persistence,new lf,e.initialUser,this.It)}},{key:"gc",value:function(e){return new Jh(ef.Bs,this.It)}},{key:"mc",value:function(e){return new Bf}},{key:"terminate",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.gcScheduler&&this.gcScheduler.stop(),e.next=3,this.sharedClientState.shutdown();case 3:return e.next=5,this.persistence.shutdown();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),hv=function(e){b(n,e);var t=w(n);function n(e,r,a){var i;return f(this,n),(i=t.call(this)).Ec=e,i.cacheSizeBytes=r,i.forceOwnership=a,i.synchronizeTabs=!1,i}return p(n,[{key:"initialize",value:function(){var e=c(s().mark((function e(t){var r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,kt(k(n.prototype),"initialize",this).call(this,t);case 2:return e.next=4,this.Ec.initialize(this,t);case 4:return e.next=6,uv(this.Ec.syncEngine);case 6:return e.next=8,wd(this.Ec.remoteStore);case 8:return e.next=10,this.persistence.li((function(){return r.gcScheduler&&!r.gcScheduler.started&&r.gcScheduler.start(),r.indexBackfillerScheduler&&!r.indexBackfillerScheduler.started&&r.indexBackfillerScheduler.start(),Promise.resolve()}));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"yc",value:function(e){return ff(this.persistence,new lf,e.initialUser,this.It)}},{key:"Ic",value:function(e,t){var n=this.persistence.referenceDelegate.garbageCollector;return new Nh(n,e.asyncQueue,t)}},{key:"Tc",value:function(e,t){var n=new Do(t,this.persistence);return new _o(e.asyncQueue,n)}},{key:"gc",value:function(e){var t=uf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?ph.withCacheSize(this.cacheSizeBytes):ph.DEFAULT;return new af(this.synchronizeTabs,t,e.clientId,n,e.asyncQueue,Hf(),qf(),this.It,this.sharedClientState,!!this.forceOwnership)}},{key:"mc",value:function(e){return new Bf}}]),n}(lv),fv=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this,e,r,!1)).Ec=e,a.cacheSizeBytes=r,a.synchronizeTabs=!0,a}return p(n,[{key:"initialize",value:function(){var e=c(s().mark((function e(t){var r,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,kt(k(n.prototype),"initialize",this).call(this,t);case 2:if(r=this.Ec.syncEngine,e.t0=this.sharedClientState instanceof zf,!e.t0){e.next=8;break}return this.sharedClientState.syncEngine={Fr:Xp.bind(null,r),$r:rv.bind(null,r),Br:iv.bind(null,r),vi:nv.bind(null,r),Or:qp.bind(null,r)},e.next=8,this.sharedClientState.start();case 8:return e.next=10,this.persistence.li(function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Yp(a.Ec.syncEngine,t);case 2:a.gcScheduler&&(t&&!a.gcScheduler.started?a.gcScheduler.start():t||a.gcScheduler.stop()),a.indexBackfillerScheduler&&(t&&!a.indexBackfillerScheduler.started?a.indexBackfillerScheduler.start():t||a.indexBackfillerScheduler.stop());case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"mc",value:function(e){var t=Hf();if(!zf.C(t))throw new Bi(zi.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=uf(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new zf(t,e.asyncQueue,n,e.clientId,e.initialUser)}}]),n}(hv),dv=function(){function e(){f(this,e)}return p(e,[{key:"initialize",value:function(){var e=c(s().mark((function e(t,n){var r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=this.localStore,e.t0){e.next=12;break}return this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(n),this.remoteStore=this.createRemoteStore(n),this.eventManager=this.createEventManager(n),this.syncEngine=this.createSyncEngine(n,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(e){return Ip(r.syncEngine,e,1)},this.remoteStore.remoteSyncer.handleCredentialChange=Wp.bind(null,this.syncEngine),e.next=12,zd(this.remoteStore,this.syncEngine.isPrimaryClient);case 12:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"createEventManager",value:function(e){return new Xd}},{key:"createDatastore",value:function(e){var t,n=Kf(e.databaseInfo.databaseId),r=(t=e.databaseInfo,new Gf(t));return function(e,t,n,r){return new $f(e,t,n,r)}(e.authCredentials,e.appCheckCredentials,r,n)}},{key:"createRemoteStore",value:function(e){var t,n,r,a,i,o=this;return t=this.localStore,n=this.datastore,r=e.asyncQueue,a=function(e){return Ip(o.syncEngine,e,0)},i=Wf.C()?new Wf:new Uf,new td(t,n,r,a,i)}},{key:"createSyncEngine",value:function(e,t){return function(e,t,n,r,a,i,o){var s=new dp(e,t,n,r,a,i);return o&&(s.fc=!0),s}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}},{key:"terminate",value:function(){return function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Pi(t),_i("RemoteStore","RemoteStore shutting down."),n._u.add(5),e.next=5,ad(n);case 5:n.mu.shutdown(),n.gu.set("Unknown");case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(this.remoteStore)}}]),e}();function pv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10240,n=0;return{read:function(){return c(s().mark((function r(){var a;return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(!(n<e.byteLength)){r.next=3;break}return a={value:e.slice(n,n+t),done:!1},r.abrupt("return",(n+=t,a));case 3:return r.abrupt("return",{done:!0});case 4:case"end":return r.stop()}}),r)})))()},cancel:function(){return c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})))()},releaseLock:function(){},closed:Promise.reject("unimplemented")}}var vv=function(){function e(t){f(this,e),this.observer=t,this.muted=!1}return p(e,[{key:"next",value:function(e){this.observer.next&&this.Ac(this.observer.next,e)}},{key:"error",value:function(e){this.observer.error?this.Ac(this.observer.error,e):Di("Uncaught Error in snapshot listener:",e)}},{key:"Rc",value:function(){this.muted=!0}},{key:"Ac",value:function(e,t){var n=this;this.muted||setTimeout((function(){n.muted||e(t)}),0)}}]),e}(),mv=function(){function e(t,n){var r=this;f(this,e),this.bc=t,this.It=n,this.metadata=new Ui,this.buffer=new Uint8Array,this.Pc=new TextDecoder("utf-8"),this.vc().then((function(e){e&&e.ku()?r.metadata.resolve(e.payload.metadata):r.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             ".concat(JSON.stringify(null==e?void 0:e.payload))))}),(function(e){return r.metadata.reject(e)}))}return p(e,[{key:"close",value:function(){return this.bc.cancel()}},{key:"getMetadata",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.metadata.promise);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"wc",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getMetadata();case 2:return e.abrupt("return",this.vc());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"vc",value:function(){var e=c(s().mark((function e(){var t,n,r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.Vc();case 2:if(null!==(t=e.sent)){e.next=5;break}return e.abrupt("return",null);case 5:return n=this.Pc.decode(t),r=Number(n),isNaN(r)&&this.Sc("length string (".concat(n,") is not valid number")),e.next=9,this.Dc(r);case 9:return a=e.sent,e.abrupt("return",new ap(JSON.parse(a),t.length+r));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Cc",value:function(){return this.buffer.findIndex((function(e){return e==="{".charCodeAt(0)}))}},{key:"Vc",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.Cc()<0)){e.next=7;break}return e.next=3,this.xc();case 3:if(!e.sent){e.next=5;break}return e.abrupt("break",7);case 5:e.next=0;break;case 7:if(0!==this.buffer.length){e.next=9;break}return e.abrupt("return",null);case 9:return(t=this.Cc())<0&&this.Sc("Reached the end of bundle when a length string is expected."),n=this.buffer.slice(0,t),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Dc",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.buffer.length<t)){e.next=8;break}return e.next=3,this.xc();case 3:if(e.t0=e.sent,!e.t0){e.next=6;break}this.Sc("Reached the end of bundle when more is expected.");case 6:e.next=0;break;case 8:return n=this.Pc.decode(this.buffer.slice(0,t)),e.abrupt("return",(this.buffer=this.buffer.slice(t),n));case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"Sc",value:function(e){throw this.bc.cancel(),new Error("Invalid bundle format: ".concat(e))}},{key:"xc",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.bc.read();case 2:return(t=e.sent).done||((n=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),n.set(t.value,this.buffer.length),this.buffer=n),e.abrupt("return",t.done);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),gv=function(){function e(t){f(this,e),this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return p(e,[{key:"lookup",value:function(){var e=c(s().mark((function e(t){var n,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!(this.mutations.length>0)){e.next=2;break}throw new Bi(zi.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");case 2:return e.next=4,function(){var e=c(s().mark((function e(t,n){var r,a,i,o,u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Pi(t),a=_c(r.It)+"/documents",i={documents:n.map((function(e){return Tc(r.It,e)}))},e.next=5,r.fo("BatchGetDocuments",a,i,n.length);case 5:return o=e.sent,u=new Map,o.forEach((function(e){var t=Lc(r.It,e);u.set(t.key.toString(),t)})),c=[],e.abrupt("return",(n.forEach((function(e){var t=u.get(e.toString());Mi(!!t),c.push(t)})),c));case 10:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,t);case 4:return n=e.sent,e.abrupt("return",(n.forEach((function(e){return r.recordVersion(e)})),n));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"set",value:function(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"update",value:function(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(e){this.lastWriteError=e}this.writtenDocs.add(e.toString())}},{key:"delete",value:function(e){this.write(new Gu(e,this.precondition(e))),this.writtenDocs.add(e.toString())}},{key:"commit",value:function(){var e=c(s().mark((function e(){var t,n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.ensureCommitNotCalled(),!this.lastWriteError){e.next=2;break}throw this.lastWriteError;case 2:return t=this.readVersions,this.mutations.forEach((function(e){t.delete(e.key.toString())})),t.forEach((function(e,t){var r=so.fromPath(t);n.mutations.push(new Hu(r,n.precondition(r)))})),e.next=7,function(){var e=c(s().mark((function e(t,n){var r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=Pi(t),a=_c(r.It)+"/documents",i={writes:n.map((function(e){return Mc(r.It,e)}))},e.next=3,r.co("Commit",a,i);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()(this.datastore,this.mutations);case 7:this.committed=!0;case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"recordVersion",value:function(e){var t;if(e.isFoundDocument())t=e.version;else{if(!e.isNoDocument())throw Li();t=no.min()}var n=this.readVersions.get(e.key.toString());if(n){if(!t.isEqual(n))throw new Bi(zi.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}},{key:"precondition",value:function(e){var t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(no.min())?Au.exists(!1):Au.updateTime(t):Au.none()}},{key:"preconditionForUpdate",value:function(e){var t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(no.min()))throw new Bi(zi.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Au.updateTime(t)}return Au.exists(!0)}},{key:"write",value:function(e){this.ensureCommitNotCalled(),this.mutations.push(e)}},{key:"ensureCommitNotCalled",value:function(){}}]),e}(),yv=function(){function e(t,n,r,a,i){f(this,e),this.asyncQueue=t,this.datastore=n,this.options=r,this.updateFunction=a,this.deferred=i,this.Nc=r.maxAttempts,this.xo=new Xf(this.asyncQueue,"transaction_retry")}return p(e,[{key:"run",value:function(){this.Nc-=1,this.kc()}},{key:"kc",value:function(){var e=this;this.xo.Ao(c(s().mark((function t(){var n,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=new gv(e.datastore),(r=e.Mc(n))&&r.then((function(t){e.asyncQueue.enqueueAndForget((function(){return n.commit().then((function(){e.deferred.resolve(t)})).catch((function(t){e.Oc(t)}))}))})).catch((function(t){e.Oc(t)}));case 2:case"end":return t.stop()}}),t)}))))}},{key:"Mc",value:function(e){try{var t=this.updateFunction(e);return!ts(t)&&t.catch&&t.then?t:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(e){return this.deferred.reject(e),null}}},{key:"Oc",value:function(e){var t=this;this.Nc>0&&this.Fc(e)?(this.Nc-=1,this.asyncQueue.enqueueAndForget((function(){return t.kc(),Promise.resolve()}))):this.deferred.reject(e)}},{key:"Fc",value:function(e){if("FirebaseError"===e.name){var t=e.code;return"aborted"===t||"failed-precondition"===t||!Ku(t)}return!1}}]),e}(),bv=function(){function e(t,n,r,a){var i=this;f(this,e),this.authCredentials=t,this.appCheckCredentials=n,this.asyncQueue=r,this.databaseInfo=a,this.user=Ti.UNAUTHENTICATED,this.clientId=Yi.R(),this.authCredentialListener=function(){return Promise.resolve()},this.appCheckCredentialListener=function(){return Promise.resolve()},this.authCredentials.start(r,function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return _i("FirestoreClient","Received user=",t.uid),e.next=3,i.authCredentialListener(t);case 3:i.user=t;case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),this.appCheckCredentials.start(r,(function(e){return _i("FirestoreClient","Received new app check token=",e),i.appCheckCredentialListener(e,i.user)}))}return p(e,[{key:"getConfiguration",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100});case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setCredentialChangeListener",value:function(e){this.authCredentialListener=e}},{key:"setAppCheckTokenChangeListener",value:function(e){this.appCheckCredentialListener=e}},{key:"verifyNotTerminated",value:function(){if(this.asyncQueue.isShuttingDown)throw new Bi(zi.FAILED_PRECONDITION,"The client has already been terminated.")}},{key:"terminate",value:function(){var e=this;this.asyncQueue.enterRestrictedMode();var t=new Ui;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(c(s().mark((function n(){var r;return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,n.t0=e.onlineComponents,!n.t0){n.next=5;break}return n.next=5,e.onlineComponents.terminate();case 5:if(n.t1=e.offlineComponents,!n.t1){n.next=9;break}return n.next=9,e.offlineComponents.terminate();case 9:e.authCredentials.shutdown(),e.appCheckCredentials.shutdown(),t.resolve(),n.next=18;break;case 14:n.prev=14,n.t2=n.catch(0),r=Zd(n.t2,"Failed to shutdown persistence"),t.reject(r);case 18:case"end":return n.stop()}}),n,null,[[0,14]])})))),t.promise}}]),e}();function kv(e,t){return Vv.apply(this,arguments)}function Vv(){return Vv=c(s().mark((function e(t,n){var r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),_i("FirestoreClient","Initializing OfflineComponentProvider"),e.next=3,t.getConfiguration();case 3:return r=e.sent,e.next=6,n.initialize(r);case 6:a=r.initialUser,t.setCredentialChangeListener(function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=a.isEqual(t),e.t0){e.next=5;break}return e.next=4,df(n.localStore,t);case 4:a=t;case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),n.persistence.setDatabaseDeletedListener((function(){return t.terminate()})),t.offlineComponents=n;case 8:case"end":return e.stop()}}),e)}))),Vv.apply(this,arguments)}function xv(e,t){return wv.apply(this,arguments)}function wv(){return wv=c(s().mark((function e(t,n){var r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.asyncQueue.verifyOperationInProgress(),e.next=3,Iv(t);case 3:return r=e.sent,_i("FirestoreClient","Initializing OnlineComponentProvider"),e.next=7,t.getConfiguration();case 7:return a=e.sent,e.next=10,n.initialize(r,a);case 10:t.setCredentialChangeListener((function(e){return Md(n.remoteStore,e)})),t.setAppCheckTokenChangeListener((function(e,t){return Md(n.remoteStore,t)})),t.onlineComponents=n;case 13:case"end":return e.stop()}}),e)}))),wv.apply(this,arguments)}function Iv(e){return Sv.apply(this,arguments)}function Sv(){return Sv=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.offlineComponents,e.t0){e.next=5;break}return _i("FirestoreClient","Using default OfflineComponentProvider"),e.next=5,kv(t,new lv);case 5:return e.abrupt("return",t.offlineComponents);case 6:case"end":return e.stop()}}),e)}))),Sv.apply(this,arguments)}function Cv(e){return Ev.apply(this,arguments)}function Ev(){return Ev=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=t.onlineComponents,e.t0){e.next=5;break}return _i("FirestoreClient","Using default OnlineComponentProvider"),e.next=5,xv(t,new dv);case 5:return e.abrupt("return",t.onlineComponents);case 6:case"end":return e.stop()}}),e)}))),Ev.apply(this,arguments)}function Tv(e){return Iv(e).then((function(e){return e.persistence}))}function Nv(e){return Iv(e).then((function(e){return e.localStore}))}function Av(e){return Cv(e).then((function(e){return e.remoteStore}))}function Rv(e){return Cv(e).then((function(e){return e.syncEngine}))}function _v(e){return Dv.apply(this,arguments)}function Dv(){return Dv=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Cv(t);case 2:return n=e.sent,r=n.eventManager,e.abrupt("return",(r.onListen=pp.bind(null,n.syncEngine),r.onUnlisten=yp.bind(null,n.syncEngine),r));case 5:case"end":return e.stop()}}),e)}))),Dv.apply(this,arguments)}function Fv(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new Ui;return e.asyncQueue.enqueueAndForget(c(s().mark((function a(){return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=function(e,t,n,r,a){var i=new vv({next:function(i){t.enqueueAndForget((function(){return Jd(e,o)}));var s=i.docs.has(n);!s&&i.fromCache?a.reject(new Bi(zi.UNAVAILABLE,"Failed to get document because the client is offline.")):s&&i.fromCache&&r&&"server"===r.source?a.reject(new Bi(zi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):a.resolve(i)},error:function(e){return a.reject(e)}}),o=new rp(Js(n.path),i,{includeMetadataChanges:!0,Nu:!0});return Qd(e,o)},a.next=3,_v(e);case 3:return a.t1=a.sent,a.t2=e.asyncQueue,a.t3=t,a.t4=n,a.t5=r,a.abrupt("return",(0,a.t0)(a.t1,a.t2,a.t3,a.t4,a.t5));case 9:case"end":return a.stop()}}),a)})))),r.promise}function Ov(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=new Ui;return e.asyncQueue.enqueueAndForget(c(s().mark((function a(){return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.t0=function(e,t,n,r,a){var i=new vv({next:function(n){t.enqueueAndForget((function(){return Jd(e,o)})),n.fromCache&&"server"===r.source?a.reject(new Bi(zi.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):a.resolve(n)},error:function(e){return a.reject(e)}}),o=new rp(n,i,{includeMetadataChanges:!0,Nu:!0});return Qd(e,o)},a.next=3,_v(e);case 3:return a.t1=a.sent,a.t2=e.asyncQueue,a.t3=t,a.t4=n,a.t5=r,a.abrupt("return",(0,a.t0)(a.t1,a.t2,a.t3,a.t4,a.t5));case 9:case"end":return a.stop()}}),a)})))),r.promise}var Lv=new Map;function Mv(e,t,n){if(!n)throw new Bi(zi.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function Pv(e,t,n,r){if(!0===t&&!0===r)throw new Bi(zi.INVALID_ARGUMENT,"".concat(e," and ").concat(n," cannot be used together."))}function zv(e){if(!so.isDocumentKey(e))throw new Bi(zi.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function Bv(e){if(so.isDocumentKey(e))throw new Bi(zi.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function Uv(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";var t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}return"function"==typeof e?"a function":Li()}function Wv(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Bi(zi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=Uv(e);throw new Bi(zi.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(n))}return e}function jv(e,t){if(t<=0)throw new Bi(zi.INVALID_ARGUMENT,"Function ".concat(e,"() requires a positive number, but it was: ").concat(t,"."))}var Zv=function(){function e(t){var n;if(f(this,e),void 0===t.host){if(void 0!==t.ssl)throw new Bi(zi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(n=t.ssl)||void 0===n||n;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Bi(zi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Pv("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return p(e,[{key:"isEqual",value:function(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}]),e}(),Gv=function(){function e(t,n,r,a){f(this,e),this._authCredentials=t,this._appCheckCredentials=n,this._databaseId=r,this._app=a,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Zv({}),this._settingsFrozen=!1}return p(e,[{key:"app",get:function(){if(!this._app)throw new Bi(zi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}},{key:"_initialized",get:function(){return this._settingsFrozen}},{key:"_terminated",get:function(){return void 0!==this._terminateTask}},{key:"_setSettings",value:function(e){if(this._settingsFrozen)throw new Bi(zi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Zv(e),void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new ji;switch(e.type){case"gapi":var t=e.client;return new qi(t,e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Bi(zi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}},{key:"_getSettings",value:function(){return this._settings}},{key:"_freezeSettings",value:function(){return this._settingsFrozen=!0,this._settings}},{key:"_delete",value:function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}},{key:"toJSON",value:function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}},{key:"_terminate",value:function(){return function(e){var t=Lv.get(e);t&&(_i("ComponentProvider","Removing Datastore"),Lv.delete(e),t.terminate())}(this),Promise.resolve()}}]),e}();function Hv(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=(e=Wv(e,Gv))._getSettings();if("firestore.googleapis.com"!==i.host&&i.host!==t&&Fi("Host has been set in both settings() and useEmulator(), emulator host will be used"),e._setSettings(Object.assign(Object.assign({},i),{host:"".concat(t,":").concat(n),ssl:!1})),a.mockUserToken){var o,s;if("string"==typeof a.mockUserToken)o=a.mockUserToken,s=Ti.MOCK_USER;else{o=R(a.mockUserToken,null===(r=e._app)||void 0===r?void 0:r.options.projectId);var u=a.mockUserToken.sub||a.mockUserToken.user_id;if(!u)throw new Bi(zi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");s=new Ti(u)}e._authCredentials=new Zi(new Wi(o,s))}}var qv=function(){function e(t,n,r){f(this,e),this.converter=n,this._key=r,this.type="document",this.firestore=t}return p(e,[{key:"_path",get:function(){return this._key.path}},{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"path",get:function(){return this._key.path.canonicalString()}},{key:"parent",get:function(){return new Xv(this.firestore,this.converter,this._key.path.popLast())}},{key:"withConverter",value:function(t){return new e(this.firestore,t,this._key)}}]),e}(),Kv=function(){function e(t,n,r){f(this,e),this.converter=n,this._query=r,this.type="query",this.firestore=t}return p(e,[{key:"withConverter",value:function(t){return new e(this.firestore,t,this._query)}}]),e}(),Xv=function(e){b(n,e);var t=w(n);function n(e,r,a){var i;return f(this,n),(i=t.call(this,e,r,Js(a)))._path=a,i.type="collection",i}return p(n,[{key:"id",get:function(){return this._query.path.lastSegment()}},{key:"path",get:function(){return this._query.path.canonicalString()}},{key:"parent",get:function(){var e=this._path.popLast();return e.isEmpty()?null:new qv(this.firestore,null,new so(e))}},{key:"withConverter",value:function(e){return new n(this.firestore,e,this._path)}}]),n}(Kv);function Qv(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(e=G(e),Mv("collection","path",t),e instanceof Gv){var i=ao.fromString.apply(ao,[t].concat(r));return Bv(i),new Xv(e,null,i)}if(!(e instanceof qv||e instanceof Xv))throw new Bi(zi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(ao.fromString.apply(ao,[t].concat(r)));return Bv(o),new Xv(e.firestore,null,o)}function Yv(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];if(e=G(e),1===arguments.length&&(t=Yi.R()),Mv("doc","path",t),e instanceof Gv){var i=ao.fromString.apply(ao,[t].concat(r));return zv(i),new qv(e,null,new so(i))}if(!(e instanceof qv||e instanceof Xv))throw new Bi(zi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");var o=e._path.child(ao.fromString.apply(ao,[t].concat(r)));return zv(o),new qv(e.firestore,e instanceof Xv?e.converter:null,new so(o))}function Jv(e,t){return e=G(e),t=G(t),(e instanceof qv||e instanceof Xv)&&(t instanceof qv||t instanceof Xv)&&e.firestore===t.firestore&&e.path===t.path&&e.converter===t.converter}function $v(e,t){return e=G(e),t=G(t),e instanceof Kv&&t instanceof Kv&&e.firestore===t.firestore&&ou(e._query,t._query)&&e.converter===t.converter}var em=function(){function e(){var t=this;f(this,e),this.$c=Promise.resolve(),this.Bc=[],this.Lc=!1,this.Uc=[],this.qc=null,this.Kc=!1,this.Gc=!1,this.Qc=[],this.xo=new Xf(this,"async_queue_retry"),this.jc=function(){var e=qf();e&&_i("AsyncQueue","Visibility state changed to "+e.visibilityState),t.xo.bo()};var n=qf();n&&"function"==typeof n.addEventListener&&n.addEventListener("visibilitychange",this.jc)}return p(e,[{key:"isShuttingDown",get:function(){return this.Lc}},{key:"enqueueAndForget",value:function(e){this.enqueue(e)}},{key:"enqueueAndForgetEvenWhileRestricted",value:function(e){this.Wc(),this.zc(e)}},{key:"enterRestrictedMode",value:function(e){if(!this.Lc){this.Lc=!0,this.Gc=e||!1;var t=qf();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this.jc)}}},{key:"enqueue",value:function(e){var t=this;if(this.Wc(),this.Lc)return new Promise((function(){}));var n=new Ui;return this.zc((function(){return t.Lc&&t.Gc?Promise.resolve():(e().then(n.resolve,n.reject),n.promise)})).then((function(){return n.promise}))}},{key:"enqueueRetryable",value:function(e){var t=this;this.enqueueAndForget((function(){return t.Bc.push(e),t.Hc()}))}},{key:"Hc",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0===this.Bc.length){e.next=14;break}return e.prev=1,e.next=4,this.Bc[0]();case 4:this.Bc.shift(),this.xo.reset(),e.next=13;break;case 8:if(e.prev=8,e.t0=e.catch(1),Eo(e.t0)){e.next=12;break}throw e.t0;case 12:_i("AsyncQueue","Operation failed with retryable error: "+e.t0);case 13:this.Bc.length>0&&this.xo.Ao((function(){return t.Hc()}));case 14:case"end":return e.stop()}}),e,this,[[1,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"zc",value:function(e){var t=this,n=this.$c.then((function(){return t.Kc=!0,e().catch((function(e){t.qc=e,t.Kc=!1;var n=function(e){var t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}(e);throw Di("INTERNAL UNHANDLED ERROR: ",n),e})).then((function(e){return t.Kc=!1,e}))}));return this.$c=n,n}},{key:"enqueueAfterDelay",value:function(e,t,n){var r=this;this.Wc(),this.Qc.indexOf(e)>-1&&(t=0);var a=jd.createAndSchedule(this,e,t,n,(function(e){return r.Jc(e)}));return this.Uc.push(a),a}},{key:"Wc",value:function(){this.qc&&Li()}},{key:"verifyOperationInProgress",value:function(){}},{key:"Yc",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.$c,e.next=3,t;case 3:if(t!==this.$c){e.next=0;break}case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"Xc",value:function(e){var t,n=m(this.Uc);try{for(n.s();!(t=n.n()).done;){if(t.value.timerId===e)return!0}}catch(r){n.e(r)}finally{n.f()}return!1}},{key:"Zc",value:function(e){var t=this;return this.Yc().then((function(){t.Uc.sort((function(e,t){return e.targetTimeMs-t.targetTimeMs}));var n,r=m(t.Uc);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.skipDelay(),"all"!==e&&a.timerId===e)break}}catch(i){r.e(i)}finally{r.f()}return t.Yc()}))}},{key:"ta",value:function(e){this.Qc.push(e)}},{key:"Jc",value:function(e){var t=this.Uc.indexOf(e);this.Uc.splice(t,1)}}]),e}();function tm(e){return function(e,t){if("object"!=typeof e||null===e)return!1;var n,r=e,a=m(["next","error","complete"]);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i in r&&"function"==typeof r[i])return!0}}catch(o){a.e(o)}finally{a.f()}return!1}(e)}var nm=function(){function e(){f(this,e),this._progressObserver={},this._taskCompletionResolver=new Ui,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}return p(e,[{key:"onProgress",value:function(e,t,n){this._progressObserver={next:e,error:t,complete:n}}},{key:"catch",value:function(e){return this._taskCompletionResolver.promise.catch(e)}},{key:"then",value:function(e,t){return this._taskCompletionResolver.promise.then(e,t)}},{key:"_completeWith",value:function(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}},{key:"_failWith",value:function(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}},{key:"_updateProgress",value:function(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}}]),e}(),rm=function(e){b(n,e);var t=w(n);function n(e,r,a,i){var o;return f(this,n),(o=t.call(this,e,r,a,i)).type="firestore",o._queue=new em,o._persistenceKey=(null==i?void 0:i.name)||"[DEFAULT]",o}return p(n,[{key:"_terminate",value:function(){return this._firestoreClient||im(this),this._firestoreClient.terminate()}}]),n}(Gv);function am(e){return e._firestoreClient||im(e),e._firestoreClient.verifyNotTerminated(),e._firestoreClient}function im(e){var t,n=e._freezeSettings(),r=function(e,t,n,r){return new $o(e,t,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,n);e._firestoreClient=new bv(e._authCredentials,e._appCheckCredentials,e._queue,r)}function om(e,t,n){var r=new Ui;return e.asyncQueue.enqueue(c(s().mark((function a(){var i;return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,kv(e,n);case 3:return a.next=5,xv(e,t);case 5:r.resolve(),a.next=14;break;case 8:if(a.prev=8,a.t0=a.catch(0),function(e){return"FirebaseError"===e.name?e.code===zi.FAILED_PRECONDITION||e.code===zi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||(22===e.code||20===e.code||11===e.code)}(i=a.t0)){a.next=13;break}throw i;case 13:Fi("Error enabling offline persistence. Falling back to persistence disabled: "+i),r.reject(i);case 14:case"end":return a.stop()}}),a,null,[[0,8]])})))).then((function(){return r.promise}))}function sm(e){return function(e){return e.asyncQueue.enqueue(c(s().mark((function t(){var n,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Tv(e);case 2:return n=t.sent,t.next=5,Av(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!0),function(e){var t=Pi(e);return t._u.delete(0),nd(t)}(r)));case 7:case"end":return t.stop()}}),t)}))))}(am(e=Wv(e,rm)))}function um(e){return function(e){return e.asyncQueue.enqueue(c(s().mark((function t(){var n,r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Tv(e);case 2:return n=t.sent,t.next=5,Av(e);case 5:return r=t.sent,t.abrupt("return",(n.setNetworkEnabled(!1),function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(n=Pi(t))._u.add(0),e.next=4,ad(n);case 4:n.gu.set("Offline");case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(r)));case 7:case"end":return t.stop()}}),t)}))))}(am(e=Wv(e,rm)))}function cm(e,t){var n=am(e=Wv(e,rm)),r=new nm;return function(e,t,n,r){var a=function(e,t){return function(e,t){return new mv(e,t)}(function(e,t){if(e instanceof Uint8Array)return pv(e,t);if(e instanceof ArrayBuffer)return pv(new Uint8Array(e),t);if(e instanceof ReadableStream)return e.getReader();throw new Error("Source of `toByteStreamReader` has to be a ArrayBuffer or ReadableStream")}("string"==typeof e?(new TextEncoder).encode(e):e),t)}(n,Kf(t));e.asyncQueue.enqueueAndForget(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=cv,t.next=3,Rv(e);case 3:t.t1=t.sent,t.t2=a,t.t3=r,(0,t.t0)(t.t1,t.t2,t.t3);case 7:case"end":return t.stop()}}),t)}))))}(n,e._databaseId,t,r),r}function lm(e,t){return function(e,t){return e.asyncQueue.enqueue(c(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=function(e,t){var n=Pi(e);return n.persistence.runTransaction("Get named query","readonly",(function(e){return n.Ns.getNamedQuery(e,t)}))},n.next=3,Nv(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)}))))}(am(e=Wv(e,rm)),t).then((function(t){return t?new Kv(e,null,t.query):null}))}function hm(e){if(e._initialized||e._terminated)throw new Bi(zi.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var fm=function(){function e(){f(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];for(var a=0;a<n.length;++a)if(0===n[a].length)throw new Bi(zi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new oo(n)}return p(e,[{key:"isEqual",value:function(e){return this._internalPath.isEqual(e._internalPath)}}]),e}();var dm=function(){function e(t){f(this,e),this._byteString=t}return p(e,[{key:"toBase64",value:function(){return this._byteString.toBase64()}},{key:"toUint8Array",value:function(){return this._byteString.toUint8Array()}},{key:"toString",value:function(){return"Bytes(base64: "+this.toBase64()+")"}},{key:"isEqual",value:function(e){return this._byteString.isEqual(e._byteString)}}],[{key:"fromBase64String",value:function(t){try{return new e(Go.fromBase64String(t))}catch(t){throw new Bi(zi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}},{key:"fromUint8Array",value:function(t){return new e(Go.fromUint8Array(t))}}]),e}(),pm=p((function e(t){f(this,e),this._methodName=t})),vm=function(){function e(t,n){if(f(this,e),!isFinite(t)||t<-90||t>90)throw new Bi(zi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(n)||n<-180||n>180)throw new Bi(zi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+n);this._lat=t,this._long=n}return p(e,[{key:"latitude",get:function(){return this._lat}},{key:"longitude",get:function(){return this._long}},{key:"isEqual",value:function(e){return this._lat===e._lat&&this._long===e._long}},{key:"toJSON",value:function(){return{latitude:this._lat,longitude:this._long}}},{key:"_compareTo",value:function(e){return Ji(this._lat,e._lat)||Ji(this._long,e._long)}}]),e}(),mm=/^__.*__$/,gm=function(){function e(t,n,r){f(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return p(e,[{key:"toMutation",value:function(e,t){return null!==this.fieldMask?new zu(e,this.data,this.fieldMask,t,this.fieldTransforms):new Pu(e,this.data,t,this.fieldTransforms)}}]),e}(),ym=function(){function e(t,n,r){f(this,e),this.data=t,this.fieldMask=n,this.fieldTransforms=r}return p(e,[{key:"toMutation",value:function(e,t){return new zu(e,this.data,this.fieldMask,t,this.fieldTransforms)}}]),e}();function bm(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Li()}}var km=function(){function e(t,n,r,a,i,o){f(this,e),this.settings=t,this.databaseId=n,this.It=r,this.ignoreUndefinedProperties=a,void 0===i&&this.ea(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return p(e,[{key:"path",get:function(){return this.settings.path}},{key:"na",get:function(){return this.settings.na}},{key:"sa",value:function(t){return new e(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.It,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}},{key:"ia",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.sa({path:n,ra:!1});return r.oa(e),r}},{key:"ua",value:function(e){var t,n=null===(t=this.path)||void 0===t?void 0:t.child(e),r=this.sa({path:n,ra:!1});return r.ea(),r}},{key:"ca",value:function(e){return this.sa({path:void 0,ra:!0})}},{key:"aa",value:function(e){return Bm(e,this.settings.methodName,this.settings.ha||!1,this.path,this.settings.la)}},{key:"contains",value:function(e){return void 0!==this.fieldMask.find((function(t){return e.isPrefixOf(t)}))||void 0!==this.fieldTransforms.find((function(t){return e.isPrefixOf(t.field)}))}},{key:"ea",value:function(){if(this.path)for(var e=0;e<this.path.length;e++)this.oa(this.path.get(e))}},{key:"oa",value:function(e){if(0===e.length)throw this.aa("Document fields must not be empty");if(bm(this.na)&&mm.test(e))throw this.aa('Document fields cannot begin and end with "__"')}}]),e}(),Vm=function(){function e(t,n,r){f(this,e),this.databaseId=t,this.ignoreUndefinedProperties=n,this.It=r||Kf(t)}return p(e,[{key:"fa",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new km({na:e,methodName:t,la:n,path:oo.emptyPath(),ra:!1,ha:r},this.databaseId,this.It,this.ignoreUndefinedProperties)}}]),e}();function xm(e){var t=e._freezeSettings(),n=Kf(e._databaseId);return new Vm(e._databaseId,!!t.ignoreUndefinedProperties,n)}function wm(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},o=e.fa(i.merge||i.mergeFields?2:0,t,n,a);Lm("Data must be an object, but it was:",o,r);var s,u,c=Fm(r,o);if(i.merge)s=new Zo(o.fieldMask),u=o.fieldTransforms;else if(i.mergeFields){var l,h=[],f=m(i.mergeFields);try{for(f.s();!(l=f.n()).done;){var d=l.value,p=Mm(t,d,n);if(!o.contains(p))throw new Bi(zi.INVALID_ARGUMENT,"Field '".concat(p,"' is specified in your field mask but missing from your input data."));Um(h,p)||h.push(p)}}catch(v){f.e(v)}finally{f.f()}s=new Zo(h),u=o.fieldTransforms.filter((function(e){return s.covers(e.field)}))}else s=null,u=o.fieldTransforms;return new gm(new Ss(c),s,u)}var Im=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_toFieldTransform",value:function(e){if(2!==e.na)throw 1===e.na?e.aa("".concat(this._methodName,"() can only appear at the top level of your update data")):e.aa("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(pm);function Sm(e,t,n){return new km({na:3,la:t.settings.la,methodName:e._methodName,ra:n},t.databaseId,t.It,t.ignoreUndefinedProperties)}var Cm=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"_toFieldTransform",value:function(e){return new Tu(e.path,new ku)}},{key:"isEqual",value:function(e){return e instanceof n}}]),n}(pm),Em=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this,e)).da=r,a}return p(n,[{key:"_toFieldTransform",value:function(e){var t=Sm(this,e,!0),n=this.da.map((function(e){return Dm(e,t)})),r=new Vu(n);return new Tu(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(pm),Tm=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this,e)).da=r,a}return p(n,[{key:"_toFieldTransform",value:function(e){var t=Sm(this,e,!0),n=this.da.map((function(e){return Dm(e,t)})),r=new wu(n);return new Tu(e.path,r)}},{key:"isEqual",value:function(e){return this===e}}]),n}(pm),Nm=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this,e))._a=r,a}return p(n,[{key:"_toFieldTransform",value:function(e){var t=new Su(e.It,vu(e.It,this._a));return new Tu(e.path,t)}},{key:"isEqual",value:function(e){return this===e}}]),n}(pm);function Am(e,t,n,r){var a=e.fa(1,t,n);Lm("Data must be an object, but it was:",a,r);var i=[],o=Ss.empty();Lo(r,(function(e,r){var s=zm(t,e,n);r=G(r);var u=a.ua(s);if(r instanceof Im)i.push(s);else{var c=Dm(r,u);null!=c&&(i.push(s),o.set(s,c))}}));var s=new Zo(i);return new ym(o,s,a.fieldTransforms)}function Rm(e,t,n,r,a,i){var o=e.fa(1,t,n),s=[Mm(t,r,n)],u=[a];if(i.length%2!=0)throw new Bi(zi.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(var c=0;c<i.length;c+=2)s.push(Mm(t,i[c])),u.push(i[c+1]);for(var l=[],h=Ss.empty(),f=s.length-1;f>=0;--f)if(!Um(l,s[f])){var d=s[f],p=u[f];p=G(p);var v=o.ua(d);if(p instanceof Im)l.push(d);else{var m=Dm(p,v);null!=m&&(l.push(d),h.set(d,m))}}var g=new Zo(l);return new ym(h,g,o.fieldTransforms)}function _m(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return Dm(n,e.fa(r?4:3,t))}function Dm(e,t){if(Om(e=G(e)))return Lm("Unsupported field value:",t,e),Fm(e,t);if(e instanceof pm)return function(e,t){if(!bm(t.na))throw t.aa("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.aa("".concat(e._methodName,"() is not currently supported inside arrays"));var n=e._toFieldTransform(t);n&&t.fieldTransforms.push(n)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.ra&&4!==t.na)throw t.aa("Nested arrays are not supported");return function(e,t){var n,r=[],a=0,i=m(e);try{for(i.s();!(n=i.n()).done;){var o=Dm(n.value,t.ca(a));null==o&&(o={nullValue:"NULL_VALUE"}),r.push(o),a++}}catch(s){i.e(s)}finally{i.f()}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=G(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return vu(t.It,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){var n=to.fromDate(e);return{timestampValue:xc(t.It,n)}}if(e instanceof to){var r=new to(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:xc(t.It,r)}}if(e instanceof vm)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof dm)return{bytesValue:wc(t.It,e._byteString)};if(e instanceof qv){var a=t.databaseId,i=e.firestore._databaseId;if(!i.isEqual(a))throw t.aa("Document reference is for database ".concat(i.projectId,"/").concat(i.database," but should be for database ").concat(a.projectId,"/").concat(a.database));return{referenceValue:Cc(e.firestore._databaseId||t.databaseId,e._key.path)}}throw t.aa("Unsupported field value: ".concat(Uv(e)))}(e,t)}function Fm(e,t){var n={};return Mo(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):Lo(e,(function(e,r){var a=Dm(r,t.ia(e));null!=a&&(n[e]=a)})),{mapValue:{fields:n}}}function Om(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof to||e instanceof vm||e instanceof dm||e instanceof qv||e instanceof pm)}function Lm(e,t,n){if(!Om(n)||!function(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}(n)){var r=Uv(n);throw"an object"===r?t.aa(e+" a custom object"):t.aa(e+" "+r)}}function Mm(e,t,n){if((t=G(t))instanceof fm)return t._internalPath;if("string"==typeof t)return zm(e,t);throw Bm("Field path arguments must be of type string or ",e,!1,void 0,n)}var Pm=new RegExp("[~\\*/\\[\\]]");function zm(e,t,n){if(t.search(Pm)>=0)throw Bm("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,n);try{return I(fm,(0,H.Z)(t.split(".")))._internalPath}catch(r){throw Bm("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,n)}}function Bm(e,t,n,r,a){var i=r&&!r.isEmpty(),o=void 0!==a,s="Function ".concat(t,"() called with invalid data");n&&(s+=" (via `toFirestore()`)"),s+=". ";var u="";return(i||o)&&(u+=" (found",i&&(u+=" in field ".concat(r)),o&&(u+=" in document ".concat(a)),u+=")"),new Bi(zi.INVALID_ARGUMENT,s+e+u)}function Um(e,t){return e.some((function(e){return e.isEqual(t)}))}var Wm=function(){function e(t,n,r,a,i){f(this,e),this._firestore=t,this._userDataWriter=n,this._key=r,this._document=a,this._converter=i}return p(e,[{key:"id",get:function(){return this._key.path.lastSegment()}},{key:"ref",get:function(){return new qv(this._firestore,this._converter,this._key)}},{key:"exists",value:function(){return null!==this._document}},{key:"data",value:function(){if(this._document){if(this._converter){var e=new jm(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}},{key:"get",value:function(e){if(this._document){var t=this._document.data.field(Zm("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}]),e}(),jm=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"data",value:function(){return kt(k(n.prototype),"data",this).call(this)}}]),n}(Wm);function Zm(e,t){return"string"==typeof t?zm(e,t):t instanceof fm?t._internalPath:t._delegate._internalPath}var Gm=function(){function e(t,n){f(this,e),this.hasPendingWrites=t,this.fromCache=n}return p(e,[{key:"isEqual",value:function(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}]),e}(),Hm=function(e){b(n,e);var t=w(n);function n(e,r,a,i,o,s){var u;return f(this,n),(u=t.call(this,e,r,a,i,s))._firestore=e,u._firestoreImpl=e,u.metadata=o,u}return p(n,[{key:"exists",value:function(){return kt(k(n.prototype),"exists",this).call(this)}},{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){var t=new qm(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){var n=this._document.data.field(Zm("DocumentSnapshot.get",e));if(null!==n)return this._userDataWriter.convertValue(n,t.serverTimestamps)}}}]),n}(Wm),qm=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"data",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return kt(k(n.prototype),"data",this).call(this,e)}}]),n}(Hm),Km=function(){function e(t,n,r,a){f(this,e),this._firestore=t,this._userDataWriter=n,this._snapshot=a,this.metadata=new Gm(a.hasPendingWrites,a.fromCache),this.query=r}return p(e,[{key:"docs",get:function(){var e=[];return this.forEach((function(t){return e.push(t)})),e}},{key:"size",get:function(){return this._snapshot.docs.size}},{key:"empty",get:function(){return 0===this.size}},{key:"forEach",value:function(e,t){var n=this;this._snapshot.docs.forEach((function(r){e.call(t,new qm(n._firestore,n._userDataWriter,r.key,r,new Gm(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))}))}},{key:"docChanges",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new Bi(zi.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===t||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){var n=0;return e._snapshot.docChanges.map((function(t){return{type:"added",doc:new qm(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Gm(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),oldIndex:-1,newIndex:n++}}))}var r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter((function(e){return t||3!==e.type})).map((function(t){var n=new qm(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Gm(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter),a=-1,i=-1;return 0!==t.type&&(a=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(i=(r=r.add(t.doc)).indexOf(t.doc.key)),{type:Xm(t.type),doc:n,oldIndex:a,newIndex:i}}))}(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}}]),e}();function Xm(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Li()}}function Qm(e,t){return e instanceof Hm&&t instanceof Hm?e._firestore===t._firestore&&e._key.isEqual(t._key)&&(null===e._document?null===t._document:e._document.isEqual(t._document))&&e._converter===t._converter:e instanceof Km&&t instanceof Km&&e._firestore===t._firestore&&$v(e.query,t.query)&&e.metadata.isEqual(t.metadata)&&e._snapshot.isEqual(t._snapshot)}function Ym(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Bi(zi.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Jm=p((function e(){f(this,e)}));function $m(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];e=o._apply(e)}return e}var eg=function(e){b(n,e);var t=w(n);function n(e,r,a){var i;return f(this,n),(i=t.call(this)).wa=e,i.ma=r,i.ga=a,i.type="where",i}return p(n,[{key:"_apply",value:function(e){var t=xm(e.firestore),n=function(e,t,n,r,a,i,o){var s;if(a.isKeyField()){if("array-contains"===i||"array-contains-any"===i)throw new Bi(zi.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(i,"' queries on documentId()."));if("in"===i||"not-in"===i){hg(o,i);var u,c=[],l=m(o);try{for(l.s();!(u=l.n()).done;){var h=u.value;c.push(lg(r,e,h))}}catch(d){l.e(d)}finally{l.f()}s={arrayValue:{values:c}}}else s=lg(r,e,o)}else"in"!==i&&"not-in"!==i&&"array-contains-any"!==i||hg(o,i),s=_m(n,"where",o,"in"===i||"not-in"===i);var f=Ls.create(a,i,s);return function(e,t){if(t.dt()){var n=tu(e);if(null!==n&&!n.isEqual(t.field))throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '".concat(n.toString(),"' and '").concat(t.field.toString(),"'"));var r=eu(e);null!==r&&fg(e,t.field,r)}var a=function(e,t){var n,r=m(e.filters);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(t.indexOf(a.op)>=0)return a.op}}catch(d){r.e(d)}finally{r.f()}return null}(e,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==a)throw a===t.op?new Bi(zi.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new Bi(zi.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(a.toString(),"' filters."))}(e,f),f}(e._query,0,t,e.firestore._databaseId,this.wa,this.ma,this.ga);return new Kv(e.firestore,e.converter,function(e,t){var n=e.filters.concat([t]);return new Qs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),n,e.limit,e.limitType,e.startAt,e.endAt)}(e._query,n))}}]),n}(Jm);var tg=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).wa=e,a.ya=r,a.type="orderBy",a}return p(n,[{key:"_apply",value:function(e){var t=function(e,t,n){if(null!==e.startAt)throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new Hs(t,n);return function(e,t){if(null===eu(e)){var n=tu(e);null!==n&&fg(e,n,t.field)}}(e,r),r}(e._query,this.wa,this.ya);return new Kv(e.firestore,e.converter,function(e,t){var n=e.explicitOrderBy.concat([t]);return new Qs(e.path,e.collectionGroup,n,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}]),n}(Jm);var ng=function(e){b(n,e);var t=w(n);function n(e,r,a){var i;return f(this,n),(i=t.call(this)).type=e,i.pa=r,i.Ia=a,i}return p(n,[{key:"_apply",value:function(e){return new Kv(e.firestore,e.converter,iu(e._query,this.pa,this.Ia))}}]),n}(Jm);var rg=function(e){b(n,e);var t=w(n);function n(e,r,a){var i;return f(this,n),(i=t.call(this)).type=e,i.Ta=r,i.Ea=a,i}return p(n,[{key:"_apply",value:function(e){var t=cg(e,this.type,this.Ta,this.Ea);return new Kv(e.firestore,e.converter,function(e,t){return new Qs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,t,e.endAt)}(e._query,t))}}]),n}(Jm);function ag(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new rg("startAt",t,!0)}function ig(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new rg("startAfter",t,!1)}var og=function(e){b(n,e);var t=w(n);function n(e,r,a){var i;return f(this,n),(i=t.call(this)).type=e,i.Ta=r,i.Ea=a,i}return p(n,[{key:"_apply",value:function(e){var t=cg(e,this.type,this.Ta,this.Ea);return new Kv(e.firestore,e.converter,function(e,t){return new Qs(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,t)}(e._query,t))}}]),n}(Jm);function sg(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new og("endBefore",t,!1)}function ug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new og("endAt",t,!0)}function cg(e,t,n,r){if(n[0]=G(n[0]),n[0]instanceof Wm)return function(e,t,n,r,a){if(!r)throw new Bi(zi.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for ".concat(n,"()."));var i,o=[],s=m(ru(e));try{for(s.s();!(i=s.n()).done;){var u=i.value;if(u.field.isKeyField())o.push(ds(t,r.key));else{var c=r.data.field(u.field);if(Qo(c))throw new Bi(zi.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+u.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===c){var l=u.field.canonicalString();throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '".concat(l,"' (used as the orderBy) does not exist."))}o.push(c)}}}catch(h){s.e(h)}finally{s.f()}return new Gs(o,a)}(e._query,e.firestore._databaseId,t,n[0]._document,r);var a=xm(e.firestore);return function(e,t,n,r,a,i){var o=e.explicitOrderBy;if(a.length>o.length)throw new Bi(zi.INVALID_ARGUMENT,"Too many arguments provided to ".concat(r,"(). The number of arguments must be less than or equal to the number of orderBy() clauses"));for(var s=[],u=0;u<a.length;u++){var c=a[u];if(o[u].field.isKeyField()){if("string"!=typeof c)throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in ".concat(r,"(), but got a ").concat(typeof c));if(!nu(e)&&-1!==c.indexOf("/"))throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by documentId(), the value passed to ".concat(r,"() must be a plain document ID, but '").concat(c,"' contains a slash."));var l=e.path.child(ao.fromString(c));if(!so.isDocumentKey(l))throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by documentId(), the value passed to ".concat(r,"() must result in a valid document path, but '").concat(l,"' is not because it contains an odd number of segments."));var h=new so(l);s.push(ds(t,h))}else{var f=_m(n,r,c);s.push(f)}}return new Gs(s,i)}(e._query,e.firestore._databaseId,a,t,n,r)}function lg(e,t,n){if("string"==typeof(n=G(n))){if(""===n)throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!nu(t)&&-1!==n.indexOf("/"))throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(n,"' contains a '/' character."));var r=t.path.child(ao.fromString(n));if(!so.isDocumentKey(r))throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(r,"' is not because it has an odd number of segments (").concat(r.length,")."));return ds(e,new so(r))}if(n instanceof qv)return ds(e,n._key);throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(Uv(n),"."))}function hg(e,t){if(!Array.isArray(e)||0===e.length)throw new Bi(zi.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."));if(e.length>10)throw new Bi(zi.INVALID_ARGUMENT,"Invalid Query. '".concat(t.toString(),"' filters support a maximum of 10 elements in the value array."))}function fg(e,t,n){if(!n.isEqual(t))throw new Bi(zi.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '".concat(t.toString(),"' and so you must also use '").concat(t.toString(),"' as your first argument to orderBy(), but your first orderBy() is on field '").concat(n.toString(),"' instead."))}var dg={maxAttempts:5},pg=function(){function e(){f(this,e)}return p(e,[{key:"convertValue",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(os(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ko(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Xo(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw Li()}}},{key:"convertObject",value:function(e,t){var n=this,r={};return Lo(e.fields,(function(e,a){r[e]=n.convertValue(a,t)})),r}},{key:"convertGeoPoint",value:function(e){return new vm(Ko(e.latitude),Ko(e.longitude))}},{key:"convertArray",value:function(e,t){var n=this;return(e.values||[]).map((function(e){return n.convertValue(e,t)}))}},{key:"convertServerTimestamp",value:function(e,t){switch(t){case"previous":var n=Yo(e);return null==n?null:this.convertValue(n,t);case"estimate":return this.convertTimestamp(Jo(e));default:return null}}},{key:"convertTimestamp",value:function(e){var t=qo(e);return new to(t.seconds,t.nanos)}},{key:"convertDocumentKey",value:function(e,t){var n=ao.fromString(e);Mi(Qc(n));var r=new es(n.get(1),n.get(3)),a=new so(n.popFirst(5));return r.isEqual(t)||Di("Document ".concat(a," contains a document reference within a different database (").concat(r.projectId,"/").concat(r.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),a}}]),e}();function vg(e,t,n){return e?n&&(n.merge||n.mergeFields)?e.toFirestore(t,n):e.toFirestore(t):t}var mg=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).firestore=e,r}return p(n,[{key:"convertBytes",value:function(e){return new dm(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new qv(this.firestore,null,t)}}]),n}(pg),gg=function(){function e(t,n){f(this,e),this._firestore=t,this._commitHandler=n,this._mutations=[],this._committed=!1,this._dataReader=xm(t)}return p(e,[{key:"set",value:function(e,t,n){this._verifyNotCommitted();var r=yg(e,this._firestore),a=vg(r.converter,t,n),i=wm(this._dataReader,"WriteBatch.set",r._key,a,null!==r.converter,n);return this._mutations.push(i.toMutation(r._key,Au.none())),this}},{key:"update",value:function(e,t,n){this._verifyNotCommitted();for(var r,a=yg(e,this._firestore),i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];return r="string"==typeof(t=G(t))||t instanceof fm?Rm(this._dataReader,"WriteBatch.update",a._key,t,n,o):Am(this._dataReader,"WriteBatch.update",a._key,t),this._mutations.push(r.toMutation(a._key,Au.exists(!0))),this}},{key:"delete",value:function(e){this._verifyNotCommitted();var t=yg(e,this._firestore);return this._mutations=this._mutations.concat(new Gu(t._key,Au.none())),this}},{key:"commit",value:function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}},{key:"_verifyNotCommitted",value:function(){if(this._committed)throw new Bi(zi.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}}]),e}();function yg(e,t){if((e=G(e)).firestore!==t)throw new Bi(zi.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}var bg=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).firestore=e,r}return p(n,[{key:"convertBytes",value:function(e){return new dm(e)}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return new qv(this.firestore,null,t)}}]),n}(pg);function kg(e){e=Wv(e,qv);var t=Wv(e.firestore,rm),n=am(t),r=new bg(t);return function(e,t){var n=new Ui;return e.asyncQueue.enqueueAndForget(c(s().mark((function r(){return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=c(s().mark((function e(t,n,r){var a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,function(e,t){var n=Pi(e);return n.persistence.runTransaction("read document","readonly",(function(e){return n.localDocuments.getDocument(e,t)}))}(t,n);case 3:(a=e.sent).isFoundDocument()?r.resolve(a):a.isNoDocument()?r.resolve(null):r.reject(new Bi(zi.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),i=Zd(e.t0,"Failed to get document '".concat(n," from cache")),r.reject(i);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Nv(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._key).then((function(n){return new Hm(t,r,e._key,n,new Gm(null!==n&&n.hasLocalMutations,!0),e.converter)}))}function Vg(e){e=Wv(e,Kv);var t=Wv(e.firestore,rm),n=am(t),r=new bg(t);return function(e,t){var n=new Ui;return e.asyncQueue.enqueueAndForget(c(s().mark((function r(){return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=function(){var e=c(s().mark((function e(t,n,r){var a,i,o,u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,wf(t,n,!0);case 3:a=e.sent,i=new lp(n,a.Hi),o=i.ju(a.documents),u=i.applyChanges(o,!1),r.resolve(u.snapshot),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),c=Zd(e.t0,"Failed to execute query '".concat(n," against cache")),r.reject(c);case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t,n,r){return e.apply(this,arguments)}}(),r.next=3,Nv(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(n,e._query).then((function(n){return new Km(t,r,e,n)}))}function xg(e,t,n){e=Wv(e,qv);var r=Wv(e.firestore,rm),a=vg(e.converter,t,n);return Cg(r,[wm(xm(r),"setDoc",e._key,a,null!==e.converter,n).toMutation(e._key,Au.none())])}function wg(e,t,n){e=Wv(e,qv);for(var r=Wv(e.firestore,rm),a=xm(r),i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];return Cg(r,[("string"==typeof(t=G(t))||t instanceof fm?Rm(a,"updateDoc",e._key,t,n,o):Am(a,"updateDoc",e._key,t)).toMutation(e._key,Au.exists(!0))])}function Ig(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a,i,o;e=G(e);var u={includeMetadataChanges:!1},l=0;"object"!=typeof n[l]||tm(n[l])||(u=n[l],l++);var h,f,d,p={includeMetadataChanges:u.includeMetadataChanges};if(tm(n[l])){var v=n[l];n[l]=null===(a=v.next)||void 0===a?void 0:a.bind(v),n[l+1]=null===(i=v.error)||void 0===i?void 0:i.bind(v),n[l+2]=null===(o=v.complete)||void 0===o?void 0:o.bind(v)}if(e instanceof qv)f=Wv(e.firestore,rm),d=Js(e._key.path),h={next:function(t){n[l]&&n[l](Eg(f,e,t))},error:n[l+1],complete:n[l+2]};else{var m=Wv(e,Kv);f=Wv(m.firestore,rm),d=m._query;var g=new bg(f);h={next:function(e){n[l]&&n[l](new Km(f,g,m,e))},error:n[l+1],complete:n[l+2]},Ym(e._query)}return function(e,t,n,r){var a=new vv(r),i=new rp(t,a,n);return e.asyncQueue.enqueueAndForget(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Qd,t.next=3,_v(e);case 3:return t.t1=t.sent,t.t2=i,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){a.Rc(),e.asyncQueue.enqueueAndForget(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=Jd,t.next=3,_v(e);case 3:return t.t1=t.sent,t.t2=i,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(am(f),d,p,h)}function Sg(e,t){return function(e,t){var n=new vv(t);return e.asyncQueue.enqueueAndForget(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Pi(e).Ru.add(t),t.next()},t.next=3,_v(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)})))),function(){n.Rc(),e.asyncQueue.enqueueAndForget(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.t0=function(e,t){Pi(e).Ru.delete(t)},t.next=3,_v(e);case 3:return t.t1=t.sent,t.t2=n,t.abrupt("return",(0,t.t0)(t.t1,t.t2));case 6:case"end":return t.stop()}}),t)}))))}}(am(e=Wv(e,rm)),tm(t)?t:{next:t})}function Cg(e,t){return function(e,t){var n=new Ui;return e.asyncQueue.enqueueAndForget(c(s().mark((function r(){return s().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.t0=kp,r.next=3,Rv(e);case 3:return r.t1=r.sent,r.t2=t,r.t3=n,r.abrupt("return",(0,r.t0)(r.t1,r.t2,r.t3));case 7:case"end":return r.stop()}}),r)})))),n.promise}(am(e),t)}function Eg(e,t,n){var r=n.docs.get(t._key),a=new bg(e);return new Hm(e,a,t._key,r,new Gm(n.hasPendingWrites,n.fromCache),t.converter)}var Tg=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this,e,r))._firestore=e,a}return p(n,[{key:"get",value:function(e){var t=this,r=yg(e,this._firestore),a=new bg(this._firestore);return kt(k(n.prototype),"get",this).call(this,e).then((function(e){return new Hm(t._firestore,a,r._key,e._document,new Gm(!1,!1),r.converter)}))}}]),n}(function(){function e(t,n){f(this,e),this._firestore=t,this._transaction=n,this._dataReader=xm(t)}return p(e,[{key:"get",value:function(e){var t=this,n=yg(e,this._firestore),r=new mg(this._firestore);return this._transaction.lookup([n._key]).then((function(e){if(!e||1!==e.length)return Li();var a=e[0];if(a.isFoundDocument())return new Wm(t._firestore,r,a.key,a,n.converter);if(a.isNoDocument())return new Wm(t._firestore,r,n._key,null,n.converter);throw Li()}))}},{key:"set",value:function(e,t,n){var r=yg(e,this._firestore),a=vg(r.converter,t,n),i=wm(this._dataReader,"Transaction.set",r._key,a,null!==r.converter,n);return this._transaction.set(r._key,i),this}},{key:"update",value:function(e,t,n){for(var r,a=yg(e,this._firestore),i=arguments.length,o=new Array(i>3?i-3:0),s=3;s<i;s++)o[s-3]=arguments[s];return r="string"==typeof(t=G(t))||t instanceof fm?Rm(this._dataReader,"Transaction.update",a._key,t,n,o):Am(this._dataReader,"Transaction.update",a._key,t),this._transaction.update(a._key,r),this}},{key:"delete",value:function(e){var t=yg(e,this._firestore);return this._transaction.delete(t._key),this}}]),e}());function Ng(e,t,n){e=Wv(e,rm);var r=Object.assign(Object.assign({},dg),n);return function(e){if(e.maxAttempts<1)throw new Bi(zi.INVALID_ARGUMENT,"Max attempts must be at least 1")}(r),function(e,t,n){var r=new Ui;return e.asyncQueue.enqueueAndForget(c(s().mark((function a(){var i;return s().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,function(e){return Cv(e).then((function(e){return e.datastore}))}(e);case 2:i=a.sent,new yv(e.asyncQueue,i,n,t,r).run();case 4:case"end":return a.stop()}}),a)})))),r.promise}(am(e),(function(n){return t(new Tg(e,n))}),r)}function Ag(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Em("arrayUnion",t)}function Rg(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return new Tm("arrayRemove",t)}!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){Ni=e}(We),Oe(new q("firestore",(function(e,n){var r=n.instanceIdentifier,a=n.options,i=e.getProvider("app").getImmediate(),o=new rm(new Gi(e.getProvider("auth-internal")),new Xi(e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Bi(zi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new es(e.options.projectId,t)}(i,r),i);return a=Object.assign({useFetchStreams:t},a),o._setSettings(a),o}),"PUBLIC").setMultipleInstances(!0)),Ke(Ei,"3.5.0",e),Ke(Ei,"3.5.0","esm2017")}();function _g(e,t){if(void 0===t)return{merge:!1};if(void 0!==t.mergeFields&&void 0!==t.merge)throw new Bi("invalid-argument","Invalid options passed to function ".concat(e,"(): You cannot ")+'specify both "merge" and "mergeFields".');return t}function Dg(){if("undefined"===typeof Uint8Array)throw new Bi("unimplemented","Uint8Arrays are not available in this environment.")}function Fg(){if("undefined"==typeof atob)throw new Bi("unimplemented","Blobs are unavailable in Firestore in this environment.")}var Og=function(){function e(t){f(this,e),this._delegate=t}return p(e,[{key:"toBase64",value:function(){return Fg(),this._delegate.toBase64()}},{key:"toUint8Array",value:function(){return Dg(),this._delegate.toUint8Array()}},{key:"isEqual",value:function(e){return this._delegate.isEqual(e._delegate)}},{key:"toString",value:function(){return"Blob(base64: "+this.toBase64()+")"}}],[{key:"fromBase64String",value:function(t){return Fg(),new e(dm.fromBase64String(t))}},{key:"fromUint8Array",value:function(t){return Dg(),new e(dm.fromUint8Array(t))}}]),e}();function Lg(e){return function(e,t){if("object"!==typeof e||null===e)return!1;var n,r=e,a=m(t);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i in r&&"function"===typeof r[i])return!0}}catch(o){a.e(o)}finally{a.f()}return!1}(e,["next","error","complete"])}var Mg=function(){function e(){f(this,e)}return p(e,[{key:"enableIndexedDbPersistence",value:function(e,t){return function(e,t){hm(e=Wv(e,rm));var n=am(e),r=e._freezeSettings(),a=new dv;return om(n,a,new hv(a,r.cacheSizeBytes,null==t?void 0:t.forceOwnership))}(e._delegate,{forceOwnership:t})}},{key:"enableMultiTabIndexedDbPersistence",value:function(e){return function(e){hm(e=Wv(e,rm));var t=am(e),n=e._freezeSettings(),r=new dv;return om(t,r,new fv(r,n.cacheSizeBytes))}(e._delegate)}},{key:"clearIndexedDbPersistence",value:function(e){return function(e){if(e._initialized&&!e._terminated)throw new Bi(zi.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var t=new Ui;return e._queue.enqueueAndForgetEvenWhileRestricted(c(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Io.C()){e.next=2;break}return e.abrupt("return",Promise.resolve());case 2:return n=t+"main",e.next=5,Io.delete(n);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()(uf(e._databaseId,e._persistenceKey));case 3:t.resolve(),n.next=9;break;case 6:n.prev=6,n.t0=n.catch(0),t.reject(n.t0);case 9:case"end":return n.stop()}}),n,null,[[0,6]])})))),t.promise}(e._delegate)}}]),e}(),Pg=function(){function e(t,n,r){var a=this;f(this,e),this._delegate=n,this._persistenceProvider=r,this.INTERNAL={delete:function(){return a.terminate()}},t instanceof es||(this._appCompat=t)}return p(e,[{key:"_databaseId",get:function(){return this._delegate._databaseId}},{key:"settings",value:function(e){var t=this._delegate._getSettings();e.merge||t.host===e.host||Fi("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&delete(e=Object.assign(Object.assign({},t),e)).merge,this._delegate._setSettings(e)}},{key:"useEmulator",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Hv(this._delegate,e,t,n)}},{key:"enableNetwork",value:function(){return sm(this._delegate)}},{key:"disableNetwork",value:function(){return um(this._delegate)}},{key:"enablePersistence",value:function(e){var t=!1,n=!1;return e&&Pv("synchronizeTabs",t=!!e.synchronizeTabs,"experimentalForceOwningTab",n=!!e.experimentalForceOwningTab),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,n)}},{key:"clearPersistence",value:function(){return this._persistenceProvider.clearIndexedDbPersistence(this)}},{key:"terminate",value:function(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}},{key:"waitForPendingWrites",value:function(){return function(e){return function(e){var t=new Ui;return e.asyncQueue.enqueueAndForget(c(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.t0=Rp,n.next=3,Rv(e);case 3:return n.t1=n.sent,n.t2=t,n.abrupt("return",(0,n.t0)(n.t1,n.t2));case 6:case"end":return n.stop()}}),n)})))),t.promise}(am(e=Wv(e,rm)))}(this._delegate)}},{key:"onSnapshotsInSync",value:function(e){return Sg(this._delegate,e)}},{key:"app",get:function(){if(!this._appCompat)throw new Bi("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}},{key:"collection",value:function(e){try{return new Jg(this,Qv(this._delegate,e))}catch(t){throw Zg(t,"collection()","Firestore.collection()")}}},{key:"doc",value:function(e){try{return new jg(this,Yv(this._delegate,e))}catch(t){throw Zg(t,"doc()","Firestore.doc()")}}},{key:"collectionGroup",value:function(e){try{return new Xg(this,function(e,t){if(e=Wv(e,Gv),Mv("collectionGroup","collection id",t),t.indexOf("/")>=0)throw new Bi(zi.INVALID_ARGUMENT,"Invalid collection ID '".concat(t,"' passed to function collectionGroup(). Collection IDs must not contain '/'."));return new Kv(e,null,function(e){return new Qs(ao.emptyPath(),e)}(t))}(this._delegate,e))}catch(t){throw Zg(t,"collectionGroup()","Firestore.collectionGroup()")}}},{key:"runTransaction",value:function(e){var t=this;return Ng(this._delegate,(function(n){return e(new Bg(t,n))}))}},{key:"batch",value:function(){var e=this;return am(this._delegate),new Ug(new gg(this._delegate,(function(t){return Cg(e._delegate,t)})))}},{key:"loadBundle",value:function(e){return cm(this._delegate,e)}},{key:"namedQuery",value:function(e){var t=this;return lm(this._delegate,e).then((function(e){return e?new Xg(t,e):null}))}}]),e}(),zg=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).firestore=e,r}return p(n,[{key:"convertBytes",value:function(e){return new Og(new dm(e))}},{key:"convertReference",value:function(e){var t=this.convertDocumentKey(e,this.firestore._databaseId);return jg.forKey(t,this.firestore,null)}}]),n}(pg);var Bg=function(){function e(t,n){f(this,e),this._firestore=t,this._delegate=n,this._userDataWriter=new zg(t)}return p(e,[{key:"get",value:function(e){var t=this,n=$g(e);return this._delegate.get(n).then((function(e){return new qg(t._firestore,new Hm(t._firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,n.converter))}))}},{key:"set",value:function(e,t,n){var r=$g(e);return n?(_g("Transaction.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}},{key:"update",value:function(e,t,n){for(var r=arguments.length,a=new Array(r>3?r-3:0),i=3;i<r;i++)a[i-3]=arguments[i];var o,s=$g(e);2===arguments.length?this._delegate.update(s,t):(o=this._delegate).update.apply(o,[s,t,n].concat(a));return this}},{key:"delete",value:function(e){var t=$g(e);return this._delegate.delete(t),this}}]),e}(),Ug=function(){function e(t){f(this,e),this._delegate=t}return p(e,[{key:"set",value:function(e,t,n){var r=$g(e);return n?(_g("WriteBatch.set",n),this._delegate.set(r,t,n)):this._delegate.set(r,t),this}},{key:"update",value:function(e,t,n){for(var r=arguments.length,a=new Array(r>3?r-3:0),i=3;i<r;i++)a[i-3]=arguments[i];var o,s=$g(e);2===arguments.length?this._delegate.update(s,t):(o=this._delegate).update.apply(o,[s,t,n].concat(a));return this}},{key:"delete",value:function(e){var t=$g(e);return this._delegate.delete(t),this}},{key:"commit",value:function(){return this._delegate.commit()}}]),e}(),Wg=function(){function e(t,n,r){f(this,e),this._firestore=t,this._userDataWriter=n,this._delegate=r}return p(e,[{key:"fromFirestore",value:function(e,t){var n=new qm(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new Kg(this._firestore,n),null!==t&&void 0!==t?t:{})}},{key:"toFirestore",value:function(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}}],[{key:"getInstance",value:function(t,n){var r=e.INSTANCES,a=r.get(t);a||(a=new WeakMap,r.set(t,a));var i=a.get(n);return i||(i=new e(t,new zg(t),n),a.set(n,i)),i}}]),e}();Wg.INSTANCES=new WeakMap;var jg=function(){function e(t,n){f(this,e),this.firestore=t,this._delegate=n,this._userDataWriter=new zg(t)}return p(e,[{key:"id",get:function(){return this._delegate.id}},{key:"parent",get:function(){return new Jg(this.firestore,this._delegate.parent)}},{key:"path",get:function(){return this._delegate.path}},{key:"collection",value:function(e){try{return new Jg(this.firestore,Qv(this._delegate,e))}catch(t){throw Zg(t,"collection()","DocumentReference.collection()")}}},{key:"isEqual",value:function(e){return(e=G(e))instanceof qv&&Jv(this._delegate,e)}},{key:"set",value:function(e,t){t=_g("DocumentReference.set",t);try{return t?xg(this._delegate,e,t):xg(this._delegate,e)}catch(n){throw Zg(n,"setDoc()","DocumentReference.set()")}}},{key:"update",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];try{return 1===arguments.length?wg(this._delegate,e):wg.apply(void 0,[this._delegate,e,t].concat(r))}catch(i){throw Zg(i,"updateDoc()","DocumentReference.update()")}}},{key:"delete",value:function(){return function(e){return Cg(Wv(e.firestore,rm),[new Gu(e._key,Au.none())])}(this._delegate)}},{key:"onSnapshot",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=Gg(n),i=Hg(n,(function(t){return new qg(e.firestore,new Hm(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))}));return Ig(this._delegate,a,i)}},{key:"get",value:function(e){var t,n=this;return t="cache"===(null===e||void 0===e?void 0:e.source)?kg(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?function(e){e=Wv(e,qv);var t=Wv(e.firestore,rm);return Fv(am(t),e._key,{source:"server"}).then((function(n){return Eg(t,e,n)}))}(this._delegate):function(e){e=Wv(e,qv);var t=Wv(e.firestore,rm);return Fv(am(t),e._key).then((function(n){return Eg(t,e,n)}))}(this._delegate),t.then((function(e){return new qg(n.firestore,new Hm(n.firestore._delegate,n._userDataWriter,e._key,e._document,e.metadata,n._delegate.converter))}))}},{key:"withConverter",value:function(t){return new e(this.firestore,t?this._delegate.withConverter(Wg.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}],[{key:"forPath",value:function(t,n,r){if(t.length%2!==0)throw new Bi("invalid-argument","Invalid document reference. Document references must have an even number of segments, but "+"".concat(t.canonicalString()," has ").concat(t.length));return new e(n,new qv(n._delegate,r,new so(t)))}},{key:"forKey",value:function(t,n,r){return new e(n,new qv(n._delegate,r,t))}}]),e}();function Zg(e,t,n){return e.message=e.message.replace(t,n),e}function Gg(e){var t,n=m(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;if("object"===typeof r&&!Lg(r))return r}}catch(a){n.e(a)}finally{n.f()}return{}}function Hg(e,t){var n,r,a;return{next:function(e){a.next&&a.next(t(e))},error:null===(n=(a=Lg(e[0])?e[0]:Lg(e[1])?e[1]:"function"===typeof e[0]?{next:e[0],error:e[1],complete:e[2]}:{next:e[1],error:e[2],complete:e[3]}).error)||void 0===n?void 0:n.bind(a),complete:null===(r=a.complete)||void 0===r?void 0:r.bind(a)}}var qg=function(){function e(t,n){f(this,e),this._firestore=t,this._delegate=n}return p(e,[{key:"ref",get:function(){return new jg(this._firestore,this._delegate.ref)}},{key:"id",get:function(){return this._delegate.id}},{key:"metadata",get:function(){return this._delegate.metadata}},{key:"exists",get:function(){return this._delegate.exists()}},{key:"data",value:function(e){return this._delegate.data(e)}},{key:"get",value:function(e,t){return this._delegate.get(e,t)}},{key:"isEqual",value:function(e){return Qm(this._delegate,e._delegate)}}]),e}(),Kg=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"data",value:function(e){var t=this._delegate.data(e);return function(e,t){e||Li()}(void 0!==t),t}}]),n}(qg),Xg=function(){function e(t,n){f(this,e),this.firestore=t,this._delegate=n,this._userDataWriter=new zg(t)}return p(e,[{key:"where",value:function(t,n,r){try{return new e(this.firestore,$m(this._delegate,function(e,t,n){var r=t,a=Zm("where",e);return new eg(a,r,n)}(t,n,r)))}catch(a){throw Zg(a,/(orderBy|where)\(\)/,"Query.$1()")}}},{key:"orderBy",value:function(t,n){try{return new e(this.firestore,$m(this._delegate,function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",n=Zm("orderBy",e);return new tg(n,t)}(t,n)))}catch(r){throw Zg(r,/(orderBy|where)\(\)/,"Query.$1()")}}},{key:"limit",value:function(t){try{return new e(this.firestore,$m(this._delegate,function(e){return jv("limit",e),new ng("limit",e,"F")}(t)))}catch(n){throw Zg(n,"limit()","Query.limit()")}}},{key:"limitToLast",value:function(t){try{return new e(this.firestore,$m(this._delegate,function(e){return jv("limitToLast",e),new ng("limitToLast",e,"L")}(t)))}catch(n){throw Zg(n,"limitToLast()","Query.limitToLast()")}}},{key:"startAt",value:function(){try{return new e(this.firestore,$m(this._delegate,ag.apply(void 0,arguments)))}catch(t){throw Zg(t,"startAt()","Query.startAt()")}}},{key:"startAfter",value:function(){try{return new e(this.firestore,$m(this._delegate,ig.apply(void 0,arguments)))}catch(t){throw Zg(t,"startAfter()","Query.startAfter()")}}},{key:"endBefore",value:function(){try{return new e(this.firestore,$m(this._delegate,sg.apply(void 0,arguments)))}catch(t){throw Zg(t,"endBefore()","Query.endBefore()")}}},{key:"endAt",value:function(){try{return new e(this.firestore,$m(this._delegate,ug.apply(void 0,arguments)))}catch(t){throw Zg(t,"endAt()","Query.endAt()")}}},{key:"isEqual",value:function(e){return $v(this._delegate,e._delegate)}},{key:"get",value:function(e){var t,n=this;return t="cache"===(null===e||void 0===e?void 0:e.source)?Vg(this._delegate):"server"===(null===e||void 0===e?void 0:e.source)?function(e){e=Wv(e,Kv);var t=Wv(e.firestore,rm),n=am(t),r=new bg(t);return Ov(n,e._query,{source:"server"}).then((function(n){return new Km(t,r,e,n)}))}(this._delegate):function(e){e=Wv(e,Kv);var t=Wv(e.firestore,rm),n=am(t),r=new bg(t);return Ym(e._query),Ov(n,e._query).then((function(n){return new Km(t,r,e,n)}))}(this._delegate),t.then((function(e){return new Yg(n.firestore,new Km(n.firestore._delegate,n._userDataWriter,n._delegate,e._snapshot))}))}},{key:"onSnapshot",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var a=Gg(n),i=Hg(n,(function(t){return new Yg(e.firestore,new Km(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))}));return Ig(this._delegate,a,i)}},{key:"withConverter",value:function(t){return new e(this.firestore,t?this._delegate.withConverter(Wg.getInstance(this.firestore,t)):this._delegate.withConverter(null))}}]),e}(),Qg=function(){function e(t,n){f(this,e),this._firestore=t,this._delegate=n}return p(e,[{key:"type",get:function(){return this._delegate.type}},{key:"doc",get:function(){return new Kg(this._firestore,this._delegate.doc)}},{key:"oldIndex",get:function(){return this._delegate.oldIndex}},{key:"newIndex",get:function(){return this._delegate.newIndex}}]),e}(),Yg=function(){function e(t,n){f(this,e),this._firestore=t,this._delegate=n}return p(e,[{key:"query",get:function(){return new Xg(this._firestore,this._delegate.query)}},{key:"metadata",get:function(){return this._delegate.metadata}},{key:"size",get:function(){return this._delegate.size}},{key:"empty",get:function(){return this._delegate.empty}},{key:"docs",get:function(){var e=this;return this._delegate.docs.map((function(t){return new Kg(e._firestore,t)}))}},{key:"docChanges",value:function(e){var t=this;return this._delegate.docChanges(e).map((function(e){return new Qg(t._firestore,e)}))}},{key:"forEach",value:function(e,t){var n=this;this._delegate.forEach((function(r){e.call(t,new Kg(n._firestore,r))}))}},{key:"isEqual",value:function(e){return Qm(this._delegate,e._delegate)}}]),e}(),Jg=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this,e,r)).firestore=e,a._delegate=r,a}return p(n,[{key:"id",get:function(){return this._delegate.id}},{key:"path",get:function(){return this._delegate.path}},{key:"parent",get:function(){var e=this._delegate.parent;return e?new jg(this.firestore,e):null}},{key:"doc",value:function(e){try{return new jg(this.firestore,void 0===e?Yv(this._delegate):Yv(this._delegate,e))}catch(t){throw Zg(t,"doc()","CollectionReference.doc()")}}},{key:"add",value:function(e){var t=this;return function(e,t){var n=Wv(e.firestore,rm),r=Yv(e),a=vg(e.converter,t);return Cg(n,[wm(xm(e.firestore),"addDoc",r._key,a,null!==e.converter,{}).toMutation(r._key,Au.exists(!1))]).then((function(){return r}))}(this._delegate,e).then((function(e){return new jg(t.firestore,e)}))}},{key:"isEqual",value:function(e){return Jv(this._delegate,e._delegate)}},{key:"withConverter",value:function(e){return new n(this.firestore,e?this._delegate.withConverter(Wg.getInstance(this.firestore,e)):this._delegate.withConverter(null))}}]),n}(Xg);function $g(e){return Wv(e,qv)}var ey,ty=function(){function e(){f(this,e);for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this._delegate=I(fm,n)}return p(e,[{key:"isEqual",value:function(e){return(e=G(e))instanceof fm&&this._delegate._internalPath.isEqual(e._internalPath)}}],[{key:"documentId",value:function(){return new e(oo.keyField().canonicalString())}}]),e}(),ny=function(){function e(t){f(this,e),this._delegate=t}return p(e,[{key:"isEqual",value:function(e){return this._delegate.isEqual(e._delegate)}}],[{key:"serverTimestamp",value:function(){var t=new Cm("serverTimestamp");return t._methodName="FieldValue.serverTimestamp",new e(t)}},{key:"delete",value:function(){var t=new Im("deleteField");return t._methodName="FieldValue.delete",new e(t)}},{key:"arrayUnion",value:function(){var t=Ag.apply(void 0,arguments);return t._methodName="FieldValue.arrayUnion",new e(t)}},{key:"arrayRemove",value:function(){var t=Rg.apply(void 0,arguments);return t._methodName="FieldValue.arrayRemove",new e(t)}},{key:"increment",value:function(t){var n=function(e){return new Nm("increment",e)}(t);return n._methodName="FieldValue.increment",new e(n)}}]),e}(),ry={Firestore:Pg,GeoPoint:vm,Timestamp:to,Blob:Og,Transaction:Bg,WriteBatch:Ug,DocumentReference:jg,DocumentSnapshot:qg,Query:Xg,QueryDocumentSnapshot:Kg,QuerySnapshot:Yg,CollectionReference:Jg,FieldPath:ty,FieldValue:ny,setLogLevel:function(e){!function(e){Ai.setLogLevel(e)}(e)},CACHE_SIZE_UNLIMITED:-1};(function(e,t){e.INTERNAL.registerComponent(new q("firestore-compat",(function(e){var n=e.getProvider("app-compat").getImmediate(),r=e.getProvider("firestore").getImmediate();return t(n,r)}),"PUBLIC").setServiceProps(Object.assign({},ry)))})(ey=yt,(function(e,t){return new Pg(e,t,new Mg)})),ey.registerVersion("@firebase/firestore-compat","0.1.25");yt.initializeApp({apiKey:"AIzaSyD1f7Sy92LOZQ-fVSOUIoLvsOls7ck7XI4",authDomain:"snapfit-e9ed9.firebaseapp.com",projectId:"snapfit-e9ed9",storageBucket:"snapfit-e9ed9.appspot.com",messagingSenderId:"450027673483",appId:"1:450027673483:web:ee22e2c06f82cd2e2b418e"});var ay=yt.firestore(),iy=n(3366),oy=n(7462),sy=(n(8457),n(8182)),uy=n(4419),cy=n(6863),ly=n(5873),hy=n(886),fy=n(4205);function dy(){return(0,hy.Z)(fy.Z)}var py,vy=n(5602);function my(){if(py)return py;var e=document.createElement("div"),t=document.createElement("div");return t.style.width="10px",t.style.height="1px",e.appendChild(t),e.dir="rtl",e.style.fontSize="14px",e.style.width="4px",e.style.height="1px",e.style.position="absolute",e.style.top="-1000px",e.style.overflow="scroll",document.body.appendChild(e),py="reverse",e.scrollLeft>0?py="default":(e.scrollLeft=1,0===e.scrollLeft&&(py="negative")),document.body.removeChild(e),py}function gy(e,t){var n=e.scrollLeft;if("rtl"!==t)return n;switch(my()){case"negative":return e.scrollWidth-e.clientWidth+n;case"reverse":return e.scrollWidth-e.clientWidth-n;default:return n}}function yy(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2}function by(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:function(){},i=r.ease,o=void 0===i?yy:i,s=r.duration,u=void 0===s?300:s,c=null,l=t[e],h=!1,f=function(){h=!0},d=function r(i){if(h)a(new Error("Animation cancelled"));else{null===c&&(c=i);var s=Math.min(1,(i-c)/u);t[e]=o(s)*(n-l)+l,s>=1?requestAnimationFrame((function(){a(null)})):requestAnimationFrame(r)}};return l===n?(a(new Error("Element already at target position")),f):(requestAnimationFrame(d),f)}var ky=n(1003),Vy=n(184),xy=["onChange"],wy={width:99,height:99,position:"absolute",top:-9999,overflow:"scroll"};var Iy=n(1245),Sy=(0,Iy.Z)((0,Vy.jsx)("path",{d:"M15.41 16.09l-4.58-4.59 4.58-4.59L14 5.5l-6 6 6 6z"}),"KeyboardArrowLeft"),Cy=(0,Iy.Z)((0,Vy.jsx)("path",{d:"M8.59 16.34l4.58-4.59-4.58-4.59L10 5.75l6 6-6 6z"}),"KeyboardArrowRight"),Ey=n(792),Ty=n(6702),Ny=n(2763);function Ay(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var Ry=r.createContext(null);function _y(e,t){var n=Object.create(null);return e&&r.Children.map(e,(function(e){return e})).forEach((function(e){n[e.key]=function(e){return t&&(0,r.isValidElement)(e)?t(e):e}(e)})),n}function Dy(e,t,n){return null!=n[t]?n[t]:e.props[t]}function Fy(e,t,n){var a=_y(e.children),i=function(e,t){function n(n){return n in t?t[n]:e[n]}e=e||{},t=t||{};var r,a=Object.create(null),i=[];for(var o in e)o in t?i.length&&(a[o]=i,i=[]):i.push(o);var s={};for(var u in t){if(a[u])for(r=0;r<a[u].length;r++){var c=a[u][r];s[a[u][r]]=n(c)}s[u]=n(u)}for(r=0;r<i.length;r++)s[i[r]]=n(i[r]);return s}(t,a);return Object.keys(i).forEach((function(o){var s=i[o];if((0,r.isValidElement)(s)){var u=o in t,c=o in a,l=t[o],h=(0,r.isValidElement)(l)&&!l.props.in;!c||u&&!h?c||!u||h?c&&u&&(0,r.isValidElement)(l)&&(i[o]=(0,r.cloneElement)(s,{onExited:n.bind(null,s),in:l.props.in,exit:Dy(s,"exit",e),enter:Dy(s,"enter",e)})):i[o]=(0,r.cloneElement)(s,{in:!1}):i[o]=(0,r.cloneElement)(s,{onExited:n.bind(null,s),in:!0,exit:Dy(s,"exit",e),enter:Dy(s,"enter",e)})}})),i}var Oy=Object.values||function(e){return Object.keys(e).map((function(t){return e[t]}))},Ly=function(e){var t,n;function a(t,n){var r,a=(r=e.call(this,t,n)||this).handleExited.bind(g(r));return r.state={contextValue:{isMounting:!0},handleExited:a,firstRender:!0},r}n=e,(t=a).prototype=Object.create(n.prototype),t.prototype.constructor=t,y(t,n);var i=a.prototype;return i.componentDidMount=function(){this.mounted=!0,this.setState({contextValue:{isMounting:!1}})},i.componentWillUnmount=function(){this.mounted=!1},a.getDerivedStateFromProps=function(e,t){var n,a,i=t.children,o=t.handleExited;return{children:t.firstRender?(n=e,a=o,_y(n.children,(function(e){return(0,r.cloneElement)(e,{onExited:a.bind(null,e),in:!0,appear:Dy(e,"appear",n),enter:Dy(e,"enter",n),exit:Dy(e,"exit",n)})}))):Fy(e,i,o),firstRender:!1}},i.handleExited=function(e,t){var n=_y(this.props.children);e.key in n||(e.props.onExited&&e.props.onExited(t),this.mounted&&this.setState((function(t){var n=(0,oy.Z)({},t.children);return delete n[e.key],{children:n}})))},i.render=function(){var e=this.props,t=e.component,n=e.childFactory,a=(0,iy.Z)(e,["component","childFactory"]),i=this.state.contextValue,o=Oy(this.state.children).map(n);return delete a.appear,delete a.enter,delete a.exit,null===t?r.createElement(Ry.Provider,{value:i},o):r.createElement(Ry.Provider,{value:i},r.createElement(t,a,o))},a}(r.Component);Ly.propTypes={},Ly.defaultProps={component:"div",childFactory:function(e){return e}};var My=Ly,Py=(n(76),n(2110),n(9140));n(2561);function zy(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,Py.O)(t)}var By=function(){var e=zy.apply(void 0,arguments),t="animation-"+e.name;return{name:t,styles:"@keyframes "+t+"{"+e.styles+"}",anim:1,toString:function(){return"_EMO_"+this.name+"_"+this.styles+"_EMO_"}}};var Uy=function(e){var t=e.className,n=e.classes,a=e.pulsate,i=void 0!==a&&a,o=e.rippleX,s=e.rippleY,u=e.rippleSize,c=e.in,h=e.onExited,f=e.timeout,d=r.useState(!1),p=(0,l.Z)(d,2),v=p[0],m=p[1],g=(0,sy.Z)(t,n.ripple,n.rippleVisible,i&&n.ripplePulsate),y={width:u,height:u,top:-u/2+s,left:-u/2+o},b=(0,sy.Z)(n.child,v&&n.childLeaving,i&&n.childPulsate);return c||v||m(!0),r.useEffect((function(){if(!c&&null!=h){var e=setTimeout(h,f);return function(){clearTimeout(e)}}}),[h,c,f]),(0,Vy.jsx)("span",{className:g,style:y,children:(0,Vy.jsx)("span",{className:b})})},Wy=n(5878);var jy,Zy,Gy,Hy,qy,Ky,Xy,Qy,Yy=(0,Wy.Z)("MuiTouchRipple",["root","ripple","rippleVisible","ripplePulsate","child","childLeaving","childPulsate"]),Jy=["center","classes","className"],$y=By(qy||(qy=jy||(jy=Ay(["\n  0% {\n    transform: scale(0);\n    opacity: 0.1;\n  }\n\n  100% {\n    transform: scale(1);\n    opacity: 0.3;\n  }\n"])))),eb=By(Ky||(Ky=Zy||(Zy=Ay(["\n  0% {\n    opacity: 1;\n  }\n\n  100% {\n    opacity: 0;\n  }\n"])))),tb=By(Xy||(Xy=Gy||(Gy=Ay(["\n  0% {\n    transform: scale(1);\n  }\n\n  50% {\n    transform: scale(0.92);\n  }\n\n  100% {\n    transform: scale(1);\n  }\n"])))),nb=(0,cy.ZP)("span",{name:"MuiTouchRipple",slot:"Root"})({overflow:"hidden",pointerEvents:"none",position:"absolute",zIndex:0,top:0,right:0,bottom:0,left:0,borderRadius:"inherit"}),rb=(0,cy.ZP)(Uy,{name:"MuiTouchRipple",slot:"Ripple"})(Qy||(Qy=Hy||(Hy=Ay(["\n  opacity: 0;\n  position: absolute;\n\n  &."," {\n    opacity: 0.3;\n    transform: scale(1);\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ",";\n  }\n\n  &."," {\n    animation-duration: ","ms;\n  }\n\n  & ."," {\n    opacity: 1;\n    display: block;\n    width: 100%;\n    height: 100%;\n    border-radius: 50%;\n    background-color: currentColor;\n  }\n\n  & ."," {\n    opacity: 0;\n    animation-name: ",";\n    animation-duration: ","ms;\n    animation-timing-function: ",";\n  }\n\n  & ."," {\n    position: absolute;\n    /* @noflip */\n    left: 0px;\n    top: 0;\n    animation-name: ",";\n    animation-duration: 2500ms;\n    animation-timing-function: ",";\n    animation-iteration-count: infinite;\n    animation-delay: 200ms;\n  }\n"]))),Yy.rippleVisible,$y,550,(function(e){return e.theme.transitions.easing.easeInOut}),Yy.ripplePulsate,(function(e){return e.theme.transitions.duration.shorter}),Yy.child,Yy.childLeaving,eb,550,(function(e){return e.theme.transitions.easing.easeInOut}),Yy.childPulsate,tb,(function(e){return e.theme.transitions.easing.easeInOut})),ab=r.forwardRef((function(e,t){var n=(0,ly.Z)({props:e,name:"MuiTouchRipple"}),a=n.center,i=void 0!==a&&a,o=n.classes,s=void 0===o?{}:o,u=n.className,c=(0,iy.Z)(n,Jy),h=r.useState([]),f=(0,l.Z)(h,2),d=f[0],p=f[1],v=r.useRef(0),m=r.useRef(null);r.useEffect((function(){m.current&&(m.current(),m.current=null)}),[d]);var g=r.useRef(!1),y=r.useRef(null),b=r.useRef(null),k=r.useRef(null);r.useEffect((function(){return function(){clearTimeout(y.current)}}),[]);var V=r.useCallback((function(e){var t=e.pulsate,n=e.rippleX,r=e.rippleY,a=e.rippleSize,i=e.cb;p((function(e){return[].concat((0,H.Z)(e),[(0,Vy.jsx)(rb,{classes:{ripple:(0,sy.Z)(s.ripple,Yy.ripple),rippleVisible:(0,sy.Z)(s.rippleVisible,Yy.rippleVisible),ripplePulsate:(0,sy.Z)(s.ripplePulsate,Yy.ripplePulsate),child:(0,sy.Z)(s.child,Yy.child),childLeaving:(0,sy.Z)(s.childLeaving,Yy.childLeaving),childPulsate:(0,sy.Z)(s.childPulsate,Yy.childPulsate)},timeout:550,pulsate:t,rippleX:n,rippleY:r,rippleSize:a},v.current)])})),v.current+=1,m.current=i}),[s]),x=r.useCallback((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,r=t.pulsate,a=void 0!==r&&r,o=t.center,s=void 0===o?i||t.pulsate:o,u=t.fakeElement,c=void 0!==u&&u;if("mousedown"===(null==e?void 0:e.type)&&g.current)g.current=!1;else{"touchstart"===(null==e?void 0:e.type)&&(g.current=!0);var l,h,f,d=c?null:k.current,p=d?d.getBoundingClientRect():{width:0,height:0,left:0,top:0};if(s||void 0===e||0===e.clientX&&0===e.clientY||!e.clientX&&!e.touches)l=Math.round(p.width/2),h=Math.round(p.height/2);else{var v=e.touches&&e.touches.length>0?e.touches[0]:e,m=v.clientX,x=v.clientY;l=Math.round(m-p.left),h=Math.round(x-p.top)}if(s)(f=Math.sqrt((2*Math.pow(p.width,2)+Math.pow(p.height,2))/3))%2===0&&(f+=1);else{var w=2*Math.max(Math.abs((d?d.clientWidth:0)-l),l)+2,I=2*Math.max(Math.abs((d?d.clientHeight:0)-h),h)+2;f=Math.sqrt(Math.pow(w,2)+Math.pow(I,2))}null!=e&&e.touches?null===b.current&&(b.current=function(){V({pulsate:a,rippleX:l,rippleY:h,rippleSize:f,cb:n})},y.current=setTimeout((function(){b.current&&(b.current(),b.current=null)}),80)):V({pulsate:a,rippleX:l,rippleY:h,rippleSize:f,cb:n})}}),[i,V]),w=r.useCallback((function(){x({},{pulsate:!0})}),[x]),I=r.useCallback((function(e,t){if(clearTimeout(y.current),"touchend"===(null==e?void 0:e.type)&&b.current)return b.current(),b.current=null,void(y.current=setTimeout((function(){I(e,t)})));b.current=null,p((function(e){return e.length>0?e.slice(1):e})),m.current=t}),[]);return r.useImperativeHandle(t,(function(){return{pulsate:w,start:x,stop:I}}),[w,x,I]),(0,Vy.jsx)(nb,(0,oy.Z)({className:(0,sy.Z)(Yy.root,s.root,u),ref:k},c,{children:(0,Vy.jsx)(My,{component:null,exit:!0,children:d})}))})),ib=ab,ob=n(1217);function sb(e){return(0,ob.Z)("MuiButtonBase",e)}var ub,cb=(0,Wy.Z)("MuiButtonBase",["root","disabled","focusVisible"]),lb=["action","centerRipple","children","className","component","disabled","disableRipple","disableTouchRipple","focusRipple","focusVisibleClassName","LinkComponent","onBlur","onClick","onContextMenu","onDragLeave","onFocus","onFocusVisible","onKeyDown","onKeyUp","onMouseDown","onMouseLeave","onMouseUp","onTouchEnd","onTouchMove","onTouchStart","tabIndex","TouchRippleProps","touchRippleRef","type"],hb=(0,cy.ZP)("button",{name:"MuiButtonBase",slot:"Root",overridesResolver:function(e,t){return t.root}})((ub={display:"inline-flex",alignItems:"center",justifyContent:"center",position:"relative",boxSizing:"border-box",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none",textDecoration:"none",color:"inherit","&::-moz-focus-inner":{borderStyle:"none"}},(0,h.Z)(ub,"&.".concat(cb.disabled),{pointerEvents:"none",cursor:"default"}),(0,h.Z)(ub,"@media print",{colorAdjust:"exact"}),ub)),fb=r.forwardRef((function(e,t){var n=(0,ly.Z)({props:e,name:"MuiButtonBase"}),a=n.action,i=n.centerRipple,o=void 0!==i&&i,s=n.children,u=n.className,c=n.component,h=void 0===c?"button":c,f=n.disabled,d=void 0!==f&&f,p=n.disableRipple,v=void 0!==p&&p,m=n.disableTouchRipple,g=void 0!==m&&m,y=n.focusRipple,b=void 0!==y&&y,k=n.LinkComponent,V=void 0===k?"a":k,x=n.onBlur,w=n.onClick,I=n.onContextMenu,S=n.onDragLeave,C=n.onFocus,E=n.onFocusVisible,T=n.onKeyDown,N=n.onKeyUp,A=n.onMouseDown,R=n.onMouseLeave,_=n.onMouseUp,D=n.onTouchEnd,F=n.onTouchMove,O=n.onTouchStart,L=n.tabIndex,M=void 0===L?0:L,P=n.TouchRippleProps,z=n.touchRippleRef,B=n.type,U=(0,iy.Z)(n,lb),W=r.useRef(null),j=r.useRef(null),Z=(0,Ey.Z)(j,z),G=(0,Ny.Z)(),H=G.isFocusVisibleRef,q=G.onFocus,K=G.onBlur,X=G.ref,Q=r.useState(!1),Y=(0,l.Z)(Q,2),J=Y[0],$=Y[1];d&&J&&$(!1),r.useImperativeHandle(a,(function(){return{focusVisible:function(){$(!0),W.current.focus()}}}),[]);var ee=r.useState(!1),te=(0,l.Z)(ee,2),ne=te[0],re=te[1];r.useEffect((function(){re(!0)}),[]);var ae=ne&&!v&&!d;function ie(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:g;return(0,Ty.Z)((function(r){return t&&t(r),!n&&j.current&&j.current[e](r),!0}))}r.useEffect((function(){J&&b&&!v&&ne&&j.current.pulsate()}),[v,b,J,ne]);var oe=ie("start",A),se=ie("stop",I),ue=ie("stop",S),ce=ie("stop",_),le=ie("stop",(function(e){J&&e.preventDefault(),R&&R(e)})),he=ie("start",O),fe=ie("stop",D),de=ie("stop",F),pe=ie("stop",(function(e){K(e),!1===H.current&&$(!1),x&&x(e)}),!1),ve=(0,Ty.Z)((function(e){W.current||(W.current=e.currentTarget),q(e),!0===H.current&&($(!0),E&&E(e)),C&&C(e)})),me=function(){var e=W.current;return h&&"button"!==h&&!("A"===e.tagName&&e.href)},ge=r.useRef(!1),ye=(0,Ty.Z)((function(e){b&&!ge.current&&J&&j.current&&" "===e.key&&(ge.current=!0,j.current.stop(e,(function(){j.current.start(e)}))),e.target===e.currentTarget&&me()&&" "===e.key&&e.preventDefault(),T&&T(e),e.target===e.currentTarget&&me()&&"Enter"===e.key&&!d&&(e.preventDefault(),w&&w(e))})),be=(0,Ty.Z)((function(e){b&&" "===e.key&&j.current&&J&&!e.defaultPrevented&&(ge.current=!1,j.current.stop(e,(function(){j.current.pulsate(e)}))),N&&N(e),w&&e.target===e.currentTarget&&me()&&" "===e.key&&!e.defaultPrevented&&w(e)})),ke=h;"button"===ke&&(U.href||U.to)&&(ke=V);var Ve={};"button"===ke?(Ve.type=void 0===B?"button":B,Ve.disabled=d):(U.href||U.to||(Ve.role="button"),d&&(Ve["aria-disabled"]=d));var xe=(0,Ey.Z)(X,W),we=(0,Ey.Z)(t,xe);var Ie=(0,oy.Z)({},n,{centerRipple:o,component:h,disabled:d,disableRipple:v,disableTouchRipple:g,focusRipple:b,tabIndex:M,focusVisible:J}),Se=function(e){var t=e.disabled,n=e.focusVisible,r=e.focusVisibleClassName,a=e.classes,i={root:["root",t&&"disabled",n&&"focusVisible"]},o=(0,uy.Z)(i,sb,a);return n&&r&&(o.root+=" ".concat(r)),o}(Ie);return(0,Vy.jsxs)(hb,(0,oy.Z)({as:ke,className:(0,sy.Z)(Se.root,u),ownerState:Ie,onBlur:pe,onClick:w,onContextMenu:se,onFocus:ve,onKeyDown:ye,onKeyUp:be,onMouseDown:oe,onMouseLeave:le,onMouseUp:ce,onDragLeave:ue,onTouchEnd:fe,onTouchMove:de,onTouchStart:he,ref:we,tabIndex:d?-1:M,type:B},Ve,U,{children:[s,ae?(0,Vy.jsx)(ib,(0,oy.Z)({ref:Z,center:o},P)):null]}))})),db=fb;function pb(e){return(0,ob.Z)("MuiTabScrollButton",e)}var vb,mb,gb=(0,Wy.Z)("MuiTabScrollButton",["root","vertical","horizontal","disabled"]),yb=["className","direction","orientation","disabled"],bb=(0,cy.ZP)(db,{name:"MuiTabScrollButton",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,n.orientation&&t[n.orientation]]}})((function(e){var t=e.ownerState;return(0,oy.Z)((0,h.Z)({width:40,flexShrink:0,opacity:.8},"&.".concat(gb.disabled),{opacity:0}),"vertical"===t.orientation&&{width:"100%",height:40,"& svg":{transform:"rotate(".concat(t.isRtl?-90:90,"deg)")}})})),kb=r.forwardRef((function(e,t){var n=(0,ly.Z)({props:e,name:"MuiTabScrollButton"}),r=n.className,a=n.direction,i=(0,iy.Z)(n,yb),o="rtl"===dy().direction,s=(0,oy.Z)({isRtl:o},n),u=function(e){var t=e.classes,n={root:["root",e.orientation,e.disabled&&"disabled"]};return(0,uy.Z)(n,pb,t)}(s);return(0,Vy.jsx)(bb,(0,oy.Z)({component:"div",className:(0,sy.Z)(u.root,r),ref:t,role:null,ownerState:s,tabIndex:null},i,{children:"left"===a?vb||(vb=(0,Vy.jsx)(Sy,{fontSize:"small"})):mb||(mb=(0,Vy.jsx)(Cy,{fontSize:"small"}))}))}));function Vb(e){return(0,ob.Z)("MuiTabs",e)}var xb=(0,Wy.Z)("MuiTabs",["root","vertical","flexContainer","flexContainerVertical","centered","scroller","fixed","scrollableX","scrollableY","hideScrollbar","scrollButtons","scrollButtonsHideMobile","indicator"]),wb=n(5783),Ib=["aria-label","aria-labelledby","action","centered","children","className","component","allowScrollButtonsMobile","indicatorColor","onChange","orientation","ScrollButtonComponent","scrollButtons","selectionFollowsFocus","TabIndicatorProps","TabScrollButtonProps","textColor","value","variant","visibleScrollbar"],Sb=function(e,t){return e===t?e.firstChild:t&&t.nextElementSibling?t.nextElementSibling:e.firstChild},Cb=function(e,t){return e===t?e.lastChild:t&&t.previousElementSibling?t.previousElementSibling:e.lastChild},Eb=function(e,t,n){for(var r=!1,a=n(e,t);a;){if(a===e.firstChild){if(r)return;r=!0}var i=a.disabled||"true"===a.getAttribute("aria-disabled");if(a.hasAttribute("tabindex")&&!i)return void a.focus();a=n(e,a)}},Tb=(0,cy.ZP)("div",{name:"MuiTabs",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[(0,h.Z)({},"& .".concat(xb.scrollButtons),t.scrollButtons),(0,h.Z)({},"& .".concat(xb.scrollButtons),n.scrollButtonsHideMobile&&t.scrollButtonsHideMobile),t.root,n.vertical&&t.vertical]}})((function(e){var t=e.ownerState,n=e.theme;return(0,oy.Z)({overflow:"hidden",minHeight:48,WebkitOverflowScrolling:"touch",display:"flex"},t.vertical&&{flexDirection:"column"},t.scrollButtonsHideMobile&&(0,h.Z)({},"& .".concat(xb.scrollButtons),(0,h.Z)({},n.breakpoints.down("sm"),{display:"none"})))})),Nb=(0,cy.ZP)("div",{name:"MuiTabs",slot:"Scroller",overridesResolver:function(e,t){var n=e.ownerState;return[t.scroller,n.fixed&&t.fixed,n.hideScrollbar&&t.hideScrollbar,n.scrollableX&&t.scrollableX,n.scrollableY&&t.scrollableY]}})((function(e){var t=e.ownerState;return(0,oy.Z)({position:"relative",display:"inline-block",flex:"1 1 auto",whiteSpace:"nowrap"},t.fixed&&{overflowX:"hidden",width:"100%"},t.hideScrollbar&&{scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}},t.scrollableX&&{overflowX:"auto",overflowY:"hidden"},t.scrollableY&&{overflowY:"auto",overflowX:"hidden"})})),Ab=(0,cy.ZP)("div",{name:"MuiTabs",slot:"FlexContainer",overridesResolver:function(e,t){var n=e.ownerState;return[t.flexContainer,n.vertical&&t.flexContainerVertical,n.centered&&t.centered]}})((function(e){var t=e.ownerState;return(0,oy.Z)({display:"flex"},t.vertical&&{flexDirection:"column"},t.centered&&{justifyContent:"center"})})),Rb=(0,cy.ZP)("span",{name:"MuiTabs",slot:"Indicator",overridesResolver:function(e,t){return t.indicator}})((function(e){var t=e.ownerState,n=e.theme;return(0,oy.Z)({position:"absolute",height:2,bottom:0,width:"100%",transition:n.transitions.create()},"primary"===t.indicatorColor&&{backgroundColor:(n.vars||n).palette.primary.main},"secondary"===t.indicatorColor&&{backgroundColor:(n.vars||n).palette.secondary.main},t.vertical&&{height:"100%",width:2,right:0})})),_b=(0,cy.ZP)((function(e){var t=e.onChange,n=(0,iy.Z)(e,xy),a=r.useRef(),i=r.useRef(null),o=function(){a.current=i.current.offsetHeight-i.current.clientHeight};return r.useEffect((function(){var e=(0,vy.Z)((function(){var e=a.current;o(),e!==a.current&&t(a.current)})),n=(0,ky.Z)(i.current);return n.addEventListener("resize",e),function(){e.clear(),n.removeEventListener("resize",e)}}),[t]),r.useEffect((function(){o(),t(a.current)}),[t]),(0,Vy.jsx)("div",(0,oy.Z)({style:wy,ref:i},n))}),{name:"MuiTabs",slot:"ScrollbarSize"})({overflowX:"auto",overflowY:"hidden",scrollbarWidth:"none","&::-webkit-scrollbar":{display:"none"}}),Db={},Fb=r.forwardRef((function(e,t){var n=(0,ly.Z)({props:e,name:"MuiTabs"}),a=dy(),i="rtl"===a.direction,o=n["aria-label"],s=n["aria-labelledby"],u=n.action,c=n.centered,f=void 0!==c&&c,d=n.children,p=n.className,v=n.component,m=void 0===v?"div":v,g=n.allowScrollButtonsMobile,y=void 0!==g&&g,b=n.indicatorColor,k=void 0===b?"primary":b,V=n.onChange,x=n.orientation,w=void 0===x?"horizontal":x,I=n.ScrollButtonComponent,S=void 0===I?kb:I,C=n.scrollButtons,E=void 0===C?"auto":C,T=n.selectionFollowsFocus,N=n.TabIndicatorProps,A=void 0===N?{}:N,R=n.TabScrollButtonProps,_=void 0===R?{}:R,D=n.textColor,F=void 0===D?"primary":D,O=n.value,L=n.variant,M=void 0===L?"standard":L,P=n.visibleScrollbar,z=void 0!==P&&P,B=(0,iy.Z)(n,Ib),U="scrollable"===M,W="vertical"===w,j=W?"scrollTop":"scrollLeft",Z=W?"top":"left",G=W?"bottom":"right",H=W?"clientHeight":"clientWidth",q=W?"height":"width",K=(0,oy.Z)({},n,{component:m,allowScrollButtonsMobile:y,indicatorColor:k,orientation:w,vertical:W,scrollButtons:E,textColor:F,variant:M,visibleScrollbar:z,fixed:!U,hideScrollbar:U&&!z,scrollableX:U&&!W,scrollableY:U&&W,centered:f&&!U,scrollButtonsHideMobile:!y}),X=function(e){var t=e.vertical,n=e.fixed,r=e.hideScrollbar,a=e.scrollableX,i=e.scrollableY,o=e.centered,s=e.scrollButtonsHideMobile,u=e.classes,c={root:["root",t&&"vertical"],scroller:["scroller",n&&"fixed",r&&"hideScrollbar",a&&"scrollableX",i&&"scrollableY"],flexContainer:["flexContainer",t&&"flexContainerVertical",o&&"centered"],indicator:["indicator"],scrollButtons:["scrollButtons",s&&"scrollButtonsHideMobile"],scrollableX:[a&&"scrollableX"],hideScrollbar:[r&&"hideScrollbar"]};return(0,uy.Z)(c,Vb,u)}(K);var Q=r.useState(!1),Y=(0,l.Z)(Q,2),J=Y[0],$=Y[1],ee=r.useState(Db),te=(0,l.Z)(ee,2),ne=te[0],re=te[1],ae=r.useState({start:!1,end:!1}),ie=(0,l.Z)(ae,2),oe=ie[0],se=ie[1],ue=r.useState({overflow:"hidden",scrollbarWidth:0}),ce=(0,l.Z)(ue,2),le=ce[0],he=ce[1],fe=new Map,de=r.useRef(null),pe=r.useRef(null),ve=function(){var e,t,n=de.current;if(n){var r=n.getBoundingClientRect();e={clientWidth:n.clientWidth,scrollLeft:n.scrollLeft,scrollTop:n.scrollTop,scrollLeftNormalized:gy(n,a.direction),scrollWidth:n.scrollWidth,top:r.top,bottom:r.bottom,left:r.left,right:r.right}}if(n&&!1!==O){var i=pe.current.children;if(i.length>0){var o=i[fe.get(O)];0,t=o?o.getBoundingClientRect():null}}return{tabsMeta:e,tabMeta:t}},me=(0,Ty.Z)((function(){var e,t,n=ve(),r=n.tabsMeta,a=n.tabMeta,o=0;if(W)t="top",a&&r&&(o=a.top-r.top+r.scrollTop);else if(t=i?"right":"left",a&&r){var s=i?r.scrollLeftNormalized+r.clientWidth-r.scrollWidth:r.scrollLeft;o=(i?-1:1)*(a[t]-r[t]+s)}var u=(e={},(0,h.Z)(e,t,o),(0,h.Z)(e,q,a?a[q]:0),e);if(isNaN(ne[t])||isNaN(ne[q]))re(u);else{var c=Math.abs(ne[t]-u[t]),l=Math.abs(ne[q]-u[q]);(c>=1||l>=1)&&re(u)}})),ge=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.animation,r=void 0===n||n;r?by(j,de.current,e,{duration:a.transitions.duration.standard}):de.current[j]=e},ye=function(e){var t=de.current[j];W?t+=e:(t+=e*(i?-1:1),t*=i&&"reverse"===my()?-1:1),ge(t)},be=function(){for(var e=de.current[H],t=0,n=Array.from(pe.current.children),r=0;r<n.length;r+=1){var a=n[r];if(t+a[H]>e){0===r&&(t=e);break}t+=a[H]}return t},ke=function(){ye(-1*be())},Ve=function(){ye(be())},xe=r.useCallback((function(e){he({overflow:null,scrollbarWidth:e})}),[]),we=(0,Ty.Z)((function(e){var t=ve(),n=t.tabsMeta,r=t.tabMeta;if(r&&n)if(r[Z]<n[Z]){var a=n[j]+(r[Z]-n[Z]);ge(a,{animation:e})}else if(r[G]>n[G]){var i=n[j]+(r[G]-n[G]);ge(i,{animation:e})}})),Ie=(0,Ty.Z)((function(){if(U&&!1!==E){var e,t,n=de.current,r=n.scrollTop,o=n.scrollHeight,s=n.clientHeight,u=n.scrollWidth,c=n.clientWidth;if(W)e=r>1,t=r<o-s-1;else{var l=gy(de.current,a.direction);e=i?l<u-c-1:l>1,t=i?l>1:l<u-c-1}e===oe.start&&t===oe.end||se({start:e,end:t})}}));r.useEffect((function(){var e,t=(0,vy.Z)((function(){de.current&&(me(),Ie())})),n=(0,ky.Z)(de.current);return n.addEventListener("resize",t),"undefined"!==typeof ResizeObserver&&(e=new ResizeObserver(t),Array.from(pe.current.children).forEach((function(t){e.observe(t)}))),function(){t.clear(),n.removeEventListener("resize",t),e&&e.disconnect()}}),[me,Ie]);var Se=r.useMemo((function(){return(0,vy.Z)((function(){Ie()}))}),[Ie]);r.useEffect((function(){return function(){Se.clear()}}),[Se]),r.useEffect((function(){$(!0)}),[]),r.useEffect((function(){me(),Ie()})),r.useEffect((function(){we(Db!==ne)}),[we,ne]),r.useImperativeHandle(u,(function(){return{updateIndicator:me,updateScrollButtons:Ie}}),[me,Ie]);var Ce=(0,Vy.jsx)(Rb,(0,oy.Z)({},A,{className:(0,sy.Z)(X.indicator,A.className),ownerState:K,style:(0,oy.Z)({},ne,A.style)})),Ee=0,Te=r.Children.map(d,(function(e){if(!r.isValidElement(e))return null;var t=void 0===e.props.value?Ee:e.props.value;fe.set(t,Ee);var n=t===O;return Ee+=1,r.cloneElement(e,(0,oy.Z)({fullWidth:"fullWidth"===M,indicator:n&&!J&&Ce,selected:n,selectionFollowsFocus:T,onChange:V,textColor:F,value:t},1!==Ee||!1!==O||e.props.tabIndex?{}:{tabIndex:0}))})),Ne=function(){var e={};e.scrollbarSizeListener=U?(0,Vy.jsx)(_b,{onChange:xe,className:(0,sy.Z)(X.scrollableX,X.hideScrollbar)}):null;var t=oe.start||oe.end,n=U&&("auto"===E&&t||!0===E);return e.scrollButtonStart=n?(0,Vy.jsx)(S,(0,oy.Z)({orientation:w,direction:i?"right":"left",onClick:ke,disabled:!oe.start},_,{className:(0,sy.Z)(X.scrollButtons,_.className)})):null,e.scrollButtonEnd=n?(0,Vy.jsx)(S,(0,oy.Z)({orientation:w,direction:i?"left":"right",onClick:Ve,disabled:!oe.end},_,{className:(0,sy.Z)(X.scrollButtons,_.className)})):null,e}();return(0,Vy.jsxs)(Tb,(0,oy.Z)({className:(0,sy.Z)(X.root,p),ownerState:K,ref:t,as:m},B,{children:[Ne.scrollButtonStart,Ne.scrollbarSizeListener,(0,Vy.jsxs)(Nb,{className:X.scroller,ownerState:K,style:(0,h.Z)({overflow:le.overflow},W?"margin".concat(i?"Left":"Right"):"marginBottom",z?void 0:-le.scrollbarWidth),ref:de,onScroll:Se,children:[(0,Vy.jsx)(Ab,{"aria-label":o,"aria-labelledby":s,"aria-orientation":"vertical"===w?"vertical":null,className:X.flexContainer,ownerState:K,onKeyDown:function(e){var t=pe.current,n=(0,wb.Z)(t).activeElement;if("tab"===n.getAttribute("role")){var r="horizontal"===w?"ArrowLeft":"ArrowUp",a="horizontal"===w?"ArrowRight":"ArrowDown";switch("horizontal"===w&&i&&(r="ArrowRight",a="ArrowLeft"),e.key){case r:e.preventDefault(),Eb(t,n,Cb);break;case a:e.preventDefault(),Eb(t,n,Sb);break;case"Home":e.preventDefault(),Eb(t,null,Sb);break;case"End":e.preventDefault(),Eb(t,null,Cb)}}},ref:pe,role:"tablist",children:Te}),J&&Ce]}),Ne.scrollButtonEnd]}))})),Ob=Fb,Lb=n(9853);function Mb(e){return(0,ob.Z)("MuiTab",e)}var Pb=(0,Wy.Z)("MuiTab",["root","labelIcon","textColorInherit","textColorPrimary","textColorSecondary","selected","disabled","fullWidth","wrapped","iconWrapper"]),zb=["className","disabled","disableFocusRipple","fullWidth","icon","iconPosition","indicator","label","onChange","onClick","onFocus","selected","selectionFollowsFocus","textColor","value","wrapped"],Bb=(0,cy.ZP)(db,{name:"MuiTab",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,n.label&&n.icon&&t.labelIcon,t["textColor".concat((0,Lb.Z)(n.textColor))],n.fullWidth&&t.fullWidth,n.wrapped&&t.wrapped]}})((function(e){var t,n,r,a=e.theme,i=e.ownerState;return(0,oy.Z)({},a.typography.button,{maxWidth:360,minWidth:90,position:"relative",minHeight:48,flexShrink:0,padding:"12px 16px",overflow:"hidden",whiteSpace:"normal",textAlign:"center"},i.label&&{flexDirection:"top"===i.iconPosition||"bottom"===i.iconPosition?"column":"row"},{lineHeight:1.25},i.icon&&i.label&&(0,h.Z)({minHeight:72,paddingTop:9,paddingBottom:9},"& > .".concat(Pb.iconWrapper),(0,oy.Z)({},"top"===i.iconPosition&&{marginBottom:6},"bottom"===i.iconPosition&&{marginTop:6},"start"===i.iconPosition&&{marginRight:a.spacing(1)},"end"===i.iconPosition&&{marginLeft:a.spacing(1)})),"inherit"===i.textColor&&(t={color:"inherit",opacity:.6},(0,h.Z)(t,"&.".concat(Pb.selected),{opacity:1}),(0,h.Z)(t,"&.".concat(Pb.disabled),{opacity:(a.vars||a).palette.action.disabledOpacity}),t),"primary"===i.textColor&&(n={color:(a.vars||a).palette.text.secondary},(0,h.Z)(n,"&.".concat(Pb.selected),{color:(a.vars||a).palette.primary.main}),(0,h.Z)(n,"&.".concat(Pb.disabled),{color:(a.vars||a).palette.text.disabled}),n),"secondary"===i.textColor&&(r={color:(a.vars||a).palette.text.secondary},(0,h.Z)(r,"&.".concat(Pb.selected),{color:(a.vars||a).palette.secondary.main}),(0,h.Z)(r,"&.".concat(Pb.disabled),{color:(a.vars||a).palette.text.disabled}),r),i.fullWidth&&{flexShrink:1,flexGrow:1,flexBasis:0,maxWidth:"none"},i.wrapped&&{fontSize:a.typography.pxToRem(12)})})),Ub=r.forwardRef((function(e,t){var n=(0,ly.Z)({props:e,name:"MuiTab"}),a=n.className,i=n.disabled,o=void 0!==i&&i,s=n.disableFocusRipple,u=void 0!==s&&s,c=n.fullWidth,l=n.icon,h=n.iconPosition,f=void 0===h?"top":h,d=n.indicator,p=n.label,v=n.onChange,m=n.onClick,g=n.onFocus,y=n.selected,b=n.selectionFollowsFocus,k=n.textColor,V=void 0===k?"inherit":k,x=n.value,w=n.wrapped,I=void 0!==w&&w,S=(0,iy.Z)(n,zb),C=(0,oy.Z)({},n,{disabled:o,disableFocusRipple:u,selected:y,icon:!!l,iconPosition:f,label:!!p,fullWidth:c,textColor:V,wrapped:I}),E=function(e){var t=e.classes,n=e.textColor,r=e.fullWidth,a=e.wrapped,i=e.icon,o=e.label,s=e.selected,u=e.disabled,c={root:["root",i&&o&&"labelIcon","textColor".concat((0,Lb.Z)(n)),r&&"fullWidth",a&&"wrapped",s&&"selected",u&&"disabled"],iconWrapper:["iconWrapper"]};return(0,uy.Z)(c,Mb,t)}(C),T=l&&p&&r.isValidElement(l)?r.cloneElement(l,{className:(0,sy.Z)(E.iconWrapper,l.props.className)}):l;return(0,Vy.jsxs)(Bb,(0,oy.Z)({focusRipple:!u,className:(0,sy.Z)(E.root,a),ref:t,role:"tab","aria-selected":y,disabled:o,onClick:function(e){!y&&v&&v(e,x),m&&m(e)},onFocus:function(e){b&&!y&&v&&v(e,x),g&&g(e)},ownerState:C,tabIndex:y?0:-1},S,{children:["top"===f||"start"===f?(0,Vy.jsxs)(r.Fragment,{children:[T,p]}):(0,Vy.jsxs)(r.Fragment,{children:[p,T]}),d]}))})),Wb=Ub,jb=n(1125),Zb=n(104),Gb=n(2466),Hb=n(114),qb=["sx"];function Kb(e){var t,n=e.sx,r=function(e){var t={systemProps:{},otherProps:{}};return Object.keys(e).forEach((function(n){Hb.Gc[n]?t.systemProps[n]=e[n]:t.otherProps[n]=e[n]})),t}((0,iy.Z)(e,qb)),a=r.systemProps,i=r.otherProps;return t=Array.isArray(n)?[a].concat((0,H.Z)(n)):"function"===typeof n?function(){var e=n.apply(void 0,arguments);return(0,Gb.P)(e)?(0,oy.Z)({},a,e):a}:(0,oy.Z)({},a,n),(0,oy.Z)({},i,{sx:t})}var Xb=["className","component"];var Qb=n(5902),Yb=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.defaultTheme,n=e.defaultClassName,a=void 0===n?"MuiBox-root":n,i=e.generateClassName,o=e.styleFunctionSx,s=void 0===o?Zb.Z:o,u=(0,jb.ZP)("div",{shouldForwardProp:function(e){return"theme"!==e&&"sx"!==e&&"as"!==e}})(s),c=r.forwardRef((function(e,n){var r=(0,hy.Z)(t),o=Kb(e),s=o.className,c=o.component,l=void 0===c?"div":c,h=(0,iy.Z)(o,Xb);return(0,Vy.jsx)(u,(0,oy.Z)({as:l,ref:n,className:(0,sy.Z)(s,i?i(a):a),theme:r},h))}));return c}({defaultTheme:(0,n(4360).Z)(),defaultClassName:"MuiBox-root",generateClassName:Qb.Z.generate}),Jb=Yb,$b=n(1184),ek=n(5682),tk=["component","direction","spacing","divider","children"];function nk(e,t){var n=r.Children.toArray(e).filter(Boolean);return n.reduce((function(e,a,i){return e.push(a),i<n.length-1&&e.push(r.cloneElement(t,{key:"separator-".concat(i)})),e}),[])}var rk=(0,cy.ZP)("div",{name:"MuiStack",slot:"Root",overridesResolver:function(e,t){return[t.root]}})((function(e){var t=e.ownerState,n=e.theme,r=(0,oy.Z)({display:"flex",flexDirection:"column"},(0,$b.k9)({theme:n},(0,$b.P$)({values:t.direction,breakpoints:n.breakpoints.values}),(function(e){return{flexDirection:e}})));if(t.spacing){var a=(0,ek.hB)(n),i=Object.keys(n.breakpoints.values).reduce((function(e,n){return("object"===typeof t.spacing&&null!=t.spacing[n]||"object"===typeof t.direction&&null!=t.direction[n])&&(e[n]=!0),e}),{}),o=(0,$b.P$)({values:t.direction,base:i}),s=(0,$b.P$)({values:t.spacing,base:i});"object"===typeof o&&Object.keys(o).forEach((function(e,t,n){if(!o[e]){var r=t>0?o[n[t-1]]:"column";o[e]=r}}));r=(0,Gb.Z)(r,(0,$b.k9)({theme:n},s,(function(e,n){return{"& > :not(style) + :not(style)":(0,h.Z)({margin:0},"margin".concat((r=n?o[n]:t.direction,{row:"Left","row-reverse":"Right",column:"Top","column-reverse":"Bottom"}[r])),(0,ek.NA)(a,e))};var r})))}return r=(0,$b.dt)(n.breakpoints,r)})),ak=r.forwardRef((function(e,t){var n=Kb((0,ly.Z)({props:e,name:"MuiStack"})),r=n.component,a=void 0===r?"div":r,i=n.direction,o=void 0===i?"column":i,s=n.spacing,u=void 0===s?0:s,c=n.divider,l=n.children,h=(0,iy.Z)(n,tk),f={direction:o,spacing:u};return(0,Vy.jsx)(rk,(0,oy.Z)({as:a,ownerState:f,ref:t},h,{children:c?nk(l,c):l}))})),ik=ak,ok=n(5735),sk=n(2065);function uk(e){return(0,ob.Z)("MuiButton",e)}var ck=(0,Wy.Z)("MuiButton",["root","text","textInherit","textPrimary","textSecondary","textSuccess","textError","textInfo","textWarning","outlined","outlinedInherit","outlinedPrimary","outlinedSecondary","outlinedSuccess","outlinedError","outlinedInfo","outlinedWarning","contained","containedInherit","containedPrimary","containedSecondary","containedSuccess","containedError","containedInfo","containedWarning","disableElevation","focusVisible","disabled","colorInherit","textSizeSmall","textSizeMedium","textSizeLarge","outlinedSizeSmall","outlinedSizeMedium","outlinedSizeLarge","containedSizeSmall","containedSizeMedium","containedSizeLarge","sizeMedium","sizeSmall","sizeLarge","fullWidth","startIcon","endIcon","iconSizeSmall","iconSizeMedium","iconSizeLarge"]);var lk=r.createContext({}),hk=["children","color","component","className","disabled","disableElevation","disableFocusRipple","endIcon","focusVisibleClassName","fullWidth","size","startIcon","type","variant"],fk=["root"],dk=function(e){return(0,oy.Z)({},"small"===e.size&&{"& > *:nth-of-type(1)":{fontSize:18}},"medium"===e.size&&{"& > *:nth-of-type(1)":{fontSize:20}},"large"===e.size&&{"& > *:nth-of-type(1)":{fontSize:22}})},pk=(0,cy.ZP)(db,{shouldForwardProp:function(e){return(0,cy.FO)(e)||"classes"===e},name:"MuiButton",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,t[n.variant],t["".concat(n.variant).concat((0,Lb.Z)(n.color))],t["size".concat((0,Lb.Z)(n.size))],t["".concat(n.variant,"Size").concat((0,Lb.Z)(n.size))],"inherit"===n.color&&t.colorInherit,n.disableElevation&&t.disableElevation,n.fullWidth&&t.fullWidth]}})((function(e){var t,n,r,a=e.theme,i=e.ownerState;return(0,oy.Z)({},a.typography.button,(t={minWidth:64,padding:"6px 16px",borderRadius:(a.vars||a).shape.borderRadius,transition:a.transitions.create(["background-color","box-shadow","border-color","color"],{duration:a.transitions.duration.short}),"&:hover":(0,oy.Z)({textDecoration:"none",backgroundColor:a.vars?"rgba(".concat(a.vars.palette.text.primaryChannel," / ").concat(a.vars.palette.action.hoverOpacity,")"):(0,sk.Fq)(a.palette.text.primary,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"text"===i.variant&&"inherit"!==i.color&&{backgroundColor:a.vars?"rgba(".concat(a.vars.palette[i.color].mainChannel," / ").concat(a.vars.palette.action.hoverOpacity,")"):(0,sk.Fq)(a.palette[i.color].main,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"outlined"===i.variant&&"inherit"!==i.color&&{border:"1px solid ".concat((a.vars||a).palette[i.color].main),backgroundColor:a.vars?"rgba(".concat(a.vars.palette[i.color].mainChannel," / ").concat(a.vars.palette.action.hoverOpacity,")"):(0,sk.Fq)(a.palette[i.color].main,a.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},"contained"===i.variant&&{backgroundColor:(a.vars||a).palette.grey.A100,boxShadow:(a.vars||a).shadows[4],"@media (hover: none)":{boxShadow:(a.vars||a).shadows[2],backgroundColor:(a.vars||a).palette.grey[300]}},"contained"===i.variant&&"inherit"!==i.color&&{backgroundColor:(a.vars||a).palette[i.color].dark,"@media (hover: none)":{backgroundColor:(a.vars||a).palette[i.color].main}}),"&:active":(0,oy.Z)({},"contained"===i.variant&&{boxShadow:(a.vars||a).shadows[8]})},(0,h.Z)(t,"&.".concat(ck.focusVisible),(0,oy.Z)({},"contained"===i.variant&&{boxShadow:(a.vars||a).shadows[6]})),(0,h.Z)(t,"&.".concat(ck.disabled),(0,oy.Z)({color:(a.vars||a).palette.action.disabled},"outlined"===i.variant&&{border:"1px solid ".concat((a.vars||a).palette.action.disabledBackground)},"outlined"===i.variant&&"secondary"===i.color&&{border:"1px solid ".concat((a.vars||a).palette.action.disabled)},"contained"===i.variant&&{color:(a.vars||a).palette.action.disabled,boxShadow:(a.vars||a).shadows[0],backgroundColor:(a.vars||a).palette.action.disabledBackground})),t),"text"===i.variant&&{padding:"6px 8px"},"text"===i.variant&&"inherit"!==i.color&&{color:(a.vars||a).palette[i.color].main},"outlined"===i.variant&&{padding:"5px 15px",border:"1px solid currentColor"},"outlined"===i.variant&&"inherit"!==i.color&&{color:(a.vars||a).palette[i.color].main,border:a.vars?"1px solid rgba(".concat(a.vars.palette[i.color].mainChannel," / 0.5)"):"1px solid ".concat((0,sk.Fq)(a.palette[i.color].main,.5))},"contained"===i.variant&&{color:a.vars?a.vars.palette.text.primary:null==(n=(r=a.palette).getContrastText)?void 0:n.call(r,a.palette.grey[300]),backgroundColor:(a.vars||a).palette.grey[300],boxShadow:(a.vars||a).shadows[2]},"contained"===i.variant&&"inherit"!==i.color&&{color:(a.vars||a).palette[i.color].contrastText,backgroundColor:(a.vars||a).palette[i.color].main},"inherit"===i.color&&{color:"inherit",borderColor:"currentColor"},"small"===i.size&&"text"===i.variant&&{padding:"4px 5px",fontSize:a.typography.pxToRem(13)},"large"===i.size&&"text"===i.variant&&{padding:"8px 11px",fontSize:a.typography.pxToRem(15)},"small"===i.size&&"outlined"===i.variant&&{padding:"3px 9px",fontSize:a.typography.pxToRem(13)},"large"===i.size&&"outlined"===i.variant&&{padding:"7px 21px",fontSize:a.typography.pxToRem(15)},"small"===i.size&&"contained"===i.variant&&{padding:"4px 10px",fontSize:a.typography.pxToRem(13)},"large"===i.size&&"contained"===i.variant&&{padding:"8px 22px",fontSize:a.typography.pxToRem(15)},i.fullWidth&&{width:"100%"})}),(function(e){var t;return e.ownerState.disableElevation&&(t={boxShadow:"none","&:hover":{boxShadow:"none"}},(0,h.Z)(t,"&.".concat(ck.focusVisible),{boxShadow:"none"}),(0,h.Z)(t,"&:active",{boxShadow:"none"}),(0,h.Z)(t,"&.".concat(ck.disabled),{boxShadow:"none"}),t)})),vk=(0,cy.ZP)("span",{name:"MuiButton",slot:"StartIcon",overridesResolver:function(e,t){var n=e.ownerState;return[t.startIcon,t["iconSize".concat((0,Lb.Z)(n.size))]]}})((function(e){var t=e.ownerState;return(0,oy.Z)({display:"inherit",marginRight:8,marginLeft:-4},"small"===t.size&&{marginLeft:-2},dk(t))})),mk=(0,cy.ZP)("span",{name:"MuiButton",slot:"EndIcon",overridesResolver:function(e,t){var n=e.ownerState;return[t.endIcon,t["iconSize".concat((0,Lb.Z)(n.size))]]}})((function(e){var t=e.ownerState;return(0,oy.Z)({display:"inherit",marginRight:-4,marginLeft:8},"small"===t.size&&{marginRight:-2},dk(t))})),gk=r.forwardRef((function(e,t){var n=r.useContext(lk),a=(0,ok.Z)(n,e),i=(0,ly.Z)({props:a,name:"MuiButton"}),o=i.children,s=i.color,u=void 0===s?"primary":s,c=i.component,l=void 0===c?"button":c,h=i.className,f=i.disabled,d=void 0!==f&&f,p=i.disableElevation,v=void 0!==p&&p,m=i.disableFocusRipple,g=void 0!==m&&m,y=i.endIcon,b=i.focusVisibleClassName,k=i.fullWidth,V=void 0!==k&&k,x=i.size,w=void 0===x?"medium":x,I=i.startIcon,S=i.type,C=i.variant,E=void 0===C?"text":C,T=(0,iy.Z)(i,hk),N=(0,oy.Z)({},i,{color:u,component:l,disabled:d,disableElevation:v,disableFocusRipple:g,fullWidth:V,size:w,type:S,variant:E}),A=function(e){var t=e.color,n=e.disableElevation,r=e.fullWidth,a=e.size,i=e.variant,o=e.classes,s={root:["root",i,"".concat(i).concat((0,Lb.Z)(t)),"size".concat((0,Lb.Z)(a)),"".concat(i,"Size").concat((0,Lb.Z)(a)),"inherit"===t&&"colorInherit",n&&"disableElevation",r&&"fullWidth"],label:["label"],startIcon:["startIcon","iconSize".concat((0,Lb.Z)(a))],endIcon:["endIcon","iconSize".concat((0,Lb.Z)(a))]},u=(0,uy.Z)(s,uk,o);return(0,oy.Z)({},o,u)}(N),R=A.root,_=(0,iy.Z)(A,fk),D=I&&(0,Vy.jsx)(vk,{className:_.startIcon,ownerState:N,children:I}),F=y&&(0,Vy.jsx)(mk,{className:_.endIcon,ownerState:N,children:y});return(0,Vy.jsxs)(pk,(0,oy.Z)({ownerState:N,className:(0,sy.Z)(n.className,R,h),component:l,disabled:d,focusRipple:!g,focusVisibleClassName:(0,sy.Z)(_.focusVisible,b),ref:t,type:S},T,{classes:_,children:[D,o,F]}))})),yk=gk;function bk(){var e=(0,r.useState)("shirts"),t=(0,l.Z)(e,2),n=t[0],a=t[1],i=(0,r.useState)(),o=(0,l.Z)(i,2),u=o[0],h=o[1],f=(0,r.useState)(),d=(0,l.Z)(f,2),p=d[0],v=d[1];(0,r.useEffect)((function(){var e=[];ay.collection(n).onSnapshot((function(t){for(var n=0;n<t.docs.length;n++)t.docs[n].data().photo&&e.push({id:t.docs[n].id,photo:t.docs[n].data().photo});h(e)}))}),[n,p]);function m(){return(m=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(null),e.next=3,ay.collection(n).doc(u[p].id).delete();case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return(0,Vy.jsxs)("div",{children:[(0,Vy.jsx)(Jb,{sx:{maxWidth:{xs:320,sm:480},bgcolor:"background.paper"},children:(0,Vy.jsxs)(Ob,{id:"selectorContainer",value:n,onChange:function(e,t){v(null),a(t)},variant:"scrollable",scrollButtons:"false","aria-label":"scrollable auto tabs example",children:[(0,Vy.jsx)(Wb,{label:"Shirts",value:"shirts"}),(0,Vy.jsx)(Wb,{label:"Pants/Shorts",value:"pants"}),(0,Vy.jsx)(Wb,{label:"Shoes",value:"shoes"})]})}),(0,Vy.jsx)("br",{}),(0,Vy.jsx)("br",{}),null!=p&&(0,Vy.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"column"},children:[(0,Vy.jsx)("img",{id:"editWardrobe",src:u[p].photo}),(0,Vy.jsxs)(ik,{spacing:2,direction:"row",children:[(0,Vy.jsx)(yk,{onClick:function(){return m.apply(this,arguments)},variant:"contained",children:"Delete Image"}),(0,Vy.jsx)(yk,{variant:"contained",onClick:function(){v(null)},children:"Return"})]})]}),null==p&&(0,Vy.jsx)("div",{children:u&&u.map((function(e,t){return(0,Vy.jsx)("div",{className:"imgContainer",style:{position:"relative"},children:(0,Vy.jsx)("img",{src:e.photo,alt:n,onClick:function(){v(t)}},t)})}))})]})}function kk(e){return(0,ob.Z)("MuiBottomNavigation",e)}(0,Wy.Z)("MuiBottomNavigation",["root"]);var Vk=["children","className","component","onChange","showLabels","value"],xk=(0,cy.ZP)("div",{name:"MuiBottomNavigation",slot:"Root",overridesResolver:function(e,t){return t.root}})((function(e){var t=e.theme;return{display:"flex",justifyContent:"center",height:56,backgroundColor:(t.vars||t).palette.background.paper}})),wk=r.forwardRef((function(e,t){var n=(0,ly.Z)({props:e,name:"MuiBottomNavigation"}),a=n.children,i=n.className,o=n.component,s=void 0===o?"div":o,u=n.onChange,c=n.showLabels,l=void 0!==c&&c,h=n.value,f=(0,iy.Z)(n,Vk),d=(0,oy.Z)({},n,{component:s,showLabels:l}),p=function(e){var t=e.classes;return(0,uy.Z)({root:["root"]},kk,t)}(d);return(0,Vy.jsx)(xk,(0,oy.Z)({as:s,className:(0,sy.Z)(p.root,i),ref:t,ownerState:d},f,{children:r.Children.map(a,(function(e,t){if(!r.isValidElement(e))return null;var n=void 0===e.props.value?t:e.props.value;return r.cloneElement(e,{selected:n===h,showLabel:void 0!==e.props.showLabel?e.props.showLabel:l,value:n,onChange:u})}))}))}));function Ik(e){return(0,ob.Z)("MuiBottomNavigationAction",e)}var Sk,Ck=(0,Wy.Z)("MuiBottomNavigationAction",["root","iconOnly","selected","label"]),Ek=["className","icon","label","onChange","onClick","selected","showLabel","value"],Tk=(0,cy.ZP)(db,{name:"MuiBottomNavigationAction",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,!n.showLabel&&!n.selected&&t.iconOnly]}})((function(e){var t=e.theme,n=e.ownerState;return(0,oy.Z)({transition:t.transitions.create(["color","padding-top"],{duration:t.transitions.duration.short}),padding:"0px 12px",minWidth:80,maxWidth:168,color:(t.vars||t).palette.text.secondary,flexDirection:"column",flex:"1"},!n.showLabel&&!n.selected&&{paddingTop:14},!n.showLabel&&!n.selected&&!n.label&&{paddingTop:0},(0,h.Z)({},"&.".concat(Ck.selected),{color:(t.vars||t).palette.primary.main}))})),Nk=(0,cy.ZP)("span",{name:"MuiBottomNavigationAction",slot:"Label",overridesResolver:function(e,t){return t.label}})((function(e){var t=e.theme,n=e.ownerState;return(0,oy.Z)({fontFamily:t.typography.fontFamily,fontSize:t.typography.pxToRem(12),opacity:1,transition:"font-size 0.2s, opacity 0.2s",transitionDelay:"0.1s"},!n.showLabel&&!n.selected&&{opacity:0,transitionDelay:"0s"},(0,h.Z)({},"&.".concat(Ck.selected),{fontSize:t.typography.pxToRem(14)}))})),Ak=r.forwardRef((function(e,t){var n=(0,ly.Z)({props:e,name:"MuiBottomNavigationAction"}),r=n.className,a=n.icon,i=n.label,o=n.onChange,s=n.onClick,u=n.value,c=(0,iy.Z)(n,Ek),l=n,h=function(e){var t=e.classes,n=e.showLabel,r=e.selected,a={root:["root",!n&&!r&&"iconOnly",r&&"selected"],label:["label",!n&&!r&&"iconOnly",r&&"selected"]};return(0,uy.Z)(a,Ik,t)}(l);return(0,Vy.jsxs)(Tk,(0,oy.Z)({ref:t,className:(0,sy.Z)(h.root,r),focusRipple:!0,onClick:function(e){o&&o(e,u),s&&s(e)},ownerState:l},c,{children:[a,(0,Vy.jsx)(Nk,{className:h.label,ownerState:l,children:i})]}))})),Rk=n(2868),_k=n(135),Dk=n(3411);function Fk(){return Fk=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Fk.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(Sk||(Sk={}));var Ok,Lk="popstate";function Mk(e){return{usr:e.state,key:e.key}}function Pk(e,t,n,r){return void 0===n&&(n=null),Fk({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?Bk(t):t,{state:n,key:(null==t?void 0:t.key)||r||Math.random().toString(36).substr(2,8)})}function zk(e){var t=e.pathname,n=void 0===t?"/":t,r=e.search,a=void 0===r?"":r,i=e.hash,o=void 0===i?"":i;return a&&"?"!==a&&(n+="?"===a.charAt(0)?a:"?"+a),o&&"#"!==o&&(n+="#"===o.charAt(0)?o:"#"+o),n}function Bk(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}function Uk(e,t,n,r){void 0===r&&(r={});var a=r,i=a.window,o=void 0===i?document.defaultView:i,s=a.v5Compat,u=void 0!==s&&s,c=o.history,l=Sk.Pop,h=null;function f(){l=Sk.Pop,h&&h({action:l,location:d.location})}var d={get action(){return l},get location(){return e(o,c)},listen:function(e){if(h)throw new Error("A history only accepts one active listener");return o.addEventListener(Lk,f),h=e,function(){o.removeEventListener(Lk,f),h=null}},createHref:function(e){return t(o,e)},push:function(e,t){l=Sk.Push;var r=Pk(d.location,e,t);null==n||n(r,e);var a=Mk(r),i=d.createHref(r);try{c.pushState(a,"",i)}catch(s){o.location.assign(i)}u&&h&&h({action:l,location:r})},replace:function(e,t){l=Sk.Replace;var r=Pk(d.location,e,t);null==n||n(r,e);var a=Mk(r),i=d.createHref(r);c.replaceState(a,"",i),u&&h&&h({action:l,location:r})},go:function(e){return c.go(e)}};return d}function Wk(e,t,n){return void 0===t&&(t=[]),void 0===n&&(n=new Set),e.map((function(e,r){var a=[].concat((0,H.Z)(t),[r]),i="string"===typeof e.id?e.id:a.join("-");return Yk(!n.has(i),'Found a route id collision on id "'+i+"\".  Route id's must be globally unique within Data Router usages"),n.add(i),Fk({},e,{id:i,children:e.children?Wk(e.children,a,n):void 0})}))}function jk(e,t,n){void 0===n&&(n="/");var r=Qk(("string"===typeof t?Bk(t):t).pathname||"/",n);if(null==r)return null;var a=Zk(e);!function(e){e.sort((function(e,t){return e.score!==t.score?t.score-e.score:function(e,t){var n=e.length===t.length&&e.slice(0,-1).every((function(e,n){return e===t[n]}));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((function(e){return e.childrenIndex})),t.routesMeta.map((function(e){return e.childrenIndex})))}))}(a);for(var i=null,o=0;null==i&&o<a.length;++o)i=Kk(a[o],r);return i}function Zk(e,t,n,r){return void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r=""),e.forEach((function(e,a){var i={relativePath:e.path||"",caseSensitive:!0===e.caseSensitive,childrenIndex:a,route:e};i.relativePath.startsWith("/")&&(Yk(i.relativePath.startsWith(r),'Absolute route path "'+i.relativePath+'" nested under path "'+r+'" is not valid. An absolute child route path must start with the combined path of all its parent routes.'),i.relativePath=i.relativePath.slice(r.length));var o=eV([r,i.relativePath]),s=n.concat(i);e.children&&e.children.length>0&&(Yk(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'+o+'".'),Zk(e.children,t,s,o)),(null!=e.path||e.index)&&t.push({path:o,score:qk(o,e.index),routesMeta:s})})),t}!function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"}(Ok||(Ok={}));var Gk=/^:\w+$/,Hk=function(e){return"*"===e};function qk(e,t){var n=e.split("/"),r=n.length;return n.some(Hk)&&(r+=-2),t&&(r+=2),n.filter((function(e){return!Hk(e)})).reduce((function(e,t){return e+(Gk.test(t)?3:""===t?1:10)}),r)}function Kk(e,t){for(var n=e.routesMeta,r={},a="/",i=[],o=0;o<n.length;++o){var s=n[o],u=o===n.length-1,c="/"===a?t:t.slice(a.length)||"/",l=Xk({path:s.relativePath,caseSensitive:s.caseSensitive,end:u},c);if(!l)return null;Object.assign(r,l.params);var h=s.route;i.push({params:r,pathname:eV([a,l.pathname]),pathnameBase:tV(eV([a,l.pathnameBase])),route:h}),"/"!==l.pathnameBase&&(a=eV([a,l.pathnameBase]))}return i}function Xk(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});var n=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);Jk("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were "'+e.replace(/\*$/,"/*")+'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "'+e.replace(/\*$/,"/*")+'".');var r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/:(\w+)/g,(function(e,t){return r.push(t),"([^\\/]+)"}));e.endsWith("*")?(r.push("*"),a+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):a+=n?"\\/*$":"(?:(?=[@.~-]|%[0-9A-F]{2})|\\b|\\/|$)";return[new RegExp(a,t?void 0:"i"),r]}(e.path,e.caseSensitive,e.end),r=(0,l.Z)(n,2),a=r[0],i=r[1],o=t.match(a);if(!o)return null;var s=o[0],u=s.replace(/(.)\/+$/,"$1"),c=o.slice(1);return{params:i.reduce((function(e,t,n){if("*"===t){var r=c[n]||"";u=s.slice(0,s.length-r.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(n){return Jk(!1,'The value for the URL param "'+t+'" will not be decoded because the string "'+e+'" is a malformed URL segment. This is probably due to a bad percent encoding ('+n+")."),e}}(c[n]||"",t),e}),{}),pathname:s,pathnameBase:u,pattern:e}}function Qk(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;var n=t.endsWith("/")?t.length-1:t.length,r=e.charAt(n);return r&&"/"!==r?null:e.slice(n)||"/"}function Yk(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function Jk(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(n){}}}function $k(e,t,n,r){void 0===r&&(r=!1);var a,i="string"===typeof e?Bk(e):Fk({},e),o=""===e||""===i.pathname,s=o?"/":i.pathname;if(r||null==s)a=n;else{var u=t.length-1;if(s.startsWith("..")){for(var c=s.split("/");".."===c[0];)c.shift(),u-=1;i.pathname=c.join("/")}a=u>=0?t[u]:"/"}var l=function(e,t){void 0===t&&(t="/");var n="string"===typeof e?Bk(e):e,r=n.pathname,a=n.search,i=void 0===a?"":a,o=n.hash,s=void 0===o?"":o,u=r?r.startsWith("/")?r:function(e,t){var n=t.replace(/\/+$/,"").split("/");return e.split("/").forEach((function(e){".."===e?n.length>1&&n.pop():"."!==e&&n.push(e)})),n.length>1?n.join("/"):"/"}(r,t):t;return{pathname:u,search:nV(i),hash:rV(s)}}(i,a),h=s&&"/"!==s&&s.endsWith("/"),f=(o||"."===s)&&n.endsWith("/");return l.pathname.endsWith("/")||!h&&!f||(l.pathname+="/"),l}var eV=function(e){return e.join("/").replace(/\/\/+/g,"/")},tV=function(e){return e.replace(/\/+$/,"").replace(/^\/*/,"/")},nV=function(e){return e&&"?"!==e?e.startsWith("?")?e:"?"+e:""},rV=function(e){return e&&"#"!==e?e.startsWith("#")?e:"#"+e:""},aV=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n)}(S(Error)),iV=function(){function e(t){var n,r=this;f(this,e),this.pendingKeys=new Set,this.subscriber=void 0,Yk(t&&"object"===typeof t&&!Array.isArray(t),"defer() only accepts plain objects"),this.abortPromise=new Promise((function(e,t){return n=t})),this.controller=new AbortController;var a=function(){return n(new aV("Deferred data aborted"))};this.unlistenAbortSignal=function(){return r.controller.signal.removeEventListener("abort",a)},this.controller.signal.addEventListener("abort",a),this.data=Object.entries(t).reduce((function(e,t){var n=(0,l.Z)(t,2),a=n[0],i=n[1];return Object.assign(e,(0,h.Z)({},a,r.trackPromise(a,i)))}),{})}return p(e,[{key:"trackPromise",value:function(e,t){var n=this;if(!(t instanceof Promise))return t;this.pendingKeys.add(e);var r=Promise.race([t,this.abortPromise]).then((function(t){return n.onSettle(r,e,null,t)}),(function(t){return n.onSettle(r,e,t)}));return r.catch((function(){})),Object.defineProperty(r,"_tracked",{get:function(){return!0}}),r}},{key:"onSettle",value:function(e,t,n,r){var a,i;return this.controller.signal.aborted&&n instanceof aV?(this.unlistenAbortSignal(),Object.defineProperty(e,"_error",{get:function(){return n}}),Promise.reject(n)):(this.pendingKeys.delete(t),this.done&&this.unlistenAbortSignal(),n?(Object.defineProperty(e,"_error",{get:function(){return n}}),null==(i=this.subscriber)||i.call(this,!1),Promise.reject(n)):(Object.defineProperty(e,"_data",{get:function(){return r}}),null==(a=this.subscriber)||a.call(this,!1),r))}},{key:"subscribe",value:function(e){this.subscriber=e}},{key:"cancel",value:function(){var e,t=this;this.controller.abort(),this.pendingKeys.forEach((function(e,n){return t.pendingKeys.delete(n)})),null==(e=this.subscriber)||e.call(this,!0)}},{key:"resolveData",value:function(){var e=c(s().mark((function e(t){var n,r,a=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=!1,this.done){e.next=7;break}return r=function(){return a.cancel()},t.addEventListener("abort",r),e.next=6,new Promise((function(e){a.subscribe((function(n){t.removeEventListener("abort",r),(n||a.done)&&e(n)}))}));case 6:n=e.sent;case 7:return e.abrupt("return",n);case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"done",get:function(){return 0===this.pendingKeys.size}},{key:"unwrappedData",get:function(){return Yk(null!==this.data&&this.done,"Can only unwrap data on initialized and settled deferreds"),Object.entries(this.data).reduce((function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1];return Object.assign(e,(0,h.Z)({},r,function(e){if(!function(e){return e instanceof Promise&&!0===e._tracked}(e))return e;if(e._error)throw e._error;return e._data}(a)))}),{})}}]),e}();var oV=p((function e(t,n,r){f(this,e),this.status=t,this.statusText=n||"",this.data=r}));function sV(e){return e instanceof oV}var uV={state:"idle",location:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},cV={state:"idle",data:void 0,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0};function lV(e){var t,n,r;Yk(e.routes.length>0,"You must provide a non-empty routes array to createRouter");var a=Wk(e.routes),i=null,o=new Set,u=null,f=null,d=null,p=!1,v=jk(a,e.history.location,e.basename),g=null;if(null==v){var y=SV(a),b=y.matches,k=y.route,V=y.error;v=b,g=(0,h.Z)({},k.id,V)}var x,w,I=!v.some((function(e){return e.route.loader}))||null!=e.hydrationData,S={historyAction:e.history.action,location:e.history.location,matches:v,initialized:I,navigation:uV,restoreScrollPosition:null,preventScrollReset:!1,revalidation:"idle",loaderData:(null==(t=e.hydrationData)?void 0:t.loaderData)||{},actionData:(null==(n=e.hydrationData)?void 0:n.actionData)||null,errors:(null==(r=e.hydrationData)?void 0:r.errors)||g,fetchers:new Map},C=Sk.Pop,E=!1,T=!1,N=!1,A=[],R=[],_=new Map,D=0,F=-1,O=new Map,L=new Set,M=new Map,P=new Map;function z(e){S=Fk({},S,e),o.forEach((function(e){return e(S)}))}function B(t,n){z(Fk({},null!=S.actionData&&null!=S.navigation.formMethod&&"loading"===S.navigation.state?{}:{actionData:null},n,n.loaderData?{loaderData:wV(S.loaderData,n.loaderData,n.matches||[])}:{},{historyAction:C,location:t,initialized:!0,navigation:uV,revalidation:"idle",restoreScrollPosition:!S.navigation.formData&&he(t,n.matches||S.matches),preventScrollReset:E})),T||C===Sk.Pop||(C===Sk.Push?e.history.push(t,t.state):C===Sk.Replace&&e.history.replace(t,t.state)),C=Sk.Pop,E=!1,T=!1,N=!1,A=[],R=[]}function U(){return U=c(s().mark((function t(n,r){var a,i,o,u,c,l,h;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("number"!==typeof n){t.next=3;break}return e.history.go(n),t.abrupt("return");case 3:return a=hV(n,r),i=a.path,o=a.submission,u=a.error,c=Pk(S.location,i,null==r?void 0:r.state),l=!0===(null==r?void 0:r.replace)||null!=o?Sk.Replace:Sk.Push,h=r&&"preventScrollReset"in r?!0===r.preventScrollReset:void 0,t.next=9,W(l,c,{submission:o,pendingError:u,preventScrollReset:h,replace:null==r?void 0:r.replace});case 9:return t.abrupt("return",t.sent);case 10:case"end":return t.stop()}}),t)}))),U.apply(this,arguments)}function W(e,t,n){return j.apply(this,arguments)}function j(){return j=c(s().mark((function t(n,r,i){var o,u,c,l,f,d,p,v,m,g,y,b,k,V,x,I;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==(o=w)||o.abort(),w=null,C=n,T=!0===(null==i?void 0:i.startUninterruptedRevalidation),le(S.location,S.matches),E=!0===(null==i?void 0:i.preventScrollReset),u=null==i?void 0:i.overrideNavigation,c=jk(a,r,e.basename)){t.next=13;break}return l=SV(a),f=l.matches,d=l.route,p=l.error,ce(),B(r,{matches:f,loaderData:{},errors:(0,h.Z)({},d.id,p)}),t.abrupt("return");case 13:if(!NV(S.location,r)){t.next=16;break}return B(r,{matches:c}),t.abrupt("return");case 16:if(w=new AbortController,v=bV(r,w.signal,null==i?void 0:i.submission),null==i||!i.pendingError){t.next=22;break}g=(0,h.Z)({},IV(c).route.id,i.pendingError),t.next=32;break;case 22:if(null==i||!i.submission){t.next=32;break}return t.next=25,Z(v,r,i.submission,c,{replace:i.replace});case 25:if(!(y=t.sent).shortCircuited){t.next=28;break}return t.abrupt("return");case 28:m=y.pendingActionData,g=y.pendingActionError,b=Fk({state:"loading",location:r},i.submission),u=b;case 32:return t.next=34,q(v,r,c,u,null==i?void 0:i.submission,null==i?void 0:i.replace,m,g);case 34:if(k=t.sent,V=k.shortCircuited,x=k.loaderData,I=k.errors,!V){t.next=40;break}return t.abrupt("return");case 40:w=null,B(r,{matches:c,loaderData:x,errors:I});case 42:case"end":return t.stop()}}),t)}))),j.apply(this,arguments)}function Z(e,t,n,r,a){return G.apply(this,arguments)}function G(){return G=c(s().mark((function e(t,n,r,a,i){var o,u,c,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ne(),z({navigation:Fk({state:"submitting",location:n},r)}),(u=PV(a,n)).route.action){e.next=8;break}o=CV(n),e.next=13;break;case 8:return e.next=10,gV("action",t,u);case 10:if(o=e.sent,!t.signal.aborted){e.next=13;break}return e.abrupt("return",{shortCircuited:!0});case 13:if(!_V(o)){e.next=18;break}return c=Fk({state:"loading",location:Pk(S.location,o.location)},r),e.next=17,J(o,c,null==i?void 0:i.replace);case 17:return e.abrupt("return",{shortCircuited:!0});case 18:if(!RV(o)){e.next=22;break}return l=IV(a,u.route.id),!0!==(null==i?void 0:i.replace)&&(C=Sk.Push),e.abrupt("return",{pendingActionError:(0,h.Z)({},l.route.id,o.error)});case 22:if(!AV(o)){e.next=24;break}throw new Error("defer() is not supported in actions");case 24:return e.abrupt("return",{pendingActionData:(0,h.Z)({},u.route.id,o.data)});case 25:case"end":return e.stop()}}),e)}))),G.apply(this,arguments)}function q(e,t,n,r,a,i,o,s){return K.apply(this,arguments)}function K(){return K=c(s().mark((function e(t,n,r,a,i,o,u,c){var h,f,d,p,v,m,g,y,b,k,V,x,I,C,E;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((h=a)||(h={state:"loading",location:n,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0}),f=pV(S,r,i,n,N,A,R,u,c,M),d=(0,l.Z)(f,2),p=d[0],v=d[1],ce((function(e){return!(null!=r&&r.some((function(t){return t.route.id===e})))||(null==p?void 0:p.some((function(t){return t.route.id===e})))})),0!==p.length||0!==v.length){e.next=7;break}return B(n,{matches:r,loaderData:wV(S.loaderData,{},r),errors:c||null,actionData:u||null}),e.abrupt("return",{shortCircuited:!0});case 7:return T||(v.forEach((function(e){var t,n=(0,l.Z)(e,1)[0],r={state:"loading",data:null==(t=S.fetchers.get(n))?void 0:t.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0};S.fetchers.set(n,r)})),z(Fk({navigation:h,actionData:u||S.actionData||null},v.length>0?{fetchers:new Map(S.fetchers)}:{}))),F=++D,v.forEach((function(e){var t=(0,l.Z)(e,1)[0];return _.set(t,w)})),e.next=12,ee(S.matches,p,v,t);case 12:if(m=e.sent,g=m.results,y=m.loaderResults,b=m.fetcherResults,!t.signal.aborted){e.next=18;break}return e.abrupt("return",{shortCircuited:!0});case 18:if(v.forEach((function(e){var t=(0,l.Z)(e,1)[0];return _.delete(t)})),!(k=EV(g))){e.next=25;break}return V=fV(S,k),e.next=24,J(k,V,o);case 24:return e.abrupt("return",{shortCircuited:!0});case 25:return x=xV(S,r,p,y,c,v,b,P),I=x.loaderData,C=x.errors,P.forEach((function(e,t){e.subscribe((function(n){(n||e.done)&&P.delete(t)}))})),se(),E=ue(F),e.abrupt("return",Fk({loaderData:I,errors:C},E||v.length>0?{fetchers:new Map(S.fetchers)}:{}));case 30:case"end":return e.stop()}}),e)}))),K.apply(this,arguments)}function X(e){return S.fetchers.get(e)||cV}function Q(){return Q=c(s().mark((function t(n,r,i,o,u){var c,f,d,p,v,m,g,y,b,k,V,x,I,E,T,U,W,j,Z,G,H,q,K,X,Q,Y,$,te,ae;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ne(),M.delete(n),o.route.action){t.next=6;break}return f=CV(i),d=f.error,re(n,r,d),t.abrupt("return");case 6:return p=Fk({state:"submitting"},u,{data:(null==(c=S.fetchers.get(n))?void 0:c.data)||void 0}),S.fetchers.set(n,p),z({fetchers:new Map(S.fetchers)}),v=new AbortController,m=bV(i,v.signal,u),_.set(n,v),t.next=14,gV("action",m,o);case 14:if(g=t.sent,!m.signal.aborted){t.next=18;break}return _.get(n)===v&&_.delete(n),t.abrupt("return");case 18:if(!_V(g)){t.next=28;break}return _.delete(n),L.add(n),y=Fk({state:"loading"},u,{data:void 0}),S.fetchers.set(n,y),z({fetchers:new Map(S.fetchers)}),b=Fk({state:"loading",location:Pk(S.location,g.location)},u),t.next=27,J(g,b);case 27:return t.abrupt("return");case 28:if(!RV(g)){t.next=31;break}return re(n,r,g.error),t.abrupt("return");case 31:return AV(g)&&Yk(!1,"defer() is not supported in actions"),k=S.navigation.location||S.location,V=bV(k,v.signal),Yk(x="idle"!==S.navigation.state?jk(a,S.navigation.location,e.basename):S.matches,"Didn't find any matches after fetcher action"),I=++D,O.set(n,I),E=Fk({state:"loading",data:g.data},u),S.fetchers.set(n,E),T=pV(S,x,u,k,N,A,R,(0,h.Z)({},o.route.id,g.data),void 0,M),U=(0,l.Z)(T,2),W=U[0],(j=U[1]).filter((function(e){return(0,l.Z)(e,1)[0]!==n})).forEach((function(e){var t,n=(0,l.Z)(e,1)[0],r={state:"loading",data:null==(t=S.fetchers.get(n))?void 0:t.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0};S.fetchers.set(n,r),_.set(n,v)})),z({fetchers:new Map(S.fetchers)}),t.next=45,ee(S.matches,W,j,V);case 45:if(Z=t.sent,G=Z.results,H=Z.loaderResults,q=Z.fetcherResults,!v.signal.aborted){t.next=51;break}return t.abrupt("return");case 51:if(O.delete(n),_.delete(n),j.forEach((function(e){var t=(0,l.Z)(e,1)[0];return _.delete(t)})),!(K=EV(G))){t.next=60;break}return b=fV(S,K),t.next=59,J(K,b);case 59:return t.abrupt("return");case 60:X=xV(S,S.matches,W,H,void 0,j,q,P),Q=X.loaderData,Y=X.errors,$={state:"idle",data:g.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},S.fetchers.set(n,$),te=ue(I),"loading"===S.navigation.state&&I>F?(Yk(C,"Expected pending action"),null==(ae=w)||ae.abort(),B(S.navigation.location,{matches:x,loaderData:Q,errors:Y,fetchers:new Map(S.fetchers)})):(z(Fk({errors:Y,loaderData:wV(S.loaderData,Q,x)},te?{fetchers:new Map(S.fetchers)}:{})),N=!1);case 65:case"end":return t.stop()}}),t)}))),Q.apply(this,arguments)}function Y(){return(Y=c(s().mark((function e(t,n,r,a){var i,o,u,c,l,f,d,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o={state:"loading",formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0,data:(null==(i=S.fetchers.get(t))?void 0:i.data)||void 0},S.fetchers.set(t,o),z({fetchers:new Map(S.fetchers)}),u=new AbortController,c=bV(r,u.signal),_.set(t,u),e.next=8,gV("loader",c,a);case 8:if(!AV(l=e.sent)){e.next=16;break}return e.next=12,OV(l,c.signal,!0);case 12:if(e.t0=e.sent,e.t0){e.next=15;break}e.t0=l;case 15:l=e.t0;case 16:if(_.get(t)===u&&_.delete(t),!c.signal.aborted){e.next=19;break}return e.abrupt("return");case 19:if(!_V(l)){e.next=24;break}return f=fV(S,l),e.next=23,J(l,f);case 23:return e.abrupt("return");case 24:if(!RV(l)){e.next=29;break}return d=IV(S.matches,n),S.fetchers.delete(t),z({fetchers:new Map(S.fetchers),errors:(0,h.Z)({},d.route.id,l.error)}),e.abrupt("return");case 29:Yk(!AV(l),"Unhandled fetcher deferred data"),p={state:"idle",data:l.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0},S.fetchers.set(t,p),z({fetchers:new Map(S.fetchers)});case 33:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function J(e,t,n){return $.apply(this,arguments)}function $(){return $=c(s().mark((function e(t,n,r){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.revalidate&&(N=!0),Yk(n.location,"Expected a location on the redirect navigation"),w=null,a=!0===r?Sk.Replace:Sk.Push,e.next=6,W(a,n.location,{overrideNavigation:n});case 6:case"end":return e.stop()}}),e)}))),$.apply(this,arguments)}function ee(e,t,n,r){return te.apply(this,arguments)}function te(){return(te=c(s().mark((function e(t,n,r,a){var i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([].concat((0,H.Z)(n.map((function(e){return gV("loader",a,e)}))),(0,H.Z)(r.map((function(e){var t=(0,l.Z)(e,3),n=t[1],r=t[2];return gV("loader",bV(n,a.signal),r)})))));case 2:return i=e.sent,o=i.slice(0,n.length),u=i.slice(n.length),e.next=7,Promise.all([DV(t,n,o,a.signal,!1,S.loaderData),DV(t,r.map((function(e){return(0,l.Z)(e,3)[2]})),u,a.signal,!0)]);case 7:return e.abrupt("return",{results:i,loaderResults:o,fetcherResults:u});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ne(){var e;N=!0,(e=A).push.apply(e,(0,H.Z)(ce())),M.forEach((function(e,t){_.has(t)&&(R.push(t),ie(t))}))}function re(e,t,n){var r=IV(S.matches,t);ae(e),z({errors:(0,h.Z)({},r.route.id,n),fetchers:new Map(S.fetchers)})}function ae(e){_.has(e)&&ie(e),M.delete(e),O.delete(e),L.delete(e),S.fetchers.delete(e)}function ie(e){var t=_.get(e);Yk(t,"Expected fetch controller: "+e),t.abort(),_.delete(e)}function oe(e){var t,n=m(e);try{for(n.s();!(t=n.n()).done;){var r=t.value,a={state:"idle",data:X(r).data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0};S.fetchers.set(r,a)}}catch(i){n.e(i)}finally{n.f()}}function se(){var e,t=[],n=m(L);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=S.fetchers.get(r);Yk(a,"Expected fetcher: "+r),"loading"===a.state&&(L.delete(r),t.push(r))}}catch(i){n.e(i)}finally{n.f()}oe(t)}function ue(e){var t,n=[],r=m(O);try{for(r.s();!(t=r.n()).done;){var a=(0,l.Z)(t.value,2),i=a[0];if(a[1]<e){var o=S.fetchers.get(i);Yk(o,"Expected fetcher: "+i),"loading"===o.state&&(ie(i),O.delete(i),n.push(i))}}}catch(s){r.e(s)}finally{r.f()}return oe(n),n.length>0}function ce(e){var t=[];return P.forEach((function(n,r){e&&!e(r)||(n.cancel(),t.push(r),P.delete(r))})),t}function le(e,t){if(u&&f&&d){var n=t.map((function(e){return MV(e,S.loaderData)})),r=f(e,n)||e.key;u[r]=d()}}function he(e,t){if(u&&f&&d){var n=t.map((function(e){return MV(e,S.loaderData)})),r=f(e,n)||e.key,a=u[r];if("number"===typeof a)return a}return null}return x={get basename(){return e.basename},get state(){return S},get routes(){return a},initialize:function(){return i=e.history.listen((function(e){return W(e.action,e.location)})),S.initialized||W(Sk.Pop,S.location),x},subscribe:function(e){return o.add(e),function(){return o.delete(e)}},enableScrollRestoration:function(e,t,n){if(u=e,d=t,f=n||function(e){return e.key},!p&&S.navigation===uV){p=!0;var r=he(S.location,S.matches);null!=r&&z({restoreScrollPosition:r})}return function(){u=null,d=null,f=null}},navigate:function(e,t){return U.apply(this,arguments)},fetch:function(t,n,r,i){if("undefined"===typeof AbortController)throw new Error("router.fetch() was called during the server render, but it shouldn't be. You are likely calling a useFetcher() method in the body of your component. Try moving it to a useEffect or a callback.");_.has(t)&&ie(t);var o=jk(a,r,e.basename);if(o){var s=hV(r,i),u=s.path,c=s.submission,l=PV(o,u);c?function(e,t,n,r,a){Q.apply(this,arguments)}(t,n,u,l,c):(M.set(t,[u,l]),function(e,t,n,r){Y.apply(this,arguments)}(t,n,u,l))}else re(t,n,new oV(404,"Not Found",null))},revalidate:function(){ne(),z({revalidation:"loading"}),"submitting"!==S.navigation.state&&("idle"!==S.navigation.state?W(C||S.historyAction,S.navigation.location,{overrideNavigation:S.navigation}):W(S.historyAction,S.location,{startUninterruptedRevalidation:!0}))},createHref:TV,getFetcher:X,deleteFetcher:ae,dispose:function(){var e;i&&i(),o.clear(),null==(e=w)||e.abort(),S.fetchers.forEach((function(e,t){return ae(t)}))},_internalFetchControllers:_,_internalActiveDeferreds:P},x}function hV(e,t){var n="string"===typeof e?e:zk(e);if(!t||!("formMethod"in t)&&!("formData"in t))return{path:n};if(null!=t.formMethod&&"get"!==t.formMethod)return{path:n,submission:{formMethod:t.formMethod,formAction:TV(Bk(n)),formEncType:(null==t?void 0:t.formEncType)||"application/x-www-form-urlencoded",formData:t.formData}};if(!t.formData)return{path:n};var r=Bk(n);try{var a=kV(t.formData);r.search="?"+a}catch(i){return{path:n,error:new oV(400,"Bad Request","Cannot submit binary form data using GET")}}return{path:zk(r)}}function fV(e,t){var n=e.navigation,r=n.formMethod,a=n.formAction,i=n.formEncType,o=n.formData;return{state:"loading",location:Pk(e.location,t.location),formMethod:r||void 0,formAction:a||void 0,formEncType:i||void 0,formData:o||void 0}}function dV(e,t){var n=e;if(t){var r=e.findIndex((function(e){return e.route.id===t}));r>=0&&(n=e.slice(0,r))}return n}function pV(e,t,n,r,a,i,o,s,u,c){var h=u?Object.values(u)[0]:s?Object.values(s)[0]:null,f=dV(t,u?Object.keys(u)[0]:void 0).filter((function(t,o){return null!=t.route.loader&&(function(e,t,n){var r=!t||n.route.id!==t.route.id,a=void 0===e[n.route.id];return r||a}(e.loaderData,e.matches[o],t)||i.some((function(e){return e===t.route.id}))||mV(e.location,e.matches[o],n,r,t,a,h))})),d=[];return null==c||c.forEach((function(e,t){var r=(0,l.Z)(e,2),i=r[0],s=r[1];if(o.includes(t))d.push([t,i,s]);else if(a){mV(i,s,n,i,s,a,h)&&d.push([t,i,s])}})),[f,d]}function vV(e,t){var n;return e.pathname!==t.pathname||(null==(n=e.route.path)?void 0:n.endsWith("*"))&&e.params["*"]!==t.params["*"]}function mV(e,t,n,r,a,i,o){var s=zV(e),u=t.params,c=zV(r),l=a.params,h=vV(t,a)||s.toString()===c.toString()||s.search!==c.search||i;if(a.route.shouldRevalidate){var f=a.route.shouldRevalidate(Fk({currentUrl:s,currentParams:u,nextUrl:c,nextParams:l},n,{actionResult:o,defaultShouldRevalidate:h}));if("boolean"===typeof f)return f}return h}function gV(e,t,n,r,a){return yV.apply(this,arguments)}function yV(){return(yV=c(s().mark((function e(t,n,r,a,i){var o,u,c,l,h,f,d,p,v,m;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===a&&(a=!1),void 0===i&&(i=!1),l=new Promise((function(e,t){return c=t})),h=function(){return c()},n.signal.addEventListener("abort",h),e.prev=5,Yk(f=r.route[t],"Could not find the "+t+' to run on the "'+r.route.id+'" route'),e.next=10,Promise.race([f({request:n,params:r.params}),l]);case 10:u=e.sent,e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),o=Ok.error,u=e.t0;case 17:return e.prev=17,n.signal.removeEventListener("abort",h),e.finish(17);case 20:if(!(u instanceof Response)){e.next=41;break}if(p=u.status,v=u.headers.get("Location"),!i){e.next=25;break}throw u;case 25:if(!(p>=300&&p<=399&&null!=v)){e.next=29;break}if(!a){e.next=28;break}throw u;case 28:return e.abrupt("return",{type:Ok.redirect,status:p,location:v,revalidate:null!==u.headers.get("X-Remix-Revalidate")});case 29:if(null==(d=u.headers.get("Content-Type"))||!d.startsWith("application/json")){e.next=35;break}return e.next=32,u.json();case 32:m=e.sent,e.next=38;break;case 35:return e.next=37,u.text();case 37:m=e.sent;case 38:if(o!==Ok.error){e.next=40;break}return e.abrupt("return",{type:o,error:new oV(p,u.statusText,m),headers:u.headers});case 40:return e.abrupt("return",{type:Ok.data,data:m,statusCode:u.status,headers:u.headers});case 41:if(o!==Ok.error){e.next=43;break}return e.abrupt("return",{type:o,error:u});case 43:if(!(u instanceof iV)){e.next=45;break}return e.abrupt("return",{type:Ok.deferred,deferredData:u});case 45:return e.abrupt("return",{type:Ok.data,data:u});case 46:case"end":return e.stop()}}),e,null,[[5,13,17,20]])})))).apply(this,arguments)}function bV(e,t,n){var r=zV(e).toString(),a={signal:t};if(n){var i=n.formMethod,o=n.formEncType,s=n.formData;a.method=i.toUpperCase(),a.body="application/x-www-form-urlencoded"===o?kV(s):s}return new Request(r,a)}function kV(e){var t,n=new URLSearchParams,r=m(e.entries());try{for(r.s();!(t=r.n()).done;){var a=(0,l.Z)(t.value,2),i=a[0],o=a[1];Yk("string"===typeof o,'File inputs are not supported with encType "application/x-www-form-urlencoded", please use "multipart/form-data" instead.'),n.append(i,o)}}catch(s){r.e(s)}finally{r.f()}return n}function VV(e,t,n,r,a){var i,o={},s=null,u=!1,c={};return n.forEach((function(n,l){var f=t[l].route.id;if(Yk(!_V(n),"Cannot handle redirect results in processLoaderData"),RV(n)){var d=IV(e,f),p=n.error;r&&(p=Object.values(r)[0],r=void 0),s=Object.assign(s||{},(0,h.Z)({},d.route.id,p)),u||(u=!0,i=sV(n.error)?n.error.status:500),n.headers&&(c[f]=n.headers)}else AV(n)?(null==a||a.set(f,n.deferredData),o[f]=n.deferredData.data):(o[f]=n.data,200===n.statusCode||u||(i=n.statusCode),n.headers&&(c[f]=n.headers))})),r&&(s=r),{loaderData:o,errors:s,statusCode:i||200,loaderHeaders:c}}function xV(e,t,n,r,a,i,o,s){for(var u=VV(t,n,r,a,s),c=u.loaderData,f=u.errors,d=0;d<i.length;d++){var p=(0,l.Z)(i[d],3),v=p[0],m=p[2];Yk(void 0!==o&&void 0!==o[d],"Did not find corresponding fetcher result");var g=o[d];if(RV(g)){var y,b=IV(e.matches,m.route.id);null!=(y=f)&&y[b.route.id]||(f=Fk({},f,(0,h.Z)({},b.route.id,g.error))),e.fetchers.delete(v)}else{if(_V(g))throw new Error("Unhandled fetcher revalidation redirect");if(AV(g))throw new Error("Unhandled fetcher deferred data");var k={state:"idle",data:g.data,formMethod:void 0,formAction:void 0,formEncType:void 0,formData:void 0};e.fetchers.set(v,k)}}return{loaderData:c,errors:f}}function wV(e,t,n){var r=Fk({},t);return n.forEach((function(n){var a=n.route.id;void 0===t[a]&&void 0!==e[a]&&(r[a]=e[a])})),r}function IV(e,t){return(t?e.slice(0,e.findIndex((function(e){return e.route.id===t}))+1):(0,H.Z)(e)).reverse().find((function(e){return!0===e.route.hasErrorBoundary}))||e[0]}function SV(e){var t=e.find((function(e){return e.index||""===e.path||"/"===e.path}))||{id:"__shim-404-route__"};return{matches:[{params:{},pathname:"",pathnameBase:"",route:t}],route:t,error:new oV(404,"Not Found",null)}}function CV(e){var t="string"===typeof e?e:TV(e);return console.warn("You're trying to submit to a route that does not have an action.  To fix this, please add an `action` function to the route for ["+t+"]"),{type:Ok.error,error:new oV(405,"Method Not Allowed","No action found for ["+t+"]")}}function EV(e){for(var t=e.length-1;t>=0;t--){var n=e[t];if(_V(n))return n}}function TV(e){return(e.pathname||"")+(e.search||"")}function NV(e,t){return e.pathname===t.pathname&&e.search===t.search&&e.hash!==t.hash}function AV(e){return e.type===Ok.deferred}function RV(e){return e.type===Ok.error}function _V(e){return(null==e?void 0:e.type)===Ok.redirect}function DV(e,t,n,r,a,i){return FV.apply(this,arguments)}function FV(){return FV=c(s().mark((function e(t,n,r,a,i,o){var u,c;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:u=s().mark((function e(u){var c,l,h,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(c=r[u],l=n[u],h=t.find((function(e){return e.route.id===l.route.id})),f=null!=h&&!vV(h,l)&&void 0!==(null==o?void 0:o[l.route.id]),!AV(c)||!i&&!f){e.next=7;break}return e.next=7,OV(c,a,i).then((function(e){e&&(r[u]=e||r[u])}));case 7:case"end":return e.stop()}}),e)})),c=0;case 2:if(!(c<r.length)){e.next=7;break}return e.delegateYield(u(c),"t0",4);case 4:c++,e.next=2;break;case 7:case"end":return e.stop()}}),e)}))),FV.apply(this,arguments)}function OV(e,t,n){return LV.apply(this,arguments)}function LV(){return LV=c(s().mark((function e(t,n,r){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0===r&&(r=!1),e.next=3,t.deferredData.resolveData(n);case 3:if(!e.sent){e.next=6;break}return e.abrupt("return");case 6:if(!r){e.next=14;break}return e.prev=7,e.abrupt("return",{type:Ok.data,data:t.deferredData.unwrappedData});case 11:return e.prev=11,e.t0=e.catch(7),e.abrupt("return",{type:Ok.error,error:e.t0});case 14:return e.abrupt("return",{type:Ok.data,data:t.deferredData.data});case 15:case"end":return e.stop()}}),e,null,[[7,11]])}))),LV.apply(this,arguments)}function MV(e,t){var n=e.route,r=e.pathname,a=e.params;return{id:n.id,pathname:r,params:a,data:t[n.id],handle:n.handle}}function PV(e,t){var n="string"===typeof t?Bk(t).search:t.search;return e[e.length-1].route.index&&!function(e){return new URLSearchParams(e).getAll("index").some((function(e){return""===e}))}(n||"")?e.slice(-2)[0]:e.slice(-1)[0]}function zV(e){var t="undefined"!==typeof window&&"undefined"!==typeof window.location?window.location.origin:"unknown://unknown",n="string"===typeof e?e:TV(e);return new URL(n,t)}function BV(){return BV=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},BV.apply(this,arguments)}var UV="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},WV=r.useState,jV=r.useEffect,ZV=r.useLayoutEffect,GV=r.useDebugValue;function HV(e){var t=e.getSnapshot,n=e.value;try{var r=t();return!UV(n,r)}catch(a){return!0}}"undefined"===typeof window||"undefined"===typeof window.document||window.document.createElement;var qV=a.useSyncExternalStore,KV=r.createContext(null);var XV=r.createContext(null);var QV=r.createContext(null);var YV=r.createContext(null);var JV=r.createContext(null);var $V=r.createContext(null);var ex=r.createContext({outlet:null,matches:[]});var tx=r.createContext(null);function nx(){return null!=r.useContext($V)}function rx(){return nx()||Yk(!1),r.useContext($V).location}function ax(e){return e.filter((function(t,n){return 0===n||!t.route.index&&t.pathnameBase!==e[n-1].pathnameBase}))}function ix(){nx()||Yk(!1);var e=r.useContext(JV),t=e.basename,n=e.navigator,a=r.useContext(ex).matches,i=rx().pathname,o=JSON.stringify(ax(a).map((function(e){return e.pathnameBase}))),s=r.useRef(!1);r.useEffect((function(){s.current=!0}));var u=r.useCallback((function(e,r){if(void 0===r&&(r={}),s.current)if("number"!==typeof e){var a=$k(e,JSON.parse(o),i,"path"===r.relative);"/"!==t&&(a.pathname="/"===a.pathname?t:eV([t,a.pathname])),(r.replace?n.replace:n.push)(a,r.state,r)}else n.go(e)}),[t,n,o,i]);return u}var ox=r.createContext(null);function sx(e,t){var n=(void 0===t?{}:t).relative,a=r.useContext(ex).matches,i=rx().pathname,o=JSON.stringify(ax(a).map((function(e){return e.pathnameBase})));return r.useMemo((function(){return $k(e,JSON.parse(o),i,"path"===n)}),[e,o,i,n])}function ux(){var e=function(){var e,t=r.useContext(tx),n=dx(cx.UseRouteError),a=r.useContext(ex),i=a.matches[a.matches.length-1];if(t)return t;return a||Yk(!1),!i.route.id&&Yk(!1),null==(e=n.errors)?void 0:e[i.route.id]}(),t=sV(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),n=e instanceof Error?e.stack:null,a="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:a},o={padding:"2px 4px",backgroundColor:a};return r.createElement(r.Fragment,null,r.createElement("h2",null,"Unhandled Thrown Error!"),r.createElement("h3",{style:{fontStyle:"italic"}},t),n?r.createElement("pre",{style:i},n):null,r.createElement("p",null,"\ud83d\udcbf Hey developer \ud83d\udc4b"),r.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own\xa0",r.createElement("code",{style:o},"errorElement")," props on\xa0",r.createElement("code",{style:o},"<Route>")))}var cx,lx=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).state={location:e.location,error:e.error},r}return p(n,[{key:"componentDidCatch",value:function(e,t){console.error("React Router caught the following error during render",e,t)}},{key:"render",value:function(){return this.state.error?r.createElement(tx.Provider,{value:this.state.error,children:this.props.component}):this.props.children}}],[{key:"getDerivedStateFromError",value:function(e){return{error:e}}},{key:"getDerivedStateFromProps",value:function(e,t){return t.location!==e.location?{error:e.error,location:e.location}:{error:e.error||t.error,location:t.location}}}]),n}(r.Component);function hx(e){var t=e.routeContext,n=e.match,a=e.children,i=r.useContext(KV);return i&&n.route.errorElement&&(i._deepestRenderedBoundaryId=n.route.id),r.createElement(ex.Provider,{value:t},a)}function fx(e,t,n){if(void 0===t&&(t=[]),null==e){if(null==n||!n.errors)return null;e=n.matches}var a=e,i=null==n?void 0:n.errors;if(null!=i){var o=a.findIndex((function(e){return e.route.id&&(null==i?void 0:i[e.route.id])}));o>=0||Yk(!1),a=a.slice(0,Math.min(a.length,o+1))}return a.reduceRight((function(e,o,s){var u=o.route.id?null==i?void 0:i[o.route.id]:null,c=n?o.route.errorElement||r.createElement(ux,null):null,l=function(){return r.createElement(hx,{match:o,routeContext:{outlet:e,matches:t.concat(a.slice(0,s+1))}},u?c:void 0!==o.route.element?o.route.element:e)};return n&&(o.route.errorElement||0===s)?r.createElement(lx,{location:n.location,component:c,error:u,children:l()}):l()}),null)}function dx(e){var t=r.useContext(QV);return t||Yk(!1),t}!function(e){e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator"}(cx||(cx={}));var px;function vx(e){var t=e.fallbackElement,n=e.router,a=qV(n.subscribe,(function(){return n.state}),(function(){return n.state})),i=r.useMemo((function(){return{createHref:n.createHref,go:function(e){return n.navigate(e)},push:function(e,t,r){return n.navigate(e,{state:t,preventScrollReset:null==r?void 0:r.preventScrollReset})},replace:function(e,t,r){return n.navigate(e,{replace:!0,state:t,preventScrollReset:null==r?void 0:r.preventScrollReset})}}}),[n]),o=n.basename||"/";return r.createElement(XV.Provider,{value:{router:n,navigator:i,static:!1,basename:o}},r.createElement(QV.Provider,{value:a},r.createElement(bx,{basename:n.basename,location:n.state.location,navigationType:n.state.historyAction,navigator:i},n.state.initialized?r.createElement(kx,null):t)))}function mx(e){var t=e.to,n=e.replace,a=e.state,i=e.relative;nx()||Yk(!1);var o=r.useContext(QV),s=ix();return r.useEffect((function(){o&&"idle"!==o.navigation.state||s(t,{replace:n,state:a,relative:i})})),null}function gx(e){return function(e){var t=r.useContext(ex).outlet;return t?r.createElement(ox.Provider,{value:e},t):t}(e.context)}function yx(e){Yk(!1)}function bx(e){var t=e.basename,n=void 0===t?"/":t,a=e.children,i=void 0===a?null:a,o=e.location,s=e.navigationType,u=void 0===s?Sk.Pop:s,c=e.navigator,l=e.static,h=void 0!==l&&l;nx()&&Yk(!1);var f=n.replace(/^\/*/,"/"),d=r.useMemo((function(){return{basename:f,navigator:c,static:h}}),[f,c,h]);"string"===typeof o&&(o=Bk(o));var p=o,v=p.pathname,m=void 0===v?"/":v,g=p.search,y=void 0===g?"":g,b=p.hash,k=void 0===b?"":b,V=p.state,x=void 0===V?null:V,w=p.key,I=void 0===w?"default":w,S=r.useMemo((function(){var e=Qk(m,f);return null==e?null:{pathname:e,search:y,hash:k,state:x,key:I}}),[f,m,y,k,x,I]);return null==S?null:r.createElement(JV.Provider,{value:d},r.createElement($V.Provider,{children:i,value:{location:S,navigationType:u}}))}function kx(e){var t=e.children,n=e.location,a=r.useContext(XV);return function(e,t){nx()||Yk(!1);var n,a=r.useContext(QV),i=r.useContext(ex).matches,o=i[i.length-1],s=o?o.params:{},u=(o&&o.pathname,o?o.pathnameBase:"/"),c=(o&&o.route,rx());if(t){var l,h="string"===typeof t?Bk(t):t;"/"===u||(null==(l=h.pathname)?void 0:l.startsWith(u))||Yk(!1),n=h}else n=c;var f=n.pathname||"/",d=jk(e,{pathname:"/"===u?f:f.slice(u.length)||"/"}),p=fx(d&&d.map((function(e){return Object.assign({},e,{params:Object.assign({},s,e.params),pathname:eV([u,e.pathname]),pathnameBase:"/"===e.pathnameBase?u:eV([u,e.pathnameBase])})})),i,a||void 0);return t?r.createElement($V.Provider,{value:{location:BV({pathname:"/",search:"",hash:"",state:null,key:"default"},n),navigationType:Sk.Pop}},p):p}(a&&!t?a.router.routes:xx(t),n)}!function(e){e[e.pending=0]="pending",e[e.success=1]="success",e[e.error=2]="error"}(px||(px={}));var Vx=new Promise((function(){}));r.Component;function xx(e,t){void 0===t&&(t=[]);var n=[];return r.Children.forEach(e,(function(e,a){if(r.isValidElement(e))if(e.type!==r.Fragment){e.type!==yx&&Yk(!1);var i=[].concat((0,H.Z)(t),[a]),o={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,index:e.props.index,path:e.props.path,loader:e.props.loader,action:e.props.action,errorElement:e.props.errorElement,hasErrorBoundary:null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle};e.props.children&&(o.children=xx(e.props.children,i)),n.push(o)}else n.push.apply(n,xx(e.props.children,t))})),n}function wx(e){return e.map((function(e){var t=BV({},e);return null==t.hasErrorBoundary&&(t.hasErrorBoundary=null!=t.errorElement),t.children&&(t.children=wx(t.children)),t}))}function Ix(){return Ix=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Ix.apply(this,arguments)}function Sx(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}var Cx=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset"];var Ex=r.forwardRef((function(e,t){var n=e.onClick,a=e.relative,i=e.reloadDocument,o=e.replace,s=e.state,u=e.target,c=e.to,l=e.preventScrollReset,h=Sx(e,Cx),f=function(e,t){var n=(void 0===t?{}:t).relative;nx()||Yk(!1);var a=r.useContext(JV),i=a.basename,o=a.navigator,s=sx(e,{relative:n}),u=s.hash,c=s.pathname,l=s.search,h=c;return"/"!==i&&(h="/"===c?i:eV([i,c])),o.createHref({pathname:h,search:l,hash:u})}(c,{relative:a}),d=function(e,t){var n=void 0===t?{}:t,a=n.target,i=n.replace,o=n.state,s=n.preventScrollReset,u=n.relative,c=ix(),l=rx(),h=sx(e,{relative:u});return r.useCallback((function(t){if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(t,a)){t.preventDefault();var n=void 0!==i?i:zk(l)===zk(h);c(e,{replace:n,state:o,preventScrollReset:s,relative:u})}}),[l,c,h,i,o,a,e,s,u])}(c,{replace:o,state:s,target:u,preventScrollReset:l,relative:a});return r.createElement("a",Ix({},h,{href:f,onClick:i?n:function(e){n&&n(e),e.defaultPrevented||d(e)},ref:t,target:u}))}));function Tx(){var e=window.location.route,t=r.useState(e),n=(0,l.Z)(t,2),a=n[0],i=n[1];return(0,Vy.jsxs)("div",{id:"container",style:{zIndex:99999},children:[(0,Vy.jsx)(Jb,{sx:{width:500},children:(0,Vy.jsxs)(wk,{showLabels:!0,value:a,onChange:function(e,t){i(t)},children:[(0,Vy.jsx)(Ak,{value:"/wardrobe",label:"My Wardrobe",icon:(0,Vy.jsx)(_k.Z,{}),component:Ex,to:"/wardrobe"}),(0,Vy.jsx)(Ak,{value:"/camera",label:"Camera",icon:(0,Vy.jsx)(Rk.Z,{}),component:Ex,to:"/camera"}),(0,Vy.jsx)(Ak,{value:"/fits",label:"My Fits",icon:(0,Vy.jsx)(Dk.Z,{}),component:Ex,to:"/fits"})]})}),(0,Vy.jsx)(kx,{children:(0,Vy.jsx)(yx,{path:"/",element:(0,Vy.jsx)(mx,{to:"/camera"})})})]})}var Nx=function(){return(0,Vy.jsxs)("div",{className:"App",children:[(0,Vy.jsx)(gx,{}),(0,Vy.jsx)(Tx,{})]})},Ax=n(6050),Rx=n.n(Ax),_x=function(){function e(t,n){f(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return p(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),Dx=function(){function e(){f(this,e)}return p(e,[{key:"refCount",value:function(e){return Fx("refCount")}},{key:"incRef",value:function(e){return Fx("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return Fx("time")}},{key:"read",value:function(e){return Fx("read")}},{key:"readSync",value:function(e){return Fx("readSync")}},{key:"readToGPU",value:function(e,t){return Fx("readToGPU")}},{key:"numDataIds",value:function(){return Fx("numDataIds")}},{key:"disposeData",value:function(e,t){return Fx("disposeData")}},{key:"write",value:function(e,t,n){return Fx("write")}},{key:"move",value:function(e,t,n,r,a){return Fx("move")}},{key:"memory",value:function(){return Fx("memory")}},{key:"floatPrecision",value:function(){return Fx("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return Fx("dispose")}}]),e}();function Fx(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function Ox(e){for(var t=e.length,n=0;t>0;)n=Math.random()*t|0,Px(e,--t,n)}function Lx(e,t,n){return Math.max(e,Math.min(t,n))}function Mx(e){return e%2===0?e:e+1}function Px(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function zx(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function Bx(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function Ux(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";Bx(Gx(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function Wx(e){Bx(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function jx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||nw(e)&&!n)for(var r=0;r<e.length;++r)jx(e[r],t,n);else t.push(e);return t}function Zx(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function Gx(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function Hx(e){return e%1===0}function qx(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function Kx(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function Xx(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var i=0;!function o(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}}()}))}function Qx(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}function Yx(e,t){var n=t.length;return Bx((e=null==e?t.map((function(e,t){return t})):[].concat(e)).every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),Bx(e.every((function(e){return Hx(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function Jx(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:Yx(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function $x(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function ew(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function tw(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function nw(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function rw(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function aw(e){return"string"===typeof e||e instanceof String}function iw(e){return"number"===typeof e}function ow(e){return Array.isArray(e)?ow(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":iw(e)?"float32":aw(e)?"string":"boolean"===typeof e?"bool":"float32"}function sw(e){return!!(e&&e.constructor&&e.call&&e.apply)}function uw(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function cw(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function lw(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=lw(e+l*c,u,n,r);return a}function hw(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return lw(0,e,t,n)}function fw(e,t){for(var n=dw(e,t),r=0;r<n.length;r++)n[r]=1;return n}function dw(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function pw(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return hw(e,new Float32Array(n));if("int32"===t)return hw(e,new Int32Array(n));if("bool"===t)return hw(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function vw(e){e.forEach((function(t){Bx(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function mw(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function gw(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function yw(e){return e&&e.then&&"function"===typeof e.then}var bw="tfjsflags",kw=function(){function e(t){f(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Vw,this.populateURLFlags()}return p(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(ww().getBool("IS_TEST")||ww().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];ww().getBool("IS_TEST")||ww().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=2;break}return e.abrupt("return",this.flags[t]);case 2:return e.next=4,this.evaluateFlag(t);case 4:return this.flags[t]=e.sent,e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(yw(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!==typeof this.global&&"undefined"!==typeof this.global.location&&"undefined"!==typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);if(bw in t)t.tfjsflags.split(",").forEach((function(t){var n=t.split(":"),r=(0,l.Z)(n,2),a=r[0],i=r[1];e.urlFlags[a]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(a,i)}))}}}]),e}();function Vw(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return xw(t,r[0],r[1]),r.join("=")})),t}function xw(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function ww(){return Sw}var Iw,Sw=null;function Cw(){if(null==Iw){var e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof n.g)e=n.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}Iw=e}return Iw}function Ew(e,t){var n=function(){var e=Cw();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var Tw="Abs",Nw="Acos",Aw="Acosh",Rw="Add",_w="AddN",Dw="All",Fw="Any",Ow="ArgMax",Lw="ArgMin",Mw="Asin",Pw="Asinh",zw="Atan",Bw="Atanh",Uw="Atan2",Ww="AvgPool",jw="AvgPoolGrad",Zw="AvgPool3D",Gw="AvgPool3DGrad",Hw="BatchMatMul",qw="BatchToSpaceND",Kw="Bincount",Xw="BroadcastArgs",Qw="Cast",Yw="Ceil",Jw="ClipByValue",$w="Complex",eI="ComplexAbs",tI="Concat",nI="Conv2D",rI="Conv2DBackpropFilter",aI="Conv2DBackpropInput",iI="Conv3D",oI="Conv3DBackpropFilterV2",sI="Conv3DBackpropInputV2",uI="Cos",cI="Cosh",lI="Cumprod",hI="Cumsum",fI="CropAndResize",dI="DenseBincount",pI="DepthToSpace",vI="DepthwiseConv2dNative",mI="DepthwiseConv2dNativeBackpropFilter",gI="DepthwiseConv2dNativeBackpropInput",yI="Diag",bI="Dilation2D",kI="Dilation2DBackpropInput",VI="Dilation2DBackpropFilter",xI="RealDiv",wI="Einsum",II="Elu",SI="EluGrad",CI="Erf",EI="Equal",TI="Exp",NI="ExpandDims",AI="Expm1",RI="FFT",_I="Fill",DI="FlipLeftRight",FI="Floor",OI="FloorDiv",LI="FusedBatchNorm",MI="GatherV2",PI="GatherNd",zI="Greater",BI="GreaterEqual",UI="Identity",WI="IFFT",jI="Imag",ZI="IsFinite",GI="IsInf",HI="IsNan",qI="LeakyRelu",KI="Less",XI="LessEqual",QI="LinSpace",YI="Log",JI="Log1p",$I="LogicalAnd",eS="LogicalNot",tS="LogicalOr",nS="LRN",rS="LRNGrad",aS="Max",iS="Maximum",oS="MaxPool",sS="MaxPoolGrad",uS="MaxPool3D",cS="MaxPool3DGrad",lS="MaxPoolWithArgmax",hS="Mean",fS="Min",dS="Minimum",pS="MirrorPad",vS="Mod",mS="Multinomial",gS="Multiply",yS="Neg",bS="NotEqual",kS="NonMaxSuppressionV3",VS="NonMaxSuppressionV4",xS="NonMaxSuppressionV5",wS="OnesLike",IS="OneHot",SS="Pack",CS="PadV2",ES="Pow",TS="Prelu",NS="Prod",AS="RaggedTensorToTensor",RS="Range",_S="Real",DS="Reciprocal",FS="Relu",OS="Reshape",LS="ResizeNearestNeighbor",MS="ResizeNearestNeighborGrad",PS="ResizeBilinear",zS="ResizeBilinearGrad",BS="Relu6",US="Reverse",WS="Round",jS="Rsqrt",ZS="ScatterNd",GS="SearchSorted",HS="Select",qS="Selu",KS="Slice",XS="Sin",QS="Sinh",YS="Sign",JS="Sigmoid",$S="Softplus",eC="Sqrt",tC="Sum",nC="SpaceToBatchND",rC="SplitV",aC="Softmax",iC="SparseFillEmptyRows",oC="SparseReshape",sC="SparseSegmentMean",uC="SparseSegmentSum",cC="SparseToDense",lC="SquaredDifference",hC="Square",fC="StridedSlice",dC="StringNGrams",pC="StringSplit",vC="StringToHashBucketFast",mC="Sub",gC="Tan",yC="Tanh",bC="Tile",kC="TopK",VC="Transform",xC="Transpose",wC="Unique",IC="Unpack",SC="UnsortedSegmentSum",CC="ZerosLike",EC="Step",TC="FromPixels",NC="RotateWithOffset",AC="_FusedMatMul",RC="FusedConv2D",_C="FusedDepthwiseConv2D";function DC(){var e;ww().getBool("IS_TEST")||ww().getBool("PROD")||(e=console).warn.apply(e,arguments)}var FC=Ew("kernelRegistry",(function(){return new Map})),OC=Ew("gradRegistry",(function(){return new Map}));function LC(e,t){var n=UC(e,t);return FC.get(n)}function MC(e){return OC.get(e)}function PC(e){for(var t=FC.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=(0,l.Z)(i,2),s=o[0],u=o[1],c=s.split("_");(0,l.Z)(c,1)[0]===e&&n.push(u)}return n}function zC(e){var t=e.kernelName,n=e.backendName,r=UC(t,n);FC.has(r)&&DC("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),FC.set(r,e)}function BC(e){var t=e.kernelName;OC.has(t)&&ww().getBool("DEBUG")&&DC("Overriding the gradient for '".concat(t,"'")),OC.set(t,e)}function UC(e,t){return"".concat(t,"_").concat(e)}var WC=n(8987),jC=n.n(WC)()||WC;function ZC(e){return jC.fromString(e,!0,16)}var GC=ZC("c3a5c85c97cb3127"),HC=ZC("b492b66fbe98f273"),qC=ZC("9ae16a3b2f90404f");function KC(e){return e.xor(e.shru(47))}function XC(e,t,n){var r=e.slice(t,t+n);return jC.fromBytes(Array.from(r),!0,!0)}function QC(e,t){return XC(e,t,8)}function YC(e,t){return XC(e,t,4)}function JC(e,t){return 0===t?e:e.shru(t).or(e.shl(64-t))}function $C(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:ZC("9ddfea08eb382d69"),r=e.xor(t).mul(n);r=r.xor(r.shru(47));var a=t.xor(r).mul(n);return a=(a=a.xor(a.shru(47))).mul(n)}function eE(e,t,n,r){return function(e,t,n,r,a,i){a=a.add(e),i=JC(i.add(a).add(r),21);var o=a;return a=(a=a.add(t)).add(n),i=i.add(JC(a,44)),[a.add(r),i.add(o)]}(QC(e,t),QC(e,t+8),QC(e,t+16),QC(e,t+24),n,r)}function tE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length;if(t>=8){var n=qC.add(2*t),r=QC(e,0).add(qC),a=QC(e,t-8),i=JC(a,37).mul(n).add(r),o=JC(r,25).add(a).mul(n);return $C(i,o,n)}if(t>=4){var s=qC.add(2*t),u=YC(e,0);return $C(u.shl(3).add(t),YC(e,t-4),s)}if(t>0){var c=e[0],l=e[t>>1],h=e[t-1],f=c+(l<<8),d=t+(h<<2);return KC(qC.mul(f).xor(GC.mul(d))).mul(qC)}return qC}function nE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=qC.add(2*t),r=QC(e,0).mul(HC),a=QC(e,8),i=QC(e,t-8).mul(n),o=QC(e,t-16).mul(qC);return $C(JC(r.add(a),43).add(JC(i,30)).add(o),r.add(JC(a.add(qC),18)).add(i),n)}function rE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=qC.add(2*t),r=QC(e,0).mul(qC),a=QC(e,8),i=QC(e,t-8).mul(n),o=QC(e,t-16).mul(qC),s=JC(r.add(a),43).add(JC(i,30)).add(o),u=$C(s,r.add(JC(a.add(qC),18)).add(i),n),c=QC(e,16).mul(n),l=QC(e,24),h=s.add(QC(e,t-32)).mul(n),f=u.add(QC(e,t-24)).mul(n);return $C(JC(c.add(l),43).add(JC(h,30)).add(f),c.add(JC(l.add(r),18)).add(h),n)}function aE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.length,n=jC.fromNumber(81,!0);if(t<=32)return t<=16?tE(e,t):nE(e,t);if(t<=64)return rE(e,t);var r=n,a=n.mul(HC).add(113),i=KC(a.mul(qC).add(113)).mul(qC),o=[jC.UZERO,jC.UZERO],s=[jC.UZERO,jC.UZERO];r=r.mul(qC).add(QC(e,0));var u=0,c=64*(t-1>>6),l=c+(t-1&63)-63;do{r=JC(r.add(a).add(o[0]).add(QC(e,u+8)),37).mul(HC),a=JC(a.add(o[1]).add(QC(e,u+48)),42).mul(HC),r=r.xor(s[1]),a=a.add(o[0]).add(QC(e,u+40)),i=JC(i.add(s[0]),33).mul(HC),o=eE(e,u,o[1].mul(HC),r.add(s[0])),s=eE(e,u+32,i.add(s[1]),a.add(QC(e,u+16)));var h=[r,i];i=h[0],r=h[1],u+=64}while(u!==c);var f=HC.add(i.and(255).shl(1));u=l,s[0]=s[0].add(t-1&63),o[0]=o[0].add(s[0]),s[0]=s[0].add(o[0]),r=JC(r.add(a).add(o[0]).add(QC(e,u+8)),37).mul(f),a=JC(a.add(o[1]).add(QC(e,u+48)),42).mul(f),r=r.xor(s[1].mul(9)),a=a.add(o[0].mul(9).add(QC(e,u+40))),i=JC(i.add(s[0]),33).mul(f),o=eE(e,u,o[1].mul(f),r.add(s[0])),s=eE(e,u+32,i.add(s[1]),a.add(QC(e,u+16)));var d=[r,i];return i=d[0],r=d[1],$C($C(o[0],s[0],f).add(KC(a).mul(GC)).add(i),$C(o[1],s[1],f).add(r),f)}function iE(e,t){return"string"===t?uE(e):oE([e],t)}function oE(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=jx(e)),ww().getBool("DEBUG")&&function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function sE(){return ww().platform.now()}function uE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",ww().platform.encode(e,t)}function cE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",ww().platform.decode(e,t)}var lE=function(){function e(t,n){f(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new hE)}return p(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=sE();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=m(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch(h){u.e(h)}finally{u.f()}a=Promise.resolve({kernelMs:sE()-o})}if(ww().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var c=function(t){var n=r[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},l=0;l<r.length;l++)c(l);return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var hE=function(){function e(){f(this,e)}return p(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"===typeof r?Kx("".concat(r,"ms"),9):r.error,s=Kx(e,25),u=t.rank,c=t.size,l=Kx(t.shape.toString(),14),h="";for(var f in a){var d=a[f];if(null!=d){var p=d.shape||t.shape,v=p.length;h+="".concat(f,": ").concat(v,"D ").concat(v>0?p:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function fE(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],h=!1,f=0;f<t.length;f++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),h=!0,a[s.id]=!0;break}if(h)break}}var d={};d[n.id]=!0;for(var p={},v=e.length-1;v>=0;v--)for(var m=e[v],g=m.inputs,y=0;y<m.outputs.length;y++)if(d[m.outputs[y].id]){for(var b in g)d[g[b].id]=!0,p[m.id]=!0;break}for(var k=[],V=0;V<e.length;V++){var x=e[V];if(a[x.id]&&p[x.id]){var w={};for(var I in x.inputs){var S=x.inputs[I];r[S.id]&&(w[I]=S)}var C=Object.assign({},x);C.inputs=w,C.outputs=x.outputs,k.push(C)}}return k}function dE(e,t,n,r){for(var a=function(a){var i=t[a],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));var a=n((function(){return s[t]()}));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));var o=i.inputs[t];if(!Gx(a.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(a.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=a;else{var u=e[o.id];e[o.id]=r(u,a),u.dispose()}};for(var c in i.inputs)u(c)},i=t.length-1;i>=0;i--)a(i)}function pE(e,t,n,r){var a=cw(t),i=function(e,t,n,r){var a=Zx(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?yE(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,h=0;h<i;h++)o[h]=Math.max(o[h],vE(u[l+h],0,n).length);return o}(e,t,n,a),o=t.length,s=gE(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function vE(e,t,n){return Kx(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):aw(e)?"'".concat(e,"'"):"bool"===n?mE(e):parseFloat(e.toFixed(7)).toString(),t)}function mE(e){return 0===e?"false":"true"}function gE(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u){if("complex64"===n){var c=yE(e);return[vE(c[0],0,n)]}return"bool"===n?[mE(e[0])]:[e[0].toString()]}if(1===u){if(s>20){var l=3*o,h=Array.from(e.slice(0,l)),f=Array.from(e.slice((s-3)*o,s*o));return"complex64"===n&&(h=yE(h),f=yE(f)),["["+h.map((function(e,t){return vE(e,a[t],n)})).join(", ")+", ..., "+f.map((function(e,t){return vE(e,a[s-3+t],n)})).join(", ")+"]"]}var d="complex64"===n?yE(e):Array.from(e);return["["+d.map((function(e,t){return vE(e,a[t],n)})).join(", ")+"]"]}var p=t.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>20){for(var y=0;y<3;y++){var b=y*m,k=b+m;g.push.apply(g,(0,H.Z)(gE(e.slice(b,k),p,n,v,a,!1)))}g.push("...");for(var V=s-3;V<s;V++){var x=V*m,w=x+m;g.push.apply(g,(0,H.Z)(gE(e.slice(x,w),p,n,v,a,V===s-1)))}}else for(var I=0;I<s;I++){var S=I*m,C=S+m;g.push.apply(g,(0,H.Z)(gE(e.slice(S,C),p,n,v,a,I===s-1)))}var E=2===u?",":"";g[0]="["+g[0]+E;for(var T=1;T<g.length-1;T++)g[T]=" "+g[T]+E;for(var N=",\n",A=2;A<u;A++)N+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":N),g}function yE(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var bE=function(){function e(t,n,r){var a=this;if(f(this,e),this.dtype=n,this.shape=t.slice(),this.size=Zx(t),null!=r){var i=r.length;Bx(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||ew(n,this.size),this.strides=cw(t)}return p(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),Bx(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return kE().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),kE=null,VE=null;var xE=function(){function e(t,n,r,a){f(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=Zx(t),this.strides=cw(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return p(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",VE.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return VE.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",hw(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return hw(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=kE().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return cE(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),kE().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=kE().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return cE(e)}))}catch(Bv){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,kE().read(this.dataId);case 3:if(t=e.sent,"string"!==this.dtype){e.next=8;break}return e.abrupt("return",t);case 8:return e.abrupt("return",new Uint8Array(t.buffer));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(kE().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return VE.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),VE.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.dataSync();return pE(t,this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),VE.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),kE().makeVariable(this,e,t,n)}}]),e}();function wE(){return Ew("Tensor",(function(){return xE}))}Object.defineProperty(xE,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),wE();var IE,SE,CE,EE,TE,NE=function(e){b(n,e);var t=w(n);function n(e,r,a,i){var o;return f(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return p(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!Gx(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));kE().disposeTensor(this),this.dataId=e.dataId,kE().incRef(this,null)}},{key:"dispose",value:function(){kE().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(xE);Object.defineProperty(NE,Symbol.hasInstance,{value:function(e){return e instanceof xE&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(IE||(IE={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(SE||(SE={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(CE||(CE={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(EE||(EE={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(TE||(TE={}));var AE={float32:EE,int32:SE,bool:CE,complex64:TE};function RE(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return AE[e][t]}function _E(e){return RE(e,"int32")}function DE(e,t){if(e.dtype===t.dtype)return[e,t];var n=RE(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function FE(e,t){return t.some((function(t){return t.id===e.id}))}function OE(e){var t=[];return LE(e,t,new Set),t}function LE(e,t,n){if(null!=e)if(e instanceof xE)t.push(e);else if(r=e,Array.isArray(r)||"object"===typeof r){var r,a=e;for(var i in a){var o=a[i];n.has(o)||(n.add(o),LE(o,t,n))}}}function ME(e){return null!=e.kernelName}var PE=function(){function e(){f(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return p(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),zE=function(){function e(t){f(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new PE}return p(e,[{key:"ready",value:function(){var e=c(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=18;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=15;break}return e.next=14,this.setBackend(r);case 14:return e.abrupt("return");case 15:n++,e.next=6;break;case 18:throw new Error("Could not initialize any backends, all backend initializations failed.");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(DC("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=16;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=12;break}return e.next=9,r;case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=r;case 13:if(e.t0){e.next=16;break}return e.abrupt("return",!1);case 16:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new lE(this.backendInstance),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;PC(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;PC(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof Dx||"function"!==typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,DC("Initialization of backend ".concat(e," failed")),DC(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(o){return DC("Initialization of backend ".concat(e," failed")),DC(o.stack||o.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=jE.runKernel(UI,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return jE.runKernel(Qw,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,!(null!=LC(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r,a=this,i=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var c=ME(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(ME(e)){var l=e.kernelName,h=e.inputs,f=e.attrs;null==this.backendName&&this.backend;var d=LC(l,this.backendName);Bx(null!=d,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(a.backendName,"'")})),n=function(){var e=a.backend.numDataIds();r=d.kernelFunc({inputs:h,attrs:f,backend:a.backend});var t=Array.isArray(r)?r:[r];a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:a.makeTensorFromTensorInfo(e)}));if(o){var s=a.getTensorsForGradient(l,h,n);i=a.saveTensorsForBackwardMode(s)}return n}}else{var p=e.forwardFunc,v=function(e){o&&(i=e.map((function(e){return a.keep(a.clone(e))})))};n=function(){var e=a.backend.numDataIds();r=a.tidy((function(){return p(a.backend,v)}));var t=Array.isArray(r)?r:[r];return a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(c,e,t),t}}var m,g=e.inputs,y=e.attrs,b=ME(e)?null:e.backwardsFunc;return this.scopedRun((function(){return a.state.kernelDepth++}),(function(){return a.state.kernelDepth--}),(function(){a.ENV.getBool("DEBUG")||a.state.profiling?(m=a.profiler.profileKernel(c,g,(function(){return n()})),a.ENV.getBool("DEBUG")&&a.profiler.logKernelProfile(m),t=m.outputs):t=n()})),o&&this.addTapeNode(c,g,t,b,i,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map((function(e){return null!=g[e]?g[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(r)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=MC(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(Bx(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&aw(e[0])&&(a=e.map((function(e){return uE(e)})));var i=r.write(a,t,n),o=new xE(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new xE(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new NE(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*rw(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof NE||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*rw(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=c(s().mark((function e(t){var n,r,a,i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=6,t();case 6:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,(0,H.Z)(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=m(this.state.activeProfile.kernels),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=24;break}return o=i.value,e.next=18,o.kernelTimeMs;case 18:return o.kernelTimeMs=e.sent,e.next=21,o.extraInfo;case 21:o.extraInfo=e.sent;case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),a.e(e.t0);case 29:return e.prev=29,a.f(),e.finish(29);case 32:return e.abrupt("return",this.state.activeProfile);case 33:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=MC(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=dw(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=OE(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(Bx(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));Bx(i instanceof xE,(function(){return"The result y returned by f() must be a tensor."}));var o=fE(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?BE(i.shape):n,dE(e,o,(function(e){return r.tidy(e)}),ZE);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=m(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return Bx(sw(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;Bx(r.every((function(e){return e instanceof xE})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};r.forEach((function(e,t){o[t]=e}));var s=function(t,n){return Bx((i=e.apply(void 0,[].concat(r,[n]))).value instanceof xE,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),Bx(sw(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},u=function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];Bx(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),Bx(a.every((function(e){return e instanceof xE})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=sE(),e.next=3,this.backend.time(t);case 3:return(r=e.sent).wallMs=sE()-n,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new PE,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function BE(e){var t=fw(Zx(e),"float32");return jE.makeTensor(t,e,"float32")}function UE(){var e=Cw();if(null==e._tfengine){var t=new kw(e);e._tfengine=new zE(t)}return function(e){Sw=e}(e._tfengine.ENV),function(e){kE=e}((function(){return e._tfengine})),e._tfengine}zE.nextTensorId=0,zE.nextVariableId=0;var WE,jE=UE();function ZE(e,t){var n={a:e,b:t};return jE.runKernel(Rw,n)}function GE(e){if(void 0!==WE)return WE;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function HE(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}var qE=ww();function KE(e,t){var n=e;if(nw(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||nw(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&ww().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&XE(e,r,[]),r}function XE(e,t,n){if(n=n||[],Array.isArray(e)||nw(e)){Bx(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")})),Bx(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)XE(e[a],r,n.concat(a))}else Bx(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")}))}function QE(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function YE(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof xE)return QE(r,e.dtype,t,n),e;var a=ow(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),QE(r,a,t,n),null==e||!nw(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=KE(e,a);nw(e)||Array.isArray(e)||(e=[e]);var s=!0,u="string"!==a?oE(e,a):jx(e,[],s);return jE.makeTensor(u,o,a)}function JE(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=e;return a.map((function(e,a){return YE(e,"".concat(t,"[").concat(a,"]"),n,r)}))}qE.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),qE.registerFlag("IS_BROWSER",(function(){return HE()})),qE.registerFlag("IS_NODE",(function(){return"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node})),qE.registerFlag("IS_CHROME",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),qE.registerFlag("PROD",(function(){return!1})),qE.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return qE.getBool("DEBUG")})),qE.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),qE.registerFlag("IS_TEST",(function(){return!1})),qE.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),qE.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),qE.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1})),qE.registerFlag("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU",(function(){return!1}));function $E(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function(){jE.startScope(n);try{var e=r.apply(void 0,arguments);return yw(e)&&console.error("Cannot return a Promise inside of tidy."),jE.endScope(e),e}catch(t){throw jE.endScope(null),t}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var eT=$E({complex_:function(e,t){var n=YE(e,"real","complex"),r=YE(t,"imag","complex");Ux(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:n,imag:r};return jE.runKernel($w,a)}});function tT(e,t,n,r){if(null==r&&(r=ow(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!nw(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){vw(t);var a=Zx(t),i=Zx(n);Bx(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==Zx(t.slice(o));Bx(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return nw(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?oE(e,r):jx(e,[],!0),jE.makeTensor(e,t,r)}function nT(e,t,n){return tT(e,t,KE(e,n),n)}var rT={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function aT(e,t){return iT.apply(this,arguments)}function iT(){return iT=c(s().mark((function e(t,n){var r,a,i,o,u,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=function(e){var o=i[e],u=Array.isArray(t)?t[e].tensor:t[o];if("float32"!==u.dtype&&"int32"!==u.dtype&&"bool"!==u.dtype&&"string"!==u.dtype&&"complex64"!==u.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(u.dtype));var l={name:o,shape:u.shape,dtype:u.dtype};if("string"===u.dtype){var h=new Promise(function(){var e=c(s().mark((function e(t){var n,r,a,i,o,c,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)c=n[o],l=new Uint8Array(new Uint32Array([c.length]).buffer),a.set(l,i),i+=4,a.set(c,i),i+=c.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());a.push(h)}else a.push(u.data());null!=n&&(l.group=n),r.push(l)},u=0;u<i.length;++u)o(u);return e.next=7,Promise.all(a);case 7:return l=e.sent,e.abrupt("return",{data:sT(l),specs:r});case 9:case"end":return e.stop()}}),e)}))),iT.apply(this,arguments)}function oT(e,t){var n,r,a={},i=0,o=m(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,h=Zx(l),f=void 0;if("quantization"in s){var d=s.quantization;if("uint8"===d.dtype||"uint16"===d.dtype){if(!("min"in d)||!("scale"in d))throw new Error("Weight ".concat(s.name," with quantization ").concat(d.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==d.dtype)throw new Error("Weight ".concat(s.name," has unknown ")+"quantization dtype ".concat(d.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(d.dtype," ")+"which only supports weights of type float32 not ".concat(c,"."))}var p=rT[d.dtype],v=e.slice(i,i+h*p),g="uint8"===d.dtype?new Uint8Array(v):new Uint16Array(v);if("float32"===c)if("uint8"===d.dtype||"uint16"===d.dtype){f=new Float32Array(g.length);for(var y=0;y<g.length;y++){var b=g[y];f[y]=b*d.scale+d.min}}else{if("float16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," ")+"for weight type float32.");void 0===n&&(n=yT()),f=n(g)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==d.dtype&&"uint16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," ")+"for weight type int32.");f=new Int32Array(g.length);for(var k=0;k<g.length;k++){var V=g[k];f[k]=Math.round(V*d.scale+d.min)}}i+=h*p}else if("string"===c){var x=Zx(s.shape);f=[];for(var w=0;w<x;w++){var I=new Uint32Array(e.slice(i,i+4))[0];i+=4;var S=new Uint8Array(e.slice(i,i+I));f.push(S),i+=I}}else{var C=rT[c],E=e.slice(i,i+h*C);if("float32"===c)f=new Float32Array(E);else if("int32"===c)f=new Int32Array(E);else if("bool"===c)f=new Uint8Array(E);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));f=new Float32Array(E);for(var T=new Float32Array(f.length/2),N=new Float32Array(f.length/2),A=0;A<T.length;A++)T[A]=f[2*A],N[A]=f[2*A+1];var R=nT(T,l,"float32"),_=nT(N,l,"float32");a[u]=eT(R,_),R.dispose(),_.dispose()}i+=h*C}"complex64"!==c&&(a[u]=nT(f,l,c))}}catch(D){o.e(D)}finally{o.f()}return a}function sT(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var uT="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function cT(e){return uT?Buffer.byteLength(e):new Blob([e]).size}function lT(e){if(uT)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function hT(e){if(uT){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function fT(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function dT(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function pT(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function vT(e,t){return mT.apply(this,arguments)}function mT(){return mT=c(s().mark((function e(t,n){var r,a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy},null!=t.trainingConfig&&(r.trainingConfig=t.trainingConfig),null==t.weightsManifest){e.next=11;break}return e.next=5,n(t.weightsManifest);case 5:a=e.sent,i=(0,l.Z)(a,2),o=i[0],u=i[1],r.weightSpecs=o,r.weightData=u;case 11:return null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),e.abrupt("return",r);case 15:case"end":return e.stop()}}),e)}))),mT.apply(this,arguments)}function gT(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:cT(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:cT(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function yT(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0===(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var bT=function(){function e(){f(this,e),this.saveRouters=[],this.loadRouters=[]}return p(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),kT=function(e){return bT.registerSaveRouter(e)},VT=function(e){return bT.registerLoadRouter(e)},xT=function(e){return bT.getSaveHandlers(e)},wT=function(e,t){return bT.getLoadHandlers(e,t)},IT="tensorflowjs",ST="models_store",CT="model_info_store";function ET(){if(!ww().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function TT(e){var t=e.result;t.createObjectStore(ST,{keyPath:"modelPath"}),t.createObjectStore(CT,{keyPath:"modelPath"})}var NT=function(){function e(t){if(f(this,e),this.indexedDB=ET(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return p(e,[{key:"save",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(IT,1);a.onupgradeneeded=function(){return TT(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(ST,"readonly"),s=o.objectStore(ST).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=gT(t),l=i.transaction(CT,"readwrite"),h=l.objectStore(CT),f=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});f.onsuccess=function(){var a=(u=i.transaction(ST,"readwrite")).objectStore(ST).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(h=l.objectStore(CT)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},f.onerror=function(e){return i.close(),r(f.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();NT.URL_SCHEME="indexeddb://";var AT=function(e){return ww().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(NT.URL_SCHEME)?(t=e.slice(NT.URL_SCHEME.length),new NT(t)):null;var t};bT.registerSaveRouter(AT),bT.registerLoadRouter(AT);var RT=function(){function e(){f(this,e),this.indexedDB=ET()}return p(e,[{key:"listModels",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(IT,1);r.onupgradeneeded=function(){return TT(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(CT,"readonly"),i=a.objectStore(CT).getAll();i.onsuccess=function(){var t,n={},r=m(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=c(s().mark((function e(t){var n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(r=t).startsWith(NT.URL_SCHEME)?r.slice(NT.URL_SCHEME.length):r,e.abrupt("return",new Promise((function(e,r){var a=n.indexedDB.open(IT,1);a.onupgradeneeded=function(){return TT(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(CT,"readwrite"),s=o.objectStore(CT),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(n=i.transaction(ST,"readwrite")).objectStore(ST).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 2:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),_T="/",DT="tensorflowjs_models",FT="info",OT="model_topology",LT="weight_specs",MT="weight_data",PT="model_metadata";function zT(e){return{info:[DT,e,FT].join(_T),topology:[DT,e,OT].join(_T),weightSpecs:[DT,e,LT].join(_T),weightData:[DT,e,MT].join(_T),modelMetadata:[DT,e,PT].join(_T)}}function BT(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function UT(e){var t=e.split(_T);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(_T)}var WT=function(){function e(t){if(f(this,e),!ww().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=zT(this.modelPath)}return p(e,[{key:"save",value:function(){var e=c(s().mark((function e(t){var n,r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=4;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 4:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=gT(t),e.prev=7,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,lT(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),e.abrupt("return",{modelArtifactsInfo:a});case 17:throw e.prev=17,e.t0=e.catch(7),BT(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."));case 21:case"end":return e.stop()}}),e,this,[[7,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=9;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 9:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=13;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 13:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(u=this.LS.getItem(this.keys.weightData))){e.next=19;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 19:return n.weightData=hT(u),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();WT.URL_SCHEME="localstorage://";var jT=function(e){return ww().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(WT.URL_SCHEME)?(t=e.slice(WT.URL_SCHEME.length),new WT(t)):null;var t};bT.registerSaveRouter(jT),bT.registerLoadRouter(jT);var ZT=function(){function e(){f(this,e),Bx(ww().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),Bx("undefined"===typeof window||"undefined"!==typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return p(e,[{key:"listModels",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i,o;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=DT+_T,r=_T+FT,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=UT(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(a=t).startsWith(WT.URL_SCHEME)?a.slice(WT.URL_SCHEME.length):a,n=zT(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),BT(n),e.abrupt("return",r);case 7:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),GT="://",HT=function(){function e(){f(this,e),this.managers={}}return p(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){Bx(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(GT)&&(t=t.slice(0,t.indexOf(GT))),Bx(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();Bx(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(t){var n=e.getInstance().managers[t];if(null==n)throw new Error("Cannot find model manager for scheme '".concat(t,"'"));return n}},{key:"getSchemes",value:function(){return Object.keys(e.getInstance().managers)}}]),e}();function qT(e){if(-1===e.indexOf(GT))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(HT.getSchemes().join(",")));return{scheme:e.split(GT)[0],path:e.split(GT)[1]}}function KT(e,t){return XT.apply(this,arguments)}function XT(){return XT=c(s().mark((function e(t,n){var r,a,i,o,u,c,l,h,f,d,p=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=p.length>2&&void 0!==p[2]&&p[2],Bx(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),Bx((a=bT.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),Bx(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"load handlers for source URL ".concat(t,".")})),i=a[0],Bx((o=bT.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(n,".")})),Bx(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"save handlers for destination URL ".concat(n,".")})),u=o[0],c=qT(t).scheme,l=qT(t).path,h=c===qT(t).scheme,e.next=15,i.load();case 15:if(f=e.sent,!r||!h){e.next=19;break}return e.next=19,HT.getManager(c).removeModel(l);case 19:return e.next=21,u.save(f);case 21:if(d=e.sent,!r||h){e.next=25;break}return e.next=25,HT.getManager(c).removeModel(l);case 25:return e.abrupt("return",d.modelArtifactsInfo);case 26:case"end":return e.stop()}}),e)}))),XT.apply(this,arguments)}function QT(){return YT.apply(this,arguments)}function YT(){return(YT=c(s().mark((function e(){var t,n,r,a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=HT.getSchemes(),n={},r=m(t),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=13;break}return i=a.value,e.next=9,HT.getManager(i).listModels();case 9:for(u in o=e.sent)n[i+GT+u]=o[u];case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})))).apply(this,arguments)}function JT(e){return $T.apply(this,arguments)}function $T(){return($T=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=qT(t),r=HT.getManager(n.scheme),e.abrupt("return",r.removeModel(n.path));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function eN(e,t){return tN.apply(this,arguments)}function tN(){return(tN=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!1,e.abrupt("return",KT(t,n,false));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nN(e,t){return rN.apply(this,arguments)}function rN(){return(rN=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0,e.abrupt("return",KT(t,n,true));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var aN=function(){function e(){f(this,e)}return p(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if(ww().get("IS_BROWSER")){ww().setPlatform("browser",new aN);try{HT.registerManager(WT.URL_SCHEME,new ZT)}catch(h6){}try{HT.registerManager(NT.URL_SCHEME,new RT)}catch(h6){}}var iN,oN=function(){return n(5410)};var sN=function(){function e(){f(this,e),this.util=n(8628),this.textEncoder=new this.util.TextEncoder}return p(e,[{key:"fetch",value:function(e,t){return null!=ww().global.fetch?ww().global.fetch(e,t):(null==iN&&(iN=oN()),iN(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}();function uN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",vw(e),new bE(e,t,n)}ww().get("IS_NODE")&&!ww().get("IS_BROWSER")&&ww().setPlatform("node",new sN);var cN=$E({cast_:function(e,t){var n=YE(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return jE.runKernel(Qw,r,a)}});var lN=$E({clone_:function(e){var t={x:YE(e,"x","clone","string_or_numeric")};return jE.runKernel(UI,t)}});UE();var hN={buffer:uN,cast:cN,clone:lN,print:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};VE=hN;function fN(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var dN=function(){function e(t){if(f(this,e),!ww().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return p(e,[{key:"save",value:function(){var e=c(s().mark((function e(t){var n,r,a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=7;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 7:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a=pT(t,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=i,e.next=15,fN((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 15:if(null==t.weightData){e.next=21;break}return(u=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,u.href=n,e.next=21,fN((function(){return u.dispatchEvent(new MouseEvent("click"))}));case 21:return e.abrupt("return",{modelArtifactsInfo:gT(t)});case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();dN.URL_SCHEME="downloads://";var pN=function(){function e(t){if(f(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(t));this.jsonFile=t[0],this.weightsFiles=t.slice(1)}return p(e,[{key:"load",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=new FileReader;r.onload=function(r){var a=JSON.parse(r.target.result),i=a.modelTopology;if(null!=i)if(null!=a.weightsManifest)if(0!==t.weightsFiles.length){var o=vT(a,(function(e){return t.loadWeights(e)}));e(o)}else e({modelTopology:i});else n(new Error("weightManifest field is missing from file ".concat(t.jsonFile.name)));else n(new Error("modelTopology field is missing from file ".concat(t.jsonFile.name)))},r.onerror=function(e){return n("Failed to read model topology and weights manifest JSON "+"from file '".concat(t.jsonFile.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},r.readAsText(t.jsonFile)})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(e){var t,n=this,r=[],a=[],i=m(e);try{for(i.s();!(t=i.n()).done;){var o=t.value;r.push.apply(r,(0,H.Z)(o.weights)),a.push.apply(a,(0,H.Z)(o.paths))}}catch(h6){i.e(h6)}finally{i.f()}var s=this.checkManifestAndWeightFiles(e),u=a.map((function(e){return n.loadWeightsFile(e,s[e])}));return Promise.all(u).then((function(e){return[r,fT(e)]}))}},{key:"loadWeightsFile",value:function(e,t){return new Promise((function(n,r){var a=new FileReader;a.onload=function(e){var t=e.target.result;n(t)},a.onerror=function(t){return r("Failed to weights data from file of path '".concat(e,"'."))},a.readAsArrayBuffer(t)}))}},{key:"checkManifestAndWeightFiles",value:function(e){var t,n=this,r=[],a=this.weightsFiles.map((function(e){return dT(e.name)})),i={},o=m(e);try{for(o.s();!(t=o.n()).done;){t.value.paths.forEach((function(e){var t=dT(e);if(-1!==r.indexOf(t))throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(t,"'"));if(r.push(t),-1===a.indexOf(t))throw new Error("Weight file with basename '".concat(t,"' is not provided."));i[e]=n.weightsFiles[a.indexOf(t)]}))}}catch(h6){o.e(h6)}finally{o.f()}if(r.length!==this.weightsFiles.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(r.length,") and the number of weight files provided ")+"(".concat(this.weightsFiles.length,")."));return i}}]),e}();function vN(e){return new pN(e)}function mN(e,t,n,r){!function(e){Bx(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){Bx(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),Bx(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),Bx(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function gN(e,t){return yN.apply(this,arguments)}function yN(){return(yN=c(s().mark((function e(t,n){var r,a,i,o,u,c,l,h,f;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?ww().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,mN(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(u=e.t0,c=u.map((function(e){return e.arrayBuffer()})),l=.5,h=1,null!=n.onProgress){e.next=24;break}return e.next=21,Promise.all(c);case 21:e.t1=e.sent,e.next=27;break;case 24:return e.next=26,mN(c,n.onProgress,l,h);case 26:e.t1=e.sent;case 27:return f=e.t1,e.abrupt("return",f);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bN(e){return kN.apply(this,arguments)}function kN(){return kN=c(s().mark((function e(t){var n,r,a,i,o=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",r=o.length>2?o[2]:void 0,a=o.length>3?o[3]:void 0,i=VN((function(e){return gN(e,{requestInit:a})})),e.abrupt("return",i(t,n,r));case 6:case"end":return e.stop()}}),e)}))),kN.apply(this,arguments)}function VN(e){return function(){var t=c(s().mark((function t(n){var r,a,i,o,u,c,l,h,f,d,p,v,m=arguments;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=m.length>1&&void 0!==m[1]?m[1]:"",a=m.length>2?m[2]:void 0,i=n.map((function(){return!1})),o={},u=null!=a?a.map((function(){return!1})):[],c=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,s=rT[r]*Zx(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:s})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),u[n]=!0)})):l(),c.push(e.name),n+=s}))})),u.every((function(e){return e}))){t.next=10;break}throw l=a.filter((function(e,t){return!u[t]})),new Error("Could not find weights in manifest with names: "+"".concat(l.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(c.join(", "),"."));case 10:return h=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),f=[],h.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;f.push(t)}))})),t.next=15,e(f);case 15:return d=t.sent,p={},v=0,h.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=d[v+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(d[v+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=oT(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)p[n]=t[n]})),v+=t})),t.abrupt("return",p);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}bT.registerSaveRouter((function(e){return ww().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(dN.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new dN(e)}(e.slice(dN.URL_SCHEME.length)):null}));var xN=function(){function e(t,n){if(f(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(Bx("function"===typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=ww().platform.fetch,Bx(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&Bx(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return p(e,[{key:"save",value:function(){var e=c(s().mark((function e(t){var n,r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=pT(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=10,this.fetch(this.path,n);case 10:if(!(i=e.sent).ok){e.next=15;break}return e.abrupt("return",{modelArtifactsInfo:gT(t),responses:[i]});case 15:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i,o=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 16:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=20;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 20:return e.abrupt("return",vT(n,(function(e){return o.loadWeights(e)})));case 21:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=c(s().mark((function e(t){var n,r,a,i,o,u,c,h,f,d,p,v,g,y,b,k,V,x,w;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=wN(n),a=(0,l.Z)(r,2),i=a[0],o=a[1],u=this.weightPathPrefix||i,c=[],h=m(t);try{for(h.s();!(f=h.n()).done;)d=f.value,c.push.apply(c,(0,H.Z)(d.weights))}catch(h6){h.e(h6)}finally{h.f()}p=[],v=[],g=m(t);try{for(g.s();!(y=g.n()).done;){b=y.value,k=m(b.paths);try{for(k.s();!(V=k.n()).done;)x=V.value,null!=this.weightUrlConverter?v.push(this.weightUrlConverter(x)):p.push(u+x+o)}catch(h6){k.e(h6)}finally{k.f()}}}catch(h6){g.e(h6)}finally{g.f()}if(!this.weightUrlConverter){e.next=19;break}return e.t0=p.push,e.t1=p,e.t2=H.Z,e.next=16,Promise.all(v);case 16:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 19:return e.next=21,gN(p,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 21:return w=e.sent,e.abrupt("return",[c,fT(w)]);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function wN(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function IN(e){return null!=e.match(xN.URL_SCHEME_REGEX)}xN.URL_SCHEME_REGEX=/^https?:\/\//;var SN=function(e,t){if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return IN(e)})):IN(e))?CN(e,t):null};function CN(e,t){return new xN(e,t)}function EN(e,t){return CN(e,t)}bT.registerSaveRouter(SN),bT.registerLoadRouter(SN);var TN,NN=function(){function e(t){f(this,e),this.modelArtifacts=t}return p(e,[{key:"load",value:function(){return this.modelArtifacts}}]),e}(),AN=function(){function e(t){f(this,e),this.saveHandler=t}return p(e,[{key:"save",value:function(e){return this.saveHandler(e)}}]),e}(),RN=p((function e(t){f(this,e),t.load&&(this.load=function(){return Promise.resolve(t.load())}),t.save&&(this.save=function(e){return Promise.resolve(t.save(e))})}));function _N(e,t,n,r){var a=arguments;return new RN(DN.apply(void 0,(0,H.Z)(a)))}function DN(e,t,n,r){if(1===arguments.length){var a=null!=e.modelTopology||null!=e.weightSpecs;return a?new NN(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new NN({modelTopology:e}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new NN({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r})}function FN(e){return new AN(e)}function ON(e){return new AN(e)}function LN(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function MN(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function PN(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}function zN(e,t,n){if(Wx(e),null!=t&&3!==t.length)throw new Error("tensor3d() requires shape to have three numbers");var r=KE(e,n);if(3!==r.length&&1!==r.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return tT(e,t,r,n)}function BN(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3;if(t>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==e)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");var n=!1,r=!1,a=!1,i=!1,o=!1,s=!1;if(e.data instanceof Uint8Array)n=!0;else if("undefined"!==typeof ImageData&&e instanceof ImageData)r=!0;else if("undefined"!==typeof HTMLVideoElement&&e instanceof HTMLVideoElement)a=!0;else if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement)i=!0;else if(null!=e.getContext)o=!0;else{if(!("undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap))throw new Error("pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, "+"but was ".concat(e.constructor.name));s=!0}var u=LC(TC,jE.backendName);if(null!=u){var c={pixels:e},h={numChannels:t};return jE.runKernel(TC,c,h)}var f,d,p=a?[e.videoWidth,e.videoHeight]:[e.width,e.height],v=(0,l.Z)(p,2),m=v[0],g=v[1];if(o)f=e.getContext("2d").getImageData(0,0,m,g).data;else if(r||n)f=e.data;else if(i||a||s){if(null==TN)if("undefined"===typeof document){if("undefined"===typeof OffscreenCanvas||"undefined"===typeof OffscreenCanvasRenderingContext2D)throw new Error("Cannot parse input in current context. Reason: OffscreenCanvas Context2D rendering is not supported.");TN=new OffscreenCanvas(1,1).getContext("2d")}else TN=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});TN.canvas.width=m,TN.canvas.height=g,TN.drawImage(e,0,0,m,g),f=TN.getImageData(0,0,m,g).data}if(4===t)d=new Int32Array(f);else{var y=m*g;d=new Int32Array(y*t);for(var b=0;b<y;b++)for(var k=0;k<t;++k)d[b*t+k]=f[4*b+k]}var V=[g,m,t];return zN(d,V,"int32")}var UN=$E({fromPixels_:BN});function WN(e,t,n){var r=e.shape.length;Bx(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")})),Bx(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")}));for(var a=function(a){Bx(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] ")+"(".concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}function jN(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}function ZN(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}function GN(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}function HN(e,t,n){var r,a,i=e.shape.length;return(r="number"===typeof t?[t].concat((0,H.Z)(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){Bx(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"===typeof n?[n].concat((0,H.Z)(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(Bx(-1===t,(function(){return"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function qN(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&0!==(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,h={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},f=0;f<h.dims;f++)l&&0!==(1<<f&s)&&h.numAddAxisAfterEllipsis++,1<<f&o&&(l=!0);l||(h.ellipsisMask|=1<<h.dims,h.dims++);var d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(h,d);for(var p=!0,v=!0,m=!0,g=[],y=[],b=0;b<e.length;++b){if(0===d.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var k=!!(d.shrinkAxisMask&1<<b),V=e[b];if(-1!==V){var x=[d.beginMask&1<<b,d.endMask&1<<b],w=[d.strides[b]>0?0:-1,d.strides[b]>0?V:V-1];if(k&&d.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===d.strides[b];var I=!!(d.beginMask&1<<b&&d.endMask&1<<b);if(d.beginValid&&d.endValid){if(k){var S=d.begin[b]<0?V+d.begin[b]:d.begin[b];if(d.begin[b]=S,d.end[b]=d.begin[b]+1,S<0||S>=V)throw Error("slice index ".concat(d.begin[b]," of dimension ").concat(b," out of bounds."))}else d.begin[b]=KN(d.begin[b],0,d.strides[b],V,x,w),d.end[b]=KN(d.end[b],1,d.strides[b],V,x,w);var C=1===d.strides[b]&&0===d.begin[b]&&d.end[b]===V;p=p&&C,v=v&&(0===b&&1===d.strides[b]||C)}else p=p&&1===d.strides[b]&&I,v=v&&(0===b&&1===d.strides[b]||I);var E=void 0,T=!1;if(d.beginValid&&d.endValid?(E=d.end[b]-d.begin[b],T=!0):k?(E=1,T=!0):I&&V>=0&&(E=d.strides[b]<0?-V:V,T=!0),T){var N=void 0;N=0===E||E<0!==d.strides[b]<0?0:Math.trunc(E/d.strides[b])+(E%d.strides[b]!==0?1:0),g.push(N)}else g.push(-1)}else g.push(k?1:-1)}for(var A=0;A<d.finalShapeGatherIndices.length;++A){var R=d.finalShapeGatherIndices[A];R>=0?y.push(g[R]):-2===R&&y.push(1)}var _=y.filter((function(e,t){return-2!==d.finalShapeGatherIndices[t]}));return{finalShapeSparse:_,finalShape:y,isIdentity:p,sliceDim0:v,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function KN(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}var XN=function(){function e(){f(this,e)}return p(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),QN=function(){function e(){f(this,e),this.classNameMap={}}return p(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function YN(e){Bx(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),Bx("string"===typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),Bx(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),QN.register(e)}function JN(){return jE}function $N(){return jE.memory()}function eA(e,t){return jE.tidy(e,t)}function tA(e){OE(e).forEach((function(e){return e.dispose()}))}function nA(e){return jE.keep(e)}function rA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return jE.registerBackend(e,t,n)}function aA(e){return jE.customGrad(e)}function iA(e,t){if((nw(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&nw(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return tT(e,[],[],t)}!function(e){e}((function(e){ww().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}));var oA=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return tA(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return function(e,t){Bx(sw(e),(function(){return"The f passed in variableGrads(f) must be a function"})),Bx(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof NE})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],jE.registeredVariables)t.push(jE.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;t=t.filter((function(e){return e.trainable})),Bx(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."}));var o=jE.gradients(e,t,null,!0),s=o.value,u=o.grads;Bx(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),Bx(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&tA(this.iterations_)}},{key:"saveIterations",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==this.iterations_&&(this.iterations_=0),e.abrupt("return",{name:"iter",tensor:iA(this.iterations_,"int32")});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(XN);Object.defineProperty(oA,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var sA=$E({abs_:function(e){var t=YE(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return jE.runKernel(eI,n)}var r={x:t};return jE.runKernel(Tw,r)}});var uA=$E({add_:function(e,t){var n=YE(e,"a","add"),r=YE(t,"b","add"),a=DE(n,r),i=(0,l.Z)(a,2),o={a:n=i[0],b:r=i[1]};return jE.runKernel(Rw,o)}});var cA=$E({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=YE(e,"x","all","bool"),a={x:r},i={axis:t,keepDims:n};return jE.runKernel(Dw,a,i)}});var lA=$E({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=YE(e,"x","any","bool"),a={x:r},i={axis:t,keepDims:n};return jE.runKernel(Fw,a,i)}});var hA=$E({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=YE(e,"x","argMax"),r={x:n},a={axis:t};return jE.runKernel(Ow,r,a)}});function fA(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3],s=[].concat((0,H.Z)(t),[o]),u=CA(a);return vA(e,s,n,i,r,null,null,u)}function dA(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=yA(t),c=(0,l.Z)(u,2),h=c[0],f=c[1];if("channelsLast"===s)o=[h,f,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[h,f,e[1],e[1]]}return vA(e,o,n,r,a,i,!1,s)}function pA(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=bA(t),h=(0,l.Z)(c,3),f=h[0],d=h[1],p=h[2];if("NDHWC"===u)s="channelsLast",o=[f,d,p,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[f,d,p,e[1],e[1]]}return mA(e,o,n,r,a,!1,s,i)}function vA(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,h=-1,f=-1;if("channelsLast"===s){var d=(0,l.Z)(e,4);u=d[0],c=d[1],h=d[2],f=d[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var p=(0,l.Z)(e,4);u=p[0],f=p[1],c=p[2],h=p[3]}var v,m=(0,l.Z)(t,4),g=m[0],y=m[1],b=m[3],k=yA(n),V=(0,l.Z)(k,2),x=V[0],w=V[1],I=yA(r),S=(0,l.Z)(I,2),C=S[0],E=S[1],T=kA(g,C),N=kA(y,E),A=VA(a,c,h,x,w,T,N,i,s),R=A.padInfo,_=A.outHeight,D=A.outWidth,F=o?b*f:b;return"channelsFirst"===s?v=[u,F,_,D]:"channelsLast"===s&&(v=[u,_,D,F]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:h,inChannels:f,outHeight:_,outWidth:D,outChannels:F,padInfo:R,strideHeight:x,strideWidth:w,filterHeight:g,filterWidth:y,effectiveFilterHeight:T,effectiveFilterWidth:N,dilationHeight:C,dilationWidth:E,inShape:e,outShape:v,filterShape:t}}function mA(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,h=-1,f=-1,d=-1;if("channelsLast"===o){var p=(0,l.Z)(e,5);u=p[0],c=p[1],h=p[2],f=p[3],d=p[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var v=(0,l.Z)(e,5);u=v[0],d=v[1],c=v[2],h=v[3],f=v[4]}var m,g=(0,l.Z)(t,5),y=g[0],b=g[1],k=g[2],V=g[4],x=bA(n),w=(0,l.Z)(x,3),I=w[0],S=w[1],C=w[2],E=bA(r),T=(0,l.Z)(E,3),N=T[0],A=T[1],R=T[2],_=kA(y,N),D=kA(b,A),F=kA(k,R),O=xA(a,c,h,f,I,S,C,_,D,F,s),L=O.padInfo,M=O.outDepth,P=O.outHeight,z=O.outWidth,B=i?V*d:V;return"channelsFirst"===o?m=[u,B,M,P,z]:"channelsLast"===o&&(m=[u,M,P,z,B]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:h,inWidth:f,inChannels:d,outDepth:M,outHeight:P,outWidth:z,outChannels:B,padInfo:L,strideDepth:I,strideHeight:S,strideWidth:C,filterDepth:y,filterHeight:b,filterWidth:k,effectiveFilterDepth:_,effectiveFilterHeight:D,effectiveFilterWidth:F,dilationDepth:N,dilationHeight:A,dilationWidth:R,inShape:e,outShape:m,filterShape:t}}function gA(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=kA(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function yA(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function bA(e){return"number"===typeof e?[e,e,e]:e}function kA(e,t){return t<=1?e:e+(e-1)*(t-1)}function VA(e,t,n,r,a,i,o,s,u){var c,l,h;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,a){null==r&&(r=gA(e,t,n));var i=e[0],o=e[1];return[wA((i-t+2*r)/n+1,a),wA((o-t+2*r)/n+1,a)]}([t,n],i,r,e,s);l=f[0],h=f[1]}else if("same"===e){l=Math.ceil(t/r),h=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),p=Math.max(0,(h-1)*a+o-n),v=Math.floor(d/2),m=d-v,g=Math.floor(p/2);c={top:v,bottom:m,left:g,right:p-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],k="channelsLast"===u?e[2][0]:e[3][0],V="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:k,right:V,type:0===y&&0===b&&0===k&&0===V?"VALID":"EXPLICIT"},l=wA((t-i+y+b)/r+1,s),h=wA((n-o+k+V)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:h}}function xA(e,t,n,r,a,i,o,s,u,c,l){var h,f,d,p;if("number"===typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,a,i){null==a&&(a=gA(e,t,r));var o=e[0],s=e[1],u=e[2];return[wA((o-t+2*a)/r+1,i),wA((s-t+2*a)/r+1,i),wA((u-t+2*a)/r+1,i),n]}([t,n,r,1],s,1,a,e,l);f=v[0],d=v[1],p=v[2]}else if("same"===e){var m=((f=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((p=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(m/2),k=m-b,V=Math.floor(g/2),x=g-V,w=Math.floor(y/2);h={top:V,bottom:x,left:w,right:y-w,front:b,back:k,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/a),d=Math.ceil((n-u+1)/i),p=Math.ceil((r-c+1)/o)}return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}function wA(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function IA(e){var t=yA(e),n=(0,l.Z)(t,3),r=n[0],a=n[1],i=n[2];return 1===r&&1===a&&1===i}function SA(e,t){return IA(e)||IA(t)}function CA(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}function EA(e,t,n){if(null!=n){if("string"===typeof t)throw Error("Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,"."));if("number"===typeof t)Bx(Hx(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}));else{if("object"!==typeof t)throw Error("Error in ".concat(e,": Unknown padding parameter: ").concat(t));t.forEach((function(t){t.forEach((function(t){Bx(Hx(t),(function(){return"Error in ".concat(e,": pad must be an integer when using ")+"dimRoundingMode ".concat(n," but got pad ").concat(t,".")}))}))}))}}}var TA=$E({reshape_:function(e,t){var n={x:YE(e,"x","reshape","string_or_numeric")},r={shape:t};return jE.runKernel(OS,n,r)}});var NA=$E({avgPool_:function(e,t,n,r,a){var i=YE(e,"x","avgPool","float32");Bx(SA(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=TA(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Bx(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),EA("avgPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=jE.runKernel(Ww,u,c);return l=cN(l,i.dtype),s?TA(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var AA=$E({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=YE(e,"x","avgPool3d","float32"),s=o,u=!1;4===o.rank&&(u=!0,s=TA(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Bx(5===s.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),Bx("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),EA("avgPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},h=jE.runKernel(Zw,c,l);return h=cN(h,s.dtype),u?TA(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var RA=$E({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=YE(e,"x","batchNorm"),c=YE(t,"mean","batchNorm"),l=YE(n,"variance","batchNorm");null!=a&&(o=YE(a,"scale","batchNorm")),null!=r&&(s=YE(r,"offset","batchNorm")),Bx(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Bx(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Bx(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var h=function(e){return 0===e.rank||1===e.rank?TA(e,[1,1,1,e.size]):2===e.rank?TA(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?TA(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(u),f={x:h,scale:o,offset:s,mean:c,variance:l},d={varianceEpsilon:i},p=jE.runKernel(LI,f,d);return TA(p,u.shape)}});var _A=$E({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=YE(e,"x","batchNorm"),c=YE(t,"mean","batchNorm"),l=YE(n,"variance","batchNorm");return null!=a&&(o=YE(a,"scale","batchNorm")),null!=r&&(s=YE(r,"offset","batchNorm")),Bx(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(u.rank,".")})),Bx(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(c.rank,".")})),Bx(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&Bx(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&Bx(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(s.rank,".")})),RA(u,c,l,s,o,i)}});var DA=$E({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=YE(e,"x","batchNorm"),c=YE(t,"mean","batchNorm"),l=YE(n,"variance","batchNorm");return null!=a&&(o=YE(a,"scale","batchNorm")),null!=r&&(s=YE(r,"offset","batchNorm")),Bx(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(u.rank,".")})),Bx(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(c.rank,".")})),Bx(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&Bx(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&Bx(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(s.rank,".")})),RA(u,c,l,s,o,i)}});var FA=$E({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=YE(e,"x","batchNorm"),c=YE(t,"mean","batchNorm"),l=YE(n,"variance","batchNorm");return null!=a&&(o=YE(a,"scale","batchNorm")),null!=r&&(s=YE(r,"offset","batchNorm")),Bx(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(u.rank,".")})),Bx(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(c.rank,".")})),Bx(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&Bx(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&Bx(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(s.rank,".")})),RA(u,c,l,s,o,i)}});var OA=$E({broadcastTo_:function(e,t){var n=YE(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!==0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=TA(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));var u=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===u.length)return lN(n);var c={x:n},l={reps:o};return jE.runKernel(bC,c,l)}});var LA=$E({clipByValue_:function(e,t,n){var r=YE(e,"x","clipByValue");Bx(t<=n,(function(){return"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")}));var a={x:r},i={clipValueMin:t,clipValueMax:n};return jE.runKernel(Jw,a,i)}});var MA=$E({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;Bx(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=JE(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return lN(n[0]);var r=n,a={axis:t};return jE.runKernel(tI,r,a)}});var PA=$E({concat1d_:function(e){return MA(e,0)}});var zA=$E({concat2d_:function(e,t){return MA(e,t)}});var BA=$E({concat3d_:function(e,t){return MA(e,t)}});var UA=$E({concat4d_:function(e,t){return MA(e,t)}});var WA=$E({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=YE(e,"x","conv2d","float32"),u=YE(t,"filter","conv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=TA(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Bx(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),Bx(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),EA("conv2d",r,o);var h="NHWC"===a?c.shape[3]:c.shape[1];Bx(h===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(h,") must match ")+"input depth for filter ".concat(u.shape[2],".")})),Bx(SA(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")}));var f={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=jE.runKernel(nI,f,d);return l?TA(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var jA=$E({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=YE(e,"x","conv1d"),u=YE(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=TA(s,[1,s.shape[0],s.shape[1]])),Bx(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),Bx(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")})),EA("conv1d",r,o),Bx(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")})),Bx(SA(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'")})),Bx("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var h=TA(u,[1,u.shape[0],u.shape[1],u.shape[2]]),f=TA(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=[1,n],p=[1,i],v="NHWC",m=WA(f,h,d,r,v,p,o);return TA(m,l?[m.shape[2],m.shape[3]]:[m.shape[0],m.shape[2],m.shape[3]])}});var ZA=$E({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;Bx(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=TA(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),Bx(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")})),Bx(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)})),Bx(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],h="NHWC"===i?u.shape[3]:u.shape[1];Bx(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[2],".")})),Bx(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(h,") must ")+"match output depth for filter ".concat(n.shape[3],".")})),EA("conv2dDerInput",a,o);var f={dy:u,filter:n},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=jE.runKernel(aI,f,d);return c?TA(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var GA=$E({conv2dTranspose_:function(e,t,n,r,a,i){var o=YE(e,"x","conv2dTranspose"),s=YE(t,"filter","conv2dTranspose");return ZA(n,o,s,r,a,"NHWC",i)}});var HA=$E({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=YE(e,"x","conv3d"),s=YE(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=TA(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Bx(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),Bx(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")})),Bx(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")})),Bx(SA(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),Bx("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var l={x:u,filter:s},h={strides:n,pad:r,dataFormat:a,dilations:i},f=jE.runKernel(iI,l,h);return c?TA(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});var qA=$E({conv3DBackpropInput_:function(e,t,n,r,a){Bx(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=TA(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];Bx(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")})),Bx(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)})),Bx(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)})),Bx(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[3],".")})),Bx(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(n.shape[4],".")}));var l={dy:o,filter:n},h={pad:a,strides:r,inputShape:i},f=jE.runKernel(sI,l,h);return s?TA(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});var KA=$E({conv3dTranspose_:function(e,t,n,r,a){var i=YE(e,"x","conv3dTranspose"),o=YE(t,"filter","conv3dTranspose");return qA(n,i,o,r,a)}});var XA=$E({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=YE(e,"x","depthwiseConv2d","float32"),u=YE(t,"filter","depthwiseConv2d","float32"),c=s,l=!1;3===s.rank&&(l=!0,c=TA(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Bx(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")})),Bx(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")}));var h="NHWC"===a?c.shape[3]:c.shape[1];Bx(h===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(h,") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")})),EA("depthwiseConv2d",r,o);var f={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=jE.runKernel(vI,f,d);return l?TA(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var QA=$E({floorDiv_:function(e,t){var n=YE(e,"a","floorDiv"),r=YE(t,"b","floorDiv"),a=DE(n,r),i=(0,l.Z)(a,2),o={a:n=i[0],b:r=i[1]};return jE.runKernel(OI,o)}});var YA=$E({div_:function(e,t){var n=YE(e,"a","div"),r=YE(t,"b","div"),a=DE(n,r),i=(0,l.Z)(a,2);if(n=i[0],r=i[1],"int32"===n.dtype&&"int32"===r.dtype)return QA(n,r);var o={a:n,b:r};return jE.runKernel(xI,o,{})}});var JA=$E({elu_:function(e){var t={x:YE(e,"x","elu","float32")};return jE.runKernel(II,t)}});var $A=$E({equal_:function(e,t){var n=YE(e,"a","equal","string_or_numeric"),r=YE(t,"b","equal","string_or_numeric"),a=DE(n,r),i=(0,l.Z)(a,2);n=i[0],r=i[1],PN(n.shape,r.shape);var o={a:n,b:r};return jE.runKernel(EI,o)}});var eR=$E({exp_:function(e){var t={x:YE(e,"x","exp")};return jE.runKernel(TI,t)}});var tR=$E({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=YE(e,"x","expandDims","string_or_numeric");Bx(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return jE.runKernel(NI,r,a)}});var nR=$E({tile_:function(e,t){var n=YE(e,"x","tile","string_or_numeric");Bx(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")}));var r={x:n},a={reps:t};return jE.runKernel(bC,r,a)}});var rR=$E({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=uN([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=TA(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return nR(tR(s,0),[n[0],1,1]);if(2===n.length)return nR(tR(tR(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return nR(tR(tR(tR(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});function aR(e,t,n){var r={shape:e,value:t,dtype:n};return jE.runKernel(_I,{},r)}var iR=$E({floor_:function(e){var t={x:YE(e,"x","floor","float32")};return jE.runKernel(FI,t)}});var oR=$E({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=YE(e,"x","gather"),i=YE(t,"indices","gather","int32"),o={x:a,indices:i},s={axis:n,batchDims:r};return jE.runKernel(MI,o,s)}});var sR=$E({greater_:function(e,t){var n=YE(e,"a","greater","string_or_numeric"),r=YE(t,"b","greater","string_or_numeric"),a=DE(n,r),i=(0,l.Z)(a,2);n=i[0],r=i[1],PN(n.shape,r.shape);var o={a:n,b:r};return jE.runKernel(zI,o)}});var uR=$E({greaterEqual_:function(e,t){var n=YE(e,"a","greaterEqual","string_or_numeric"),r=YE(t,"b","greaterEqual","string_or_numeric"),a=DE(n,r),i=(0,l.Z)(a,2);n=i[0],r=i[1],PN(n.shape,r.shape);var o={a:n,b:r};return jE.runKernel(BI,o)}});var cR=$E({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=YE(e,"x","leakyRelu"),r={x:n},a={alpha:t};return jE.runKernel(qI,r,a)}});var lR=$E({log_:function(e){var t={x:YE(e,"x","log","float32")};return jE.runKernel(YI,t)}});var hR=$E({log1p_:function(e){var t={x:YE(e,"x","log1p")};return jE.runKernel(JI,t)}});var fR=$E({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=YE(e,"x","max"),a={x:r},i={reductionIndices:t,keepDims:n};return jE.runKernel(aS,a,i)}});var dR=$E({mul_:function(e,t){var n=YE(e,"a","mul"),r=YE(t,"b","mul"),a=DE(n,r),i=(0,l.Z)(a,2),o={a:n=i[0],b:r=i[1]};return jE.runKernel(gS,o)}});var pR=$E({sub_:function(e,t){var n=YE(e,"a","sub"),r=YE(t,"b","sub"),a=DE(n,r),i=(0,l.Z)(a,2),o={a:n=i[0],b:r=i[1]};return jE.runKernel(mC,o)}});var vR=$E({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=YE(e,"x","sum");"bool"===r.dtype&&(r=cN(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return jE.runKernel(tC,a,i)}});var mR=$E({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=YE(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));var r=aA((function(e,n){var r=fR(e,t,!0),a=pR(e,r),i=pR(cN(a,"float32"),lR(vR(eR(a),t,!0)));n([i]);return{value:i,gradFunc:function(e,n){var r=(0,l.Z)(n,1)[0],a=eR(r);return pR(e,dR(vR(e,t,!0),a))}}}));return r(n)}});var gR=$E({logicalAnd_:function(e,t){var n=YE(e,"a","logicalAnd","bool"),r=YE(t,"b","logicalAnd","bool");PN(n.shape,r.shape);var a={a:n,b:r};return jE.runKernel($I,a)}});var yR=$E({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=YE(e,"a","matMul"),i=YE(t,"b","matMul"),o=DE(a,i),s=(0,l.Z)(o,2),u={a:a=s[0],b:i=s[1]},c={transposeA:n,transposeB:r};return jE.runKernel(Hw,u,c)}});var bR=$E({maxPool_:function(e,t,n,r,a){var i=YE(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=TA(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Bx(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),Bx(SA(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")})),EA("maxPool",r,a);var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=jE.runKernel(oS,u,c);return s?TA(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var kR=$E({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=YE(e,"x","maxPool3d"),s=o,u=!1;4===o.rank&&(u=!0,s=TA(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),Bx(5===s.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(s.rank,".")})),Bx("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),EA("maxPool3d",r,a);var c={x:s},l={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i},h=jE.runKernel(uS,c,l);return u?TA(h,[h.shape[1],h.shape[2],h.shape[3],h.shape[4]]):h}});var VR=$E({maximum_:function(e,t){var n=YE(e,"a","maximum"),r=YE(t,"b","maximum"),a=DE(n,r),i=(0,l.Z)(a,2);n=i[0],r=i[1],"bool"===n.dtype&&(n=cN(n,"int32"),r=cN(r,"int32")),PN(n.shape,r.shape);var o={a:n,b:r};return jE.runKernel(iS,o)}});var xR=$E({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=YE(e,"x","mean"),a={x:r},i={axis:t,keepDims:n};return jE.runKernel(hS,a,i)}});var wR=$E({minimum_:function(e,t){var n=YE(e,"a","minimum"),r=YE(t,"b","minimum"),a=DE(n,r),i=(0,l.Z)(a,2);n=i[0],r=i[1],"bool"===n.dtype&&(n=cN(n,"int32"),r=cN(r,"int32")),PN(n.shape,r.shape);var o={a:n,b:r};return jE.runKernel(dS,o)}});function IR(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function SR(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function CR(e,t){return function(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}(e,t.map((function(e){return 1})),t)}function ER(e,t,n){Bx(IR(t,n),(function(){return"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function TR(e,t){if(IR(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function NR(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function AR(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var RR=$E({square_:function(e){var t=YE(e,"x","square");return jE.runKernel("Square",{x:t},{})}});var _R=$E({moments_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Yx(t,(e=YE(e,"x","moments")).shape),a=xR(e,r,n),i=a.shape;n||(i=CR(a.shape,r));var o=RR(pR(cN(e,"float32"),TA(a,i))),s=xR(o,r,n);return{mean:a,variance:s}}});var DR=$E({neg_:function(e){var t={x:YE(e,"x","neg")};return jE.runKernel(yS,t)}});var FR=$E({notEqual_:function(e,t){var n=YE(e,"a","notEqual","string_or_numeric"),r=YE(t,"b","notEqual","string_or_numeric"),a=DE(n,r),i=(0,l.Z)(a,2);n=i[0],r=i[1],PN(n.shape,r.shape);var o={a:n,b:r};return jE.runKernel(bS,o)}});var OR=$E({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"int32";if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var i=YE(e,"indices","oneHot","int32"),o={indices:i},s={dtype:a,depth:t,onValue:n,offValue:r};return jE.runKernel(IS,o,s)}});function LR(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=LR(e,"float32"),r=LR(e,"float32");return eT(n,r)}var a=dw(Zx(e),t);return jE.makeTensor(a,e,t)}function MR(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=MR(e,"float32"),r=LR(e,"float32");return eT(n,r)}var a=fw(Zx(e),t);return jE.makeTensor(a,e,t)}var PR=$E({onesLike_:function(e){var t={x:YE(e,"x","onesLike")};return jE.runKernel(wS,t)}});var zR=$E({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=YE(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return jE.runKernel(CS,i,a)}});var BR=$E({prelu_:function(e,t){var n={x:YE(e,"x","prelu"),alpha:YE(t,"alpha","prelu")};return jE.runKernel(TS,n)}}),UR=n(6699),WR=function(){function e(t,n,r,a,i){f(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=UR.alea(o.toString())}return p(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),jR=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if(f(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"===typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=UR.alea(i)}return p(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var ZR=$E({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new WR(t,n,r,!1,a),o=uN(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var GR=$E({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,i=uN(e,r),o=new jR(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});var HR=$E({relu_:function(e){var t={x:YE(e,"x","relu")};return jE.runKernel(FS,t)}});var qR=$E({reverse_:function(e,t){var n={x:YE(e,"x","reverse")},r={dims:t};return jE.runKernel(US,n,r)}});var KR=$E({selu_:function(e){var t={x:YE(e,"x","selu")};return jE.runKernel(qS,t)}});var XR=$E({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=YE(e,"x","separableConv2d"),u=YE(t,"depthwiseFilter","separableConv2d"),c=YE(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=TA(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");Bx(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")})),Bx(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),Bx(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),Bx(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")})),Bx(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")}));var f=u.shape[2],d=u.shape[3];Bx(c.shape[2]===f*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(f*d,", ")+"but got ".concat(c.shape[2],".")}));var p=XA(l,u,r,a,o,i),v=1,m=WA(p,c,v,"valid",o);return h?TA(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});var QR=$E({sigmoid_:function(e){var t={x:YE(e,"x","sigmoid","float32")};return jE.runKernel(JS,t)}});var YR=$E({slice_:function(e,t,n){var r=YE(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return jE.runKernel(KS,a,i)}});var JR=$E({slice1d_:function(e,t,n){var r=YE(e,"x","slice1d");return Bx(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),YR(r,[t],[n])}});var $R=$E({slice2d_:function(e,t,n){var r=YE(e,"x","slice2d");return Bx(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),YR(r,t,n)}});var e_=$E({slice3d_:function(e,t,n){var r=YE(e,"x","slice3d");return Bx(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),YR(r,t,n)}});var t_=$E({slice4d_:function(e,t,n){var r=YE(e,"x","slice4d");return Bx(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),YR(r,t,n)}});var n_=$E({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=YE(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return jE.runKernel(aC,r,a)}});var r_=$E({softplus_:function(e){var t={x:YE(e,"x","softplus")};return jE.runKernel($S,t)}});var a_=$E({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=YE(e,"x","split"),a={x:r},i={numOrSizeSplits:t,axis:n};return jE.runKernel(rC,a,i)}});var i_=$E({sqrt_:function(e){var t={x:YE(e,"x","sqrt","float32")};return jE.runKernel(eC,t)}});var o_=$E({squeeze_:function(e,t){var n=YE(e,"x","squeeze","string_or_numeric");return TA(n,Jx(n.shape,t).newShape)}});var s_=$E({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=JE(e,"tensors","stack","string_or_numeric");Bx(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&Bx(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return jE.runKernel(SS,r,a)}});var u_=$E({tanh_:function(e){var t={x:YE(e,"x","tanh","float32")};return jE.runKernel(yC,t)}});function c_(e,t){Wx(e);var n=KE(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return tT(e,null,n,t)}var l_=$E({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new WR(t,n,r,!0,a),o=uN(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var h_=$E({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=YE(e,"x","unstack","string_or_numeric");Bx(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return jE.runKernel(IC,r,a)}});function f_(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return jE.makeVariable(e,t,n,r)}var d_=$E({where_:function(e,t,n){var r=YE(t,"a","where"),a=YE(n,"b","where"),i=YE(e,"condition","where","bool"),o=PN(PN(i.shape,r.shape),a.shape),s={condition:OA(i,o),t:OA(r,o),e:OA(a,o)};return jE.runKernel(HS,s)}});var p_=$E({zerosLike_:function(e){var t={x:YE(e,"x","zerosLike")};return jE.runKernel(CC,t)}});var v_=$E({imag_:function(e){var t={input:YE(e,"input","imag")};return jE.runKernel(jI,t)}});var m_=$E({real_:function(e){var t={input:YE(e,"input","real")};return jE.runKernel(_S,t)}});var g_=$E({transpose_:function(e,t,n){var r=YE(e,"x","transpose");if(null==t&&(t=r.shape.map((function(e,t){return t})).reverse()),Bx(r.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){Bx(e>=0&&e<r.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(t)}))})),r.rank<=1)return r.clone();var a={x:r},i={perm:t};return"complex64"===r.dtype?eA((function(){var e=m_(r),t=v_(r);return e=jE.runKernel(xC,{x:e},i),t=jE.runKernel(xC,{x:t},i),n&&(t=DR(t)),eT(e,t)})):jE.runKernel(xC,a,i)}});var y_=$E({dropout_:function(e,t,n,r){var a=YE(e,"x","dropout");if(Bx("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")})),Bx(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof xE?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(Gx(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=YA(iR(uA(GR(i,0,1,"float32",r),o)),o);return dR(a,s)}});var b_=$E({fft_:function(e){Bx("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return jE.runKernel(RI,t)}});var k_=$E({rfft_:function(e,t){Bx("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=YR(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=MA([e,LR(s)],e.shape.length-1),r=t}else n=e;var u=p_(n),c=TA(eT(n,u),[a,r]),l=b_(c),h=Math.floor(r/2)+1,f=m_(l),d=v_(l),p=a_(f,[h,r-h],f.shape.length-1),v=a_(d,[h,r-h],d.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=h,TA(eT(p[0],v[0]),m)}});var V_=$E({ifft_:function(e){Bx("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return jE.runKernel(WI,t)}});var x_=$E({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=TA(e,[r,n]);t=V_(a)}else{var i=[r,2*(n-1)],o=TA(m_(e),[r,n]),s=TA(v_(e),[r,n]),u=qR(YR(o,[0,1],[r,n-2]),1),c=dR(qR(YR(s,[0,1],[r,n-2]),1),iA(-1)),l=MA([o,u],1),h=MA([s,c],1),f=TA(eT(l,h),[i[0],i[1]]);t=V_(f)}if(t=m_(t),3===e.rank&&0!==e.shape[0]){var d=t,p=e.shape[0];t=TA(t,[p,t.shape[0]/p,t.shape[1]]),d.dispose()}return t}});var w_=$E({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=TA(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=TA(t,[1,t.shape[0],t.shape[1],t.shape[2]])),Bx(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")})),Bx(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")})),Bx(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];Bx(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(n[2],".")})),Bx(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(n[3],").")})),EA("conv2dDerFilter",a,o);var h={x:s,dy:u},f={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return jE.runKernel(rI,h,f)}});var I_=$E({relu6_:function(e){var t={x:YE(e,"x","relu6")};return jE.runKernel(BS,t)}});var S_=$E({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=YE(e,"x","step"),r={x:n},a={alpha:t};return jE.runKernel(EC,r,a)}});function C_(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return dR(e,S_(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function E_(e,t){var n=t,r=MN(e.shape,t.shape);return r.length>0&&(n=vR(n,r)),TA(n,e.shape)}function T_(e,t,n,r){if("linear"===t)return e;if("relu"===t)return HR(e);if("elu"===t)return JA(e);if("relu6"===t)return I_(e);if("prelu"===t)return BR(e,n);if("leakyrelu"===t)return cR(e,r);if("sigmoid"===t)return QR(e);throw new Error("Unknown fused activation ".concat(t,"."))}var N_=function(e,t){return!(e>0)||"linear"===t};var A_=$E({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,h=e.bias,f=e.activation,d=void 0===f?"linear":f,p=e.preluActivationWeights,v=e.leakyreluAlpha;if(d=d||"linear",!1===N_(jE.state.gradientDepth,d)){Bx("NHWC"===o,(function(){return"Error in fused conv2d: got dataFormat of ".concat(o," but ")+"only NHWC is currently supported for the case of gradient depth is 0 and the activation is not linear."}));var m=WA(t,n,r,a,o,u,c);return null!=h&&(m=uA(m,h)),T_(m,d,p,v)}var g=YE(t,"x","conv2d","float32"),y=YE(n,"filter","conv2d","float32"),b=g,k=!1;3===g.rank&&(k=!0,b=TA(g,[1,g.shape[0],g.shape[1],g.shape[2]])),Bx(4===b.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(b.rank,".")})),Bx(4===y.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")})),EA("fused conv2d",a,c);var V="NHWC"===o?b.shape[3]:b.shape[1];Bx(y.shape[2]===V,(function(){return"Error in conv2d: depth of input (".concat(V,") must match ")+"input depth for filter ".concat(y.shape[2],".")})),Bx(SA(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(u,"'")}));var x,w,I=vA(b.shape,y.shape,r,u,a,c);if(null!=h){var S=DE(x=YE(h,"bias","fused conv2d"),g),C=(0,l.Z)(S,1);x=C[0],"NHWC"===o?PN(I.outShape,x.shape):(Bx(x.shape.length<=1,(function(){return"Error in fused conv2d: only supports scalar or 1-D Tensor bias for NCHW format but got the bias of "+"rank-".concat(x.shape.length,".")})),Bx(0===x.shape.length||x.shape[0]===I.outChannels||1===x.shape[0],(function(){return"Error in fused conv2d: bias shape (".concat(x.shape,") is not ")+"compatible with the number of output channels "+"(".concat(I.outChannels,")")})))}if(null!=p){var E=p.shape;if(Bx(E.length<=1||3===E.length,(function(){return"Error in fused conv2d: only supports scalar, 1-D Tensor or 3-D Tensor PReLU activation weights but got a tensor of "+"rank-".concat(E.length,".")})),1===E.length)Bx(1===E[0]||E[0]===I.outChannels,(function(){return"Error in fused conv2d: PReLU activation weights "+"(".concat(E,") is not compatible with the number of output ")+"channels (".concat(I.outChannels,").")}));else if(3===E.length)try{PN(E,I.outShape)}catch(F){var T="Error in fused conv2d: PReLU activation weights (".concat(E,") ")+"is not compatible with the output shape of the conv2d "+"(".concat(I.outShape,").");throw Error(T)}w=YE(p,"prelu weights","fused conv2d")}var N=function(e,t){Bx("NHWC"===o,(function(){return"Error in gradient of fused conv2D: got dataFormat of ".concat(o," but only NHWC is currently supported.")}));var n=(0,l.Z)(t,4),i=n[0],s=n[1],c=n[2],h=n[3],f=C_(e,c,d);Bx(IA(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(u,"'")}));var p=[ZA(s.shape,f,i,r,a),w_(s,f,i.shape,r,a)];if(null!=h){var v=E_(h,f);p.push(v)}return p},A={x:b,filter:y,bias:x,preluActivationWeights:w},R={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:d,leakyreluAlpha:v};if(null==h){var _=aA((function(e,t,n){var r=jE.runKernel(RC,A,R);return n([t,e,r]),k&&(r=TA(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:N}}));return _(b,y)}var D=aA((function(e,t,n,r){var a=jE.runKernel(RC,A,R);return r([t,e,a,n]),k&&(a=TA(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:N}}));return D(b,y,x)}});var R_=$E({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=TA(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=TA(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return jE.runKernel(mI,c,l)}});var __=$E({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=TA(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},h=jE.runKernel(gI,c,l);return u?TA(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});$E({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,h=e.bias,f=e.activation,d=void 0===f?"linear":f,p=e.preluActivationWeights,v=e.leakyreluAlpha;if(!1===N_(jE.state.gradientDepth,d)){var m=XA(t,n,r,a,o,u,c);return null!=h&&(m=uA(m,h)),T_(m,d,p,v)}var g=YE(t,"x","depthwiseConv2d","float32"),y=YE(n,"filter","depthwiseConv2d","float32"),b=g,k=!1;3===g.rank&&(k=!0,b=TA(g,[1,g.shape[0],g.shape[1],g.shape[2]])),Bx(4===b.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(b.rank,".")})),Bx(4===y.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")})),Bx(b.shape[3]===y.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(b.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")})),null==u&&(u=[1,1]),Bx(SA(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(r," and dilations '").concat(u,"'")})),EA("fused depthwiseConv2d",a,c);var V,x,w=vA(b.shape,y.shape,r,u,a,c,!0);if(null!=h){var I=DE(V=YE(h,"bias","fused conv2d"),g),S=(0,l.Z)(I,1);V=S[0],PN(w.outShape,V.shape)}null!=p&&(x=YE(p,"prelu weights","fused depthwiseConv2d"));var C=function(e,t){Bx(IA(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(u,"'")}));var n=(0,l.Z)(t,4),i=n[0],o=n[1],s=n[2],h=n[3],f=C_(e,s,d),p=__(o.shape,f,i,r,a,u,c),v=R_(o,f,i.shape,r,a,u,c);return null!=h?[p,v,E_(V,f)]:[p,v]},E={x:b,filter:y,bias:V,preluActivationWeights:x},T={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:d,leakyreluAlpha:v};if(null==h){var N=aA((function(e,t,n){var r=jE.runKernel(_C,E,T);return n([t,e,r]),k&&(r=TA(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:C}}));return N(b,y)}var A=aA((function(e,t,n,r){var a=jE.runKernel(_C,E,T);return r([t,e,a,n]),k&&(a=TA(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:C}}));return A(b,y,V)}});var D_=$E({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,o=void 0!==i&&i,s=e.bias,u=e.activation,c=void 0===u?"linear":u,h=e.preluActivationWeights,f=e.leakyreluAlpha,d=void 0===f?.2:f;if(!1===N_(jE.state.gradientDepth,c)){var p=yR(t,n,a,o);return null!=s&&(p=uA(p,s)),T_(p,c,h,d)}var v=YE(t,"a","fused matMul"),m=YE(n,"b","fused matMul"),g=DE(v,m),y=(0,l.Z)(g,2);v=y[0],m=y[1];var b=a?v.shape[v.rank-2]:v.shape[v.rank-1],k=o?m.shape[m.rank-1]:m.shape[m.rank-2],V=a?v.shape[v.rank-1]:v.shape[v.rank-2],x=o?m.shape[m.rank-2]:m.shape[m.rank-1],w=v.shape.slice(0,-2),I=m.shape.slice(0,-2),S=Zx(w),C=Zx(I);Bx(b===k,(function(){return"Error in fused matMul: inner shapes (".concat(b,") and (")+"".concat(k,") of Tensors with shapes ").concat(v.shape," and ")+"".concat(m.shape," and transposeA=").concat(a)+" and transposeB=".concat(o," must match.")}));var E,T,N=PN(v.shape.slice(0,-2),m.shape.slice(0,-2)).concat([V,x]),A=TA(v,a?[S,b,V]:[S,V,b]),R=TA(m,o?[C,x,k]:[C,k,x]);if(null!=s){var _=DE(E=YE(s,"bias","fused matMul"),v);E=(0,l.Z)(_,1)[0],PN(N,E.shape)}null!=h&&(T=YE(h,"prelu weights","fused matMul"));var D=function(e,t){var n,r,i=(0,l.Z)(t,4),u=i[0],h=i[1],f=i[2],d=i[3],p=C_(TA(e,f.shape),f,c);return a||o?!a&&o?(n=yR(p,h,!1,!1),r=yR(p,u,!0,!1)):a&&!o?(n=yR(h,p,!1,!0),r=yR(u,p,!1,!1)):(n=yR(h,p,!0,!0),r=yR(p,u,!0,!0)):(n=yR(p,h,!1,!0),r=yR(u,p,!0,!1)),null!=s?[n,r,E_(d,p)]:[n,r]},F={a:A,b:R,bias:E,preluActivationWeights:T},O={transposeA:a,transposeB:o,activation:c,leakyreluAlpha:d};if(null==s){var L=aA((function(e,t,n){var r=jE.runKernel(AC,F,O);return n([e,t,r]),{value:TA(r,N),gradFunc:D}}));return L(A,R)}var M=aA((function(e,t,n,r){var a=jE.runKernel(AC,F,O);return r([e,t,a,n]),{value:TA(a,N),gradFunc:D}}));return M(A,R,E)}});function F_(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function O_(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return c_(a,"float32")}$E({hammingWindow_:function(e){return O_(e,.54,.46)}});var L_=$E({hannWindow_:function(e){return O_(e,.5,.5)}});function M_(e,t,n){if(Wx(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=KE(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return tT(e,t,r,n)}var P_=$E({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(YR(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=MA([YR(e,i,t-s),aR([s],a)]);o.push(u),i+=n}return 0===o.length?M_([],[0,t]):TA(MA(o),[o.length,t])}});$E({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:L_;null==r&&(r=F_(t));var i=P_(e,t,n),o=dR(i,a(t));return k_(o,r)}});var z_=$E({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=YE(e,"image","cropAndResize"),s=YE(t,"boxes","cropAndResize","float32"),u=YE(n,"boxInd","cropAndResize","int32"),c=s.shape[0];Bx(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),Bx(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")})),Bx(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")})),Bx(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),Bx(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),Bx("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},h={method:a,extrapolationValue:i,cropSize:r},f=jE.runKernel(fI,l,h);return f}});var B_=$E({flipLeftRight_:function(e){var t=YE(e,"image","flipLeftRight","float32");Bx(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")}));var n={image:t};return jE.runKernel(DI,n,{})}});var U_=$E({grayscaleToRGB_:function(e){var t=YE(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];Bx(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")})),Bx(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,nR(t,a)}});var W_=$E({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=YE(e,"image","rotateWithOffset","float32");Bx(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r},s=jE.runKernel(NC,i,o);return s}});function j_(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),Bx(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),Bx(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),Bx(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),Bx(1===t.rank,(function(){return"scores must be a 1D tensor"})),Bx(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),Bx(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}var Z_=$E({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=YE(e,"boxes","nonMaxSuppression","float32"),o=YE(t,"scores","nonMaxSuppression","float32"),s=j_(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return jE.runKernel(kS,{boxes:i,scores:o},u)}});function G_(e,t,n){var r=function(e,t,n){return function(e,t,n){var r=0,a=e.length,i=0,o=!1;for(;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||H_)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function H_(e,t){return e>t?1:e<t?-1:0}function q_(e,t,n,r,a){return Q_(e,t,n,r,a,0)}function K_(e,t,n,r,a,i){return Q_(e,t,n,r,a,0,!1,i,!0)}function X_(e,t,n,r,a,i){return Q_(e,t,n,r,a,i,!0)}function Q_(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort($_);for(var h=i>0?-.5/i:0,f=[],d=[];f.length<n&&c.length>0;){var p=c.pop(),v=p.score,m=p.boxIndex,g=p.suppressBeginIndex;if(v<a)break;for(var y=!1,b=f.length-1;b>=g;--b){var k=Y_(e,m,f[b]);if(k>=r){y=!0;break}if(p.score=p.score*J_(r,h,k),p.score<=a)break}p.suppressBeginIndex=f.length,y||(p.score===v?(f.push(m),d.push(p.score)):p.score>a&&G_(c,p,$_))}var V=f.length,x=n-V;s&&x>0&&(f.push.apply(f,(0,H.Z)(new Array(x).fill(0))),d.push.apply(d,(0,H.Z)(new Array(x).fill(0))));var w={selectedIndices:f};return o&&(w.selectedScores=d),u&&(w.validOutputs=V),w}function Y_(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),f=Math.max(a[1],a[3]),d=(s-i)*(u-o),p=(h-c)*(f-l);if(d<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,h),y=Math.min(u,f),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function J_(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function $_(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}function eD(){return eD=c(s().mark((function e(t,n,r){var a,i,o,u,c,l,h,f,d,p,v=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=v.length>3&&void 0!==v[3]?v[3]:.5,i=v.length>4&&void 0!==v[4]?v[4]:Number.NEGATIVE_INFINITY,o=YE(t,"boxes","nonMaxSuppressionAsync"),u=YE(n,"scores","nonMaxSuppressionAsync"),c=j_(o,u,r,a,i),r=c.maxOutputSize,a=c.iouThreshold,i=c.scoreThreshold,e.next=10,Promise.all([o.data(),u.data()]);case 10:return l=e.sent,h=l[0],f=l[1],d=q_(h,f,r,a,i),p=d.selectedIndices,o!==t&&o.dispose(),u!==n&&u.dispose(),e.abrupt("return",c_(p,"int32"));case 17:case"end":return e.stop()}}),e)}))),eD.apply(this,arguments)}var tD=function(e,t,n){return eD.apply(this,arguments)};var nD=$E({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=YE(e,"boxes","nonMaxSuppression"),s=YE(t,"scores","nonMaxSuppression"),u=j_(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},h=jE.runKernel(xS,c,l);return{selectedIndices:h[0],selectedScores:h[1]}}});function rD(){return rD=c(s().mark((function e(t,n,r){var a,i,o,u,c,l,h,f,d,p,v,m,g=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=g.length>3&&void 0!==g[3]?g[3]:.5,i=g.length>4&&void 0!==g[4]?g[4]:Number.NEGATIVE_INFINITY,o=g.length>5&&void 0!==g[5]?g[5]:0,u=YE(t,"boxes","nonMaxSuppressionAsync"),c=YE(n,"scores","nonMaxSuppressionAsync"),l=j_(u,c,r,a,i,o),r=l.maxOutputSize,a=l.iouThreshold,i=l.scoreThreshold,o=l.softNmsSigma,e.next=12,Promise.all([u.data(),c.data()]);case 12:return h=e.sent,f=h[0],d=h[1],p=X_(f,d,r,a,i,o),v=p.selectedIndices,m=p.selectedScores,u!==t&&u.dispose(),c!==n&&c.dispose(),e.abrupt("return",{selectedIndices:c_(v,"int32"),selectedScores:c_(m)});case 19:case"end":return e.stop()}}),e)}))),rD.apply(this,arguments)}var aD=function(e,t,n){return rD.apply(this,arguments)};var iD=$E({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=YE(e,"boxes","nonMaxSuppression"),s=YE(t,"scores","nonMaxSuppression"),u=j_(o,s,n,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,h=u.scoreThreshold,f={boxes:o,scores:s},d={maxOutputSize:c,iouThreshold:l,scoreThreshold:h,padToMaxOutputSize:i},p=jE.runKernel(VS,f,d);return{selectedIndices:p[0],validOutputs:p[1]}}});function oD(){return oD=c(s().mark((function e(t,n,r){var a,i,o,u,c,h,f,d,p,v,m,g,y,b,k,V,x=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=x.length>3&&void 0!==x[3]?x[3]:.5,i=x.length>4&&void 0!==x[4]?x[4]:Number.NEGATIVE_INFINITY,o=x.length>5&&void 0!==x[5]&&x[5],u=YE(t,"boxes","nonMaxSuppressionAsync"),c=YE(n,"scores","nonMaxSuppressionAsync"),h=j_(u,c,r,a,i,null),f=h.maxOutputSize,d=h.iouThreshold,p=h.scoreThreshold,e.next=11,Promise.all([u.data(),c.data()]);case 11:return v=e.sent,m=(0,l.Z)(v,2),g=m[0],y=m[1],b=K_(g,y,f,d,p,o),k=b.selectedIndices,V=b.validOutputs,u!==t&&u.dispose(),c!==n&&c.dispose(),e.abrupt("return",{selectedIndices:c_(k,"int32"),validOutputs:iA(V,"int32")});case 19:case"end":return e.stop()}}),e)}))),oD.apply(this,arguments)}var sD=function(e,t,n){return oD.apply(this,arguments)},uD=n(3878),cD=n(9199),lD=n(5267);function hD(e){return(0,uD.Z)(e)||(0,cD.Z)(e)||(0,v.Z)(e)||(0,lD.Z)()}var fD=$E({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=YE(e,"images","resizeBilinear");Bx(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),Bx(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")})),Bx(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=TA(a,[1,a.shape[0],a.shape[1],a.shape[2]])),hD(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=jE.runKernel(PS,s,u);return o?TA(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var dD=$E({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=YE(e,"images","resizeNearestNeighbor");Bx(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),Bx(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),Bx("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),Bx(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=TA(a,[1,a.shape[0],a.shape[1],a.shape[2]])),hD(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=jE.runKernel(LS,s,u);return o?TA(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var pD=$E({bincount_:function(e,t,n){var r=YE(e,"x","bincount"),a=YE(t,"weights","bincount");Bx("int32"===r.dtype,(function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)})),Bx(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),Bx(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return jE.runKernel(Kw,i,o)}});var vD=$E({lessEqual_:function(e,t){var n=YE(e,"a","lessEqual","string_or_numeric"),r=YE(t,"b","lessEqual","string_or_numeric"),a=DE(n,r),i=(0,l.Z)(a,2);n=i[0],r=i[1],PN(n.shape,r.shape);var o={a:n,b:r};return jE.runKernel(XI,o)}});var mD=$E({round_:function(e){var t={x:YE(e,"x","round")};return jE.runKernel(WS,t)}});function gD(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return jE.runKernel(RS,{},a)}function yD(e,t){for(var n,r,a,i,o,s,u=c_([-1]),c=c_([0]),l=c_([0]),h=0;h<e.size-1;h++){n=YR(e,0,h+1),r=YR(e,h+1),o=YA(vR(n),t),s=YA(vR(r),t);var f=vR(dR(n,gD(0,n.size)));a=YA(f,vR(n));var d=aR(r.shape,n.size),p=uA(gD(0,r.size),d),v=dR(r,p);i=YA(vR(v),vR(r));var m=pR(a,i),g=pR(a,i),y=dR(o,s);l=dR(dR(y,m),g);var b=sR(l,c);c=d_(b,l,c),u=d_(b,c_([h]),u)}return u}var bD=$E({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,u=YE(e,"image","threshold"),c=.2989,h=.587,f=.114,d=u.shape[0]*u.shape[1],p=dR(c_([s]),255);if(Bx(3===u.rank,(function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(u.rank,".")})),Bx(3===u.shape[2]||1===u.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(u.shape[2],".")})),Bx("int32"===u.dtype||"float32"===u.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(u.dtype,".")})),Bx("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===u.shape[2]){var v=a_(u,[1,1,1],-1),m=(0,l.Z)(v,3);t=m[0],n=m[1],r=m[2];var g=dR(t,c),y=dR(n,h),b=dR(r,f);a=uA(uA(g,y),b)}else a=e;if("otsu"===i){var k=pD(cN(mD(a),"int32"),nT([]),256);p=yD(k,d)}var V=o?vD(a,p):sR(a,p),x=cN(dR(V,255),"int32");return x}});var kD=$E({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=YE(e,"image","transform","float32"),s=YE(t,"transforms","transform","float32");Bx(4===o.rank,(function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),Bx(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),Bx(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")}));var u={image:o,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return jE.runKernel(VC,u,c)}});var VD=$E({bandPart_:function(e,t,n){Bx(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),Bx(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=YE(e,"a","bandPart");Bx(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=r.shape.slice(-2),o=(0,l.Z)(i,2),s=o[0],u=o[1];if(!(t<=s))throw new Error("bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(s,")."));if(!(n<=u))throw new Error("bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(u,")."));t<0&&(t=s),n<0&&(n=u);var c=TA(gD(0,s,1,"int32"),[-1,1]),h=gD(0,u,1,"int32"),f=pR(c,h),d=gR(vD(f,iA(+t,"int32")),uR(f,iA(-n,"int32"))),p=LR([s,u],r.dtype);return TA(s_(h_(TA(r,[-1,s,u])).map((function(e){return d_(d,e,p)}))),a)}});var xD=$E({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=YE(e,"x","min"),a={x:r},i={axis:t,keepDims:n};return jE.runKernel(fS,a,i)}});var wD=$E({pow_:function(e,t){var n=YE(e,"base","pow"),r=YE(t,"exp","pow"),a=DE(n,r),i=(0,l.Z)(a,2),o={a:n=i[0],b:r=i[1]};return jE.runKernel(ES,o)}});function ID(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return sA(e);if(1!==e.rank&&null===n)return ID(TA(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return vR(sA(e),n);if(t===1/0)return fR(sA(e),n);if(t===-1/0)return xD(sA(e),n);if("euclidean"===t||2===t)return i_(vR(wD(sA(e),iA(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return fR(vR(sA(e),n[0]),n[1]-1);if(t===1/0)return fR(vR(sA(e),n[1]),n[0]);if(t===-1/0)return xD(vR(sA(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return i_(vR(RR(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var SD=$E({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=ID(e=YE(e,"x","norm"),t,n),i=a.shape;if(r){var o=Yx(n,e.shape);i=CR(a.shape,o)}return TA(a,i)}});var CD=$E({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,Bx(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){Bx(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=a_(e,e.shape[0],0).map((function(e){return o_(e,[0])}))),Bx(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(jE.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=dR(vR(dR(n[a],t)),n[a]);t=pR(t,i)}return YA(t,SD(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?s_(n,0):n}});function ED(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return jE.tidy((function(){Bx(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=rR(n),i=lN(e),o=M_([[1]],[1,1]),s=lN(o),u=n>=r?r:n,c=function(e){var t=i,u=s,c=a,h=jE.tidy((function(){var t=YR(i,[e,e],[n-e,1]),u=SD(t),c=YR(i,[e,e],[1,1]),l=d_(sR(c,0),M_([[-1]]),M_([[1]])),h=pR(c,dR(l,u)),f=YA(t,h);s=1===f.shape[0]?lN(o):MA([o,YR(f,[1,0],[f.shape[0]-1,f.shape[1]])],0);var d=DR(YA(yR(l,h),u)),p=YR(i,[e,0],[n-e,r]),v=dR(d,s),m=g_(s);if(0===e)i=pR(p,yR(v,yR(m,p)));else{var g=pR(p,yR(v,yR(m,p)));i=MA([YR(i,[0,0],[e,r]),g],0)}var y=g_(v),b=YR(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=pR(b,yR(yR(b,s),y));else{var k=pR(b,yR(yR(b,s),y));a=MA([YR(a,[0,0],[n,e]),k],1)}return[s,i,a]})),f=(0,l.Z)(h,3);s=f[0],i=f[1],a=f[2],tA([t,u,c])},h=0;h<u;++h)c(h);return!t&&n>r&&(a=YR(a,[0,0],[n,r]),i=YR(i,[0,0],[r,r])),[a,i]}))}var TD,ND=$E({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Bx(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return ED(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=h_(TA(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach((function(e){var n=ED(e,t),r=(0,l.Z)(n,2),o=r[0],s=r[1];a.push(o),i.push(s)}));var o=TA(s_(a,0),e.shape),s=TA(s_(i,0),e.shape);return[o,s]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(TD||(TD={}));var AD=$E({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:TD.SUM_BY_NONZERO_WEIGHTS,r=YE(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=YE(t,"weights","computeWeightedLoss"));var i=null==a?r:dR(r,a);if(n===TD.NONE)return i;if(n===TD.SUM)return vR(i);if(n===TD.MEAN){if(null==a)return xR(i);var o=r.size/a.size,s=YA(vR(i),vR(a));return o>1?YA(s,iA(o)):s}if(n===TD.SUM_BY_NONZERO_WEIGHTS){if(null==a)return YA(vR(i),iA(r.size));var u=dR(a,MR(r.shape)),c=cN(vR(FR(u,iA(0))),"float32");return YA(vR(i),c)}throw Error("Unknown reduction: ".concat(n))}});$E({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:TD.SUM_BY_NONZERO_WEIGHTS,a=YE(e,"labels","absoluteDifference"),i=YE(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=YE(n,"weights","absoluteDifference")),Ux(a.shape,i.shape,"Error in absoluteDifference: ");var s=sA(pR(a,i));return AD(s,o,r)}});$E({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:TD.SUM_BY_NONZERO_WEIGHTS,i=YE(e,"labels","cosineDistance"),o=YE(t,"predictions","cosineDistance"),s=null;null!=r&&(s=YE(r,"weights","cosineDistance")),Ux(i.shape,o.shape,"Error in cosineDistance: ");var u=iA(1),c=pR(u,vR(dR(i,o),n,!0));return AD(c,s,a)}});$E({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:TD.SUM_BY_NONZERO_WEIGHTS,a=YE(e,"labels","hingeLoss"),i=YE(t,"predictions","hingeLoss"),o=null;null!=n&&(o=YE(n,"weights","hingeLoss")),Ux(a.shape,i.shape,"Error in hingeLoss: ");var s=iA(1);a=pR(dR(iA(2),a),s);var u=HR(pR(s,dR(a,i)));return AD(u,o,r)}});$E({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:TD.SUM_BY_NONZERO_WEIGHTS,i=YE(e,"labels","huberLoss"),o=YE(t,"predictions","huberLoss"),s=null;null!=n&&(s=YE(n,"weights","huberLoss")),Ux(i.shape,o.shape,"Error in huberLoss: ");var u=iA(r),c=sA(pR(o,i)),l=wR(c,u),h=pR(c,l),f=uA(dR(iA(.5),RR(l)),dR(u,h));return AD(f,s,a)}});$E({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:TD.SUM_BY_NONZERO_WEIGHTS,i=YE(e,"labels","logLoss"),o=YE(t,"predictions","logLoss"),s=null;null!=n&&(s=YE(n,"weights","logLoss")),Ux(i.shape,o.shape,"Error in logLoss: ");var u=iA(1),c=iA(r),l=DR(dR(i,lR(uA(o,c)))),h=dR(pR(u,i),lR(uA(pR(u,o),c))),f=pR(l,h);return AD(f,s,a)}});var RD=$E({squaredDifference_:function(e,t){var n=YE(e,"a","squaredDifference"),r=YE(t,"b","squaredDifference"),a=DE(n,r),i=(0,l.Z)(a,2);n=i[0],r=i[1],PN(n.shape,r.shape);var o={a:n,b:r};return jE.runKernel(lC,o,{})}});$E({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:TD.SUM_BY_NONZERO_WEIGHTS,a=YE(e,"labels","meanSquaredError"),i=YE(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=YE(n,"weights","meanSquaredError")),Ux(a.shape,i.shape,"Error in meanSquaredError: ");var s=RD(a,i);return AD(s,o,r)}});function _D(e,t){var n=YE(e,"labels","sigmoidCrossEntropyWithLogits"),r=YE(t,"logits","sigmoidCrossEntropyWithLogits");Ux(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=HR(r),i=dR(r,n),o=hR(eR(DR(sA(r))));return uA(pR(a,i),o)}$E({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:TD.SUM_BY_NONZERO_WEIGHTS,i=YE(e,"multiClassLabels","sigmoidCrossEntropy"),o=YE(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=YE(n,"weights","sigmoidCrossEntropy")),Ux(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=iA(r),c=iA(1),l=iA(.5);i=uA(dR(i,pR(c,u)),dR(l,u))}var h=_D(i,o);return AD(h,s,a)}});var DD=$E({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=YE(e,"x","logSumExp"),a=Yx(t,r.shape),i=fR(r,a,!0),o=pR(r,i),s=eR(o),u=vR(s,a),c=lR(u),l=uA(TA(i,c.shape),c);if(n){var h=CR(l.shape,a);return TA(l,h)}return l}});function FD(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));var r=aA((function(e,t,r){var a=DD(t,[n],!0),i=pR(cN(t,"float32"),a);r([e,i]);var o=DR(dR(i,e));return{value:vR(o,[n]),gradFunc:function(e,t){var r=(0,l.Z)(t,2),a=r[0],i=r[1],o=CR(e.shape,[n]);return[dR(TA(e,o),pR(cN(a,"float32"),eR(i))),dR(TA(e,o),pR(eR(i),cN(a,"float32")))]}}}));return r(e,t)}$E({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:TD.SUM_BY_NONZERO_WEIGHTS,i=YE(e,"onehotLabels","softmaxCrossEntropy"),o=YE(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=YE(n,"weights","softmaxCrossEntropy")),Ux(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=iA(r),c=iA(1),l=iA(i.shape[1]);i=uA(dR(i,pR(c,u)),YA(u,l))}var h=FD(i,o);return AD(h,s,a)}});$E({sparseFillEmptyRows_:function(e,t,n,r){var a=YE(e,"indices","sparseFillEmptyRows","int32"),i=YE(t,"values","sparseFillEmptyRows"),o=YE(n,"denseShape","sparseFillEmptyRows","int32"),s=YE(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=jE.runKernel(iC,u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});$E({sparseReshape_:function(e,t,n){var r=YE(e,"inputIndices","sparseReshape","int32"),a=YE(t,"inputShape","sparseReshape","int32"),i=YE(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=jE.runKernel(oC,o);return{outputIndices:s[0],outputShape:s[1]}}});$E({sparseSegmentMean_:function(e,t,n){var r=YE(e,"data","sparseSegmentMean"),a=YE(t,"indices","sparseSegmentMean","int32"),i=YE(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return jE.runKernel(sC,o)}});$E({sparseSegmentSum_:function(e,t,n){var r=YE(e,"data","sparseSegmentSum"),a=YE(t,"indices","sparseSegmentSum","int32"),i=YE(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return jE.runKernel(uC,o)}});$E({stringNGrams_:function(e,t,n,r,a,i,o,s){var u=YE(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=YE(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");var l={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},h={data:u,dataSplits:c},f=jE.runKernel(dC,h,l);return{nGrams:f[0],nGramsSplits:f[1]}}});$E({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=YE(e,"input","stringSplit","string"),a=YE(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=jE.runKernel(pC,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});$E({stringToHashBucketFast_:function(e,t){var n=YE(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return jE.runKernel(vC,a,r)}});var OD={flipLeftRight:B_,grayscaleToRGB:U_,resizeNearestNeighbor:dD,resizeBilinear:fD,rotateWithOffset:W_,cropAndResize:z_,nonMaxSuppression:Z_,nonMaxSuppressionAsync:tD,nonMaxSuppressionWithScore:nD,nonMaxSuppressionWithScoreAsync:aD,nonMaxSuppressionPadded:iD,nonMaxSuppressionPaddedAsync:sD,threshold:bD,transform:kD},LD={bandPart:VD,gramSchmidt:CD,qr:ND},MD=function(e){b(n,e);var t=w(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return f(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=jE.backend.epsilon()),a}return p(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=jE.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:eA((function(){return p_(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:eA((function(){return p_(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;eA((function(){var e=uA(dR(o,t.rho),dR(RR(i),1-t.rho)),n=dR(YA(i_(uA(s,t.epsilon)),i_(uA(o,t.epsilon))),i),r=uA(dR(s,t.rho),dR(RR(n),1-t.rho));o.assign(e),s.assign(r);var u=uA(dR(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(tA(this.accumulatedGrads.map((function(e){return e.variable}))),tA(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,H.Z)(this.accumulatedGrads),(0,H.Z)(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(oA);MD.className="Adadelta",YN(MD);var PD=function(e){b(n,e);var t=w(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return f(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return p(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=jE.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:eA((function(){return aR(a.shape,t.initialAccumulatorValue).variable(false)}))}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;eA((function(){var e=uA(o,RR(i));o.assign(e);var n=uA(dR(YA(i,i_(uA(e,jE.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&tA(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(oA);PD.className="Adagrad",YN(PD);var zD=function(e){b(n,e);var t=w(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return f(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],eA((function(){i.accBeta1=iA(r).variable(),i.accBeta2=iA(a).variable()})),null==o&&(i.epsilon=jE.backend.epsilon()),i}return p(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);eA((function(){var r=pR(1,t.accBeta1),a=pR(1,t.accBeta2);n.forEach((function(n,i){var o=jE.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:eA((function(){return p_(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:eA((function(){return p_(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=uA(dR(u,t.beta1),dR(s,1-t.beta1)),h=uA(dR(c,t.beta2),dR(RR(s),1-t.beta2)),f=YA(l,r),d=YA(h,a);u.assign(l),c.assign(h);var p=uA(dR(YA(f,uA(i_(d),t.epsilon)),-t.learningRate),o);o.assign(p)}})),t.accBeta1.assign(dR(t.accBeta1,t.beta1)),t.accBeta2.assign(dR(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&tA(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&tA(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,H.Z)(this.accumulatedFirstMoment),(0,H.Z)(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(s().mark((function e(t){var n,r=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,eA((function(){r.accBeta1.assign(wD(r.beta1,r.iterations_+1)),r.accBeta2.assign(wD(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(oA);zD.className="Adam",YN(zD);var BD=function(e){b(n,e);var t=w(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return f(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],eA((function(){i.iteration=iA(0).variable(),i.accBeta1=iA(r).variable()})),null==o&&(i.epsilon=jE.backend.epsilon()),i}return p(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);eA((function(){var r=pR(1,t.accBeta1),a=YA(-t.learningRate,uA(dR(t.iteration,t.decay),1));n.forEach((function(n,i){var o=jE.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:p_(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:p_(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=uA(dR(u,t.beta1),dR(s,1-t.beta1)),h=dR(c,t.beta2),f=sA(s),d=VR(h,f);u.assign(l),c.assign(d);var p=uA(dR(YA(a,r),YA(l,uA(d,t.epsilon))),o);o.assign(p)}})),t.iteration.assign(uA(t.iteration,1)),t.accBeta1.assign(dR(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&tA(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&tA(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(oA);BD.className="Adamax",YN(BD);var UD=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return p(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);n.forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=jE.registeredVariables[n];eA((function(){var e=uA(dR(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=nA(iA(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(oA);UD.className="SGD",YN(UD);var WD=function(e){b(n,e);var t=w(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return f(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=iA(a.momentum),a}return p(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=jE.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:eA((function(){return p_(a).variable(false)}))}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&eA((function(){var e,n=uA(dR(t.m,i),o);e=t.useNesterov?uA(dR(t.c,uA(o,dR(n,t.m))),a):uA(dR(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&tA(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(UD);WD.className="Momentum",YN(WD);var jD=function(e){b(n,e);var t=w(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(f(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=jE.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return r}return p(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=jE.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:eA((function(){return p_(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:eA((function(){return p_(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:eA((function(){return p_(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;eA((function(){var e=uA(dR(s,t.decay),dR(RR(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=uA(dR(n,t.decay),dR(o,1-t.decay)),c=YA(dR(o,t.learningRate),i_(pR(e,uA(RR(i),t.epsilon)))),l=uA(dR(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var h=pR(a,l);a.assign(h)}else{var f=uA(dR(s,t.decay),dR(RR(o),1-t.decay)),d=uA(dR(u,t.momentum),YA(dR(o,t.learningRate),i_(uA(f,t.epsilon))));s.assign(f),u.assign(d);var p=pR(a,d);a.assign(p)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&tA(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&tA(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&tA(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat((0,H.Z)(this.accumulatedMeanSquares),(0,H.Z)(this.accumulatedMoments)),this.centered&&t.push.apply(t,(0,H.Z)(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(oA);jD.className="RMSProp",YN(jD);var ZD,GD=function(){function e(){f(this,e)}return p(e,null,[{key:"sgd",value:function(e){return new UD(e)}},{key:"momentum",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new WD(e,t,n)}},{key:"rmsprop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new jD(e,t,n,r,a)}},{key:"adam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new zD(e,t,n,r)}},{key:"adadelta",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new MD(e,t,n)}},{key:"adamax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new BD(e,t,n,r,a)}},{key:"adagrad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return new PD(e,t)}}]),e}(),HD={sgd:GD.sgd,momentum:GD.momentum,adadelta:GD.adadelta,adagrad:GD.adagrad,rmsprop:GD.rmsprop,adamax:GD.adamax,adam:GD.adam},qD="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:function(e){return e()};function KD(){return new Promise((function(e){return qD((function(){return e()}))}))}function XD(e,t){var n=e[0].length;e.forEach((function(e,t){Bx(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")}))})),Bx(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)Bx(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")}))}))}function QD(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}!function(e){e[e.FIRST_DIM_SIZE=0]="FIRST_DIM_SIZE",e[e.VALUE_ROWIDS=1]="VALUE_ROWIDS",e[e.ROW_LENGTHS=2]="ROW_LENGTHS",e[e.ROW_SPLITS=3]="ROW_SPLITS",e[e.ROW_LIMITS=4]="ROW_LIMITS",e[e.ROW_STARTS=5]="ROW_STARTS"}(ZD||(ZD={}));function YD(e){return e<=30?e:uw(e,Math.floor(Math.sqrt(e)))}function JD(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}function $D(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function eF(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2===1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function tF(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function nF(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}function rF(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}function aF(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===Zx(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,h=i;h<n;++h)l*=u[h],c.push(u[h]);var f=[].concat((0,H.Z)(cw(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,f]}function iF(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:Zx(t.shape)/u,sliceSize:o,strides:[].concat((0,H.Z)(cw(n.slice(0,a))),[1]),outputSize:Zx(n)}}var oF=1.7580993408473768,sF=1.0507009873554805,uF=.3275911,cF=.254829592,lF=-.284496736,hF=1.421413741,fF=-1.453152027,dF=1.061405429;function pF(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function vF(e,t){return{real:e[2*t],imag:e[2*t+1]}}function mF(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function gF(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}var yF="->",bF=/->/g;function kF(e,t){var n=((e=e.replace(/\s/g,"")).length-e.replace(bF,"").length)/yF.length;if(n<1)throw new Error("Equations without an arrow are not supported.");if(n>1)throw new Error('Equation must contain exactly one arrow ("'.concat(yF,'").'));var r=e.split(yF),a=(0,l.Z)(r,2),i=a[0],o=a[1];Bx(-1===i.indexOf("..."),(function(){return'The ellipsis notation ("'.concat("...",'") is not supported yet.')}));var s=i.split(","),u=s.length;if(t!==u)throw new Error("Expected ".concat(u," input tensors, received ").concat(t));if(u>2)throw new Error("Support for more than 2 input tensors is not implemented yet.");for(var c=[],h=function(e){var t=o[e];if(!s.some((function(e){return-1!==e.indexOf(t)})))throw new Error("Output subscripts contain the label ".concat(t," ")+"not present in the input subscripts.");-1===c.indexOf(t)&&c.push(t)},f=0;f<o.length;++f)h(f);for(var d=0;d<i.length;++d){var p=i[d];-1===c.indexOf(p)&&","!==p&&c.push(p)}for(var v=new Array(s.length),m=0;m<u;++m){if(new Set(s[m].split("")).size!==s[m].length)throw new Error("Found duplicate axes in input component ".concat(s[m],". ")+"Support for duplicate axes in input is not implemented yet.");v[m]=[];for(var g=0;g<s[m].length;++g)v[m].push(c.indexOf(s[m][g]))}for(var y=c.length,b=[],k=o.length;k<y;++k)b.push(k);return{allDims:c,summedDims:b,idDims:v}}function VF(e,t){var n=new Array(e);n.fill(-1);for(var r=0;r<t.length;++r)n[t[r]]=r;for(var a=[],i=0;i<e;++i)-1===n[i]&&a.push(i);return{permutationIndices:n=n.filter((function(e){return-1!==e})),expandDims:a}}function xF(e,t,n){for(var r=new Array(e),a=function(e){for(var a=n[e].shape,i=function(n){void 0===r[t[e][n]]?r[t[e][n]]=a[n]:Bx(r[t[e][n]]===a[n],(function(){return"Expected dimension ".concat(r[t[e][n]]," at axis ").concat(n," ")+"of input shaped ".concat(JSON.stringify(a),", ")+"but got dimension ".concat(a[n])}))},o=0;o<t[e].length;++o)i(o)},i=0;i<n.length;++i)a(i)}function wF(e,t){var n,r=e,a=[];0===e.length&&r.push(-1),n=e.length+1;for(var i=0;i<n;++i)a.push([]);for(var o=[],s=0;s<r.length;++s){var u,c=m(SF(t,r[s]));try{for(c.s();!(u=c.n()).done;){var l=u.value;-1===o.indexOf(l)&&(a[s].push(l),o.push(l))}}catch(h6){c.e(h6)}finally{c.f()}}return{path:r,steps:a}}function IF(e){return e.every((function(e,t){return e===t}))}function SF(e,t){for(var n=[],r=0;r<e.length;++r)0!==e[r].length&&-1===e[r].indexOf(t)&&-1!==t||n.push(r);return n}function CF(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)Bx(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);Bx(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}Bx(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}function EF(e,t,n){return"indices(".concat(e,", 0) is invalid: ").concat(t," >= ").concat(n)}function TF(e,t){return"Segment id ".concat(e," out of range [0, ").concat(t,"), possibly because segmentIds input is not sorted.")}function NF(e,t,n){return"Bad: indices[".concat(e,"] == ").concat(t," out of range [0, ").concat(n,")")}function AF(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,h=1,f=0;f<r;++f)u.push(e.shape[f]),c*=e.shape[f];for(var d=r;d<n;d++)u.push(e.shape[d]),l*=e.shape[d];for(var p=r;p<a;p++)u.push(t.shape[p]);for(var v=n+1;v<i;v++)u.push(e.shape[v]),h*=e.shape[v];return{batchSize:c,sliceSize:h,outerSize:l,dimSize:s,outputShape:u}}function RF(e){try{return e.map((function(e){return cE(e)}))}catch(h6){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat(h6))}}function _F(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=uN(e,"int32"),i=uN([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()}var DF={kernelName:Tw,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(e,S_(cN(n,"float32"),-1))}}}},FF={kernelName:Nw,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){var t=RR(cN(n,"float32")),r=i_(pR(iA(1),t));return DR(YA(e,r))}}}},OF={kernelName:Aw,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){var t=i_(pR(RR(cN(n,"float32")),1));return YA(e,t)}}}},LF={kernelName:Rw,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1],i=PN(r.shape,a.shape);return{a:function(){var t=e,n=MN(r.shape,i);return n.length>0&&(t=vR(t,n)),TA(t,r.shape)},b:function(){var t=e,n=MN(a.shape,i);return n.length>0&&(t=vR(t,n)),TA(t,a.shape)}}}},MF={kernelName:_w,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},PF={kernelName:Ow,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return p_(n)}}}},zF={kernelName:Lw,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return p_(n)}}}},BF={kernelName:Mw,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return YA(e,i_(pR(iA(1),RR(cN(n,"float32")))))}}}},UF={kernelName:Pw,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){var t=i_(uA(iA(1),RR(cN(n,"float32"))));return YA(e,t)}}}},WF={kernelName:Uw,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1],i=PN(r.shape,a.shape);return{a:function(){var t=uA(RR(r),RR(a)),n=dR(e,YA(a,t)),o=MN(r.shape,i);return o.length>0&&(n=vR(n,o)),TA(n,r.shape)},b:function(){var t=uA(RR(r),RR(a)),n=DR(dR(e,YA(r,t))),o=MN(a.shape,i);return o.length>0&&(n=vR(n,o)),TA(n,a.shape)}}}},jF={kernelName:zw,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return YA(e,uA(RR(cN(n,"float32")),1))}}}},ZF={kernelName:Bw,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return YA(e,pR(iA(1),RR(cN(n,"float32"))))}}}};var GF=$E({avgPool3dGrad_:function(e,t,n,r,a,i){var o=YE(e,"dy","avgPool3dGrad"),s=YE(t,"input","avgPool3dGrad"),u=o,c=s,l=!1;4===s.rank&&(l=!0,u=TA(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]]),c=TA(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),Bx(5===u.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(u.rank,".")})),Bx(5===c.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(c.rank,".")})),EA("avgPool3dGrad",a,i);var h={dy:u,input:c},f={filterSize:n,strides:r,pad:a,dimRoundingMode:i},d=jE.runKernel(Gw,h,f);return l?TA(d,[d.shape[1],d.shape[2],d.shape[3],d.shape[4]]):d}}),HF={kernelName:Zw,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad,s=n.dimRoundingMode;return{x:function(){return GF(e,r,a,i,o,s)}}}};var qF=$E({avgPoolGrad_:function(e,t,n,r,a){var i=YE(e,"dy","avgPoolGrad"),o=YE(t,"input","avgPoolGrad");Bx(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=TA(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=TA(i,[1,i.shape[0],i.shape[1],i.shape[2]])),Bx(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")})),Bx(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")}));var l={dy:u,input:s},h={filterSize:n,strides:r,pad:a},f=jE.runKernel(jw,l,h);return c?TA(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),KF={kernelName:Ww,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return qF(e,r,a,i,o)}}}},XF={kernelName:Hw,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return yR(e,i,!1,!1)},b:function(){return yR(e,a,!0,!1)}}:o&&!s?{a:function(){return yR(i,e,!1,!0)},b:function(){return yR(a,e,!1,!1)}}:{a:function(){return yR(i,e,!0,!0)},b:function(){return yR(e,a,!0,!0)}}:{a:function(){return yR(e,i,!1,!0)},b:function(){return yR(a,e,!0,!1)}}}};var QF=$E({spaceToBatchND_:function(e,t,n){var r=YE(e,"x","spaceToBatchND");Bx(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),Bx(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),Bx(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return jE.runKernel(nC,a,i)}}),YF={kernelName:qw,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return QF(e,r,a)}}}},JF={kernelName:"BroadcastTo",gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return vR(e,u,!0)}}}},$F={kernelName:Qw,gradFunc:function(e){return{x:function(){return e.clone()}}}},eO={kernelName:Yw,gradFunc:function(e){return{x:function(){return p_(e)}}}},tO={kernelName:Jw,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return d_(gR(uR(r,a),vD(r,i)),e,p_(e))}}}},nO={kernelName:eI,inputsToSave:["x"],gradFunc:DF.gradFunc},rO={kernelName:tI,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=Yx(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return a_(e,i,a).map((function(e){return function(){return e}}))}},aO={kernelName:nI,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return Bx(IA(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return ZA(a.shape,e,i,s,u,c)},filter:function(){return w_(a,e,i.shape,s,u,c)}}}},iO={kernelName:aI,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return WA(e,i,o,s,u,1,c)},filter:function(){return w_(e,a,i.shape,o,s,u,c)}}}};var oO=$E({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=TA(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=TA(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),Bx(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")})),Bx(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")})),Bx(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")})),Bx(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")})),Bx(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return jE.runKernel(oI,s,u)}}),sO={kernelName:iI,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;Bx(IA(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=(0,l.Z)(t,2),s=o[0],u=o[1];return{x:function(){return qA(s.shape,e,u,a,i)},filter:function(){return oO(s,e,u.shape,a,i)}}}};var uO=$E({sin_:function(e){var t={x:YE(e,"x","sin","float32")};return jE.runKernel(XS,t)}}),cO={kernelName:uI,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(DR(uO(cN(n,"float32"))),e)}}}};var lO=$E({sinh_:function(e){var t={x:YE(e,"x","sinh")};return jE.runKernel(QS,t)}}),hO={kernelName:cI,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(lO(cN(n,"float32")),e)}}}};var fO=$E({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=YE(e,"x","cumsum"),i={x:a},o={axis:t,exclusive:n,reverse:r};return jE.runKernel(hI,i,o)}}),dO={kernelName:hI,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=TR([a],r.rank),n=fO(e,a,i,!o);return null!=t&&(n=g_(n,t)),n}}}},pO={kernelName:vI,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;Bx(IA(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")}));var u=(0,l.Z)(t,2),c=u[0],h=u[1];return Bx(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")})),Bx(4===h.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(h.rank,".")})),Bx(c.shape[3]===h.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(h.shape[2],".")})),Bx(SA(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")})),EA("depthwiseConv2d",i,o),{x:function(){return __(c.shape,e,h,a,i,s,o)},filter:function(){return R_(c,e,h.shape,a,i,s,o)}}}},vO={kernelName:bI,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return jE.runKernel(kI,o,n)},filter:function(){return jE.runKernel(VI,s,n)}}}},mO={kernelName:II,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:(0,l.Z)(t,1)[0]};return{x:function(){return jE.runKernel(SI,n)}}}},gO={kernelName:CI,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0],r=dR(eR(DR(RR(n))),2/Math.sqrt(Math.PI));return{x:function(){return dR(e,r)}}}},yO={kernelName:TI,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(e,n)}}}},bO={kernelName:NI,inputsToSave:["input"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{input:function(){return TA(e,n.shape)}}}},kO={kernelName:AI,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(e,eR(n))}}}},VO={kernelName:FI,gradFunc:function(e){return{x:function(){return p_(e)}}}},xO={kernelName:OI,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1],i=PN(r.shape,a.shape);return{a:function(){var t=YA(e,cN(a,"float32")),n=MN(r.shape,i);return n.length>0?TA(vR(t,n),r.shape):t},b:function(){var t=dR(e,cN(r,"float32")),n=MN(a.shape,i);n.length>0&&(t=TA(vR(t,n),a.shape));var o=RR(a);return DR(YA(t,cN(o,"float32")))}}}};var wO=$E({rsqrt_:function(e){var t={x:YE(e,"x","rsqrt","float32")};return jE.runKernel(jS,t)}}),IO={kernelName:LI,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=(0,l.Z)(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?iA(1):u,h=MN(o.shape,i.shape),f=[];if(1===o.rank){for(var d=0;d<i.shape.length-1;++d)f.push(i.shape[d]);f.push(1)}var p=pR(i,o),v=dR(e,c),m=wO(uA(s,iA(r))),g=dR(dR(dR(m,m),m),iA(-.5));return{x:function(){return 1===o.rank?TA(dR(dR(e,nR(TA(m,[1,1,1,o.shape[0]]),f)),c),i.shape):TA(dR(dR(e,m),c),i.shape)},mean:function(){var e=dR(dR(m,iA(-1)),v);return 1===o.rank&&(e=vR(e,h)),TA(e,o.shape)},variance:function(){var e=dR(dR(g,p),v);return 1===o.rank&&(e=vR(e,h)),TA(e,o.shape)},scale:function(){var t=dR(p,m),n=dR(e,t);return 1===o.rank&&(n=vR(n,h)),TA(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=vR(t,h)),TA(t,o.shape)}}}};var SO=$E({unsortedSegmentSum_:function(e,t,n){var r=YE(e,"x","unsortedSegmentSum"),a=YE(t,"segmentIds","unsortedSegmentSum","int32");Bx(Hx(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return jE.runKernel(SC,i,o)}}),CO={kernelName:MI,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,2),a=r[0],i=r[1],o=n.axis,s=Yx(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,h=EO(0,u),f=EO(u+1,u+1+l),d=TO([r,[n],c]),p=TA(e,d),v=TA(i,[n]),m=TO([[u],h,f]),g=g_(p,m),y=SO(g,v,a.shape[s]),b=NR(m);return y=g_(y,b)},indices:function(){return i}}}};function EO(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function TO(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var NO={kernelName:BI,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1];return{a:function(){return p_(r)},b:function(){return p_(a)}}}},AO={kernelName:UI,gradFunc:function(e){return{x:function(){return cN(e,"float32")}}}},RO={kernelName:ZI,gradFunc:function(e){return{x:function(){return p_(e)}}}},_O={kernelName:GI,gradFunc:function(e){return{x:function(){return p_(e)}}}},DO={kernelName:HI,gradFunc:function(e){return{x:function(){return p_(e)}}}},FO={kernelName:qI,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,1)[0],a=n.alpha,i=sR(r,0);return{x:function(){return d_(i,e,dR(e,a))}}}},OO={kernelName:JI,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return YA(e,uA(n,1))}}}},LO={kernelName:YI,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return YA(e,cN(n,"float32"))}}}},MO={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,l.Z)(t,1)[0],a=n.axis;return{logits:function(){var t=eR(r);return pR(e,dR(vR(e,a,!0),t))}}}};var PO=$E({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5,s={x:e,y:t,dy:n},u={depthRadius:r,bias:a,alpha:i,beta:o};return jE.runKernel(rS,s,u)}}),zO={kernelName:nS,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,l.Z)(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return PO(a,i,e,o,s,u,c)}}}};function BO(e,t,n,r){return t.rank<n.rank&&(t=TA(t,CR(t.shape,r))),e.rank<n.rank&&(e=TA(e,CR(e.shape,r))),{x:function(){return dR(e,cN($A(n,t),e.dtype))}}}var UO={kernelName:aS,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=BO(e,t[1],a,Yx(r,a.shape));return{x:function(){return i.x()}}}};var WO=$E({less_:function(e,t){var n=YE(e,"a","less","string_or_numeric"),r=YE(t,"b","less","string_or_numeric"),a=DE(n,r),i=(0,l.Z)(a,2);n=i[0],r=i[1],PN(n.shape,r.shape);var o={a:n,b:r};return jE.runKernel(KI,o)}}),jO={kernelName:iS,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1];return{a:function(){return dR(e,cN(uR(r,a),"float32"))},b:function(){return dR(e,cN(WO(r,a),"float32"))}}}};var ZO=$E({maxPool3dGrad_:function(e,t,n,r,a,i,o){var s=YE(e,"dy","maxPool3dGrad"),u=YE(t,"input","maxPool3dGrad"),c=YE(n,"output","maxPool3dGrad"),l=s,h=u,f=c,d=!1;4===u.rank&&(d=!0,l=TA(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),h=TA(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),f=TA(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]])),Bx(5===l.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(l.rank,".")})),Bx(5===h.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(h.rank,".")})),Bx(5===f.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(f.rank,".")})),EA("maxPool3dGrad",i,o);var p={dy:l,input:h,output:f},v={filterSize:r,strides:a,pad:i,dimRoundingMode:o},m=jE.runKernel(cS,p,v);return d?TA(m,[m.shape[1],m.shape[2],m.shape[3],m.shape[4]]):m}}),GO={kernelName:uS,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,l.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad,c=n.dimRoundingMode;return{x:function(){return ZO(e,a,i,o,s,u,c)}}}};var HO=$E({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=YE(e,"dy","maxPoolGrad"),u=YE(t,"input","maxPoolGrad"),c=YE(n,"output","maxPoolGrad");Bx(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")})),Bx(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")})),Bx(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")})),EA("maxPoolGrad",i,o);var l={dy:s,input:u,output:c},h={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return jE.runKernel(sS,l,h)}}),qO={kernelName:oS,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,l.Z)(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return HO(e,a,i,o,s,u)}}}},KO={kernelName:hS,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,1)[0],a=Yx(n.axis,r.shape),i=Zx(SR(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=TA(e,t);return YA(dR(n,MR(r.shape,"float32")),i)}}}},XO={kernelName:fS,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=(0,l.Z)(t,2),i=a[0],o=BO(e,a[1],i,Yx(r,i.shape));return{x:function(){return o.x()}}}},QO={kernelName:dS,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1];return{a:function(){return dR(e,cN(vD(r,a),"float32"))},b:function(){return dR(e,cN(sR(r,a),"float32"))}}}},YO={kernelName:pS,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return YR(e,a,r.shape)}}}},JO={kernelName:vS,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1],i=PN(r.shape,a.shape);return{a:function(){var t=MN(r.shape,i);return t.length>0?TA(vR(e,t),r.shape):e},b:function(){var t=dR(e,DR(iR(YA(r,a)))),n=MN(a.shape,i);return n.length>0?TA(vR(t,n),a.shape):t}}}},$O={kernelName:gS,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1],i=PN(r.shape,a.shape);return{a:function(){var t=dR(e,cN(a,"float32")),n=MN(r.shape,i);return n.length>0?TA(vR(t,n),r.shape):t},b:function(){var t=dR(e,cN(r,"float32")),n=MN(a.shape,i);return n.length>0?TA(vR(t,n),a.shape):t}}}},eL={kernelName:yS,gradFunc:function(e){return{x:function(){return DR(e)}}}},tL={kernelName:IS,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return LR(n.shape,"float32")}}}},nL={kernelName:wS,gradFunc:function(e){return{x:function(){return p_(e)}}}},rL={kernelName:SS,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return h_(e,r).map((function(e){return function(){return e}}))}},aL={kernelName:CS,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return YR(e,a,r.shape)}}}},iL={kernelName:ES,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=(0,l.Z)(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=PN(o.shape,s.shape);return{a:function(){var t=cN(s,"float32"),n=dR(e,dR(t,wD(o,pR(t,iA(1))))),r=MN(o.shape,u);return r.length>0&&(n=vR(n,r)),TA(n,o.shape)},b:function(){var t=sR(o,0),n=d_(t,lR(o),p_(o)),r=dR(e,dR(i,n)),a=MN(s.shape,u);return a.length>0&&(r=vR(r,a)),TA(r,s.shape)}}}},oL={kernelName:TS,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1],i=sR(r,0);return{x:function(){return d_(i,e,dR(e,a))},alpha:function(){var t=d_(i,p_(e),dR(e,r)),n=MN(a.shape,e.shape);return n.length>0&&(t=vR(t,n)),TA(t,a.shape)}}}};var sL=$E({cumprod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=YE(e,"x","cumprod"),i={x:a},o={axis:t,exclusive:n,reverse:r};return jE.runKernel(lI,i,o)}});function uL(e,t,n){var r=e.shape.length,a=r-n.length,i=TR(n,r),o=e;null!=i&&(o=g_(e,i));var s=o.shape.slice(),u=s.splice(r-n.length,n.length).reduce((function(e,t){return e*t}),1);s.push(u);var c=function(e,t,n){var r=e.shape.slice();r[n]=1;var a=TA(t,r),i=sL(e,n,!0,!1),o=sL(e,n,!0,!0),s=dR(i,o);return dR(a,s)}(o.reshape(s),t,a);if(c=c.reshape(o.shape),null!=i){var l=NR(i);c=g_(c,l)}return c}var cL={kernelName:NS,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,1)[0],a=n.axis,i=[];return i=void 0===a||null===a?r.shape.map((function(e,t){return t})):"number"===typeof a?[a]:a,{x:function(){return uL(r,e,i)}}}},lL={kernelName:xI,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1],i=PN(r.shape,a.shape);return{a:function(){var t=YA(e,cN(a,"float32")),n=MN(r.shape,i);return n.length>0?TA(vR(t,n),r.shape):t},b:function(){var t=dR(e,cN(r,"float32")),n=MN(a.shape,i);n.length>0&&(t=TA(vR(t,n),a.shape));var o=RR(a);return DR(YA(t,cN(o,"float32")))}}}},hL={kernelName:DS,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return YA(e,DR(RR(n)))}}}},fL={kernelName:BS,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0],r=dR(vD(n,6),S_(n));return{x:function(){return dR(e,cN(r,"float32"))}}}},dL={kernelName:FS,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(e,cN(S_(n),"float32"))}}}},pL={kernelName:OS,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return TA(e,n.shape)}}}},vL={kernelName:PS,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,l.Z)(t,1)[0]};return{images:function(){return jE.runKernel(zS,r,n)}}}},mL={kernelName:LS,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:(0,l.Z)(t,1)[0]};return{images:function(){return jE.runKernel(MS,r,n)}}}},gL={kernelName:US,gradFunc:function(e,t,n){var r=Yx(n.dims,e.shape);return{x:function(){return qR(e,r)}}}},yL={kernelName:WS,gradFunc:function(e){return{x:function(){return p_(e)}}}},bL={kernelName:jS,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return DR(YA(e,dR(wD(n,1.5),2)))}}}};var kL=$E({logicalNot_:function(e){var t={x:YE(e,"x","logicalNot","bool")};return jE.runKernel(eS,t)}}),VL={kernelName:HS,inputsToSave:["condition"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{condition:function(){return cN(p_(n),"float32")},t:function(){return dR(e,cN(n,e.dtype))},e:function(){return dR(e,cN(kL(n),e.dtype))}}}},xL={kernelName:qS,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){var t=sR(n,iA(0)),r=iA(oF),a=iA(sF),i=dR(e,a),o=dR(dR(e,r),eR(cN(n,"float32")));return d_(t,i,o)}}}},wL={kernelName:JS,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(e,dR(n,pR(iA(1),n)))}}}},IL={kernelName:YS,gradFunc:function(e){return{x:function(){return p_(e)}}}};var SL=$E({cos_:function(e){var t={x:YE(e,"x","cos","float32")};return jE.runKernel(uI,t)}}),CL={kernelName:XS,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(SL(cN(n,"float32")),e)}}}};var EL=$E({cosh_:function(e){var t={x:YE(e,"x","cosh","float32")};return jE.runKernel(cI,t)}}),TL={kernelName:QS,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(EL(cN(n,"float32")),e)}}}},NL={kernelName:KS,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=(0,l.Z)(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=HN(r,a,i),u=(0,l.Z)(s,2),c=u[0],h=u[1],f=[],d=0;d<e.rank;d++)f.push([c[d],o[d]-c[d]-h[d]]);return{x:function(){return zR(e,f)}}}},AL={kernelName:aC,outputsToSave:[!0],gradFunc:function(e,t,n){var r=(0,l.Z)(t,1)[0],a=n.dim,i=dR(e,r);return{logits:function(){return pR(i,dR(vR(i,[a],true),r))}}}},RL={kernelName:$S,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(e,QR(n))}}}};var _L=$E({batchToSpaceND_:function(e,t,n){var r=YE(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));Bx(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),Bx(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),Bx(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return jE.runKernel(qw,i,o)}}),DL={kernelName:nC,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return _L(e,r,a)}}}},FL={kernelName:rC,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return MA(e,r)}}}},OL={kernelName:lC,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1],i=iA(2);return{a:function(){return dR(e,dR(i,pR(r,a)))},b:function(){return dR(e,dR(i,pR(a,r)))}}}},LL={kernelName:mC,inputsToSave:["a","b"],gradFunc:function(e,t){var n=(0,l.Z)(t,2),r=n[0],a=n[1],i=PN(r.shape,a.shape);return{a:function(){var t=e,n=MN(r.shape,i);return n.length>0&&(t=vR(t,n)),TA(t,r.shape)},b:function(){var t=e,n=MN(a.shape,i);return n.length>0&&(t=vR(t,n)),TA(DR(t),a.shape)}}}},ML={kernelName:tC,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,1)[0],a=r.shape.slice();Yx(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=TA(e,a),o=dR(i,MR(r.shape,"float32"));return{x:function(){return o}}}},PL={kernelName:yC,outputsToSave:[!0],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(pR(iA(1),RR(n)),e)}}}},zL={kernelName:bC,inputsToSave:["x"],gradFunc:function(e,t,n){var r=(0,l.Z)(t,1)[0],a=n.reps;return{x:function(){var t=p_(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=uA(t,YR(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=uA(t,YR(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=uA(t,YR(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var h=0;h<a[1];++h)for(var f=0;f<a[2];++f)for(var d=0;d<a[3];++d)t=uA(t,YR(e,[l*r.shape[0],h*r.shape[1],f*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},BL={kernelName:SC,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return function(e,t){for(var n=VR(t,p_(t)),r=oR(e,n),a=uR(t,iA(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=tR(a,o+1);a=gR(a,MR(r.shape,"bool"));var s=p_(r);return d_(a,r,s)}(e,n)}}}};for(var UL=0,WL=[DF,FF,OF,LF,MF,PF,zF,BF,UF,WF,jF,ZF,HF,KF,XF,YF,JF,$F,eO,tO,nO,rO,iO,aO,sO,cO,hO,dO,pO,vO,lL,mO,gO,yO,bO,kO,xO,VO,IO,CO,NO,AO,RO,_O,DO,FO,OO,LO,MO,zO,UO,UO,jO,GO,qO,KO,XO,QO,YO,JO,$O,eL,tL,nL,rL,aL,aL,iL,oL,cL,hL,fL,dL,pL,vL,mL,gL,yL,bL,VL,xL,wL,IL,CL,TL,NL,AL,RL,DL,DL,FL,FL,{kernelName:eC,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return YA(e,dR(i_(cN(n,"float32")),2))}}}},OL,{kernelName:hC,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return dR(e,dR(cN(n,"float32"),2))}}}},{kernelName:EC,gradFunc:function(e){return{x:function(){return p_(e)}}}},LL,ML,{kernelName:gC,inputsToSave:["x"],gradFunc:function(e,t){var n=(0,l.Z)(t,1)[0];return{x:function(){return YA(e,RR(SL(n)))}}}},PL,zL,{kernelName:xC,gradFunc:function(e,t,n){var r=NR(n.perm);return{x:function(){return g_(e,r)}}}},{kernelName:IC,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return s_(e,r)}}}},BL,{kernelName:CC,gradFunc:function(e){return{x:function(){return p_(e)}}}}];UL<WL.length;UL++){BC(WL[UL])}wE().prototype.abs=function(){return this.throwIfDisposed(),sA(this)};var jL=$E({acos_:function(e){var t={x:YE(e,"x","acos")};return jE.runKernel(Nw,t)}});wE().prototype.acos=function(){return this.throwIfDisposed(),jL(this)};var ZL=$E({acosh_:function(e){var t={x:YE(e,"x","acosh")};return jE.runKernel(Aw,t)}});wE().prototype.acosh=function(){return this.throwIfDisposed(),ZL(this)},wE().prototype.add=function(e){return this.throwIfDisposed(),uA(this,e)},wE().prototype.all=function(e,t){return this.throwIfDisposed(),cA(this,e,t)},wE().prototype.any=function(e,t){return this.throwIfDisposed(),lA(this,e,t)},wE().prototype.argMax=function(e){return this.throwIfDisposed(),hA(this,e)};var GL=$E({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=YE(e,"x","argMin"),r={x:n},a={axis:t};return jE.runKernel(Lw,r,a)}});wE().prototype.argMin=function(e){return this.throwIfDisposed(),GL(this,e)},wE().prototype.asScalar=function(){return this.throwIfDisposed(),Bx(1===this.size,(function(){return"The array must have only 1 element."})),TA(this,[])},wE().prototype.asType=function(e){return this.throwIfDisposed(),cN(this,e)},wE().prototype.as1D=function(){return this.throwIfDisposed(),TA(this,[this.size])},wE().prototype.as2D=function(e,t){return this.throwIfDisposed(),TA(this,[e,t])},wE().prototype.as3D=function(e,t,n){return this.throwIfDisposed(),TA(this,[e,t,n])},wE().prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),TA(this,[e,t,n,r])},wE().prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),TA(this,[e,t,n,r,a])};var HL=$E({asin_:function(e){var t={x:YE(e,"x","asin")};return jE.runKernel(Mw,t)}});wE().prototype.asin=function(){return this.throwIfDisposed(),HL(this)};var qL=$E({asinh_:function(e){var t={x:YE(e,"x","asinh")};return jE.runKernel(Pw,t)}});wE().prototype.asinh=function(){return this.throwIfDisposed(),qL(this)};var KL=$E({atan_:function(e){var t={x:YE(e,"x","atan")};return jE.runKernel(zw,t)}});wE().prototype.atan=function(){return this.throwIfDisposed(),KL(this)};var XL=$E({atan2_:function(e,t){var n=YE(e,"a","atan2"),r=YE(t,"b","atan2"),a=DE(n,r),i=(0,l.Z)(a,2),o={a:n=i[0],b:r=i[1]};return jE.runKernel(Uw,o)}});wE().prototype.atan2=function(e){return this.throwIfDisposed(),XL(this,e)};var QL=$E({atanh_:function(e){var t={x:YE(e,"x","atanh")};return jE.runKernel(Bw,t)}});wE().prototype.atanh=function(){return this.throwIfDisposed(),QL(this)},wE().prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),NA(this,e,t,n,r)},wE().prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),_L(this,e,t)},wE().prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),RA(this,e,t,n,r,a)},wE().prototype.broadcastTo=function(e){return this.throwIfDisposed(),OA(this,e)},wE().prototype.cast=function(e){return this.throwIfDisposed(),cN(this,e)};var YL=$E({ceil_:function(e){var t={x:YE(e,"x","ceil","float32")};return jE.runKernel(Yw,t)}});wE().prototype.ceil=function(){return this.throwIfDisposed(),YL(this)},wE().prototype.clipByValue=function(e,t){return this.throwIfDisposed(),LA(this,e,t)},wE().prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof xE&&(e=[e]),MA([this].concat((0,H.Z)(e)),t)},wE().prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),jA(this,e,t,n,r,a,i)},wE().prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),GA(this,e,t,n,r,a)},wE().prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),WA(this,e,t,n,r,a,i)},wE().prototype.cos=function(){return this.throwIfDisposed(),SL(this)},wE().prototype.cosh=function(){return this.throwIfDisposed(),EL(this)},wE().prototype.cumprod=function(e,t,n){return this.throwIfDisposed(),sL(this,e,t,n)},wE().prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),fO(this,e,t,n)};var JL=$E({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=YE(e,"x","depthToSpace","float32"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];Bx(t>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(t)})),Bx(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),Bx(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),Bx(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return jE.runKernel(pI,s,u)}});wE().prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),JL(this,e,t)},wE().prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),XA(this,e,t,n,r,a,i)};var $L=$E({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=YE(e,"x","dilation2d"),s=YE(t,"filter","dilation2d");Bx(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")})),Bx(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")})),Bx("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=TA(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);var l={x:u,filter:s},h={strides:n,pad:r,dilations:a},f=jE.runKernel(bI,l,h);return c?TA(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});wE().prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),$L(this,e,t,n,r,a)};var eM=$E({divNoNan_:function(e,t){var n=YE(e,"a","div"),r=YE(t,"b","div"),a=DE(n,r),i=(0,l.Z)(a,2);n=i[0],r=i[1];var o=YA(n,r),s=p_(o),u=$A(r,s);return d_(u,s,o)}});wE().prototype.divNoNan=function(e){return this.throwIfDisposed(),eM(this,e)},wE().prototype.div=function(e){return this.throwIfDisposed(),YA(this,e)};var tM=$E({dot_:function(e,t){var n=YE(e,"t1","dot"),r=YE(t,"t2","dot");Bx((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(Bx(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=TA(n,[1,-1]),s=TA(r,[-1,1]),u=yR(o,s);return TA(u,[])}if(1===n.rank&&2===r.rank){var c=TA(n,[1,-1]),l=TA(r,[r.shape[0],r.shape[1]]),h=yR(c,l);return TA(h,[h.size])}if(2===n.rank&&1===r.rank){var f=TA(r,[-1,1]),d=yR(n,f);return TA(d,[d.size])}var p=TA(r,[r.shape[0],r.shape[1]]);return yR(n,p)}});wE().prototype.dot=function(e){return this.throwIfDisposed(),tM(this,e)},wE().prototype.elu=function(){return this.throwIfDisposed(),JA(this)},wE().prototype.equal=function(e){return this.throwIfDisposed(),$A(this,e)};var nM=$E({erf_:function(e){var t=YE(e,"x","erf");Bx("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=cN(t,"float32"));var n={x:t};return jE.runKernel(CI,n)}});wE().prototype.erf=function(){return this.throwIfDisposed(),nM(this)};var rM=$E({euclideanNorm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return SD(e,"euclidean",t,n)}});wE().prototype.euclideanNorm=function(e,t){return this.throwIfDisposed(),rM(this,e,t)},wE().prototype.exp=function(){return this.throwIfDisposed(),eR(this)},wE().prototype.expandDims=function(e){return this.throwIfDisposed(),tR(this,e)};var aM=$E({expm1_:function(e){var t={x:YE(e,"x","expm1")};return jE.runKernel(AI,t)}});wE().prototype.expm1=function(){return this.throwIfDisposed(),aM(this)},wE().prototype.fft=function(){return this.throwIfDisposed(),b_(this)},wE().prototype.flatten=function(){return this.throwIfDisposed(),TA(this,[this.size])},wE().prototype.floor=function(){return this.throwIfDisposed(),iR(this)},wE().prototype.floorDiv=function(e){return this.throwIfDisposed(),QA(this,e)},wE().prototype.gather=function(e,t){return this.throwIfDisposed(),oR(this,e,t)},wE().prototype.greaterEqual=function(e){return this.throwIfDisposed(),uR(this,e)},wE().prototype.greater=function(e){return this.throwIfDisposed(),sR(this,e)},wE().prototype.ifft=function(){return this.throwIfDisposed(),V_(this)},wE().prototype.irfft=function(){return this.throwIfDisposed(),x_(this)};var iM=$E({isFinite_:function(e){var t={x:YE(e,"x","isFinite")};return jE.runKernel(ZI,t)}});wE().prototype.isFinite=function(){return this.throwIfDisposed(),iM(this)};var oM=$E({isInf_:function(e){var t={x:YE(e,"x","isInf")};return jE.runKernel(GI,t)}});wE().prototype.isInf=function(){return this.throwIfDisposed(),oM(this)};var sM=$E({isNaN_:function(e){var t={x:YE(e,"x","isNaN")};return jE.runKernel(HI,t)}});wE().prototype.isNaN=function(){return this.throwIfDisposed(),sM(this)},wE().prototype.leakyRelu=function(e){return this.throwIfDisposed(),cR(this,e)},wE().prototype.lessEqual=function(e){return this.throwIfDisposed(),vD(this,e)},wE().prototype.less=function(e){return this.throwIfDisposed(),WO(this,e)};var uM=$E({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=YE(e,"x","localResponseNormalization");Bx(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),Bx(Hx(t),(function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=TA(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=jE.runKernel(nS,u,c);return s?TA(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});wE().prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),uM(this,e,t,n,r)};var cM=$E({logSigmoid_:function(e){var t=YE(e,"x","logSigmoid"),n=aA((function(e){return{value:DR(r_(DR(e))),gradFunc:function(t){return dR(t,QR(DR(e)))}}}));return n(t)}});wE().prototype.logSigmoid=function(){return this.throwIfDisposed(),cM(this)},wE().prototype.logSoftmax=function(e){return this.throwIfDisposed(),mR(this,e)},wE().prototype.logSumExp=function(e,t){return this.throwIfDisposed(),DD(this,e,t)},wE().prototype.log=function(){return this.throwIfDisposed(),lR(this)},wE().prototype.log1p=function(){return this.throwIfDisposed(),hR(this)},wE().prototype.logicalAnd=function(e){return this.throwIfDisposed(),gR(this,e)},wE().prototype.logicalNot=function(){return this.throwIfDisposed(),kL(this)};var lM=$E({logicalOr_:function(e,t){var n=YE(e,"a","logicalOr","bool"),r=YE(t,"b","logicalOr","bool");PN(n.shape,r.shape);var a={a:n,b:r};return jE.runKernel(tS,a)}});wE().prototype.logicalOr=function(e){return this.throwIfDisposed(),lM(this,e)};var hM=$E({logicalXor_:function(e,t){var n=YE(e,"a","logicalXor","bool"),r=YE(t,"b","logicalXor","bool");return PN(n.shape,r.shape),gR(lM(e,t),kL(gR(e,t)))}});wE().prototype.logicalXor=function(e){return this.throwIfDisposed(),hM(this,e)},wE().prototype.matMul=function(e,t,n){return this.throwIfDisposed(),yR(this,e,t,n)},wE().prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),bR(this,e,t,n,r)},wE().prototype.max=function(e,t){return this.throwIfDisposed(),fR(this,e,t)},wE().prototype.maximum=function(e){return this.throwIfDisposed(),VR(this,e)},wE().prototype.mean=function(e,t){return this.throwIfDisposed(),xR(this,e,t)},wE().prototype.min=function(e,t){return this.throwIfDisposed(),xD(this,e,t)},wE().prototype.minimum=function(e){return this.throwIfDisposed(),wR(this,e)};var fM=$E({mirrorPad_:function(e,t,n){Bx("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")}));var r=YE(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");Bx(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){Bx(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),Bx(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal ")+"to ".concat(r.shape[e]-a," or less than 0 for input of ")+"shape ".concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return jE.runKernel(pS,u,s)}});wE().prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),fM(this,e,t)};var dM=$E({mod_:function(e,t){var n=YE(e,"a","mod"),r=YE(t,"b","mod"),a=DE(n,r),i=(0,l.Z)(a,2),o={a:n=i[0],b:r=i[1]};return jE.runKernel(vS,o)}});wE().prototype.mod=function(e){return this.throwIfDisposed(),dM(this,e)},wE().prototype.mul=function(e){return this.throwIfDisposed(),dR(this,e)},wE().prototype.neg=function(){return this.throwIfDisposed(),DR(this)},wE().prototype.norm=function(e,t,n){return this.throwIfDisposed(),SD(this,e,t,n)},wE().prototype.notEqual=function(e){return this.throwIfDisposed(),FR(this,e)},wE().prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),OR(this,e,t,n)},wE().prototype.onesLike=function(){return this.throwIfDisposed(),PR(this)},wE().prototype.pad=function(e,t){return this.throwIfDisposed(),zR(this,e,t)};var pM=$E({pool_:function(e,t,n,r,a,i,o){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var s=YE(e,"x","maxPool"),u=s,c=!1;3===s.rank&&(c=!0,u=TA(s,[1,s.shape[0],s.shape[1],s.shape[2]])),Bx(SA(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")}));var h,f=dA(u.shape,t,i,a,r),d=[f.dilationHeight,f.dilationWidth];h="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})).map((function(e){return e-1})),r=n.map((function(e){return Math.floor(e/2)})),a=n.map((function(e,t){return e-r[t]}));return n.map((function(e,t){return[r[t],a[t]]}))}([f.filterHeight,f.filterWidth],d):[[0,0],[0,0]];var p=1===d[0]&&1===d[1],v=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([f.inHeight,f.inWidth],d,h),m=(0,l.Z)(v,2),g=m[0],y=m[1],b=p?r:"valid",k=p?u:QF(u,d,g),V=("avg"===n?function(){return NA(k,t,i,b,o)}:function(){return bR(k,t,i,b,o)})(),x=p?V:_L(V,d,y);return c?TA(x,[x.shape[1],x.shape[2],x.shape[3]]):x}});wE().prototype.pool=function(e,t,n,r,a,i){return this.throwIfDisposed(),pM(this,e,t,n,r,a,i)},wE().prototype.pow=function(e){return this.throwIfDisposed(),wD(this,e)},wE().prototype.prelu=function(e){return this.throwIfDisposed(),BR(this,e)};var vM=$E({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=YE(e,"x","prod");"bool"===r.dtype&&(r=cN(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return jE.runKernel(NS,a,i)}});wE().prototype.prod=function(e,t){return this.throwIfDisposed(),vM(this,e,t)};var mM=$E({reciprocal_:function(e){var t={x:YE(e,"x","reciprocal")};return jE.runKernel(DS,t)}});wE().prototype.reciprocal=function(){return this.throwIfDisposed(),mM(this)},wE().prototype.relu=function(){return this.throwIfDisposed(),HR(this)},wE().prototype.relu6=function(){return this.throwIfDisposed(),I_(this)},wE().prototype.reshapeAs=function(e){return this.throwIfDisposed(),TA(this,e.shape)},wE().prototype.reshape=function(e){return this.throwIfDisposed(),TA(this,e)},wE().prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),fD(this,e,t,n)},wE().prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),dD(this,e,t,n)},wE().prototype.reverse=function(e){return this.throwIfDisposed(),qR(this,e)},wE().prototype.rfft=function(){return this.throwIfDisposed(),k_(this)},wE().prototype.round=function(){return this.throwIfDisposed(),mD(this)},wE().prototype.rsqrt=function(){return this.throwIfDisposed(),wO(this)},wE().prototype.selu=function(){return this.throwIfDisposed(),KR(this)},wE().prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),XR(this,e,t,n,r,a,i)},wE().prototype.sigmoid=function(){return this.throwIfDisposed(),QR(this)};var gM=$E({sign_:function(e){var t={x:YE(e,"x","sign")};return jE.runKernel(YS,t)}});wE().prototype.sign=function(){return this.throwIfDisposed(),gM(this)},wE().prototype.sin=function(){return this.throwIfDisposed(),uO(this)},wE().prototype.sinh=function(){return this.throwIfDisposed(),lO(this)},wE().prototype.slice=function(e,t){return this.throwIfDisposed(),YR(this,e,t)},wE().prototype.softmax=function(e){return this.throwIfDisposed(),n_(this,e)},wE().prototype.softplus=function(){return this.throwIfDisposed(),r_(this)},wE().prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),QF(this,e,t)},wE().prototype.split=function(e,t){return this.throwIfDisposed(),a_(this,e,t)},wE().prototype.sqrt=function(){return this.throwIfDisposed(),i_(this)},wE().prototype.square=function(){return this.throwIfDisposed(),RR(this)},wE().prototype.squaredDifference=function(e){return this.throwIfDisposed(),RD(this,e)},wE().prototype.squeeze=function(e){return this.throwIfDisposed(),o_(this,e)},wE().prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof xE?[this,e]:[this].concat((0,H.Z)(e));return s_(n,t)},wE().prototype.step=function(e){return this.throwIfDisposed(),S_(this,e)};var yM=$E({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=YE(e,"x","stridedSlice","string_or_numeric"),l={x:c},h={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return jE.runKernel(fC,l,h)}});wE().prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),yM(this,e,t,n,r,a,i,o,s)},wE().prototype.sub=function(e){return this.throwIfDisposed(),pR(this,e)},wE().prototype.sum=function(e,t){return this.throwIfDisposed(),vR(this,e,t)};var bM=$E({tan_:function(e){var t={x:YE(e,"x","tan","float32")};return jE.runKernel(gC,t)}});wE().prototype.tan=function(){return this.throwIfDisposed(),bM(this)},wE().prototype.tanh=function(){return this.throwIfDisposed(),u_(this)},wE().prototype.tile=function(e){return this.throwIfDisposed(),nR(this,e)},wE().prototype.toBool=function(){return this.throwIfDisposed(),cN(this,"bool")},wE().prototype.toFloat=function(){return this.throwIfDisposed(),cN(this,"float32")},wE().prototype.toInt=function(){return this.throwIfDisposed(),cN(this,"int32")};var kM=$E({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=YE(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t<0)throw new Error("'k' passed to topk() must be >= 0 but got ".concat(t));if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));var i={x:r},o={k:t,sorted:n},s=jE.runKernel(kC,i,o),u=(0,l.Z)(s,2),c=u[0],h=u[1];return{values:c,indices:h}}});wE().prototype.topk=function(e,t){return this.throwIfDisposed(),kM(this,e,t)},wE().prototype.transpose=function(e){return this.throwIfDisposed(),g_(this,e)};var VM=$E({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=YE(e,"x","unique","string_or_numeric");Bx(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=jE.runKernel(wC,r,a),o=(0,l.Z)(i,2),s=o[0],u=o[1];return{values:s,indices:u}}});wE().prototype.unique=function(e){return this.throwIfDisposed(),VM(this,e)},wE().prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),SO(this,e,t)},wE().prototype.unstack=function(e){return this.throwIfDisposed(),h_(this,e)},wE().prototype.where=function(e,t){return this.throwIfDisposed(),d_(e,this,t)},wE().prototype.zerosLike=function(){return this.throwIfDisposed(),p_(this)};var xM=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),r=t.call(this,e),Object.setPrototypeOf(g(r),n.prototype),r}return p(n)}(S(Error)),wM=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),r=t.call(this,e),Object.setPrototypeOf(g(r),n.prototype),r}return p(n)}(S(Error)),IM=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),r=t.call(this,e),Object.setPrototypeOf(g(r),n.prototype),r}return p(n)}(S(Error)),SM=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),r=t.call(this,e),Object.setPrototypeOf(g(r),n.prototype),r}return p(n)}(S(Error)),CM=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),r=t.call(this,e),Object.setPrototypeOf(g(r),n.prototype),r}return p(n)}(S(Error)),EM=(Error,function(){function e(t){f(this,e),this.maxEntries=t||100,this.cache=new Map}return p(e,[{key:"get",value:function(e){var t;return this.cache.has(e)&&(t=this.cache.get(e),this.cache.delete(e),this.cache.set(e,t)),t}},{key:"put",value:function(e,t){if(this.cache.has(e))this.cache.delete(e);else if(this.cache.size>=this.maxEntries){var n=this.cache.keys().next().value;this.cache.delete(n)}this.cache.set(e,t)}},{key:"getMaxEntries",value:function(){return this.maxEntries}},{key:"setMaxEntries",value:function(e){if(e<0)throw new Error("The maxEntries of LRU caches must be at least 0, but got ".concat(e,"."));if(this.maxEntries>e)for(var t=0;t<this.maxEntries-e;t++){var n=this.cache.keys().next().value;this.cache.delete(n)}this.maxEntries=e}}]),e}());function TM(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function NM(e,t){if(!e)throw new CM(t)}function AM(e,t){var n,r=0,a=m(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch(h6){a.e(h6)}finally{a.f()}return r}function RM(e){return 1===e.length?e[0]:e}function _M(e){return Array.isArray(e)?e:[e]}function DM(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function FM(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var OM={};function LM(e){if(null===e||void 0===e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function MM(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach((function(e){return MM(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"===typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!==typeof a.value?MM(a):e[r]=a.value)}}function PM(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){var i,o=e;if(o in n)i=n[o];else if(o in OM)i=OM[o];else if(null==(i=t[o]))throw new IM("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return i}var s=e;if(null==s.className||null==s.config)throw new IM("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(s),".\n")+"'className' and 'config' must set.");var u,c,h=s.className;if(h in n){var f=(0,l.Z)(n[h],2);u=f[0],c=f[1]}else if(h in OM){var d=(0,l.Z)(OM.className,2);u=d[0],c=d[1]}else if(h in t){var p=(0,l.Z)(t[h],2);u=p[0],c=p[1]}if(null==u)throw new IM("Unknown ".concat(r,": ").concat(h,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=c){for(var v={},m=0,g=Object.keys(OM);m<g.length;m++){var y=g[m];v[y]=OM[y]}for(var b=0,k=Object.keys(n);b<k.length;b++){var V=k[b];v[V]=n[V]}var x=s.config;x.customObjects=v;for(var w=Object.assign({},OM),I=0,S=Object.keys(n);I<S.length;I++){var C=S[I];OM[C]=n[C]}MM(s.config);var E=c(u,s.config,n,a);return OM=Object.assign({},w),E}for(var T=Object.assign({},OM),N=0,A=Object.keys(n);N<A.length;N++){var R=A[N];OM[R]=n[R]}var _=new u(s.config);return OM=Object.assign({},T),_}function zM(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function BM(e){if(null==e)return e;var t,n=[],r=m(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch(h6){r.e(h6)}finally{r.f()}return n}function UM(e){if(null==e)throw new IM("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function WM(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new IM("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function jM(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return NM(n>=0),NM(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function ZM(e,t){Array.isArray(e)?(Bx(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return ZM(e,"element ".concat(n+1," of ").concat(t))}))):Bx(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ")+"".concat(GM(e),".")}))}function GM(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return GM(e)})).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function HM(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}var qM=0;function KM(){return qM++}var XM={};function QM(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in XM||(XM[e]=0),XM[e]+=1,e+XM[e].toString()}var YM=["channelsFirst","channelsLast"],JM=["nearest","bilinear"],$M=["valid","same","causal"],eP=["max","avg"],tP=["sum","mul","concat","ave"],nP=new Map;function rP(e){WM(YM,"DataFormat",e)}function aP(e){WM($M,"PaddingMode",e)}function iP(e){WM(eP,"PoolMode",e)}var oP=[];function sP(e,t){oP.push(e);try{var n=t();return oP.pop(),n}catch(r){throw oP.pop(),r}}function uP(e){if(!fP(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===oP.length?"":oP.join("/")+"/")+e}function cP(e){if(!fP(e))throw new Error("Not a valid tensor name: '"+e+"'");nP.has(e)||nP.set(e,0);var t=nP.get(e);if(nP.set(e,nP.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return nP.set(n,1),n}return e}var lP,hP=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function fP(e){return!!e.match(hP)}function dP(e){return e===parseInt(e.toString(),10)}function pP(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function vP(e){if(0===e.length)return Number.NaN;for(var t=Number.POSITIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r<t&&(t=r)}return t}function mP(e){if(0===e.length)return Number.NaN;for(var t=Number.NEGATIVE_INFINITY,n=0;n<e.length;n++){var r=e[n];r>t&&(t=r)}return t}function gP(e,t){if(t<e)throw new IM("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function yP(){return null==lP&&(lP=jE.backend.epsilon()),lP}function bP(e,t){return cN(e,t)}function kP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),TA(e,n)}function VP(e){var t=[pP(e.shape)];return TA(e,t)}function xP(e,t,n){return eA((function(){switch(e.rank){case 1:return JR(e,t,n);case 2:return $R(e,[t,0],[n,e.shape[1]]);case 3:return e_(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return t_(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return YR(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return YR(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new IM("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function wP(e,t,n){return eA((function(){switch(e.rank){case 1:return JR(e,t,n);case 2:return $R(e,[0,t],[e.shape[0],n]);case 3:return e_(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return t_(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new IM("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function IP(e,t,n,r){return eA((function(){switch(e.rank){case 1:return JR(e,t,n);case 2:switch(r){case 1:return xP(e,t,n);case 2:return wP(e,t,n);default:throw new IM("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return xP(e,t,n);case 2:return e_(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return wP(e,t,n);default:throw new IM("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return xP(e,t,n);case 2:return t_(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return t_(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return wP(e,t,n);default:throw new IM("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new IM("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function SP(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),MA(e,n)}function CP(e,t){switch(e.rank){case 1:return PA([e,t]);case 2:return zA([e,t],0);case 3:return BA([e,t],0);case 4:return UA([e,t],0);default:throw new IM("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function EP(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new IM("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return nR(e,t)}function TP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return ZR(e,t,n,r,a)}function NP(e,t,n,r){if(e.rank<2||t.rank<2)throw new SM("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new SM("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape));if(2===e.rank&&2===t.rank){return D_({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?_P(e.rank,r,"channelsLast"):null,activation:n})}var a=e.shape.slice(),i=a.pop();e=TA(e,[-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat((0,H.Z)(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=TA(g_(t,l),[u,-1]);var h=[].concat((0,H.Z)(a),(0,H.Z)(c));return TA(D_({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?_P(e.rank,r,"channelsLast"):null,activation:n}),h)}function AP(e,t,n){return eA((function(){return t=Array.isArray(t)?c_(t,"int32"):cN(t,"int32"),oR(e,t,n)}))}function RP(e){return dR(e,e)}function _P(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new IM("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?TA(t,[1,r[0],1,1,1]):TA(t,[1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?TA(t,[1,1,1,1,r[0]]):TA(t,[1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?TA(t,[1,r[0],1,1]):TA(t,[1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?TA(t,[1,1,1,r[0]]):TA(t,[1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?TA(t,[1,r[0],1]):TA(t,[1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?TA(t,[1,1,r[0]]):TA(t,[1].concat(r))}else if(e<3)return t;throw new IM("Unsupported input rank by biasAdd: ".concat(t.rank))}function DP(e,t,n){return eA((function(){return null==n&&(n="channelsLast"),rP(n),uA(e,_P(e.rank,t,n))}))}function FP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new SM("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return JA(e)}function OP(e,t,n,r){return eA((function(){return y_(e,t,n,r)}))}function LP(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e():t()}var MP=["fanIn","fanOut","fanAvg"],PP=["normal","uniform","truncatedNormal"];var zP=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(XN),BP=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e,t){return LR(e,t)}}]),n}(zP);BP.className="Zeros",YN(BP);var UP=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e,t){return MR(e,t)}}]),n}(zP);UP.className="Ones",YN(UP);var WP=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),r=t.call(this),"object"!==typeof e)throw new IM("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new IM("config must have value set but got ".concat(e));return r.value=e.value,r}return p(n,[{key:"apply",value:function(e,t){var n=this;return eA((function(){return dR(iA(n.value),MR(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(zP);WP.className="Constant",YN(WP);var jP=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return p(n,[{key:"apply",value:function(e,t){return GR(e,this.minval,this.maxval,t)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(zP);jP.className="RandomUniform",YN(jP);var ZP=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return p(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new SM("randomNormal does not support dType ".concat(t,"."));return TP(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(zP);ZP.className="RandomNormal",YN(ZP);var GP=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return p(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new SM("truncatedNormal does not support dType ".concat(t,"."));return l_(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(zP);GP.className="TruncatedNormal",YN(GP);var HP=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return p(n,[{key:"apply",value:function(e,t){var n=this;return eA((function(){if(2!==e.length||e[0]!==e[1])throw new IM("Identity matrix initializer can only be used for 2D square matrices.");return dR(n.gain,rR(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(zP);HP.className="Identity",YN(HP);var qP=function(e){b(n,e);var t=w(n);function n(e){var r,a;if(f(this,n),r=t.call(this),e.scale<0)throw new IM("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,a=r.mode,WM(MP,"FanMode",a),r.distribution=null==e.distribution?"normal":e.distribution,function(e){WM(PP,"Distribution",e)}(r.distribution),r.seed=e.seed,r}return p(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(rP(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=pP(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=pP(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=pP(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new SM("".concat(this.getClassName()," does not support dType ").concat(t,"."));return l_(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return GR(e,-s,s,t)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(zP);qP.className="VarianceScaling",YN(qP);var KP=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return p(n,[{key:"getClassName",value:function(){return qP.className}}]),n}(qP);KP.className="GlorotUniform",YN(KP);var XP=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return p(n,[{key:"getClassName",value:function(){return qP.className}}]),n}(qP);XP.className="GlorotNormal",YN(XP);var QP=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return p(n,[{key:"getClassName",value:function(){return qP.className}}]),n}(qP);QP.className="HeNormal",YN(QP);var YP=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return p(n,[{key:"getClassName",value:function(){return qP.className}}]),n}(qP);YP.className="HeUniform",YN(YP);var JP=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return p(n,[{key:"getClassName",value:function(){return qP.className}}]),n}(qP);JP.className="LeCunNormal",YN(JP);var $P=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return p(n,[{key:"getClassName",value:function(){return qP.className}}]),n}(qP);$P.className="LeCunNormal",YN($P);var ez=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new SM("Random seed is not implemented for Orthogonal Initializer yet.");return r}return p(n,[{key:"apply",value:function(e,t){var n=this;return eA((function(){if(e.length<2)throw new SM("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than 2000 (".concat(e[0]*e[1],") elements: ")+"Slowness may result.");var t=TP(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=LD.gramSchmidt(t);return e[0]>e[1]&&(r=g_(r)),dR(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(zP);ez.className="Orthogonal",YN(ez);var tz={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function nz(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return PM(e,QN.getMap().classNameMap,t,"initializer")}function rz(e){return LM(e)}function az(e){if("string"===typeof e){var t=e in tz?tz[e]:e;if("GlorotNormal"===t)return new XP;if("GlorotUniform"===t)return new KP;if("HeNormal"===t)return new QP;if("HeUniform"===t)return new YP;if("LeCunNormal"===t)return new JP;if("LeCunUniform"===t)return new $P;var n={};return n.className=t,n.config={},nz(n)}return e instanceof zP?e:nz(e)}function iz(e){return Array.isArray(e)&&Array.isArray(e[0])}function oz(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function sz(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new IM("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function uz(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new IM("Expected exactly 1 Shape; got ".concat(e.length))}return e}function cz(e){var t,n=0,r=m(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch(h6){r.e(h6)}finally{r.f()}return n}var lz="Variable",hz=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:lz,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;f(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=KM(),r=null==r?lz:r,this.originalName=uP(r),this.name=cP(this.originalName),this.trainable_=a,this.constraint=i,this.val=f_(t,this.trainable_,this.name,this.dtype)}return p(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function fz(e){return e.map((function(e){return e.read()}))}function dz(e){e.forEach((function(e){e[0].write(e[1])}))}var pz=p((function e(t){f(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),vz=p((function e(t,n,r,a,i,o,s){f(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=KM(),null!=o&&(this.originalName=uP(o),this.name=cP(this.originalName)),this.rank=n.length})),mz=0,gz=function(){function e(t,n){f(this,e),this.callArgs=n,this.id=mz++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=m(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch(h6){a.e(h6)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return p(e,[{key:"getConfig",value:function(){var e,t=[],n=m(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch(h6){n.e(h6)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),yz=0,bz=function(e){b(n,e);var t=w(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};f(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=yz++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=DM(i)+"_"+QM(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return p(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new wM("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new IM("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return RM(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return RM(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new xM("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new xM("Layer ".concat(this.name)+" is not connected, no input to return.");return RM(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new xM("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new xM("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return RM(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=_M(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=_M(this.inputSpec);if(e.length!==t.length)throw new IM("Layer ".concat(this.name," expects ").concat(t.length," inputs, ")+"but it received ".concat(e.length," input tensors. ")+"Input received: ".concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new IM("Input ".concat(n," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new IM("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new IM("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new IM("Input ".concat(n," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new IM("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(u," of input shape to ")+"have value ".concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var h=0;h<a.shape.length;++h){var f=a.shape[h],d=r.shape[h];if(null!=f&&null!=d&&f!==d)throw new IM("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=_M(e),i=!0,o=m(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof vz)){i=!1;break}}}catch(h6){o.e(h6)}finally{o.f()}var s,u=!0,c=m(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof vz){u=!1;break}}}catch(h6){c.e(h6)}finally{c.f()}if(i===u)throw new IM("Arguments to apply() must be all SymbolicTensors or all Tensors");return sP(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=m(_M(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch(h6){o.e(h6)}finally{o.f()}n.build(RM(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,l=n.call(e,t),h=[],f=m(_M(l));try{for(f.s();!(c=f.n()).done;){var d=c.value;-1!==a.indexOf(d)&&(d=d.clone()),h.push(d)}}catch(h6){f.e(h6)}finally{f.f()}if(l=RM(h),null!=n.activityRegularizer)throw new SM("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}var p,v=function(e){e=_M(e);var t,n=[],r=m(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch(h6){r.e(h6)}finally{r.f()}return RM(n)}(e),g=n.computeOutputShape(v),y="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?v[0]:v),p=null!=g&&g.length>0&&Array.isArray(g[0])?g.map((function(r,a){return new vz(y,r,n,_M(e),t,n.name,a)})):new vz(y,g,n,_M(e),t,n.name),n.addInboundNode(e,p,null,null,v,g,t),n._refCount++,null!=n.activityRegularizer)throw new SM("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new xM("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var e,t=[],n=m(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch(h6){n.e(h6)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new xM("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}},{key:"countParams",value:function(){if(!this.built)throw new wM("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return cz(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return fz(e?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;eA((function(){var n=t.weights;if(n.length!==e.length)throw new IM('You called setWeights(weights) on layer "'.concat(t.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(n.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0!==n.length){for(var r=[],a=fz(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!Gx(o.shape,u.shape))throw new IM("Layer weight shape ".concat(o.shape," ")+"not compatible with provided weight shape ".concat(u.shape));r.push([s,u])}dz(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o,s){if(-1!==this._addedWeightNames.indexOf(e))throw new IM("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=null!=s?s():az("zeros"));var u=r.apply(t,n),c=new hz(u,n,e,i,o);return u.dispose(),null!=a&&this.addLoss((function(){return a.apply(c.read())})),null==i&&(i=!0),i?this._trainableWeights.push(c):this._nonTrainableWeights.push(c),c}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=_M(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,(0,H.Z)(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, ")+"but was passed an inputMask.")}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=_M(e);t=_M(t),n=_M(n),r=_M(r),a=oz(a),i=oz(i);var u,c=[],l=[],h=[],f=m(s);try{for(f.s();!(u=f.n()).done;){var d=u.value;c.push(d.sourceLayer),l.push(d.nodeIndex),h.push(d.tensorIndex)}}catch(h6){f.e(h6)}finally{f.f()}new gz({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:h,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(XN);function kz(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=m(kz(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]));try{for(s.s();!(o=s.n()).done;){var u=o.value;-1===a.indexOf(u)&&a.push(u)}}catch(h6){s.e(h6)}finally{s.f()}}return a}var Vz=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:QM("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new IM("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new IM("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new IM("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new vz(r.dtype,r.batchInputShape,g(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new gz({outboundLayer:g(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),r}return p(n,[{key:"apply",value:function(e,t){throw new IM("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(bz);Vz.className="InputLayer",YN(Vz);var xz=function(){function e(t){if(f(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=m(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch(h6){a.e(h6)}finally{a.f()}}}return p(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new IM("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return cN(t,e.dtype)}catch(h6){throw new IM("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof vz){if(null==this.id2Value[e.id])throw new IM("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new IM("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof vz){if(null==this.id2Value[e.id])throw new IM("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new IM("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&tA(this.id2Mask)}}]),e}(),wz=new EM,Iz=new EM;function Sz(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),h=m(u);try{for(h.s();!(a=h.n()).done;){var f=a.value;-1!==l.indexOf(f)?c.push(t.getValue(f)):c.push(null)}}catch(h6){h.e(h6)}finally{h.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var d,p=u.join(",")+"|"+t.names().sort().join(","),v=wz.get(p);if(null==v){var g=function(e,t){Bx(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=Ez(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=m(e);try{for(s.s();!(i=s.n()).done;){var u,c=Ez(i.value,t),l=c.sorted,h=c.recipientMap,f=m(l);try{for(f.s();!(u=f.n()).done;){var d=u.value;o.has(d.name)||(n.push(d),o.add(d.name))}}catch(h6){f.e(h6)}finally{f.f()}var p=function(e){null==r[e]&&(r[e]=new Set),h[e].forEach((function(t){return r[e].add(t)}))};for(var v in h)p(v)}}catch(h6){s.e(h6)}finally{s.f()}}return{sorted:n,recipientCounts:Cz(r)}}(s,t);v=g.sorted,d=g.recipientCounts,wz.put(p,v),Iz.put(p,d)}d={},i||Object.assign(d,Iz.get(p));for(var y=new xz(t),b=0;b<v.length;++b){if(null!=r){var k=$N().numTensors;k>r.maxNumTensors&&(r.maxNumTensors=k),k<r.minNumTensors&&(r.minNumTensors=k)}var V=v[b],x=V.sourceLayer;if(!(x instanceof Vz)){var w,I=[],S=[],C=[],E=!1,T=m(V.inputs);try{for(T.s();!(w=T.n()).done;){var N=w.value,A=y.getValue(N),R=y.getMask(N);I.push(A),S.push(R),null!=R&&(E=!0),i||(d[N.name]--,0!==d[N.name]||t.hasKey(N)||-1!==u.indexOf(N.name)||A.isDisposed||!0===N.sourceLayer.stateful||C.push(A))}}catch(h6){T.e(h6)}finally{T.f()}E&&((n=n||{}).mask=S[0]);var _=_M(x.apply(I,n)),D=null;x.supportsMasking&&(D=x.computeMask(I,S));for(var F=Tz(V),O=Array.isArray(F)?F:[F],L=0;L<O.length;++L){y.hasKey(O[L])||y.add(O[L],_[L],Array.isArray(D)?D[0]:D);var M=u.indexOf(O[L].name);-1!==M&&(c[M]=_[L])}i||tA(C)}}return y.disposeMasks(),o?c:c[0]}function Cz(e){var t={};for(var n in e)t[n]=e[n].size;return t}function Ez(e,t){var n,r=new Set,a=[],i={},o=m(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch(h6){o.e(h6)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var h=c[c.length-1]===u.length-1;if(0===l.inputs.length||h)u.pop(),a.push(l),r.add(l.name),h&&c.pop();else{c.push(u.length-1);var f,d=m(l.inputs);try{for(d.s();!(f=d.n()).done;){var p=f.value;null==i[p.name]&&(i[p.name]=new Set),i[p.name].add(l.name),r.has(p.name)||u.push(p)}}catch(h6){d.e(h6)}finally{d.f()}}}}return{sorted:a,recipientMap:i}}function Tz(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=m(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch(h6){i.e(h6)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}function Nz(e,t){return eA((function(){return i_(vR(dR(e,e),t,!0))}))}ww().registerFlag("TOPOLOGICAL_SORT_CACHE_MAX_ENTRIES",(function(){return 100}),(function(e){null!=wz&&wz.setMaxEntries(e),null!=Iz&&Iz.setMaxEntries(e)}));var Az=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getConfig",value:function(){return{}}}]),n}(XN),Rz=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return p(n,[{key:"apply",value:function(e){var t=this;return eA((function(){var n=Nz(e,t.axis),r=LA(n,0,t.maxValue);return dR(e,YA(r,uA(yP(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(Az);Rz.className="MaxNorm",YN(Rz);var _z=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return p(n,[{key:"apply",value:function(e){var t=this;return eA((function(){return YA(e,uA(yP(),Nz(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(Az);_z.className="UnitNorm",YN(_z);var Dz=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){return HR(e)}}]),n}(Az);Dz.className="NonNeg",YN(Dz);var Fz=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return p(n,[{key:"apply",value:function(e){var t=this;return eA((function(){var n=Nz(e,t.axis),r=uA(dR(t.rate,LA(n,t.minValue,t.maxValue)),dR(1-t.rate,n));return dR(e,YA(r,uA(yP(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(Az);Fz.className="MinMaxNorm",YN(Fz);var Oz,Lz={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function Mz(e){return LM(e)}function Pz(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return PM(e,QN.getMap().classNameMap,t,"constraint")}function zz(e){return null==e?null:"string"===typeof e?Pz({className:e in Lz?Lz[e]:e,config:{}}):e instanceof Az?e:Pz(e)}function Bz(e){return Uz.apply(this,arguments)}function Uz(){return Uz=c(s().mark((function e(t){var n,r,a,i,o,u,c,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!==typeof(o=t[i])&&(u=o,n.push(u.data()),r.push(i),a.push(u));if(!(n.length>0)){e.next=12;break}return e.next=9,Promise.all(n);case 9:for(c=e.sent,l=0;l<c.length;++l)t[r[l]]=c[l][0];tA(a);case 12:case"end":return e.stop()}}),e)}))),Uz.apply(this,arguments)}function Wz(e){if(null!=e)for(var t in e){var n=e[t];"number"!==typeof n&&n.dispose()}}!function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(Oz||(Oz={}));var jz=function(){function e(){f(this,e),this.validationData=null}return p(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),Zz=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;f(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return p(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=m(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch(h6){n.e(h6)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=m(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch(h6){n.e(h6)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=c(s().mark((function e(t,n){var r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=m(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=c(s().mark((function e(t,n){var r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=m(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=c(s().mark((function e(t,n){var r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=m(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=c(s().mark((function e(t,n){var r,a,i;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=m(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=c(s().mark((function e(t){var n,r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=m(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=c(s().mark((function e(t){var n,r,a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=m(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),Gz=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.call(this)}return p(n,[{key:"onEpochBegin",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=c(s().mark((function e(t,n){var r,a,i,o=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=function(e){var t=n[e];if("number"===typeof t)o.totals.hasOwnProperty(e)||(o.totals[e]=0),o.totals[e]=o.totals[e]+t*r;else{var a;e in o.totals?a=o.totals[e]:o.totals[e]=0;var i=eA((function(){return uA(o.totals[e],dR(t,r))}));o.totals[e]=i,null!=a&&a.dispose()}},n)a(i);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=c(s().mark((function e(t,n){var r,a,i,o=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=19;break}r=m(this.params.metrics),e.prev=2,i=function(){var e=a.value;if(null==o.totals[e])return"continue";"number"===typeof o.totals[e]?n[e]=o.totals[e]/o.seen:eA((function(){var t=dR(YA(1,o.seen),o.totals[e]);n[e]=t,o.totals[e].dispose(),nA(n[e])}))},r.s();case 5:if((a=r.n()).done){e.next=11;break}if("continue"!==i()){e.next=9;break}return e.abrupt("continue",9);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[2,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(jz),Hz=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"onTrainBegin",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i,o,u,c,l;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!==typeof i[o]&&(u=i[o],t.push(u.data()),n.push(a),r.push(o));return e.next=6,Promise.all(t);case 6:for(c=e.sent,l=0;l<c.length;++l)this.history[n[l]][r[l]].dispose(),this.history[n[l]][r[l]]=c[l][0];case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(jz),qz=function(e){b(n,e);var t=w(n);function n(e,r){var a;if(f(this,n),(a=t.call(this)).currentEpoch=0,a.nowFunc=e.nowFunc,a.nextFrameFunc=e.nextFrameFunc||KD,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return iw(a.yieldEvery)&&(a.maybeWait=function(e,t,n){var r,a=null!=n?n():sE();return function(){var i=null!=n?n():sE();return i-a<t?r:(a=i,r=e.apply(void 0,arguments))}}(a.maybeWait.bind(g(a)),a.yieldEvery,a.nowFunc)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,a}return p(n,[{key:"maybeWait",value:function(){var e=c(s().mark((function e(t,n,r){var a;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],null==this.yield){e.next=5;break}return e.next=4,Bz(r);case 4:a.push(this.yield(t,n,r));case 5:return a.push(this.nextFrameFunc()),e.next=8,Promise.all(a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,null==this.epochBegin){e.next=6;break}return e.next=4,Bz(n);case 4:return e.next=6,this.epochBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.epochEnd){e.next=5;break}return e.next=4,Bz(n);case 4:r.push(this.epochEnd(t,n));case 5:return"epoch"===this.yieldEvery&&r.push(this.nextFrameFunc()),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.batchBegin){e.next=5;break}return e.next=3,Bz(n);case 3:return e.next=5,this.batchBegin(t,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.batchEnd){e.next=5;break}return e.next=4,Bz(n);case 4:r.push(this.batchEnd(t,n));case 5:return"batch"===this.yieldEvery?r.push(this.nextFrameFunc()):iw(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainBegin){e.next=5;break}return e.next=3,Bz(t);case 3:return e.next=5,this.trainBegin(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainEnd){e.next=5;break}return e.next=3,Bz(t);case 3:return e.next=5,this.trainEnd(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(jz);function Kz(e,t){return null==e&&(e={}),e instanceof jz?[e]:Array.isArray(e)&&e[0]instanceof jz?e:_M(e).map((function(e){return new qz(e,t)}))}var Xz=function(){function e(){f(this,e)}return p(e,null,[{key:"registerCallbackConstructor",value:function(t,n){Bx(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors){e.constructors[+n].forEach((function(e){if(e===t)throw new IM("Duplicate callback constructor.")}))}}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,(0,H.Z)(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function Qz(e,t,n,r,a,i,o,s,u){var c=new Hz,l=[new Gz].concat((0,H.Z)(Xz.createCallbacks(t)));null!=e&&l.push.apply(l,(0,H.Z)(e)),l.push(c);var h=new Zz(l);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:h,history:c}}function Yz(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return PM(e,QN.getMap().classNameMap,t,"layer",n)}function Jz(e,t){return eA((function(){"float32"!==e.dtype&&(e=cN(e,"float32"));var n=vR(RP(e),t,!0),r=aR(n.shape,yP()),a=i_(VR(n,r));return YA(e,a)}))}function $z(e,t){return eA((function(){return xR(RP(pR(t,e)),-1)}))}function eB(e,t){return eA((function(){return xR(sA(pR(t,e)),-1)}))}function tB(e,t){return eA((function(){var n=pR(e,t),r=LA(sA(e),yP(),Number.MAX_VALUE),a=sA(YA(n,r));return dR(100,xR(a,-1))}))}function nB(e,t){return eA((function(){var n=LA(t,yP(),Number.MAX_VALUE),r=lR(uA(1,n)),a=LA(e,yP(),Number.MAX_VALUE),i=lR(uA(1,a));return xR(RP(pR(r,i)),-1)}))}function rB(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return eA((function(){if(n)t=n_(t);else{var r=vR(t,t.shape.length-1,!0);t=YA(t,r)}return t=LA(t,yP(),1-yP()),DR(vR(dR(cN(e,"float32"),lR(t)),t.shape.length-1))}))}function aB(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return eA((function(){var r=cN(iR(VP(e)),"int32"),a=(t=LA(t,yP(),1-yP())).shape;return rB(TA(OR(r,a[a.length-1]),a),t,n)}))}function iB(e,t){return eA((function(){var n;return n=LA(t,yP(),1-yP()),n=lR(YA(n,pR(1,n))),xR(function(e,t){if(!Gx(e.shape,t.shape))throw new IM("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return eA((function(){var n=HR(t),r=DR(sA(t));return uA(pR(n,dR(t,e)),hR(eR(r)))}))}(e,n),-1)}))}function oB(e,t){return eA((function(){var n=LA(e,yP(),1),r=LA(t,yP(),1);return vR(dR(e,lR(YA(n,r))),-1)}))}function sB(e,t){return eA((function(){var n=Jz(e,-1),r=Jz(t,-1),a=dR(n,r);return DR(vR(a,-1))}))}Xz.constructors={};var uB={meanSquaredError:$z,meanAbsoluteError:eB,meanAbsolutePercentageError:tB,meanSquaredLogarithmicError:nB,squaredHinge:function(e,t){return eA((function(){var n=VR(0,pR(1,dR(e,t)));return xR(RP(n),-1)}))},hinge:function(e,t){return eA((function(){var n=VR(0,pR(1,dR(e,t)));return xR(n,-1)}))},categoricalHinge:function(e,t){return eA((function(){var n=vR(dR(e,t),-1),r=fR(dR(pR(1,e),t),-1);return VR(0,uA(1,pR(r,n)))}))},logcosh:function(e,t){return eA((function(){var n=Math.log(2),r=pR(t,e),a=pR(uA(r,r_(dR(-2,r))),n);return xR(a,-1)}))},categoricalCrossentropy:rB,sparseCategoricalCrossentropy:aB,binaryCrossentropy:iB,kullbackLeiblerDivergence:oB,poisson:function(e,t){return eA((function(){var n=lR(uA(yP(),t));return xR(pR(t,dR(e,n)),-1)}))},cosineProximity:sB};function cB(e){if("string"===typeof e){if(e in uB)return uB[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new IM(t)}return e}function lB(e,t){return eA((function(){var n=dR(.5,PR(t)),r=bP(sR(t,n),e.dtype);return xR($A(e,r),-1)}))}function hB(e,t){return eA((function(){return bP($A(hA(e,-1),hA(t,-1)),"float32")}))}function fB(e,t){return eA((function(){return cN(vR(gR($A(e,1),$A(t,1))),"float32")}))}function dB(e,t){return iB(e,t)}function pB(e,t){return e.rank===t.rank&&(e=o_(e,[e.rank-1])),(t=hA(t,-1)).dtype!==e.dtype&&(t=cN(t,e.dtype)),cN($A(e,t),"float32")}var vB=rB,mB=aB,gB={binaryAccuracy:lB,categoricalAccuracy:hB,precision:function(e,t){return eA((function(){var n=fB(e,t),r=function(e,t){return eA((function(){return cN(vR(gR($A(e,0),$A(t,1))),"float32")}))}(e,t),a=uA(n,r);return cN(d_(sR(a,0),YA(n,a),0),"float32")}))},categoricalCrossentropy:vB,sparseCategoricalCrossentropy:mB,mse:$z,MSE:$z,mae:eB,MAE:eB,mape:tB,MAPE:tB,cosine:sB};function yB(e){if("string"===typeof e&&e in gB)return gB[e];if("string"!==typeof e&&null!=e)return e;throw new IM("Unknown metric ".concat(e))}function bB(e){if(NM(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;for(var t,n=0,r=Object.keys(uB);n<r.length;n++){var a=r[n];if(uB[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(gB);i<o.length;i++){var s=o[i];if(gB[s]===e){t=s;break}}return void 0!==t?t:e.name}var kB=1048576;function VB(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!xB(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>kB&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(kB,"."))}}function xB(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!==typeof r)return!1;if(!xB(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=m(e);try{for(i.s();!(a=i.n()).done;){if(!xB(a.value))return!1}}catch(h6){i.e(h6)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function wB(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=SB(e),o=["Layer (type)","Input Shape","Output shape","Param #"];if(i?(t=t||90,n=n||[.32,.61,.89,1]):(t=t||115,n=n||[.24,.48,.7,.8,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,(0,H.Z)(e.nodesByDepth[s]))}a("_".repeat(t)),CB(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?EB(c[l],n,a):TB(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var h=IB(e),f=cz(e.nonTrainableWeights);a("Total params: ".concat(h+f)),a("Trainable params: ".concat(h)),a("Non-trainable params: ".concat(f)),a("_".repeat(t))}function IB(e){return null!=e.collectedTrainableWeights?cz(e.collectedTrainableWeights):cz(e.trainableWeights)}function SB(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,(0,H.Z)(s))}if(t){var u,c=m(e.layers);try{for(c.s();!(u=c.n()).done;){var l,h=u.value,f=!1,d=m(h.inboundNodes);try{for(d.s();!(l=d.n()).done;){var p=l.value;if(-1!==r.indexOf(p)){if(f){t=!1;break}f=!0}}}catch(h6){d.e(h6)}finally{d.f()}if(!t)break}}catch(h6){c.e(h6)}finally{c.f()}}return t}function CB(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function EB(e,t,n){var r,a;try{a=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(h6){a="multiple"}try{r=JSON.stringify(e.outputShape)}catch(h6){r="multiple"}var i=e.name,o=e.getClassName();CB(["".concat(i," (").concat(o,")"),a,r,e.countParams().toString()],t,n)}function TB(e,t,n,r){var a,i;try{i=e.inboundNodes.map((function(e){return JSON.stringify(e.inputShapes)})).join(",")}catch(h6){i="multiple"}try{a=JSON.stringify(e.outputShape)}catch(h6){a="multiple"}var o,s=[],u=m(e.inboundNodes);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(c)))for(var l=0;l<c.inboundLayers.length;++l){var h=c.inboundLayers[l].name,f=c.nodeIndices[l],d=c.tensorIndices[l];s.push("".concat(h,"[").concat(f,"][").concat(d,"]"))}}}catch(h6){u.e(h6)}finally{u.f()}var p=e.name,v=e.getClassName(),g=0===s.length?"":s[0];CB(["".concat(p," (").concat(v,")"),i,a,e.countParams().toString(),g],t,r);for(var y=1;y<s.length;++y)CB(["","","","",s[y]],t,r)}function NB(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function AB(e,t){if(null===e)return null;if("string"===typeof e)return FM(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];NB(t,a,i)?n.push(i):n.push(AB(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"===typeof l)o[c]=l;else{var h=FM(c);o[h]=AB(l,h)}}return o}function RB(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return DM(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];NB(t,a,i)?n.push(i):n.push(RB(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],h=DM(c);o[h]="name"!==c&&"className"!==c||"string"!==typeof l?RB(l,c):l}return o}var _B="3.20.0",DB=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=QM(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],BM(r.inputs).length!==r.inputs.length)throw new IM("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(r.inputs.map((function(e){return e.name}))));BM(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=m(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,c=s.nodeIndex,l=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(c),r.outputLayersTensorIndices.push(l)}}catch(h6){o.e(h6)}finally{o.f()}var h,d=m(r.inputs);try{for(d.s();!(h=d.n()).done;){var p=h.value,v=p.sourceLayer,y=p.nodeIndex,b=p.tensorIndex;NM(0===y,"input layer has >1 nodes"),NM(0===b,"input layer has >1 tensors"),r.inputLayers.push(v),r.inputLayersNodeIndices.push(y),r.inputLayersTensorIndices.push(b)}}catch(h6){d.e(h6)}finally{d.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var k=0;k<r.inputLayers.length;k++){var V=r.inputLayers[k];if(!(V instanceof Vz))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(k," (0-based) originates ")+"from layer type ".concat(V.getClassName(),"."));r.inputNames.push(V.name),r.feedInputShapes.push(V.batchInputShape),r.feedInputNames.push(V.name)}var x,w=m(r.outputLayers);try{for(w.s();!(x=w.n()).done;){var I=x.value;r.outputNames.push(I.name)}}catch(h6){w.e(h6)}finally{w.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var S,C={},E={},T={},N={},A={},R=[],_=function e(t,a,i,o,s,u){null!=o&&null!=s&&null!=u||(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new wM("The tensor ".concat(t.name,' at layer "').concat(o.name,'" ')+"is part of a cycle.");if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in A||(A[o.id]=Object.keys(A).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,h=0;h<l;h++){e(c.inputTensors[h],a,i,c.inboundLayers[h],c.nodeIndices[h],c.tensorIndices[h])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);R.push(c)}},D=[],F=[],O=m(r.outputs);try{for(O.s();!(S=O.n()).done;){_(S.value,D,F)}}catch(h6){O.e(h6)}finally{O.f()}var L,M=m(R.slice().reverse());try{for(M.s();!(L=M.n()).done;){var P=L.value;E[P.id]=P,P.id in C||(C[P.id]=0);var z=C[P.id],B=null==T[P.outboundLayer.id]?0:T[P.outboundLayer.id];z=Math.max(z,B),T[P.outboundLayer.id]=z,N[P.outboundLayer.id]=P.outboundLayer,C[P.id]=z;for(var U=0;U<P.inboundLayers.length;U++){var W=P.inboundLayers[U],j=P.nodeIndices[U],Z=W.inboundNodes[j],G=null==C[Z.id]?0:C[Z.id];C[Z.id]=Math.max(z+1,G),E[Z.id]=Z}}}catch(h6){M.e(h6)}finally{M.f()}var H={};for(var q in C){var K=C[q];K in H||(H[K]=[]),H[K].push(E[q])}var X={};for(var Q in T){var Y=T[Q];Y in X||(X[Y]=[]),X[Y].push(N[Q])}var J=Object.keys(X).map((function(e){return parseInt(e,10)})).sort(zM);r.layers=[];var $,ee=m(J);try{for(ee.s();!($=ee.n()).done;){var te=X[$.value];te.sort((function(e,t){var n=A[e.id],r=A[t.id];return n<r?-1:n>r?1:0}));var ne,re=m(te);try{for(re.s();!(ne=re.n()).done;){var ae=ne.value;ae instanceof n&&r.internalContainerRefs.push(ae),r.layers.push(ae)}}catch(h6){re.e(h6)}finally{re.f()}}}catch(h6){ee.e(h6)}finally{ee.f()}r.layersByDepth=X,J=Object.keys(H).map((function(e){return parseInt(e,10)})).sort(zM);var ie,oe=r.inputs.slice(),se=[],ue=m(J);try{for(ue.s();!(ie=ue.n()).done;){var ce,le=m(H[ie.value]);try{for(le.s();!(ce=le.n()).done;){var he=ce.value,fe=he.outboundLayer;if(null!=fe){var de,pe=m(he.inputTensors);try{for(pe.s();!(de=pe.n()).done;){var ve=de.value;if(-1===oe.indexOf(ve))throw new wM("Graph disconnected: cannot obtain value for tensor ".concat(ve)+' at layer "'.concat(fe.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(se))}}catch(h6){pe.e(h6)}finally{pe.f()}var me,ge=m(he.outputTensors);try{for(ge.s();!(me=ge.n()).done;){var ye=me.value;oe.push(ye)}}catch(h6){ge.e(h6)}finally{ge.f()}se.push(fe.name)}}}catch(h6){le.e(h6)}finally{le.f()}}}catch(h6){ue.e(h6)}finally{ue.f()}r.nodesByDepth=H;var be,ke=r.layers.map((function(e){return e.name})),Ve=m(ke);try{var xe=function(){var e=be.value,t=ke.filter((function(t){return t===e})).length;if(1!==t)throw new wM('The name "'.concat(e,'" is used ').concat(t," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(ke))};for(Ve.s();!(be=Ve.n()).done;)xe()}catch(h6){Ve.e(h6)}finally{Ve.f()}return r.outboundNodes=[],r.inboundNodes=[],new gz({outboundLayer:g(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return p(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=m(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch(h6){n.e(h6)}finally{n.f()}var a,i=m(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch(h6){i.e(h6)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new IM("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=m(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch(h6){n.e(h6)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=m(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,H.Z)(r.nonTrainableWeights))}}catch(h6){n.e(h6)}finally{n.f()}if(!this.trainable){var a,i=[],o=m(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,(0,H.Z)(s.trainableWeights))}}catch(h6){o.e(h6)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=m(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=m(s.weights);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(null!=r[c.originalName])throw new IM("Duplicate weight name: ".concat(c.originalName));r[c.originalName]=c,a++}}catch(h6){u.e(h6)}finally{u.f()}}}catch(h6){i.e(h6)}finally{i.f()}var l=[];for(var h in e){var f=h;if(null==r[h]){var d=h.split("/"),p=d.slice(0,-2).concat([d[d.length-1]]);f=p.join("/")}if(null!=r[f])l.push([r[f],e[h]]);else if(n)throw new IM("Provided weight data has no target variable: ".concat(h));delete r[f]}if(n){var v=[];for(var g in r)v.push(g);if(v.length>0)throw new IM("".concat(v.length," of ").concat(a," weights are not set: ")+"".concat(v))}dz(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(_B),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=RB(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return eA((function(){e=_M(e);for(var r=new xz,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return Sz(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return eA((function(){var r;return e=_M(e),r=null==t?TM(null,e.length):_M(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=oz(e);if(t.length!==this.inputLayers.length)throw new IM("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(zM);if(o.length>1){var s,u=m(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,h=m(this.nodesByDepth[l]);try{for(h.s();!(c=h.n()).done;){var f=c.value,d=f.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(d.id)){for(var p=[],v=0;v<f.inboundLayers.length;v++){var g=f.inboundLayers[v],y=f.nodeIndices[v],b=f.tensorIndices[v],k=n["".concat(g.name,"_").concat(y,"_").concat(b)];p.push(k)}for(var V=oz(d.computeOutputShape(RM(p))),x=d.inboundNodes.indexOf(f),w=0;w<V.length;w++){n["".concat(d.name,"_").concat(x,"_").concat(w)]=V[w]}}}}catch(h6){h.e(h6)}finally{h.f()}}}catch(h6){u.e(h6)}finally{u.f()}}for(var I=[],S=[],C=0;C<this.outputLayers.length;C++){var E=this.outputLayers[C],T=this.outputLayersNodeIndices[C],N=this.outputLayersTensorIndices[C],A="".concat(E.name,"_").concat(T,"_").concat(N);S.push(A)}for(var R=0;R<S.length;R++){var _=S[R];NM(_ in n),I.push(n[_])}return RM(I)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=TM(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],o=t[r];n[a.id]=[i,o]}var s,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(zM),c=m(u);try{for(c.s();!(s=c.n()).done;){var h,f=s.value,d=m(this.nodesByDepth[f]);try{for(d.s();!(h=d.n()).done;){var p,v=h.value,g=v.outboundLayer,y=v.inputTensors,b=v.outputTensors,k=new Array,V=m(y);try{for(V.s();!(p=V.n()).done;){var x=p.value;x.id in n&&k.push(n[x.id])}}catch(h6){V.e(h6)}finally{V.f()}if(k.length===y.length){var w={},I=void 0,S=void 0,C=void 0,E=void 0;if(null!=v.callArgs&&(w=v.callArgs),1===k.length){var T=(0,l.Z)(k[0],2),N=T[0],A=T[1];null==w.mask&&(w.mask=A),C=_M(g.call(N,w)),E=_M(g.computeMask(N,A)),I=[N],S=[A]}else I=k.map((function(e){return e[0]})),S=k.map((function(e){return e[1]})),null==w.mask&&(w.mask=S),C=_M(g.call(I,w)),E=_M(g.computeMask(I,S));if(g.activityRegularizer)throw new SM("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var R=0;R<b.length;++R){var _=b[R],D=C[R],F=E[R];n[_.id]=[D,F]}}}}catch(h6){d.e(h6)}finally{d.f()}}}catch(h6){c.e(h6)}finally{c.f()}var O,L=[],M=[],P=[],z=m(this.outputs);try{for(z.s();!(O=z.n()).done;){var B=O.value;NM(B.id in n,"Could not compute output ".concat(B.name," : ").concat(B.id));var U=(0,l.Z)(n[B.id],2),W=U[0],j=U[1];P.push(W.shape),L.push(W),M.push(j)}}catch(h6){z.e(h6)}finally{z.f()}return[L,M,P]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=m(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch(h6){i.e(h6)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new IM("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new IM("Provide either a layer name or layer index");var n,r=m(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch(h6){r.e(h6)}finally{r.f()}throw new IM("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return eA((function(){var t,r=[],a=m(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,(0,H.Z)(i.calculateLosses()))}}catch(h6){a.e(h6)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=m(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var h=o.inboundNodes[l],f=n.nodeKey(o,l),d={};if(this.containerNodes.has(f)){if(h.callArgs)try{JSON.stringify(h.callArgs),d=h.callArgs}catch(h6){console.warn("Layer ".concat(o.name," was passed ")+"non-serializable keyword arguments: "+"".concat(h.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),d={}}if(h.inboundLayers.length>0){for(var p=[],v=0;v<h.inboundLayers.length;v++){var g=h.inboundLayers[v],y=h.nodeIndices[v],b=h.tensorIndices[v],k=r[n.nodeKey(g,y)];null==k&&(k=0),p.push([g.name,k,b,d])}c.push(p)}}}var V={};V.name=o.name,V.className=s,V.config=u,V.inboundNodes=c,a.push(V)}}catch(h6){i.e(h6)}finally{i.f()}t.layers=a;for(var x=[],w=0;w<this.inputLayers.length;w++){var I=this.inputLayers[w],S=this.inputLayersNodeIndices[w],C=n.nodeKey(I,S);if(this.containerNodes.has(C)){var E=r[C];null!==E&&void 0!==E||(E=0);var T=this.inputLayersTensorIndices[w];x.push([I.name,E,T])}}t.inputLayers=x;for(var N=[],A=0;A<this.outputLayers.length;A++){var R=this.outputLayers[A],_=this.outputLayersNodeIndices[A],D=n.nodeKey(R,_);if(this.containerNodes.has(D)){var F=r[D];null!==F&&void 0!==F||(F=0);var O=this.outputLayersTensorIndices[A];N.push([R.name,F,O])}}return t.outputLayers=N,t}},{key:"stateful",get:function(){if(this._stateful)throw new IM("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=m(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch(h6){t.e(h6)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;eA((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=m(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],h=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var f=r[c];if(f.inboundNodes.length<=l)return void i(e,t);var d=f.inboundNodes[l];o.push(d.outputTensors[h])}}catch(h6){s.e(h6)}finally{s.f()}o.length>0&&e.apply(RM(o),n)}function s(e){var a=e.name,o=Yz(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new IM("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,h=m(l);try{for(h.s();!(u=h.n()).done;){var f=u.value;s(f)}}catch(h6){h.e(h6)}finally{h.f()}for(;!UM(a);){var d,p=m(l);try{for(p.s();!(d=p.n()).done;){var v=d.value,g=r[v.name];if(g.name in a){var y=a[g.name];delete a[g.name];var b,k=m(y);try{for(k.s();!(b=k.n()).done;){var V=b.value;o(g,V)}}catch(h6){k.e(h6)}finally{k.f()}}}}catch(h6){p.e(h6)}finally{p.f()}}var x,w=[],I=[],S=t.inputLayers,C=m(S);try{for(C.s();!(x=C.n()).done;){var E=x.value,T=E[0],N=E[1],A=E[2];NM(T in r);var R=r[T],_=R.inboundNodes[N].outputTensors;w.push(_[A])}}catch(h6){C.e(h6)}finally{C.f()}var D,F=t.outputLayers,O=m(F);try{for(O.s();!(D=O.n()).done;){var L=D.value,M=L[0],P=L[1],z=L[2];NM(M in r);var B=r[M],U=B.inboundNodes[P].outputTensors;I.push(U[z])}}catch(h6){O.e(h6)}finally{O.f()}return new e({inputs:w,outputs:I,name:c})}}]),n}(bz);function FB(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function OB(e,t){return FB(e,t,"classWeight")}function LB(e,t,n,r){return MB.apply(this,arguments)}function MB(){return MB=c(s().mark((function e(t,n,r,a){var i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=15;break}return i=eA((function(){if(1===t.shape.length)return lN(t);if(2===t.shape.length){if(t.shape[1]>1){return hA(t,1)}if(1===t.shape[1])return TA(t,[t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),tA(i),u=[],o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");u.push(r[e])})),e.abrupt("return",c_(u,"float32"));case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e)}))),MB.apply(this,arguments)}function PB(e,t){return dR(e,t)}function zB(e,t){var n,r,a=t;n=a.xs,r=a.ys,Bx(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t)}));var i=BB("input",e.inputNames,n),o=BB("output",e.outputNames,r),s=i[0].shape[0];Bx(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")})),Bx(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){Bx(i[t].shape[0]===s,(function(){return"Batch size mismatch: input "+"".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){Bx(o[t].shape[0]===s,(function(){return"Batch size mismatch: output "+"".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},h=0;h<o.length;h++)l(h);return{xs:i,ys:o}}function BB(e,t,n){if(n instanceof xE)return[n];if(Array.isArray(n))return Bx(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=m(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new IM("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch(h6){i.e(h6)}finally{i.f()}return a}function UB(e){if(3===e.length)throw new SM("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function WB(e,t,n){return jB.apply(this,arguments)}function jB(){return jB=c(s().mark((function e(t,n,r){var a,i,o,u,c,l,h,f,d,p,v,m,g,y,b,k,V,x,w,I,S,C,E,T,N,A,R,_,D,F,O,L,M;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,Bx(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),Bx(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),Bx(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(r.epochs)})),Bx(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(r.batchesPerEpoch)})),Bx(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=8;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 8:return t.isTraining=!0,e.prev=9,(i=null!=r.validationData)&&(GB(r.validationData)?Bx(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(r.validationBatches)})):(c=UB(r.validationData),o=c.xs,u=c.ys)),l=t.makeTrainFunction(),h=t.getDedupedMetricsNames(),f=i?h.slice().concat(h.map((function(e){return"val_"+e}))):h.slice(),d=Kz(r.callbacks,r.yieldEvery),p=null==r.verbose?1:r.verbose,v=Qz(d,p,r.epochs,null,null,ZB(n,r),null,i,f),m=v.callbackList,g=v.history,m.setModel(t),t.history=g,e.next=22,m.onTrainBegin();case 22:return t.stopTraining_=!1,y=null==r.initialEpoch?0:r.initialEpoch,e.next=26,n.iterator();case 26:b=e.sent;case 27:if(!(y<r.epochs)){e.next=98;break}return k={},e.next=31,m.onEpochBegin(y);case 31:if(V=0,x=0,a){e.next=37;break}return e.next=36,n.iterator();case 36:b=e.sent;case 37:if(a&&!(V<r.batchesPerEpoch)){e.next=91;break}return e.next=40,b.next();case 40:if(w=e.sent,!a||!w.done){e.next=44;break}return console.warn("You provided `batchesPerEpoch` as "+"".concat(r.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(V," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(r.batchesPerEpoch*r.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("break",91);case 44:if(null==w.value){e.next=73;break}return I=zB(t,w.value),S=I.xs,C=I.ys,(E={}).batch=x,E.size=S[0].shape[0],e.next=51,m.onBatchBegin(x,E);case 51:if(T=[],null==r.classWeight){e.next=64;break}N=OB(r.classWeight,t.outputNames),A=0;case 55:if(!(A<N.length)){e.next=64;break}return e.t0=T,e.next=59,LB(C[A],null,N[A]);case 59:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 61:++A,e.next=55;break;case 64:for(R=S.concat(C).concat(T),_=l(R),tA(R),D=0;D<h.length;++D)F=h[D],O=_[D],E[F]=O,nA(O);return e.next=70,m.onBatchEnd(x,E);case 70:Wz(E),x++,V++;case 73:if(!(a?V>=r.batchesPerEpoch:w.done)){e.next=87;break}if(!i){e.next=86;break}if(L=void 0,!GB(r.validationData)){e.next=84;break}return e.t2=_M,e.next=80,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 80:e.t3=e.sent,L=(0,e.t2)(e.t3),e.next=85;break;case 84:L=_M(t.evaluate(o,u,{batchSize:null==r.validationBatchSize?32:r.validationBatchSize,verbose:0}));case 85:for(M=0;M<t.metricsNames.length;++M)k["val_".concat(t.metricsNames[M])]=L[M];case 86:return e.abrupt("break",91);case 87:if(!t.stopTraining_){e.next=89;break}return e.abrupt("break",91);case 89:e.next=37;break;case 91:return e.next=93,m.onEpochEnd(y,k);case 93:if(y++,!t.stopTraining_){e.next=96;break}return e.abrupt("break",98);case 96:e.next=27;break;case 98:return e.next=100,m.onTrainEnd();case 100:return e.next=102,t.history.syncData();case 102:return e.abrupt("return",t.history);case 103:return e.prev=103,t.isTraining=!1,e.finish(103);case 106:case"end":return e.stop()}}),e,null,[[9,,103,106]])}))),jB.apply(this,arguments)}function ZB(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function GB(e){return"function"===typeof e.iterator}function HB(e){return"function"===typeof e.next}function qB(e,t,n){return KB.apply(this,arguments)}function KB(){return KB=c(s().mark((function e(t,n,r){var a,i,o,u,c,l,h,f,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=6;break}throw new SM("Verbose mode is not implemented yet.");case 6:if(Bx(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(r.batches))})),!HB(n)){e.next=11;break}e.t0=n,e.next=14;break;case 11:return e.next=13,n.iterator();case 13:e.t0=e.sent;case 14:u=e.t0,c=0,l=0,h=s().mark((function e(){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.next();case 2:if(n=e.sent,o=eA((function(){return n.value&&function(){var e=zB(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),u=eA((function(){return i(s)}));if(tA(s),0===l)for(var h=0;h<u.length;++h)o.push(iA(0));for(var f=s[0].shape[0],d=function(e){var t=u[e],n=o[e];o[e]=eA((function(){return uA(o[e],dR(f,t))})),l>0&&tA(n)},p=0;p<u.length;++p)d(p);tA(u),c+=f,++l}(),o})),!n.done){e.next=7;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(r.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("return","break");case 7:case"end":return e.stop()}}),e)}));case 18:if(a&&!(l<r.batches)){e.next=25;break}return e.delegateYield(h(),"t1",20);case 20:if("break"!==e.t1){e.next=23;break}return e.abrupt("break",25);case 23:e.next=18;break;case 25:for(f=0;f<o.length;++f)d=o[f],o[f]=YA(o[f],c),tA(d);return e.abrupt("return",RM(o));case 27:case"end":return e.stop()}}),e)}))),KB.apply(this,arguments)}function XB(e){Bx(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function QB(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return xP(e,t,n-t)})):xP(e,t,n-t)}function YB(e,t){return eA((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return YB(e,t)})):AP(e,"int32"===t.dtype?t:cN(t,"int32"))}))}function JB(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function $B(e,t,n,r,a,i,o,s,u,c,l,h,f,d,p){return eU.apply(this,arguments)}function eU(){return eU=c(s().mark((function e(t,n,r,a,i,o,u,c,l,h,f,d,p,v,m){var g,y,b,k,V,x,w,I;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i&&(i=32),null==o&&(o=1),null==f&&(f=!0),null==p&&(p=0),g=!1,null!=l&&null!=h&&(g=!0),null==m){e.next=10;break}if(g=!0,null!=v){e.next=10;break}throw new IM("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 10:return null!=(y=t.checkNumSamples(r,i,v,"steps_per_epoch"))&&(b=gP(0,y)),null==u&&(u=1),k=Qz(c,u,o,p,y,v,i,g,d),V=k.callbackList,x=k.history,V.setModel(t),t.history=x,e.next=18,V.onTrainBegin();case 18:t.stopTraining_=!1,w=s().mark((function e(o){var u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,V.onEpochBegin(o);case 2:if(u={},null==v){e.next=7;break}throw new SM("stepsPerEpoch mode is not implemented yet.");case 7:return e.delegateYield(s().mark((function e(){var o,c,d,p;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("batch"!==f){e.next=4;break}throw new SM("batch shuffling is not implemneted yet");case 4:f&&Ox(b);case 5:o=c_(b),c=JB(y,i),d=s().mark((function e(f){var d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d={},e.next=3,V.onBatchBegin(f,d);case 3:return eA((function(){var e=c[f][0],s=c[f][1],p=xP(o,e,s-e);d.batch=f,d.size=s-e;for(var v=YB(r,p),m=n(v),y=0;y<a.length;++y){var b=a[y],k=m[y];d[b]=k,nA(k)}if(f===c.length-1&&g)for(var V=t.testLoop(l,h,i),x=0;x<a.length;++x){var w=a[x],I=V[x];nA(I),u["val_"+w]=I}})),e.next=6,V.onBatchEnd(f,d);case 6:if(Wz(d),!t.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),p=0;case 9:if(!(p<c.length)){e.next=17;break}return e.delegateYield(d(p),"t0",11);case 11:if("break"!==e.t0){e.next=14;break}return e.abrupt("break",17);case 14:++p,e.next=9;break;case 17:o.dispose();case 18:case"end":return e.stop()}}),e)}))(),"t0",8);case 8:return e.next=10,V.onEpochEnd(o,u);case 10:if(!t.stopTraining_){e.next=12;break}return e.abrupt("return","break");case 12:case"end":return e.stop()}}),e)})),I=p;case 21:if(!(I<o)){e.next=29;break}return e.delegateYield(w(I),"t0",23);case 23:if("break"!==e.t0){e.next=26;break}return e.abrupt("break",29);case 26:++I,e.next=21;break;case 29:return e.next=31,V.onTrainEnd();case 31:return e.next=33,t.history.syncData();case 33:return e.abrupt("return",t.history);case 34:case"end":return e.stop()}}),e)}))),eU.apply(this,arguments)}function tU(e,t,n){return nU.apply(this,arguments)}function nU(){return nU=c(s().mark((function e(t,n,r){var a,i,o,u,c,l,h,f,d,p,v,m,g,y,b,k,V,x,w,I,S,C,E,T,N,A,R=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=R.length>3&&void 0!==R[3]?R[3]:{},!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,XB(v=null==a.batchSize?32:a.batchSize),m=!1,e.next=10,t.standardizeUserData(n,r,a.sampleWeight,a.classWeight,m,v);case 10:if(g=e.sent,i=g[0],o=g[1],p=g[2],y=!1,!(null!=a.validationData&&a.validationData.length>0)){e.next=36;break}if(y=!0,2!==a.validationData.length){e.next=22;break}l=a.validationData[0],h=a.validationData[1],e.next=27;break;case 22:if(3!==a.validationData.length){e.next=26;break}throw new SM("validationData including sample weights is not supported yet.");case 26:throw new IM("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(a.validationData," is invalid."));case 27:return k=!0,e.next=30,t.standardizeUserData(l,h,null,null,k,v);case 30:V=e.sent,f=V[0],d=V[1],b=f.concat(d),e.next=37;break;case 36:null!=a.validationSplit&&a.validationSplit>0&&a.validationSplit<1?(y=!0,x=Math.floor(i[0].shape[0]*(1-a.validationSplit)),w=i[0].shape[0],f=QB(i,x,w),u=i,i=QB(i,0,x),d=QB(o,x,w),c=o,o=QB(o,0,x),b=f.concat(d)):null!=a.validationSteps&&(y=!0);case 37:return I=i.concat(o).concat(p),t.checkTrainableWeightsConsistency(),S=t.makeTrainFunction(),C=t.getDedupedMetricsNames(),y?(t.makeTestFunction(),E=t.testFunction,T=C.slice().concat(C.map((function(e){return"val_"+e})))):(E=null,b=[],T=C.slice()),N=Kz(a.callbacks,a.yieldEvery),e.next=45,$B(t,S,I,C,v,a.epochs,a.verbose,N,E,b,a.shuffle,T,a.initialEpoch,null,null);case 45:return A=e.sent,e.abrupt("return",A);case 47:return e.prev=47,t.isTraining=!1,aU(i,n),aU(o,r),aU(u,n),aU(c,r),aU(f,l),aU(d,h),null!=p&&tA(p),e.finish(47);case 57:case"end":return e.stop()}}),e,null,[[4,,47,57]])}))),nU.apply(this,arguments)}function rU(e){var t=[];e instanceof xE&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(kP(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function aU(e,t){if(null!=e){var n=[];if(t instanceof xE)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof xE)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function iU(e){return Array.isArray(e)}function oU(e){return!function(e){return e instanceof xE}(e)&&!iU(e)}function sU(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(iU(e)&&e.length>0)o=!0;else if(oU(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new IM("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(oU(e)){r=[];var u,c=m(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new IM('No data provided for "'.concat(l,'". Need data for each key in: ')+"".concat(t));r.push(e[l])}}catch(h6){c.e(h6)}finally{c.f()}}else if(iU(e)){if(e.length!==t.length)throw new IM("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(t.length>1)throw new IM("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=rU(r),null!=n)for(var h=0;h<t.length;++h)if(null!=n[h]){var f=r[h];if(f.shape.length!==n[h].length)throw new IM("Error when checking ".concat(i,": expected ").concat(t[h]," ")+"to have ".concat(n[h].length," dimension(s). but got array with ")+"shape ".concat(f.shape));for(var d=0;d<n[h].length;++d)if(0!==d||a){var p=f.shape[d],v=n[h][d];if(null!=v&&v>=0&&p!==v)throw new IM("".concat(i," expected a batch of elements where each ")+"example has shape [".concat(n[h].slice(1,n[h].length),"] ")+"(i.e.,tensor shape [*,".concat(n[h].slice(1,n[h].length),"])")+" but the ".concat(i," received an input with ").concat(f.shape[0])+" examples, each with shape [".concat(f.shape.slice(1,f.shape.length),"]")+" (tensor shape [".concat(f.shape,"])"))}}return r}function uU(e,t,n){var r=BM(e.map((function(e){return e.shape[0]})));r.sort();var a=BM(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new IM("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new IM("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!Gx(r,a))throw new IM("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}function cU(e,t,n){for(var r=[$z,iB,rB],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===rB&&1===i.shape[i.shape.length-1])throw new IM("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var h=u[l],f=c[l];if(null!=f&&h!==f)throw new IM("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function lU(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new IM("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new IM("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new IM("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new IM("Error when checking ".concat(i,": expected ")+"".concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}var hU=function(e){b(r,e);var n=w(r);function r(e){var t;return f(this,r),(t=n.call(this,e)).isTraining=!1,t}return p(r,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new IM("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");wB(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return HD.adagrad(.01)},Adadelta:function(){return HD.adadelta(1,.95,yP())},Adam:function(){return HD.adam(.001,.9,.999,yP())},Adamax:function(){return HD.adamax(.002,.9,.999,yP(),0)},RMSProp:function(){return HD.rmsprop(.001,.9,0,yP())},SGD:function(){return HD.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new IM("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof oA))throw new IM("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new IM("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));var r=e.loss;n=r.map((function(e){return cB(e)}))}else{var a=cB(e.loss);this.outputs.forEach((function(e){n.push(a)}))}else{for(var i in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(i))throw new IM('Unknown entry in loss dictionary: "'.concat(i,'". ')+"Only expected the following keys: ".concat(this.outputNames));var o,s=m(this.outputNames);try{for(s.s();!(o=s.n()).done;){var u=o.value;null==e.loss[u]&&console.warn('Output "'.concat(u,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(u," during training")),n.push(cB(e.loss[u]))}}catch(h6){s.e(h6)}finally{s.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var c=0;c<this.outputs.length;++c){var l=this.internalOutputShapes[c],h=this.outputNames[c];this.feedOutputNames.push(h),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[c])}var f=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],sP("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===f.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var d=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=m(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch(h6){i.e(h6)}finally{i.f()}return a}(e.metrics,this.outputNames),p=function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])};sP("metric",(function(){for(var e=function(e){if(-1!==f.indexOf(e))return"continue";!function(n){var r,a,i,o,s=m(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"===typeof u&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(u)){var c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===iB?-1!==["accuracy","acc"].indexOf(u)?a=lB:-1!==["crossentropy","ce"].indexOf(u)&&(a=dB):t.lossFunctions[e]===aB?-1!==["accuracy","acc"].indexOf(u)?a=pB:-1!==["crossentropy","ce"].indexOf(u)&&(a=mB):-1!==["accuracy","acc"].indexOf(u)?a=hB:-1!==["crossentropy","ce"].indexOf(u)&&(a=vB);var l=void 0;-1!==["accuracy","acc"].indexOf(u)?l="acc":-1!==["crossentropy","ce"].indexOf(u)&&(l="ce"),i=a,r=""+l}else{var h=yB(u);i=h,r=""+bB(u)}var f=void 0;sP(r,(function(){f=i})),p(e,r,f)}}catch(h6){s.e(h6)}finally{s.f()}}(d[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;XB(r);var a=!0,i=this.standardizeUserDataXY(e,t,a,r);try{var o=i[0].concat(i[1]);this.makeTestFunction();var s=this.testFunction,u=this.testLoop(s,o,r,n.verbose,n.steps);return RM(u)}finally{aU(i[0],e),aU(i[1],t)}}},{key:"evaluateDataset",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.makeTestFunction(),e.abrupt("return",qB(this,t,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new IM("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new IM("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new IM("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new xz;if(e instanceof xE&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new IM("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=m(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=e[c.name];if(null==l)throw new IM("No value is provided for the model's input ".concat(c.name));i.add(c,l)}}catch(h6){u.e(h6)}finally{u.f()}}var h=Sz(a,i);return n?h:h[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=TM(null,e.length),r=e.length,a=m(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch(h6){a.e(h6)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new IM("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return eA((function(){var a=t.checkNumSamples(e);if(r)throw new SM("Verbose predictLoop() is not implemented yet.");for(var i=JB(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){eA((function(){var r=i[n][0],a=i[n][1],o=QB(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new xz(s);return Sz(t.outputs,c)})).forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return RM(o.map((function(e){return MA(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=rU(e);lU(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return XB(r),this.predictLoop(n,r)}finally{aU(n,e)}}},{key:"predictOnBatch",value:function(e){lU(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new wM("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a],o=this.feedLossFns[a];o===aB?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(uU(e=sU(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=sU(t,this.feedOutputNames,r,!1,"target")),cU(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new IM("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=c(s().mark((function e(t,n,r,a){var i,o,u,c,h,f,d,p,v,m=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(m.length>4&&void 0!==m[4])||m[4],o=m.length>5?m[5]:void 0,u=this.standardizeUserDataXY(t,n,i,o),c=(0,l.Z)(u,2),h=c[0],f=c[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(d=null,null==a){e.next=19;break}p=OB(a,this.outputNames),d=[],v=0;case 10:if(!(v<p.length)){e.next=19;break}return e.t0=d,e.next=14,LB(f[v],null,p[v]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++v,e.next=10;break;case 19:return e.abrupt("return",[h,f,d]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return eA((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new SM("Verbose mode is not implemented yet.");if(null!=i)throw new SM("steps mode in testLoop() is not implemented yet");for(var u=JB(o,n),c=c_(gP(0,o)),l=0;l<u.length;++l){var h=u[l][0],f=u[l][1],d=xP(c,h,f-h),p=YB(t,d),v=e(p);if(0===l)for(var m=0;m<v.length;++m)s.push(iA(0));for(var g=0;g<v.length;++g){var y=v[g];s[g]=uA(s[g],dR(f-h,y))}}for(var b=0;b<s.length;++b)s[b]=YA(s[b],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(AM(e,r)>1){var i=AM(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()}));return[e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new xz(t),l=Sz(e.outputs,c,{training:!0}),h=0;h<e.lossFunctions.length;++h){var f=(0,e.lossFunctions[h])(a[h],l[h]);null!=i[h]&&(f=PB(f,i[h]));var d=xR(f);n.push(d),u=0===h?f:uA(u,f)}for(var p=0;p<e.metricsTensors.length;++p){var v=void 0;if(e.outputs.length>1&&p<e.outputs.length)v=n[p];else{var m=e.metricsTensors[p][0],g=e.metricsTensors[p][1];v=xR(m(a[g],l[g]))}nA(v),o.push(v)}return u=xR(u),e.calculateLosses().forEach((function(e){u=uA(u,e)})),u}),!0,s)].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return eA((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new xz(o),c=Sz(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var h=e.lossFunctions[l],f=xR(h(i[l],c[l]));n=0===l?f:uA(n,f),r.push(n)}for(var d=0;d<e.metricsTensors.length;++d){var p=e.metricsTensors[d][0],v=e.metricsTensors[d][1],m=xR(p(i[v],c[v]));r.push(m)}return r}))}}},{key:"fit",value:function(){var e=c(s().mark((function e(t,n){var r,a=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",tU(this,t,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",WB(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=c(s().mark((function e(t,n){var r,a,i,o,u,c,l,h,f,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction(),u=o(a.concat(i)),c=[],l=m(u),e.prev=9,l.s();case 11:if((h=l.n()).done){e.next=19;break}return f=h.value,e.next=15,f.data();case 15:d=e.sent,c.push(d[0]);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),l.e(e.t0);case 24:return e.prev=24,l.f(),e.finish(24);case 27:return tA(u),aU(r[0],t),aU(r[1],n),e.abrupt("return",RM(c));case 31:case"end":return e.stop()}}),e,this,[[9,21,24,27]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=kt(k(r.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=$N().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-$N().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"===typeof this.loss)e=DM(this.loss);else if(Array.isArray(this.loss)){var t,n=m(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!==typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch(h6){n.e(h6)}finally{n.f()}e=this.loss.map((function(e){return DM(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!==typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=DM(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[DM(bB(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return DM(bB(e))}));var e={};for(var t in this.metrics)e[t]=DM(bB(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=Yz(AB(e.optimizer_config));if("string"===typeof e.loss)t=FM(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return FM(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=FM(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return FM(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=FM(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var e=c(s().mark((function e(n,r){var a,i,o,u,c,l,h,f,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof n){e.next=9;break}if(0!==(a=xT(n)).length){e.next=6;break}throw new IM("Cannot find any save handlers for URL '".concat(n,"'"));case 6:if(!(a.length>1)){e.next=8;break}throw new IM("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(n,"'"));case 8:n=a[0];case 9:if(null!=n.save){e.next=11;break}throw new IM("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return e.next=13,aT(this.getNamedWeights(r));case 13:if(i=e.sent,!1,null,o=this.toJSON(null,false),u={modelTopology:o,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(_B),convertedBy:null},!(null!=r&&r.includeOptimizer)||null==this.optimizer){e.next=34;break}return u.trainingConfig=this.getTrainingConfig(),l="optimizer",e.t0=t,e.next=25,this.optimizer.getWeights();case 25:return e.t1=e.sent,e.t2=l,e.next=29,e.t0.encodeWeights.call(e.t0,e.t1,e.t2);case 29:h=e.sent,f=h.data,d=h.specs,(c=i.specs).push.apply(c,(0,H.Z)(d)),i.data=fT([i.data,f]);case 34:return null!=this.userDefinedMetadata&&(!0,VB(this.userDefinedMetadata,this.name,true),u.userDefinedMetadata=this.userDefinedMetadata),u.weightData=i.data,u.weightSpecs=i.specs,e.abrupt("return",n.save(u));case 38:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){VB(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),r}(DB);hU.className="Model",YN(hU);var fU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n)}(hU);function dU(){return(dU=c(s().mark((function e(t,n){var r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),"string"!==typeof t){e.next=10;break}if(0!==(r=wT(t,n)).length){e.next=7;break}r.push(EN(t,n)),e.next=9;break;case 7:if(!(r.length>1)){e.next=9;break}throw new IM("Found more than one (".concat(r.length,") load handlers for ")+"URL '".concat(t,"'"));case 9:t=r[0];case 10:return e.abrupt("return",pU(t,void 0,n));case 11:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pU(e,t,n){return vU.apply(this,arguments)}function vU(){return vU=c(s().mark((function e(t,n,r){var a,i,o,u,c,l,h,f,d;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==r&&(r={}),null!=t.load){e.next=3;break}throw new IM("Cannot proceed with model loading because the IOHandler provided does not have the `load` method implemented.");case 3:return e.next=5,t.load();case 5:if(a=e.sent,null!=(i=a.modelTopology).model_config&&(i=i.model_config),o=null==r.strict||r.strict,u=null!=a.weightData&&null!=a.weightSpecs&&o,c=Yz(AB(i),n,u),null!=(l=a.trainingConfig)&&c.loadTrainingConfig(l),null!=a.userDefinedMetadata&&c.setUserDefinedMetadata(a.userDefinedMetadata),null==a.weightData){e.next=24;break}if(null!=a.weightSpecs){e.next=17;break}throw new IM("LayersModel artifacts contains weight data, but not weight specs. Therefore loading of weights cannot proceed.");case 17:if(h=mU(a.weightData,a.weightSpecs),f=h.modelWeights,d=h.optimizerWeights,c.loadWeights(f,o),!(null!=c.optimizer&&d.length>0)){e.next=22;break}return e.next=22,c.optimizer.setWeights(d);case 22:tA(f),tA(d.map((function(e){return e.tensor})));case 24:return e.abrupt("return",c);case 25:case"end":return e.stop()}}),e)}))),vU.apply(this,arguments)}function mU(e,t){var n=oT(e,t),r={},a=[];return t.forEach((function(e){"optimizer"===e.group?a.push({name:e.name,tensor:n[e.name]}):r[e.name]=n[e.name]})),{modelWeights:r,optimizerWeights:a}}fU.className="Functional",YN(fU);var gU=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:QM("sequential_"),null!=e.layers){var a,i=m(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch(h6){i.e(h6)}finally{i.f()}}return r}return p(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new IM("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof hU;if(r){if(1!==(t=e).outputs.length)throw new IM("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new IM("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new IM("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new IM("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new Vz({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new IM("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new IM("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=kz(this.outputs[0])}this.inboundNodes=[],new gz({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:TM(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(uz(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new hU({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),kt(k(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),kt(k(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new wM("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new wM("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=c(s().mark((function e(t,n){var r,a=arguments;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new wM("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new wM("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=c(s().mark((function e(t,n){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new IM("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new IM("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=m(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch(h6){n.e(h6)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new IM("Legacy serialization format not supported yet.");r=t}else Bx(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new SM("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=m(r);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=void 0,h=Yz(c,l,a);a&&h.setFastWeightInitDuringBuild(!0),o.add(h)}}catch(h6){u.e(h6)}finally{u.f()}return o}}]),n}(hU);function yU(e,t){return null==t&&(t={}),function(e,t){return dU.apply(this,arguments)}(e,t)}gU.className="Sequential",YN(gU);var bU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"getConfig",value:function(){return{}}}]),n}(XN),kU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return FP(e,t)}}]),n}(bU);kU.className="elu",YN(kU);var VU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){return KR(e)}}]),n}(bU);VU.className="selu",YN(VU);var xU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){return HR(e)}}]),n}(bU);xU.className="relu",YN(xU);var wU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){return eA((function(){return wR(6,HR(e))}))}}]),n}(bU);wU.className="relu6",YN(wU);var IU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){return e}}]),n}(bU);IU.className="linear",YN(IU);var SU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){return QR(e)}}]),n}(bU);SU.className="sigmoid",YN(SU);var CU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){return function(e){return eA((function(){var t=uA(.5,dR(.2,e));return LA(t,0,1)}))}(e)}}]),n}(bU);CU.className="hardSigmoid",YN(CU);var EU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){return r_(e)}}]),n}(bU);EU.className="softplus",YN(EU);var TU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){return function(e){return eA((function(){return YA(e,uA(sA(e),1))}))}(e)}}]),n}(bU);TU.className="softsign",YN(TU);var NU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){return u_(e)}}]),n}(bU);NU.className="tanh",YN(NU);var AU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n_(e,t)}}]),n}(bU);AU.className="softmax",YN(AU);var RU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return mR(e,t)}}]),n}(bU);RU.className="logSoftmax",YN(RU);var _U=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return eA((function(){return dR(QR(dR(e,t)),e)}))}}]),n}(bU);_U.className="swish",YN(_U);var DU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e){return eA((function(){return dR(e,u_(r_(e)))}))}}]),n}(bU);function FU(e){return e.getClassName()}function OU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return PM(e,QN.getMap().classNameMap,t,"activation")}function LU(e){if(null==e){var t={className:"linear",config:{}};return OU(t)}if("string"===typeof e){var n={};return n.className=e,n.config={},OU(n)}return e instanceof bU?e:OU(e)}function MU(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}DU.className="mish",YN(DU);var PU=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n)}(XN),zU=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),r=t.call(this),MU(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return p(n,[{key:"apply",value:function(e){var t=this;return eA((function(){var n=LR([1]);return t.hasL1&&(n=uA(n,vR(dR(t.l1,sA(e))))),t.hasL2&&(n=uA(n,vR(dR(t.l2,RP(e))))),TA(n,[])}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(PU);zU.className="L1L2",YN(zU);var BU={l1l2:"L1L2"};function UU(e){return LM(e)}function WU(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return PM(e,QN.getMap().classNameMap,t,"regularizer")}function jU(e){return null==e?null:"string"===typeof e?WU({className:e in BU?BU[e]:e,config:{}}):e instanceof PU?e:WU(e)}var ZU=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return p(n,[{key:"call",value:function(e,t){e=sz(e);var n=HR(e);return null!=this.maxValue&&(n=LA(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);ZU.className="ReLU",YN(ZU);var GU=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return p(n,[{key:"call",value:function(e,t){var n=sz(e);return cR(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);GU.className="LeakyReLU",YN(GU);var HU=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=az(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=jU(e.alphaRegularizer),r.alphaConstraint=zz(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new IM("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return r}return p(n,[{key:"build",value:function(e){var t=(e=uz(e)).slice(1);if(null!=this.sharedAxes){var n,r=m(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch(h6){r.e(h6)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new pz({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=sz(e),BR(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:rz(this.alphaInitializer),alphaRegularizer:UU(this.alphaRegularizer),alphaConstraint:Mz(this.alphaConstraint),sharedAxes:this.sharedAxes},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);HU.className="PReLU",YN(HU);var qU=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new SM("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return p(n,[{key:"call",value:function(e,t){var n=sz(e);return JA(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);qU.className="ELU",YN(qU);var KU=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return p(n,[{key:"call",value:function(e,t){var n=sz(e);return dR(n,cN(sR(n,this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);KU.className="ThresholdedReLU",YN(KU);var XU=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new AU).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return p(n,[{key:"call",value:function(e,t){var n=sz(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);function QU(e,t,n){if("number"===typeof e)return TM(e,t);if(e.length!==t)throw new IM("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if(!dP(a))throw new IM("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e}function YU(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(null==e)return e;var i,o=t+(t-1)*(a-1);return i="same"===n?e:e-o+1,Math.floor((i+r-1)/r)}function JU(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+mP([n-t,0]);else{if("same"!==r)throw new IM("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function $U(e,t){return eA((function(){return rP(t),"channelsFirst"===t?g_(e,[0,2,3,1]):e}))}function eW(e,t){return eA((function(){return rP(t),"channelsFirst"===t?g_(e,[0,2,3,4,1]):e}))}function tW(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return eA((function(){if(null==i&&(i="channelsLast"),rP(i),3!==e.shape.length)throw new IM("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new IM("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new IM("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=g_(e,[0,2,1])),"causal"===a)throw new SM("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=jA(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=DP(s,n)),s}))}function nW(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return eA((function(){if(null==i&&(i="channelsLast"),rP(i),3!==e.rank&&4!==e.rank)throw new IM("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new IM("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));var u=$U(e,i);if("causal"===a)throw new SM("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=A_({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=g_(u,[0,3,1,2])),u}))}function rW(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return eA((function(){if(null==i&&(i="channelsLast"),rP(i),4!==e.rank&&5!==e.rank)throw new IM("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new IM("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));var s=eW(e,i);if("causal"===a)throw new SM("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=HA(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=DP(s,n)),"channelsFirst"===i&&(s=g_(s,[0,4,1,2,3])),s}))}XU.className="Softmax",YN(XU);var aW=function(e){b(n,e);var t=w(n);function n(e,r){var a;if(f(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,ZM(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new SM("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=QU(r.kernelSize,e,"kernelSize"),a.strides=QU(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,aP(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,rP(a.dataFormat),a.activation=LU(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=az(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=zz(r.biasConstraint),a.biasRegularizer=jU(r.biasRegularizer),a.activityRegularizer=jU(r.activityRegularizer),a.dilationRate=QU(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new IM("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new IM("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new IM("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)));return a}return p(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:FU(this.activation),useBias:this.useBias,biasInitializer:rz(this.biasInitializer),biasRegularizer:UU(this.biasRegularizer),activityRegularizer:UU(this.activityRegularizer),biasConstraint:Mz(this.biasConstraint)},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(NM("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!jM(e.kernelSize,"number",1,3))throw new IM("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(bz),iW=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,ZM(a.filters,"filters"),a.kernelInitializer=az(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=zz(r.kernelConstraint),a.kernelRegularizer=jU(r.kernelRegularizer),a}return p(n,[{key:"build",value:function(e){e=uz(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new IM("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:(0,h.Z)({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return eA((function(){var t;e=sz(e);var r=null==n.bias?null:n.bias.read(),a=HM(n.activation.getClassName());if(null!=a&&2===n.rank)t=nW(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=tW(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=nW(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new SM("convolutions greater than 3D are not implemented yet.");t=rW(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=uz(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=YU(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:rz(this.kernelInitializer),kernelRegularizer:UU(this.kernelRegularizer),kernelConstraint:Mz(this.kernelConstraint)},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new IM("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}]),n}(aW),oW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return p(n,[{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!jM(e.kernelSize,"number",1,2))throw new IM("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(iW);oW.className="Conv2D",YN(oW);var sW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return p(n,[{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new IM("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(iW);sW.className="Conv3D",YN(sW);var uW=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),(r=t.call(this,e)).inputSpec=[new pz({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new IM("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return p(n,[{key:"build",value:function(e){if(4!==(e=uz(e)).length)throw new IM("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new IM("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new pz({ndim:4,axes:(0,h.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return eA((function(){var t=sz(e);if(4!==t.shape.length)throw new IM("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],l=n.kernelSize[1],h=n.strides[0],f=n.strides[1],d=[o,JU(s,h,c,n.padding),JU(u,f,l,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=g_(t,[0,2,3,1]));var p=GA(t,n.kernel.read(),d,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(p=g_(p,[0,3,1,2])),null!=n.bias&&(p=DP(p,n.bias.read(),n.dataFormat)),null!=n.activation&&(p=n.activation.apply(p)),p}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=uz(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=JU(a[n],s,i,this.padding),a[r]=JU(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(oW);uW.className="Conv2DTranspose",YN(uW);var cW=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),(r=t.call(this,e)).inputSpec=[new pz({ndim:5})],"same"!==r.padding&&"valid"!==r.padding)throw new IM("Conv3DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return p(n,[{key:"build",value:function(e){if(5!==(e=uz(e)).length)throw new IM("Input should have rank 5; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new IM("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new pz({ndim:5,axes:(0,h.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return eA((function(){var t=sz(e);if(5!==t.shape.length)throw new IM("Conv3DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i,o=t.shape,s=o[0];"channelsFirst"===n.dataFormat?(i=2,r=3,a=4):(i=1,r=2,a=3);var u=o[i],c=o[r],l=o[a],h=n.kernelSize[0],f=n.kernelSize[1],d=n.kernelSize[2],p=n.strides[0],v=n.strides[1],m=n.strides[2],g=[s,JU(u,p,h,n.padding),JU(c,v,f,n.padding),JU(l,m,d,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=g_(t,[0,2,3,4,1]));var y=KA(t,n.kernel.read(),g,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(y=g_(y,[0,4,1,2,3])),null!==n.bias&&(y=DP(y,n.bias.read(),n.dataFormat)),null!==n.activation&&(y=n.activation.apply(y)),y}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a,i=(e=uz(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3,a=4):(t=4,n=1,r=2,a=3);var o=this.kernelSize[0],s=this.kernelSize[1],u=this.kernelSize[2],c=this.strides[0],l=this.strides[1],h=this.strides[2];return i[t]=this.filters,i[n]=JU(i[n],c,o,this.padding),i[r]=JU(i[r],l,s,this.padding),i[a]=JU(i[a],h,u,this.padding),i}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(sW);cW.className="Conv3DTranspose",YN(cW);var lW=function(e){b(n,e);var t=w(n);function n(e,r){var a;if(f(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new IM("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new IM("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new IM("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=az(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=jU(r.depthwiseRegularizer),a.depthwiseConstraint=zz(r.depthwiseConstraint),a.pointwiseInitializer=az(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=jU(r.pointwiseRegularizer),a.pointwiseConstraint=zz(r.pointwiseConstraint),a}return p(n,[{key:"build",value:function(e){if((e=uz(e)).length<this.rank+2)throw new IM("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new IM("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);var o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new pz({ndim:this.rank+2,axes:(0,h.Z)({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return eA((function(){var t;if(e=sz(e),1===n.rank)throw new SM("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=g_(e,[0,2,3,1])),t=XR(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=DP(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=g_(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=rz(this.depthwiseInitializer),e.pointwiseInitializer=rz(this.pointwiseInitializer),e.depthwiseRegularizer=UU(this.depthwiseRegularizer),e.pointwiseRegularizer=UU(this.pointwiseRegularizer),e.depthwiseConstraint=Mz(this.depthwiseConstraint),e.pointwiseConstraint=Mz(this.pointwiseConstraint),e}}]),n}(iW);lW.className="SeparableConv";var hW=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,2,e)}return p(n)}(lW);hW.className="SeparableConv2D",YN(hW);var fW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return p(n,[{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!jM(e.kernelSize,"number",1,1))throw new IM("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(iW);fW.className="Conv1D",YN(fW);var dW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),r=t.call(this,e),"number"===typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return p(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return eA((function(){if(e=sz(e),"channelsLast"===n.dataFormat){var t=IP(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return IP(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=IP(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return IP(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);dW.className="Cropping2D",YN(dW);var pW=function(e){b(n,e);var t=w(n);function n(e){var r,a;return f(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,rP(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,a=r.interpolation,WM(JM,"InterpolationFormat",a),r}return p(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return eA((function(){var t=sz(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=g_(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?OD.resizeNearestNeighbor(t,[a,i]):OD.resizeBilinear(t,[a,i]);return g_(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?OD.resizeNearestNeighbor(t,[s,u]):OD.resizeBilinear(t,[s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat,interpolation:this.interpolation},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);pW.className="UpSampling2D",YN(pW);var vW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=az(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=zz(e.depthwiseConstraint),r.depthwiseRegularizer=jU(e.depthwiseRegularizer),r}return p(n,[{key:"build",value:function(e){if((e=uz(e)).length<4)throw new IM("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new IM("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return eA((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return eA((function(){null==a&&(a="channelsLast"),rP(a);var o=$U(e,a);if(4!==e.rank)throw new IM("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new IM("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return o=XA(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=g_(o,[0,3,1,2])),o}))}(e=sz(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=DP(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=uz(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=YU(t,this.kernelSize[0],this.padding,this.strides[0]),i=YU(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=rz(this.depthwiseInitializer),e.depthwiseRegularizer=UU(this.depthwiseRegularizer),e.depthwiseConstraint=Mz(this.depthwiseRegularizer),e}}]),n}(aW);function mW(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new IM("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function gW(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return eA((function(){var u=t.shape.length;if(u<3)throw new IM("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(gP(2,u));if(t=g_(t,c),null!=i)throw new SM("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=cN(cN(a,"bool"),"float32")).rank===u-1&&(a=tR(a,-1)),a=g_(a,c)),r&&(t=qR(t,0),null!=a&&(a=qR(a,0)));var l,h,f=[],d=n,p=t.shape[0],v=h_(t);null!=a&&(h=h_(a));for(var m,g=function(t){var n=v[t],r=eA((function(){return e(n,d)}));if(null==a)l=r[0],d=r[1];else{var i=eA((function(){var e=h[t],n=pR(PR(e),e);return{output:uA(dR(r[0],e),dR(d[0],n)),newStates:d.map((function(t,a){return uA(dR(r[1][a],e),dR(t,n))}))}}));l=i.output,d=i.newStates}s&&f.push(l)},y=0;y<p;++y)g(y);if(s){m=s_(f,1)}return[l,m,d]}))}vW.className="DepthwiseConv2D",YN(vW);var yW=function(e){b(n,e);var t=w(n);function n(e){var r,a;if(f(this,n),r=t.call(this,e),null==e.cell)throw new IM("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new CW({cells:e.cell}):e.cell).stateSize)throw new IM("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new pz({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return p(n,[{key:"getStates",value:function(){return null==this.states_?gP(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){iz(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=m(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch(h6){o.e(h6)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return eA((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new SM("Constants support is not implemented in RNN yet.");iz(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new pz({shape:[t,null].concat((0,H.Z)(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!Gx(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new IM("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new pz({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];eA((function(){if(!t.stateful)throw new xM("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new IM("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return LR([r,e])})):t.states_=[LR([r,t.cell.stateSize])];else if(null==e)tA(t.states_),null!=t.keptStates&&(tA(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return LR([r,e])})):t.states_[0]=LR([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new IM("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===n?t.keptStates.push(t.states_.slice()):tA(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!Gx(i.shape,s))throw new IM("State ".concat(a," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return nA(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=mW(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=m(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new pz({shape:l.shape}))}}catch(h6){c.e(h6)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof vz){var h=[e].concat(o),f=this.inputSpec.concat(s),d=this.inputSpec;this.inputSpec=f;var p=kt(k(n.prototype),"apply",this).call(this,h,t);return this.inputSpec=d,p}return kt(k(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return eA((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=sz(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new IM("RNN Layer has ".concat(o," state(s) but was passed ")+"".concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=gW((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],h=u[2];n.stateful&&n.resetStates(h,a);var f=n.returnSequences?l:c;return n.returnState?[f].concat(h):f}))}},{key:"getInitialState",value:function(e){var t=this;return eA((function(){var n=LR(e.shape);return n=kP(n=vR(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?EP(n,[1,e]):n})):t.cell.stateSize>1?[EP(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){kt(k(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.cell,a=Yz(r,n);return new e(Object.assign(t,{cell:a}))}}]),n}(bz);yW.className="RNN",YN(yW);var bW=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n)}(bz),kW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,ZM(r.units,"units"),r.activation=LU(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=az(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=az(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=az(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=jU(e.kernelRegularizer),r.recurrentRegularizer=jU(e.recurrentRegularizer),r.biasRegularizer=jU(e.biasRegularizer),r.kernelConstraint=zz(e.kernelConstraint),r.recurrentConstraint=zz(e.recurrentConstraint),r.biasConstraint=zz(e.biasConstraint),r.dropout=vP([1,mP([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=vP([1,mP([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return p(n,[{key:"build",value:function(e){e=uz(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return eA((function(){if(2!==e.length)throw new IM("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=EW({ones:function(){return PR(e)},rate:n.dropout,training:i,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=EW({ones:function(){return PR(r)},rate:n.recurrentDropout,training:i,dropoutFunc:n.dropoutFunc}));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=NP(null!=o?dR(e,o):e,n.kernel.read()),null!=n.bias&&(a=DP(a,n.bias.read())),null!=s&&(r=dR(r,s));var u=uA(a,NP(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:FU(this.activation),useBias:this.useBias,kernelInitializer:rz(this.kernelInitializer),recurrentInitializer:rz(this.recurrentInitializer),biasInitializer:rz(this.biasInitializer),kernelRegularizer:UU(this.kernelRegularizer),recurrentRegularizer:UU(this.recurrentRegularizer),biasRegularizer:UU(this.biasRegularizer),activityRegularizer:UU(this.activityRegularizer),kernelConstraint:Mz(this.kernelConstraint),recurrentConstraint:Mz(this.recurrentConstraint),biasConstraint:Mz(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}]),n}(bW);kW.className="SimpleRNNCell",YN(kW);var VW=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),e.cell=new kW(e),t.call(this,e)}return p(n,[{key:"call",value:function(e,t){var r=this;return eA((function(){null!=r.cell.dropoutMask&&(tA(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(tA(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return kt(k(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(yW);VW.className="SimpleRNN",YN(VW);var xW=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new IM("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,ZM(r.units,"units"),r.activation=LU(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=LU(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=az(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=az(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=az(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=jU(e.kernelRegularizer),r.recurrentRegularizer=jU(e.recurrentRegularizer),r.biasRegularizer=jU(e.biasRegularizer),r.kernelConstraint=zz(e.kernelConstraint),r.recurrentConstraint=zz(e.recurrentConstraint),r.biasConstraint=zz(e.biasConstraint),r.dropout=vP([1,mP([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=vP([1,mP([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return p(n,[{key:"build",value:function(e){var t=(e=uz(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return eA((function(){if(2!==e.length)throw new IM("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=EW({ones:function(){return PR(e)},rate:n.dropout,training:r,count:3,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=EW({ones:function(){return PR(a)},rate:n.recurrentDropout,training:r,count:3,dropoutFunc:n.dropoutFunc}));var i,o,s,u=n.dropoutMask,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=dR(e,u[0]));var h=NP(e,n.kernel.read());n.useBias&&(h=DP(h,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=dR(a,c[0]));var f=n.recurrentKernel.read(),d=a_(f,[2*n.units,n.units],f.rank-1),p=(0,l.Z)(d,2),v=p[0],m=p[1],g=NP(a,v),y=a_(h,3,h.rank-1),b=(0,l.Z)(y,3),k=b[0],V=b[1],x=b[2],w=a_(g,2,g.rank-1),I=(0,l.Z)(w,2),S=I[0],C=I[1];i=n.recurrentActivation.apply(uA(k,S)),o=n.recurrentActivation.apply(uA(V,C));var E=NP(dR(o,a),m);s=n.activation.apply(uA(x,E));var T=uA(dR(i,a),dR(uA(1,DR(i)),s));return[T,T]}))}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:FU(this.activation),recurrentActivation:FU(this.recurrentActivation),useBias:this.useBias,kernelInitializer:rz(this.kernelInitializer),recurrentInitializer:rz(this.recurrentInitializer),biasInitializer:rz(this.biasInitializer),kernelRegularizer:UU(this.kernelRegularizer),recurrentRegularizer:UU(this.recurrentRegularizer),biasRegularizer:UU(this.biasRegularizer),activityRegularizer:UU(this.activityRegularizer),kernelConstraint:Mz(this.kernelConstraint),recurrentConstraint:Mz(this.recurrentConstraint),biasConstraint:Mz(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}]),n}(bW);xW.className="GRUCell",YN(xW);var wW=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new xW(e),t.call(this,e)}return p(n,[{key:"call",value:function(e,t){var r=this;return eA((function(){null!=r.cell.dropoutMask&&(tA(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(tA(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return kt(k(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(yW);wW.className="GRU",YN(wW);var IW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,ZM(r.units,"units"),r.activation=LU(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=LU(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=az(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=az(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=az(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=jU(e.kernelRegularizer),r.recurrentRegularizer=jU(e.recurrentRegularizer),r.biasRegularizer=jU(e.biasRegularizer),r.kernelConstraint=zz(e.kernelConstraint),r.recurrentConstraint=zz(e.recurrentConstraint),r.biasConstraint=zz(e.biasConstraint),r.dropout=vP([1,mP([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=vP([1,mP([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.dropoutFunc=e.dropoutFunc,r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return p(n,[{key:"build",value:function(e){var t,n,r=(e=uz(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new UP).apply([i]),o=a.apply([2*i]);return CP(CP(n,r),o)}}]),n}(zP),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return eA((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new IM("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=EW({ones:function(){return PR(e)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=EW({ones:function(){return PR(a)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var o,s,u,c,h=n.dropoutMask,f=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=dR(e,h[0]));var d=NP(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=dR(a,f[0])),d=uA(d,NP(a,n.recurrentKernel.read())),n.useBias&&(d=DP(d,n.bias.read()));var p=a_(d,4,d.rank-1),v=(0,l.Z)(p,4),m=v[0],g=v[1],y=v[2],b=v[3];o=n.recurrentActivation.apply(m),s=n.recurrentActivation.apply(g),u=uA(dR(s,i),dR(o,n.activation.apply(y))),c=n.recurrentActivation.apply(b);var k=dR(c,n.activation.apply(u));return[k,k,u]}))}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:FU(this.activation),recurrentActivation:FU(this.recurrentActivation),useBias:this.useBias,kernelInitializer:rz(this.kernelInitializer),recurrentInitializer:rz(this.recurrentInitializer),biasInitializer:rz(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:UU(this.kernelRegularizer),recurrentRegularizer:UU(this.recurrentRegularizer),biasRegularizer:UU(this.biasRegularizer),activityRegularizer:UU(this.activityRegularizer),kernelConstraint:Mz(this.kernelConstraint),recurrentConstraint:Mz(this.recurrentConstraint),biasConstraint:Mz(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}]),n}(bW);IW.className="LSTMCell",YN(IW);var SW=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new IW(e),t.call(this,e)}return p(n,[{key:"call",value:function(e,t){var r=this;return eA((function(){null!=r.cell.dropoutMask&&(tA(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(tA(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return kt(k(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(yW);SW.className="LSTM",YN(SW);var CW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).cells=e.cells,r}return p(n,[{key:"stateSize",get:function(){var e,t=[],n=m(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,(0,H.Z)(r.stateSize)):t.push(r.stateSize)}}catch(h6){n.e(h6)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return eA((function(){var r,a=e.slice(1),i=[],o=m(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch(h6){o.e(h6)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var h=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=h.call(u,t),c.push(u.slice(1))}a=[];var f,d=m(c.slice().reverse());try{for(d.s();!(f=d.n()).done;){var p,v=f.value;(p=a).push.apply(p,(0,H.Z)(v))}}catch(h6){d.e(h6)}finally{d.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;iz(e)&&(e=e[0]),this.cells.forEach((function(n,r){sP("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign({},e,t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=m(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,H.Z)(r.trainableWeights))}}catch(h6){n.e(h6)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=m(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,H.Z)(r.nonTrainableWeights))}}catch(h6){n.e(h6)}finally{n.f()}if(!this.trainable){var a,i=[],o=m(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,(0,H.Z)(s.trainableWeights))}}catch(h6){o.e(h6)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=m(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,(0,H.Z)(r.weights))}}catch(h6){n.e(h6)}finally{n.f()}return fz(t)}},{key:"setWeights",value:function(e){var t,n=[],r=m(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch(h6){r.e(h6)}finally{r.f()}dz(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=m(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(Yz(o,r))}}catch(h6){i.e(h6)}finally{i.f()}return new e({cells:a})}}]),n}(bW);function EW(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=e.dropoutFunc,u=function(){return null!=s?s(t(),n):OP(t(),n)},c=function(){return LP(u,t,a)};return!o||o<=1?nA(c().clone()):Array(o).fill(void 0).map(c).map((function(e){return nA(e.clone())}))}CW.className="StackedRNNCells",YN(CW);var TW=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},NW=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),e.unroll)throw new SM("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new SM("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new pz({ndim:5})],r}return p(n,[{key:"call",value:function(e,t){var r=this;return eA((function(){if(null!=r.cell.dropoutMask&&(tA(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(tA(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new IM("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return kt(k(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat((0,H.Z)(t.slice(2)))),this.returnState&&(t=[t].concat((0,H.Z)(Array(2).fill([e[0]].concat((0,H.Z)(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return eA((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=LR([a[0]].concat((0,H.Z)(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];eA((function(){if(!t.stateful)throw new xM("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat((0,H.Z)(a.slice(2)));if(null==r[0])throw new IM("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return LR(i)})):t.states_=[LR(i)];else if(null==e)tA(t.states_),null!=t.keptStates&&(tA(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return LR(i)})):t.states_[0]=LR(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new IM("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));n?t.keptStates.push(t.states_.slice()):tA(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!Gx(s.shape,u))throw new IM("State ".concat(o," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return nA(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],h=YU(c,a[0],i,o[0],s[0]),f=YU(l,a[1],i,o[1],s[1]);return[].concat((0,H.Z)(e.slice(0,2)),(0,H.Z)(u?[r,h,f]:[h,f,r]))}}]),n}(yW);NW.className="ConvRNN2D";var AW=function(e){b(n,e);var t=w(n);function n(e){var r;f(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign({},e,{units:a}))).filters=a,ZM(r.filters,"filters"),r.kernelSize=QU(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return ZM(e,"kernelSize")})),r.strides=QU(o||1,2,"strides"),r.strides.forEach((function(e){return ZM(e,"strides")})),r.padding=s||"valid",aP(r.padding),r.dataFormat=u||"channelsLast",rP(r.dataFormat),r.dilationRate=QU(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return ZM(e,"dilationRate")})),r}return p(n,[{key:"build",value:function(e){var t;e=uz(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new IM("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"apply",value:function(e,t){return SP([s.apply([u]),MR([u]),s.apply([2*u])])}}]),n}(zP),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return eA((function(){if(3!==e.length)throw new IM("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=EW({ones:function(){return PR(a)},rate:n.dropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?dR(t[n],e):e},c=u(a,s,0),h=u(a,s,1),f=u(a,s,2),d=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=EW({ones:function(){return PR(i)},rate:n.recurrentDropout,training:r,count:4,dropoutFunc:n.dropoutFunc}));var p=n.recurrentDropoutMask,v=u(i,p,0),m=u(i,p,1),g=u(i,p,2),y=u(i,p,3),b=a_(n.kernel.read(),4,3),k=(0,l.Z)(b,4),V=k[0],x=k[1],w=k[2],I=k[3],S=n.useBias?a_(n.bias.read(),4):[null,null,null,null],C=(0,l.Z)(S,4),E=C[0],T=C[1],N=C[2],A=C[3];c=n.inputConv(c,V,E,n.padding),h=n.inputConv(h,x,T,n.padding),f=n.inputConv(f,w,N,n.padding),d=n.inputConv(d,I,A,n.padding);var R=a_(n.recurrentKernel.read(),4,3),_=(0,l.Z)(R,4),D=_[0],F=_[1],O=_[2],L=_[3];v=n.recurrentConv(v,D),m=n.recurrentConv(m,F),g=n.recurrentConv(g,O),y=n.recurrentConv(y,L);var M=n.recurrentActivation.apply(uA(c,v)),P=n.recurrentActivation.apply(uA(h,m)),z=uA(dR(P,o),dR(M,n.activation.apply(uA(f,g)))),B=dR(n.recurrentActivation.apply(uA(d,y)),n.activation.apply(z));return[B,B,z]}))}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this),t=(e.units,TW(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},t,r)}},{key:"inputConv",value:function(e,t,n,r){var a=WA(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?DP(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return WA(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(IW);AW.className="ConvLSTM2DCell",YN(AW);var RW=function(e){b(n,e);var t=w(n);function n(e){f(this,n);var r=new AW(e);return t.call(this,Object.assign({},e,{cell:r}))}return p(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(NW);RW.className="ConvLSTM2D",YN(RW);var _W=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return p(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return eA((function(){n.invokeCallHook(e,t);var r=sz(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return LP((function(){return OP(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return kt(k(n.prototype),"dispose",this).call(this)}}]),n}(bz);_W.className="Dropout",YN(_W);var DW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return p(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(_W);DW.className="SpatialDropout1D",YN(DW);var FW=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,ZM(r.units,"units"),r.activation=LU(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=az(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=az(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=zz(e.kernelConstraint),r.biasConstraint=zz(e.biasConstraint),r.kernelRegularizer=jU(e.kernelRegularizer),r.biasRegularizer=jU(e.biasRegularizer),r.activityRegularizer=jU(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return p(n,[{key:"build",value:function(e){var t=(e=uz(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:(0,h.Z)({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=uz(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return eA((function(){n.invokeCallHook(e,t);var r,a=sz(e),i=HM(n.activation.getClassName());return null!=i?r=NP(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=NP(a,n.kernel.read()),null!=n.bias&&(r=DP(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:FU(this.activation),useBias:this.useBias,kernelInitializer:rz(this.kernelInitializer),biasInitializer:rz(this.biasInitializer),kernelRegularizer:UU(this.kernelRegularizer),biasRegularizer:UU(this.biasRegularizer),activityRegularizer:UU(this.activityRegularizer),kernelConstraint:Mz(this.kernelConstraint),biasConstraint:Mz(this.biasConstraint)},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);FW.className="Dense",YN(FW);var OW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return p(n,[{key:"computeOutputShape",value:function(e){var t,n=m((e=uz(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new IM('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch(h6){n.e(h6)}finally{n.f()}return[e[0],pP(e,1)]}},{key:"call",value:function(e,t){var n=this;return eA((function(){n.invokeCallHook(e,t);var r=sz(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=g_(r,a)}return function(e){if(e.rank<=1)throw new IM("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],pP(e.shape,1)];return TA(e,t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);OW.className="Flatten",YN(OW);var LW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=LU(e.activation),r}return p(n,[{key:"call",value:function(e,t){var n=this;return eA((function(){n.invokeCallHook(e,t);var r=sz(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:FU(this.activation)},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);LW.className="Activation",YN(LW);var MW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return p(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return eA((function(){return function(e,t){return eA((function(){if(2!==e.shape.length)throw new IM("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(e.shape.length," tensor."));return EP(kP(e,1),[1,t,1])}))}(e=sz(e),n.n)}))}},{key:"getConfig",value:function(){var e={n:this.n},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);MW.className="RepeatVector",YN(MW);var PW=function(e){b(n,e);var t=w(n);function n(e){var r;f(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return p(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new IM("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=pP(e);if(null!==i){if(0===a||u%a!==0)throw new IM(n);r[i]=u/a}else if(u!==a)throw new IM(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return eA((function(){n.invokeCallHook(e,t);var r=sz(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return TA(r,i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);PW.className="Reshape",YN(PW);var zW=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));var a=gP(1,e.dims.length+1);if(!Gx(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new pz({ndim:r.dims.length+1})],r}return p(n,[{key:"computeOutputShape",value:function(e){var t=(e=uz(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return g_(sz(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);zW.className="Permute",YN(zW);var BW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return p(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=sz(e);return lA(FR(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return eA((function(){n.invokeCallHook(e,t);var r=sz(e),a=lA(FR(r,n.maskValue),-1,!0);return dR(r,cN(a,r.dtype))}))}}]),n}(bz);BW.className="Masking",YN(BW);var UW=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(_M(e.inputLength))}return r.inputDim=e.inputDim,ZM(r.inputDim,"inputDim"),r.outputDim=e.outputDim,ZM(r.outputDim,"outputDim"),r.embeddingsInitializer=az(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=jU(e.embeddingsRegularizer),r.activityRegularizer=jU(e.activityRegularizer),r.embeddingsConstraint=zz(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,r}return p(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return eA((function(){return n.maskZero?(e=sz(e),FR(e,p_(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=uz(e),null==this.inputLength)return[].concat((0,H.Z)(e),[this.outputDim]);var t=_M(this.inputLength);if(t.length!==e.length-1)throw new IM('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new IM('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat((0,H.Z)(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return eA((function(){n.invokeCallHook(e,t);var r=sz(e);"int32"!==r.dtype&&(r=bP(r,"int32"));var a=AP(n.embeddings.read(),TA(r,[r.size]));return TA(a,uz(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:rz(this.embeddingsInitializer),embeddingsRegularizer:UU(this.embeddingsRegularizer),activityRegularizer:UU(this.activityRegularizer),embeddingsConstraint:Mz(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);UW.className="Embedding",YN(UW);var WW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return p(n,[{key:"mergeFunction",value:function(e){throw new SM}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new IM("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[uz(e)]),e.length<2)throw new IM("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));var t,n=[],r=m(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch(h6){r.e(h6)}finally{r.f()}if((n=BM(n)).length>1)throw new IM("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===BM(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return eA((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=mP(r),o=m(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=kP(s,1);t.push(s)}}catch(h6){o.e(h6)}finally{o.f()}return n.mergeFunction(t)}var l,h=!1,f=m(e);try{for(f.s();!(l=f.n()).done;){var d=l.value,p=d.rank;if(null==p){var v=d.shape,g=v[0],y=v.slice(1).concat([g]),b=TA(d,[g].concat(pP(v.slice(1))));b=g_(b,[1,0]),b=TA(b,y),t.push(b),h=!0}else if(p>1){var k=gP(1,p).concat([0]);t.push(g_(d,k)),h=!0}else t.push(d)}}catch(h6){f.e(h6)}finally{f.f()}var V=n.mergeFunction(t),x=V.rank;if(h)if(null==x){var w=V.shape,I=w[w.length-1],S=[I].concat(w.slice(0,w.length-1));V=TA(g_(TA(V,[-1,I]),[1,0]),S)}else if(x>1){var C=[x-1].concat(gP(0,x-1));V=g_(V,C)}return V}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=m(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch(h6){o.e(h6)}finally{o.f()}return t=1===(i=BM(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return eA((function(){if(null==t)return null;if(!Array.isArray(t))throw new IM("`mask` should be an Array");if(!Array.isArray(e))throw new IM("`inputs` should be an Array");if(t.length!==e.length)throw new IM("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:tR(e,0)})))[0],r=1;r<t.length-1;++r)n=gR(n,t[r]);return n}))}}]),n}(bz),jW=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return p(n,[{key:"mergeFunction",value:function(e){return eA((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=uA(t,e[n]);return t}))}}]),n}(WW);jW.className="Add",YN(jW);var ZW=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return p(n,[{key:"mergeFunction",value:function(e){return eA((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=dR(t,e[n]);return t}))}}]),n}(WW);ZW.className="Multiply",YN(ZW);var GW=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return p(n,[{key:"mergeFunction",value:function(e){return eA((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=uA(t,e[n]);return dR(1/e.length,t)}))}}]),n}(WW);GW.className="Average",YN(GW);var HW=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return p(n,[{key:"mergeFunction",value:function(e){return eA((function(){for(var t=e[0],n=1;n<e.length;++n)t=VR(t,e[n]);return t}))}}]),n}(WW);HW.className="Maximum",YN(HW);var qW=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return p(n,[{key:"mergeFunction",value:function(e){return eA((function(){for(var t=e[0],n=1;n<e.length;++n)t=wR(t,e[n]);return t}))}}]),n}(WW);qW.className="Minimum",YN(qW);var KW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return p(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new IM("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=m(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch(h6){r.e(h6)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=m(a);try{for(c.s();!(s=c.n()).done;){if(Gx(s.value,o)){u=!0;break}}}catch(h6){c.e(h6)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new IM("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return eA((function(){return SP(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new IM("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=m(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch(h6){i.e(h6)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new IM("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new IM("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new IM("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return eA((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(cN(PR(e[i]),"bool")):t[i].rank<e[i].rank?a.push(tR(t[i],-1)):a.push(t[i]);var o=MA(a,n.axis);return cA(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(WW);function XW(e,t){for(;e<0;)e+=t;return e}KW.className="Concatenate",YN(KW);var QW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return p(n,[{key:"build",value:function(e){Bx(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new SM("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new IM("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new IM("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return XW(t,e[n].shape.length)})):[XW(this.axes,n.shape.length),XW(this.axes,r.shape.length)],this.normalize&&(n=Jz(n,t[0]),r=Jz(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new SM("batchDot is not implemented for tensors of 4D or higher rank yet");if(Bx(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)})),Bx(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)})),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new SM("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return eA((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=TA(t,t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=TA(e,e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?vR(dR(e,t),i[0]):vR(dR(g_(e,[1,0]),t),i[1]);else{var h=i[0]!==e.shape.length-1,f=i[1]===t.shape.length-1;o=yR(e,t,h,f)}if(n>0){for(var d,p=[],v=d=r>a?r+a-3:r-1;v<d+n;++v)p.push(v);o=o_(o,p)}return 1===o.shape.length&&(o=tR(o,1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[XW(this.axes,e.length),XW(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){Bx(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new SM("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(WW);QW.className="Dot",YN(QW);var YW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return p(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return eA((function(){n.invokeCallHook(e,t);var r=sz(e);return LP((function(){return uA(TP(r.shape,0,n.stddev),r)}),(function(){return r}),t.training||!1)}))}}]),n}(bz);YW.className="GaussianNoise",YN(YW);var JW=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return p(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return eA((function(){n.invokeCallHook(e,t);var r=sz(e);if(n.rate>0&&n.rate<1){return LP((function(){var e=Math.sqrt(n.rate/(1-n.rate));return dR(r,TP(r.shape,1,e))}),(function(){return r}),t.training||!1)}return r}))}}]),n}(bz);JW.className="GaussianDropout",YN(JW);var $W=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return p(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||sz(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=kt(k(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return eA((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return LP((function(){var t=sz(e),a=-1.7580993408473766,i=uR(GR(r),n.rate);i=bP(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate,u=uA(dR(t,i),dR(uA(i,-1),a));return uA(dR(u,o),s)}),(function(){return sz(e)}),t.training||!1)}return e}))}}]),n}(bz);function ej(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=_A(e,t,n,r,a,o);else if(3===e.rank)i=DA(e,t,n,r,a,o);else{if(4!==e.rank)throw new SM("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");i=FA(e,t,n,r,a,o)}return i}function tj(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return eA((function(){var i=_R(e,r),o=i.mean,s=i.variance;return[ej(e,o,s,n,t,a),o,s]}))}function nj(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return eA((function(){var i,o=_R(e,r),s=o.mean,u=o.variance,c=[],l=m(gP(0,e.rank));try{for(l.s();!(i=l.n()).done;){var h=i.value;-1!==r.indexOf(h)?c.push(1):c.push(e.shape[h])}}catch(h6){l.e(h6)}finally{l.f()}var f=TA(s,c),d=TA(u,c),p=null==t?null:TA(t,c),v=null==n?null:TA(n,c);return[ej(e,f,d,v,p,a),s,u]}))}$W.className="AlphaDropout",YN($W);var rj=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=az(e.betaInitializer||"zeros"),r.gammaInitializer=az(e.gammaInitializer||"ones"),r.movingMeanInitializer=az(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=az(e.movingVarianceInitializer||"ones"),r.betaConstraint=zz(e.betaConstraint),r.gammaConstraint=zz(e.gammaConstraint),r.betaRegularizer=jU(e.betaRegularizer),r.gammaRegularizer=jU(e.gammaRegularizer),r}return p(n,[{key:"build",value:function(e){e=uz(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new IM("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new pz({ndim:e.length,axes:(0,h.Z)({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return eA((function(){var r=null!=t.training&&t.training,a=sz(e),i=a.shape,o=i.length,s=gP(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var c=TM(1,o);c[u]=i[u];var h=s.slice();h.sort();var f=!Gx(h,gP(0,o).slice(0,o-1));if(!r)return function(){if(f){var e=TA(n.movingMean.read(),c),t=TA(n.movingVariance.read(),c),r=n.center?TA(n.beta.read(),c):null,i=n.scale?TA(n.gamma.read(),c):null;return ej(a,e,t,r,i,n.epsilon)}return ej(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var d=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return Gx(r.slice().sort(),gP(0,e.rank-1))?tj(e,t,n,r,a):nj(e,t,n,r,a)}(a,n.gamma.read(),n.beta.read(),s,n.epsilon),p=(0,l.Z)(d,3),v=p[0],m=p[1],g=p[2],y=function(e,t,n){eA((function(){var r=1-n,a=e.read(),i=dR(pR(a,t),r);e.write(pR(a,i))}))};return y(n.movingMean,m,n.momentum),y(n.movingVariance,g,n.momentum),v}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:rz(this.betaInitializer),gammaInitializer:rz(this.gammaInitializer),movingMeanInitializer:rz(this.movingMeanInitializer),movingVarianceInitializer:rz(this.movingVarianceInitializer),betaRegularizer:UU(this.betaRegularizer),gammaRegularizer:UU(this.gammaRegularizer),betaConstraint:Mz(this.betaConstraint),gammaConstraint:Mz(this.gammaConstraint)},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);rj.className="BatchNormalization",YN(rj);var aj=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"===typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(r.axis)));var a,i=m(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(r.axis)))}}catch(h6){i.e(h6)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=az(e.betaInitializer||"zeros"),r.gammaInitializer=az(e.gammaInitializer||"ones"),r.betaRegularizer=jU(e.betaRegularizer),r.gammaRegularizer=jU(e.gammaRegularizer),r.supportsMasking=!0,r}return p(n,[{key:"build",value:function(e){var t=(e=uz(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=m(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch(h6){a.e(h6)}finally{a.f()}if(this.axis.length!==BM(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=sz(e),a=r.shape,i=a.length;return eA((function(){var e,t=_R(r,n.axis,!0),o=t.mean,s=t.variance,u=TM(1,i),c=m(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch(h6){c.e(h6)}finally{c.f()}for(var h=function(e){return null!=e&&e.shape.length!==i?TA(e,u):e},f=n.scale?h(n.gamma.read()):null,d=n.center?h(n.beta.read()):null,p=[],v=[],g=0;g<i;++g)-1!==n.axis.indexOf(g)?(p.push(a[g]),v.push(1)):(p.push(1),v.push(a[g]));return o=nR(o,p),s=nR(s,p),null!=f&&(f=nR(f,v)),null!=d&&(d=nR(d,v)),ej(r,o,s,d,f,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:rz(this.betaInitializer),gammaInitializer:rz(this.gammaInitializer),betaRegularizer:UU(this.betaRegularizer),gammaRegularizer:UU(this.gammaRegularizer)},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);aj.className="LayerNormalization",YN(aj);var ij=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new IM("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));var a,i;if("number"===typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new IM("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new IM("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new pz({ndim:4})],r}return p(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=uz(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return eA((function(){return function(e,t,n){return eA((function(){if(4!==e.rank)throw new IM("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new IM("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new IM("Unknown data format: ".concat(n,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],zR(e,r)}))}(sz(e),n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz);function oj(e,t,n,r,a,i){return eA((function(){var o;rP(a),iP(i),aP(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=$U(e,a);var s="same"===r?"same":"valid";return o="max"===i?bR(e,t,n,s):NA(e,t,n,s),"channelsFirst"===a&&(o=g_(o,[0,3,1,2])),o}))}function sj(e,t,n,r,a,i){return eA((function(){var o;rP(a),iP(i),aP(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=eW(e,a);var s="same"===r?"same":"valid";return o="max"===i?kR(e,t,n,s):AA(e,t,n,s),"channelsFirst"===a&&(o=g_(o,[0,4,1,2,3])),o}))}ij.className="ZeroPadding2D",YN(ij);var uj=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"===typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new IM("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(ZM(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"===typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new IM("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));r.strides=e.strides}return ZM(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,aP(r.padding),r.inputSpec=[new pz({ndim:3})],r}return p(n,[{key:"computeOutputShape",value:function(e){var t=YU((e=uz(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return eA((function(){n.invokeCallHook(e,t),e=kP(sz(e),2);var r=n.poolingFunction(sz(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return o_(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz),cj=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return p(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return rP(a),aP(r),oj(e,t,n,r,a,"max")}}]),n}(uj);cj.className="MaxPooling1D",YN(cj);var lj=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return p(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return rP(a),aP(r),oj(e,t,n,r,a,"avg")}}]),n}(uj);lj.className="AveragePooling1D",YN(lj);var hj=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new IM("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return ZM(r.poolSize,"poolSize"),ZM(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,rP(r.dataFormat),aP(r.padding),r.inputSpec=[new pz({ndim:4})],r}return p(n,[{key:"computeOutputShape",value:function(e){e=uz(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=YU(t,this.poolSize[0],this.padding,this.strides[0]),n=YU(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return eA((function(){return n.invokeCallHook(e,t),n.poolingFunction(sz(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz),fj=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return p(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return rP(a),aP(r),oj(e,t,n,r,a,"max")}}]),n}(hj);fj.className="MaxPooling2D",YN(fj);var dj=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return p(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return rP(a),aP(r),oj(e,t,n,r,a,"avg")}}]),n}(hj);dj.className="AveragePooling2D",YN(dj);var pj=function(e){b(n,e);var t=w(n);function n(e){var r;if(f(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new IM("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return ZM(r.poolSize,"poolSize"),ZM(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,rP(r.dataFormat),aP(r.padding),r.inputSpec=[new pz({ndim:5})],r}return p(n,[{key:"computeOutputShape",value:function(e){e=uz(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=YU(t,this.poolSize[0],this.padding,this.strides[0]),n=YU(n,this.poolSize[1],this.padding,this.strides[1]),r=YU(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return eA((function(){return n.invokeCallHook(e,t),n.poolingFunction(sz(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz),vj=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return p(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return rP(a),aP(r),sj(e,t,n,r,a,"max")}}]),n}(pj);vj.className="MaxPooling3D",YN(vj);var mj=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e)}return p(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return rP(a),aP(r),sj(e,t,n,r,a,"avg")}}]),n}(pj);mj.className="AveragePooling3D",YN(mj);var gj=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).inputSpec=[new pz({ndim:3})],r}return p(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new SM}}]),n}(bz),yj=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e||{})}return p(n,[{key:"call",value:function(e,t){return eA((function(){var t=sz(e);return xR(t,1)}))}}]),n}(gj);yj.className="GlobalAveragePooling1D",YN(yj);var bj=function(e){b(n,e);var t=w(n);function n(e){return f(this,n),t.call(this,e||{})}return p(n,[{key:"call",value:function(e,t){return eA((function(){var t=sz(e);return fR(t,1)}))}}]),n}(gj);bj.className="GlobalMaxPooling1D",YN(bj);var kj=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,rP(r.dataFormat),r.inputSpec=[new pz({ndim:4})],r}return p(n,[{key:"computeOutputShape",value:function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new SM}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(bz),Vj=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"call",value:function(e,t){var n=this;return eA((function(){var t=sz(e);return"channelsLast"===n.dataFormat?xR(t,[1,2]):xR(t,[2,3])}))}}]),n}(kj);Vj.className="GlobalAveragePooling2D",YN(Vj);var xj=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.apply(this,arguments)}return p(n,[{key:"call",value:function(e,t){var n=this;return eA((function(){var t=sz(e);return"channelsLast"===n.dataFormat?fR(t,[1,2]):fR(t,[2,3])}))}}]),n}(kj);xj.className="GlobalMaxPooling2D",YN(xj);var wj=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).layer=e.layer,r}return p(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){kt(k(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.layer,a=Yz(r,n);delete t.layer;var i={layer:a};return Object.assign(i,t),new e(i)}}]),n}(bz),Ij=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return p(n,[{key:"build",value:function(e){if((e=uz(e)).length<3)throw new IM("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),kt(k(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=uz(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return eA((function(){return gW((function(e,r){return[sz(n.layer.call(e,t)),[]]}),e=sz(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(wj);Ij.className="TimeDistributed",YN(Ij);var Sj=function(e){b(n,e);var t=w(n);function n(e){var r;f(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=Yz(i),a.goBackwards=!0!==a.goBackwards;var o,s={};if(s.className=e.layer.getClassName(),s.config=a,r.backwardLayer=Yz(s),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,o=r.mergeMode,WM(tP,"BidirectionalMergeMode",o),e.weights)throw new SM("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return p(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState?(r=a.slice(1),t=a[0]):t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):RM(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=mW(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return kt(k(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new IM("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,(0,H.Z)(r));var c=r.map((function(e){return new pz({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,(0,H.Z)(c))}if(null!=a)throw new SM("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof vz,h=0,f=o;h<f.length;h++){if(f[h]instanceof vz!==l)throw new IM("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var d=[e].concat(o),p=this.inputSpec.concat(s),v=this.inputSpec;this.inputSpec=p;var m=kt(k(n.prototype),"apply",this).call(this,d,t);return this.inputSpec=v,m}return kt(k(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return eA((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=qR(a,1)),"concat"===n.mergeMode?o=SP([r,a]):"sum"===n.mergeMode?o=uA(r,a):"ave"===n.mergeMode?o=dR(.5,uA(r,a)):"mul"===n.mergeMode?o=dR(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;sP(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),sP(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){kt(k(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=kt(k(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=Yz(t.layer);if(delete t.layer,null!=t.numConstants)throw new SM("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(wj);Sj.className="Bidirectional",YN(Sj);var Cj,Ej;ww().registerFlag("KEEP_INTERMEDIATE_TENSORS",(function(){return!1}),(function(e){e&&console.warn("Keep intermediate tensors is ON. This will print the values of all intermediate tensors during model inference. Not all models support this mode. For details, check e2e/benchmarks/ model_config.js. This significantly impacts performance.")})),function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_QINT16=15]="DT_QINT16",e[e.DT_QUINT16=16]="DT_QUINT16",e[e.DT_UINT16=17]="DT_UINT16",e[e.DT_COMPLEX128=18]="DT_COMPLEX128",e[e.DT_HALF=19]="DT_HALF",e[e.DT_RESOURCE=20]="DT_RESOURCE",e[e.DT_VARIANT=21]="DT_VARIANT",e[e.DT_UINT32=22]="DT_UINT32",e[e.DT_UINT64=23]="DT_UINT64",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF",e[e.DT_QINT16_REF=115]="DT_QINT16_REF",e[e.DT_QUINT16_REF=116]="DT_QUINT16_REF",e[e.DT_UINT16_REF=117]="DT_UINT16_REF",e[e.DT_COMPLEX128_REF=118]="DT_COMPLEX128_REF",e[e.DT_HALF_REF=119]="DT_HALF_REF",e[e.DT_RESOURCE_REF=120]="DT_RESOURCE_REF",e[e.DT_VARIANT_REF=121]="DT_VARIANT_REF",e[e.DT_UINT32_REF=122]="DT_UINT32_REF",e[e.DT_UINT64_REF=123]="DT_UINT64_REF"}(Cj||(Cj={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(Ej||(Ej={}));function Tj(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if("function"===typeof Blob&&e instanceof Blob)return e.slice();if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(_j(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=e[o],u=Tj(s,t,n,r);i[o]=u}return r.delete(e),e.__proto__&&(i.__proto__=e.__proto__),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function Nj(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rj;return Aj(e,t)}function Aj(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(_j(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=e.map((function(e){return e[r]})),o=Aj(a,t,n);i[r]=o};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function Rj(e){return null===e?null:_j(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function _j(e){var t=!1;ww().get("IS_BROWSER")?t=e instanceof TextDecoder:t=e instanceof n(4977).StringDecoder;return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof xE)&&!(e instanceof Promise)&&!t)}function Dj(e){return function(e,t){return Tj(e,t)}(e,Fj)}function Fj(e){return e instanceof xE?{value:e.clone(),recurse:!1}:_j(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var Oj=function(){function e(t){if(f(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return p(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=m(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch(h6){n.e(h6)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),Lj=function(e){b(n,e);var t=w(n);function n(){return f(this,n),t.call(this,n.INITIAL_CAPACITY)}return p(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){kt(k(n.prototype),"isFull",this).call(this)&&this.expand(),kt(k(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){kt(k(n.prototype),"isFull",this).call(this)&&this.expand(),kt(k(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(Oj);function Mj(e){return new Wj(e)}function Pj(e,t){return new $j(e,t)}Lj.INITIAL_CAPACITY=32;var zj,Bj=function(){function e(){f(this,e)}return p(e,[{key:"toArray",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent,e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=c(s().mark((function e(){var t,n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent,e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value),e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new Xj(this,e)}},{key:"filter",value:function(e){return new qj(this,e)}},{key:"map",value:function(e){return new Kj(this,e)}},{key:"mapAsync",value:function(e){return new Qj(this,e)}},{key:"serialMapAsync",value:function(e){return new Qj(this,e).serial()}},{key:"flatmap",value:function(e){return new Jj(this,e)}},{key:"forEachAsync",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new Hj(this,e,t)}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Rj,r=this.rowMajorBatch(e,t);return r.map((function(e){return Nj(e,n)}))}},{key:"concatenate",value:function(e,t){return new $j(new Uj([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new Gj(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new Zj(this,e)}},{key:"prefetch",value:function(e){return new eZ(this,e)}},{key:"shuffle",value:function(e,t){return new tZ(this,e,t)}},{key:"serial",value:function(){return new jj(this)}}]),e}(),Uj=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).items=e,r.trav=0,r}return p(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],this.trav++,e.abrupt("return",{value:Dj(t),done:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Bj),Wj=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).nextFn=e,r}return p(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(Bj),jj=function(e){b(n,e);var t=w(n);function n(e){var r;return f(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return p(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Bj),Zj=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return p(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:tA(t.value),e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Bj),Gj=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return p(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++>=this.maxCount)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.abrupt("return",this.upstream.next());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Bj),Hj=function(e){b(n,e);var t=w(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return f(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return p(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=12;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=9;break}if(!(this.enableSmallLastBatch&&t.length>0)){e.next=8;break}return e.abrupt("return",{value:t,done:!1});case 8:return e.abrupt("return",{value:null,done:!0});case 9:t.push(n.value),e.next=1;break;case 12:return e.abrupt("return",{value:t,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Bj),qj=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return p(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=6;break}return e.abrupt("return",t);case 6:tA(t.value),e.next=0;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Bj),Kj=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return p(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=OE(t.value),r=this.transform(t.value),a=OE(r),i=m(n);try{for(i.s();!(o=i.n()).done;)FE(u=o.value,a)||u.dispose()}catch(h6){i.e(h6)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Bj),Xj=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return p(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,this.upstream.next();case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),this.handler(e.t0)){e.next=11;break}return e.abrupt("return",{value:null,done:!0});case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()}]),n}(Bj),Qj=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return p(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=OE(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=OE(r),i=m(n);try{for(i.s();!(o=i.n()).done;)FE(u=o.value,a)||u.dispose()}catch(h6){i.e(h6)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Bj),Yj=function(e){b(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).outputQueue=new Lj,e.lastRead=Promise.resolve({value:null,done:!1}),e}return p(n,[{key:"next",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Bj),Jj=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return p(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=OE(t.value),r=this.transform(t.value),a=OE(r),this.outputQueue.pushAll(r),i=m(n);try{for(i.s();!(o=i.n()).done;)FE(u=o.value,a)||u.dispose()}catch(h6){i.e(h6)}finally{i.f()}return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(Yj),$j=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return p(n,[{key:"summary",value:function(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}},{key:"next",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.readFromChain(this.lastRead),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=10;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 10:return e.next=12,this.iterator.next();case 12:if(!(r=e.sent).done){e.next=16;break}return this.iterator=null,e.abrupt("return",this.readFromChain(t));case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(Bj);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(zj||(zj={}));var eZ=function(e){b(n,e);var t=w(n);function n(e,r){var a;return f(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new Oj(r),a}return p(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(Bj),tZ=function(e){b(n,e);var t=w(n);function n(e,r,a){var i;return f(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=UR.alea(a||sE().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return p(n,[{key:"next",value:function(){var e=c(s().mark((function e(){var t=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=c(s().mark((function e(){var t,n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=14;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=12;break;case 10:return this.refill(),e.abrupt("return",n);case 12:e.next=1;break;case 14:return e.abrupt("return",{value:null,done:!0});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(eZ),nZ=function(){function e(){f(this,e),this.size=null}return p(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return Bx(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),rZ(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,aZ));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,rZ(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,rZ(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return eA((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return rZ(c(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return eA((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return rZ(c(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return rZ(c(s().mark((function n(){return s().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,rZ(c(s().mark((function t(){var r;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=Mj(c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.abrupt("return",{value:e.t0,done:!1});case 4:case"end":return e.stop()}}),e)})))),t.abrupt("return",Pj(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,rZ(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=UR.alea(t||sE().toString());return rZ(c(s().mark((function t(){var i;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,rZ(c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=c(s().mark((function e(){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function rZ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){b(a,n);var r=w(a);function a(){var e;return f(this,a),(e=r.apply(this,arguments)).size=t,e}return p(a,[{key:"iterator",value:function(){var t=c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(nZ))}function aZ(e){return null===e?null:function(e){return null==e||null===(t=e)||"object"!==typeof t&&"function"!==typeof t||Array.isArray(e)||"object"===typeof e&&e instanceof xE||nw(e);var t}(e[0])?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof xE?s_(e):nT(e)}(e),recurse:!1}:{value:null,recurse:!0}}nZ.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");function iZ(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Bx("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}var oZ=_F,sZ=function(e){b(n,e);var t=w(n);function n(){var e;return f(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new _x(g(e),JN()),e}return p(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,ww().get("IS_NODE")&&DC("\n============================\nHi, looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, visit https://github.com/tensorflow/tfjs-node for more details. \n============================"));var r={id:this.nextDataId()};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&aw(n[0])){var a=n.map((function(e){return uE(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"refCount",value:function(e){return this.data.has(e)?this.data.get(e).refCount:0}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){this.data.set(e,{values:t,dtype:r,refCount:a})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;return"complex64"===n?pF(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return cE(e)}));return uN(e.shape,e.dtype,n)}catch(Bv){throw new Error("Failed to decode encoded string bytes into utf-8")}return uN(e.shape,e.dtype,t)}},{key:"makeOutput",value:function(e,t,n){return JN().makeTensorFromTensorInfo(this.makeTensorInfo(t,n,e),this)}},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.data.has(e)){if(this.data.get(e).refCount--,!t&&this.data.get(e).refCount>0)return!1;var n=this.data.get(e),r=n.complexTensorInfos;null!=r&&(this.disposeData(r.real.dataId,!0),this.disposeData(r.imag.dataId,!0)),this.data.delete(e)}return!0}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"time",value:function(){var e=c(s().mark((function e(t){var n,r;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=sE(),t(),r=sE()-n,e.abrupt("return",{kernelMs:r});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){iZ([e],"where");var t=this.readSync(e.dataId);return oZ(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return kt(k(n.prototype),"epsilon",this).call(this)}}]),n}(Dx);sZ.nextDataId=0;function uZ(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(iZ(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,l=Zx(s.shape),h=n||s.dtype,f=ew(h,l),d=0;d<l;++d)f[d]=t(c[d],i);return u.makeTensorInfo(s.shape,h,f)}}function cZ(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(iZ(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,h=t(c,l,i);return u.makeTensorInfo(s.shape,l,h)}}rA("cpu",(function(){return new sZ}),1);var lZ=uZ(II,(function(e){return e>=0?e:Math.exp(e)-1})),hZ={kernelName:II,backendName:"cpu",kernelFunc:lZ};function fZ(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var dZ={kernelName:UI,backendName:"cpu",kernelFunc:fZ};function pZ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;iZ([a],"leakyRelu");for(var o=Zx(a.shape),s=n.data.get(a.dataId).values,u=$x("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var vZ={kernelName:qI,backendName:"cpu",kernelFunc:pZ};function mZ(e){return function(t,n,r,a,i){var o=PN(t,n),s=o.length,u=cw(o),c=$x(i,Zx(o)),l=t.length,h=n.length,f=cw(t),d=cw(n),p=LN(t,o),v=LN(n,o);if(p.length+v.length===0)for(var m=0;m<c.length;++m)c[m]=e(r[m%r.length],a[m%a.length]);else for(var g=function(t){var n=gw(t,s,u),i=n.slice(-l);p.forEach((function(e){return i[e]=0}));var o=mw(i,l,f),m=n.slice(-h);v.forEach((function(e){return m[e]=0}));var g=mw(m,h,d);c[t]=e(r[o],a[g])},y=0;y<c.length;++y)g(y);return[c,o]}}var gZ=mZ((function(e,t){return e<0?t*e:e}));function yZ(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;iZ([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=gZ(r.shape,a.shape,i,o,"float32"),u=(0,l.Z)(s,2),c=u[0],h=u[1];return n.makeTensorInfo(h,"float32",c)}var bZ={kernelName:TS,backendName:"cpu",kernelFunc:yZ},kZ=uZ(FS,(function(e){return Math.max(0,e)})),VZ={kernelName:FS,backendName:"cpu",kernelFunc:kZ},xZ=uZ(BS,(function(e){return Math.min(Math.max(0,e),6)})),wZ={kernelName:BS,backendName:"cpu",kernelFunc:xZ};function IZ(e){return function(t,n,r){for(var a=$x(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}var SZ=IZ((function(e){return 1/(1+Math.exp(-e))})),CZ=uZ(JS,(function(e){return 1/(1+Math.exp(-e))})),EZ={kernelName:JS,backendName:"cpu",kernelFunc:CZ};function TZ(e,t,n,r,a){if("linear"===n)return fZ({inputs:{x:t},backend:e});if("relu"===n)return kZ({inputs:{x:t},backend:e});if("elu"===n)return lZ({inputs:{x:t},backend:e});if("relu6"===n)return xZ({inputs:{x:t},backend:e});if("prelu"===n)return yZ({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return pZ({inputs:{x:t},backend:e,attrs:{alpha:a}});if("sigmoid"===n)return CZ({inputs:{x:t},backend:e});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function NZ(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var AZ={kernelName:$w,backendName:"cpu",kernelFunc:NZ};function RZ(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){var r=RZ(e,t,"float32"),a=RZ(e,t,"float32");return NZ({inputs:{real:r,imag:a},backend:e})}var i=dw(Zx(t),n);return e.makeTensorInfo(t,n,i)}function _Z(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var DZ={kernelName:_S,backendName:"cpu",kernelFunc:_Z};function FZ(e,t,n,r){if("int32"===r)return[t,"int32",Int32Array.from(e)];if("bool"===r){var a=oE([0],n),i=mZ((function(e,t){return e!==t?1:0}))(t,[],e,a,"bool"),o=(0,l.Z)(i,2),s=o[0];return[o[1],"bool",s]}throw new Error("Error in Cast: failed to cast ".concat(n," to ").concat(r))}function OZ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return fZ({inputs:{x:a},backend:n});var o=RZ(n,a.shape,a.dtype),s=OZ({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=NZ({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("complex64"===a.dtype){var c=_Z({inputs:{input:a},backend:n}),h=OZ({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),h}if(!tw(a.dtype,i)){var f=fZ({inputs:{x:a},backend:n});return{dataId:f.dataId,shape:f.shape,dtype:i}}var d=FZ(n.data.get(a.dataId).values,a.shape,a.dtype,i),p=(0,l.Z)(d,3),v=p[0],m=p[1],g=p[2];return n.makeTensorInfo(v,m,g)}var LZ={kernelName:Qw,backendName:"cpu",kernelFunc:OZ};function MZ(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;iZ([o,s],e);var c=u.data.get(o.dataId).values,h=u.data.get(s.dataId).values,f="string"===o.dtype?RF(c):c,d="string"===o.dtype?RF(h):h,p=r||o.dtype,v=t(o.shape,s.shape,f,d,p),m=(0,l.Z)(v,2),g=m[0],y=m[1];return u.makeTensorInfo(y,p,g)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=OZ({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),h=u.data.get(c.dataId),f=h.complexTensorInfos.real,d=h.complexTensorInfos.imag,p=u.data.get(f.dataId).values,v=u.data.get(d.dataId).values,m=OZ({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),g=u.data.get(m.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,k=u.data.get(y.dataId).values,V=u.data.get(b.dataId).values,x=n(o.shape,s.shape,p,v,k,V),w=(0,l.Z)(x,3),I=w[0],S=w[1],C=w[2],E=u.makeTensorInfo(C,"float32",I),T=u.makeTensorInfo(C,"float32",S),N=NZ({inputs:{real:E,imag:T},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(E),u.disposeIntermediateTensorInfo(T),N}var A=u.data.get(o.dataId).values,R=u.data.get(s.dataId).values,_=r||o.dtype,D=t(o.shape,s.shape,A,R,_),F=(0,l.Z)(D,2),O=F[0],L=F[1];return u.makeTensorInfo(L,_,O)}}function PZ(e){return function(t,n,r,a,i,o){var s=PN(t,n),u=Zx(s),c=s.length,l=cw(s),h=$x("float32",u),f=$x("float32",u),d=LN(t,s),p=LN(n,s),v=pF(r,a),m=pF(i,o),g=t.length,y=cw(t),b=n.length,k=cw(n);if(d.length+p.length===0)for(var V=0;V<h.length;V++){var x=V%v.length,w=V%m.length,I=e(v[2*x],v[2*x+1],m[2*w],m[2*w+1]);h[V]=I.real,f[V]=I.imag}else for(var S=function(t){var n=gw(t,c,l),r=n.slice(-g);d.forEach((function(e){return r[e]=0}));var a=mw(r,g,y),i=n.slice(-b);p.forEach((function(e){return i[e]=0}));var o=mw(i,b,k),s=e(v[2*a],v[2*a+1],m[2*o],m[2*o+1]);h[t]=s.real,f[t]=s.imag},C=0;C<h.length;C++)S(C);return[h,f,s]}}var zZ=mZ((function(e,t){return e+t})),BZ=PZ((function(e,t,n,r){return{real:e+n,imag:t+r}})),UZ=MZ(Rw,zZ,BZ),WZ={kernelName:Rw,backendName:"cpu",kernelFunc:UZ};function jZ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=Zx(a.shape),s=Qx(i,o),u=Zx(s);Bx(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.real,h=c.complexTensorInfos.imag;l.shape=s,h.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var ZZ={kernelName:OS,backendName:"cpu",kernelFunc:jZ};function GZ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;iZ([a,i],"matMul");var u=a.shape.length,c=i.shape.length,h=o?a.shape[u-2]:a.shape[u-1],f=s?i.shape[c-1]:i.shape[c-2],d=o?a.shape[u-1]:a.shape[u-2],p=s?i.shape[c-2]:i.shape[c-1],v=a.shape.slice(0,-2),m=i.shape.slice(0,-2),g=Zx(v),y=Zx(m),b=PN(a.shape.slice(0,-2),i.shape.slice(0,-2)).concat([d,p]);Bx(h===f,(function(){return"Error in matMul: inner shapes (".concat(h,") and (")+"".concat(f,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")}));for(var k=s?[y,p,f]:[y,f,p],V=jZ({inputs:{x:a},backend:n,attrs:{shape:o?[g,h,d]:[g,d,h]}}),x=jZ({inputs:{x:i},backend:n,attrs:{shape:k}}),w=o?V.shape[1]:V.shape[2],I=o?V.shape[2]:V.shape[1],S=s?x.shape[1]:x.shape[2],C=Math.max(g,y),E=n.data.get(V.dataId).values,T=n.data.get(x.dataId).values,N=cw(V.shape),A=cw(x.shape),R=o?[N[0],1,N[1]]:[N[0],N[1],1],_=(0,l.Z)(R,3),D=_[0],F=_[1],O=_[2],L=s?[1,A[1],A[0]]:[A[1],1,A[0]],M=(0,l.Z)(L,3),P=M[0],z=M[1],B=M[2],U=I*S,W=uN([C,I,S],V.dtype),j=W.values,Z=n.blockSize,G=0;G<C;G++)for(var H=0;H<I;H+=Z)for(var q=0;q<S;q+=Z)for(var K=0;K<w;K+=Z)for(var X=Math.min(H+Z,I),Q=Math.min(q+Z,S),Y=Math.min(K+Z,w),J=H;J<X;J++)for(var $=q;$<Q;$++){for(var ee=0,te=K;te<Y;te++){var ne=Math.min(G,g-1)*D,re=Math.min(G,y-1)*B;ee+=E[ne+J*F+te*O]*T[te*P+$*z+re]}j[G*U+(J*S+$)]+=ee}return n.disposeIntermediateTensorInfo(V),n.disposeIntermediateTensorInfo(x),n.makeTensorInfo(b,W.dtype,W.values)}var HZ={kernelName:Hw,backendName:"cpu",kernelFunc:GZ};var qZ={kernelName:AC,backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,h=o.transposeA,f=o.transposeB,d=o.activation,p=o.leakyreluAlpha,v=[];t=GZ({inputs:{a:s,b:u},attrs:{transposeA:h,transposeB:f},backend:i}),c&&(n=UZ({inputs:{a:t,b:c},backend:i}),v.push(t),t=n),d&&(r=TZ(i,t,d,l,p),v.push(t),t=r);for(var m=0,g=v;m<g.length;m++){var y=g[m];i.disposeIntermediateTensorInfo(y)}return t}};function KZ(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var XZ={kernelName:Tw,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;iZ(t,"abs");var r=new Float32Array(Zx(t.shape));return r=KZ(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,t.dtype)}},QZ=uZ(Nw,(function(e){return Math.acos(e)})),YZ={kernelName:Nw,backendName:"cpu",kernelFunc:QZ},JZ=uZ(Aw,(function(e){return Math.acosh(e)})),$Z={kernelName:Aw,backendName:"cpu",kernelFunc:JZ};var eG={kernelName:_w,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;iZ(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=uN(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function tG(e,t,n,r,a){for(var i=t.length,o=Zx(t),s=cw(t),u=cw(a),c=$x(n,Zx(a)),l=0;l<o;++l){for(var h=gw(l,i,s),f=new Array(h.length),d=0;d<f.length;d++)f[d]=h[r[d]];c[mw(f,i,u)]=e[l]}return c}function nG(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;iZ(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=tG(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var rG={kernelName:xC,backendName:"cpu",kernelFunc:nG};var aG={kernelName:Dw,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;iZ(a,"all");var s=Yx(i,a.shape),u=s,c=TR(u,a.shape.length),h=a;null!=c&&(h=nG({inputs:{x:a},backend:n,attrs:{perm:c}}),u=AR(u.length,a.shape.length)),ER("all",u,h.shape.length);for(var f=SR(h.shape,u),d=(0,l.Z)(f,2),p=d[0],v=Zx(d[1]),m=dw(Zx(p),h.dtype),g=n.data.get(h.dataId).values,y=0;y<m.length;++y){for(var b=y*v,k=g[b],V=0;V<v;++V){var x=g[b+V];k=k&&x}m[y]=k}null!=c&&n.disposeIntermediateTensorInfo(h);var w=n.makeTensorInfo(p,h.dtype,m);if(o){var I=jZ({inputs:{x:w},backend:n,attrs:{shape:CR(p,s)}});return n.disposeIntermediateTensorInfo(w),I}return w}};var iG={kernelName:Fw,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;iZ(a,"any");var s=Yx(i,a.shape),u=s,c=TR(u,a.shape.length),h=a;null!=c&&(h=nG({inputs:{x:a},backend:n,attrs:{perm:c}}),u=AR(u.length,a.shape.length)),ER("any",u,h.shape.length);for(var f=SR(h.shape,u),d=(0,l.Z)(f,2),p=d[0],v=Zx(d[1]),m=dw(Zx(p),h.dtype),g=n.data.get(h.dataId).values,y=0;y<m.length;++y){for(var b=y*v,k=g[b],V=0;V<v;++V){var x=g[b+V];k=k||x}m[y]=k}null!=c&&n.disposeIntermediateTensorInfo(h);var w=n.makeTensorInfo(p,h.dtype,m);if(o){var I=jZ({inputs:{x:w},backend:n,attrs:{shape:CR(p,s)}});return n.disposeIntermediateTensorInfo(w),I}return w}};var oG={kernelName:Ow,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;iZ(a,"argMax");var o=Yx(i,a.shape),s=TR(o,a.shape.length),u=a,c=[];null!=s&&(u=nG({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=AR(o.length,u.shape.length)),ER("argMax",o=[o[0]],u.shape.length);for(var h=SR(u.shape,o),f=(0,l.Z)(h,2),d=f[0],p=f[1],v=dw(Zx(d),"int32"),m=Zx(p),g=n.data.get(u.dataId).values,y=0;y<v.length;++y){for(var b=y*m,k=g[b],V=0,x=0;x<m;++x){var w=g[b+x];w>k&&(k=w,V=x)}v[y]=V}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d,"int32",v)}};var sG={kernelName:Lw,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;iZ(a,"argMin");var o=Yx(i,a.shape),s=TR(o,a.shape.length),u=a,c=[];null!=s&&(u=nG({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=AR(o.length,u.shape.length)),ER("argMin",o=[o[0]],u.shape.length);for(var h=SR(u.shape,o),f=(0,l.Z)(h,2),d=f[0],p=f[1],v=dw(Zx(d),"int32"),m=Zx(p),g=n.data.get(u.dataId).values,y=0;y<v.length;++y){for(var b=y*m,k=g[b],V=0,x=0;x<m;++x){var w=g[b+x];w<k&&(k=w,V=x)}v[y]=V}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(d,"int32",v)}},uG=uZ(Mw,(function(e){return Math.asin(e)})),cG={kernelName:Mw,backendName:"cpu",kernelFunc:uG},lG=uZ(Pw,(function(e){return Math.asinh(e)})),hG={kernelName:Pw,backendName:"cpu",kernelFunc:lG},fG=uZ(zw,(function(e){return Math.atan(e)})),dG={kernelName:zw,backendName:"cpu",kernelFunc:fG},pG=mZ((function(e,t){return Math.atan2(e,t)})),vG=MZ(Uw,pG),mG={kernelName:Uw,backendName:"cpu",kernelFunc:vG},gG=uZ(Bw,(function(e){return Math.atanh(e)})),yG={kernelName:Bw,backendName:"cpu",kernelFunc:gG};function bG(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,h=a.effectiveFilterWidth,f=a.padInfo.top,d=a.padInfo.left,p="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=uN(a.outShape,n),m=v.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],k=0;k<a.batchSize;++k)for(var V=k*g,x=k*r[0],w=0;w<a.inChannels;++w)for(var I=0;I<a.outHeight;++I)for(var S=I*o-f,C=Math.max(0,S),E=Math.min(a.inHeight,l+S),T=V+I*y,N=0;N<a.outWidth;++N){for(var A=N*s-d,R=Math.max(0,A),_=Math.min(a.inWidth,h+A),D=p,F=0,O=0,L=C;L<E;L+=u){for(var M=x+L*r[1],P=R;P<_;P+=c){var z=e[M+P*r[2]+w];"max"===i&&z>D?D=z:"avg"===i&&(F+=z,O++)}if(isNaN(D))break}m[T+N*b+w]="avg"===i?F/O:D}return v}function kG(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=uN(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,v=uN(t,n,e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,k=b;k<0;)k+=c;for(var V=Math.min(r.inHeight,h+b),x=0;x<r.outWidth;++x){for(var w=x*u-p,I=w;I<0;)I+=l;for(var S=Math.min(r.inWidth,f+w),C=Number.NEGATIVE_INFINITY,E=-1,T=k;T<V;T+=c)for(var N=T-b,A=I;A<S;A+=l){var R=A-w,_=v.get(m,T,A,g);_>C&&(C=_,E=a?i?((m*r.inHeight+T)*r.inWidth+A)*r.inChannels+g:(T*r.inWidth+A)*r.inChannels+g:N*f+R)}o.set(E,m,y,x,g)}}return o}function VG(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,h=a.dilationWidth,f=a.effectiveFilterDepth,d=a.effectiveFilterHeight,p=a.effectiveFilterWidth,v=a.padInfo.front,m=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=uN(a.outShape,n),k=b.values,V=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],x=a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[3]*a.outShape[4],I=a.outShape[4],S=0;S<a.batchSize;++S)for(var C=S*V,E=S*r[0],T=0;T<a.inChannels;++T)for(var N=0;N<a.outDepth;++N){for(var A=N*o-v,R=A;R<0;)R+=c;for(var _=Math.min(a.inDepth,f+A),D=C+N*x,F=0;F<a.outHeight;++F){for(var O=F*s-m,L=O;L<0;)L+=l;for(var M=Math.min(a.inHeight,d+O),P=D+F*w,z=0;z<a.outWidth;++z){for(var B=z*u-g,U=B;U<0;)U+=h;for(var W=Math.min(a.inWidth,p+B),j=P+z*I,Z=y,G=0,H=0,q=R;q<_;q+=c){for(var K=E+q*r[1],X=L;X<M;X+=l){for(var Q=K+X*r[2],Y=U;Y<W;Y+=h){var J=e[Q+Y*r[3]+T];if("max"===i&&J>Z?Z=J:"avg"===i&&(G+=J,H++),isNaN(Z))break}if(isNaN(Z))break}if(isNaN(Z))break}k[j+T]="avg"===i?G/H:Z}}}return b}var xG={kernelName:Ww,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;iZ(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Bx(SA(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=dA(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Gx(l.inShape,l.outShape))c=fZ({inputs:{x:a},backend:n});else{var h=n.data.get(a.dataId).values,f=cw(a.shape),d=bG(h,a.shape,a.dtype,f,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var wG={kernelName:Zw,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;iZ(a,"avgPool3d");var l=pA(a.shape,i,o,1,s,u,c),h=VG(n.data.get(a.dataId).values,a.shape,a.dtype,cw(a.shape),l,"avg");return n.makeTensorInfo(h.shape,"float32",h.values)}};var IG={kernelName:Gw,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;iZ([a,i],"avgPool3DGrad");for(var l=pA(i.shape,o,s,1,u,c),h=l.strideDepth,f=l.strideHeight,d=l.strideWidth,p=l.filterDepth,v=l.filterHeight,m=l.filterWidth,g=l.dilationDepth,y=l.dilationHeight,b=l.dilationWidth,k=l.effectiveFilterDepth,V=l.effectiveFilterHeight,x=l.effectiveFilterWidth,w=k-1-l.padInfo.front,I=x-1-l.padInfo.left,S=V-1-l.padInfo.top,C=uN(i.shape,"float32"),E=1/(p*v*m),T=n.bufferSync(a),N=0;N<l.batchSize;++N)for(var A=0;A<l.inChannels;++A)for(var R=0;R<l.inDepth;++R)for(var _=0;_<l.inHeight;++_)for(var D=0;D<l.inWidth;++D){for(var F=R-w,O=_-S,L=D-I,M=0,P=0;P<k;P+=g){var z=(F+P)/h;if(!(z<0||z>=l.outDepth||Math.floor(z)!==z))for(var B=0;B<V;B+=y){var U=(O+B)/f;if(!(U<0||U>=l.outHeight||Math.floor(U)!==U))for(var W=0;W<x;W+=b){var j=(L+W)/d;if(!(j<0||j>=l.outWidth||Math.floor(j)!==j))M+=T.get(N,z,U,j,A)}}}C.set(M*E,N,R,_,D,A)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}};var SG={kernelName:jw,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;iZ([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=dA(o.shape,s,u,1,c),h=l.strideHeight,f=l.strideWidth,d=l.filterHeight,p=l.filterWidth,v=l.dilationHeight,m=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,k=g-1-l.padInfo.top,V=uN(o.shape,"float32"),x=1/(d*p),w=n.data.get(a.dataId).values,I=uN(a.shape,"float32",w),S=0;S<l.batchSize;++S)for(var C=0;C<l.inChannels;++C)for(var E=0;E<l.inHeight;++E)for(var T=0;T<l.inWidth;++T){for(var N=E-k,A=T-b,R=0,_=0;_<g;_+=v){var D=(N+_)/h;if(!(D<0||D>=l.outHeight||Math.floor(D)!==D))for(var F=0;F<y;F+=m){var O=(A+F)/f;if(!(O<0||O>=l.outWidth||Math.floor(O)!==O))R+=I.get(S,D,O,C)}}V.set(R*x,S,E,T,C)}return n.makeTensorInfo(V.shape,V.dtype,V.values)}};var CG={kernelName:LI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;Bx(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Bx(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Bx(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),iZ([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,f=n.data.get(u.dataId).values,d=i?n.data.get(i.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(l.length),m=p.length,g=d.length,y=f.length,b=h.length,k=0,V=0,x=0,w=0,I=0;I<l.length;++I)v[I]=p[k++]+(l[I]-h[V++])*d[x++]/Math.sqrt(f[w++]+c),k>=m&&(k=0),V>=b&&(V=0),x>=g&&(x=0),w>=y&&(w=0);return n.makeTensorInfo(a.shape,a.dtype,v)}};function EG(e,t,n,r,a){var i=ZN(r,t,n),o=Zx(n),s=cw(r);if(i){var u=GN(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=uN(r,a,"string"===a?RF(e):e),l=uN(n,a),h=0;h<l.size;++h){var f=l.indexToLoc(h),d=f.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,(0,H.Z)(d))].concat((0,H.Z)(f)))}return"string"===a?l.values.map((function(e){return uE(e)})):l.values}function TG(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;iZ(a,"slice");var s=HN(a,i,o),u=(0,l.Z)(s,2),c=u[0],h=u[1];WN(a,c,h);var f=EG(n.data.get(a.dataId).values,c,h,a.shape,a.dtype);return n.makeTensorInfo(h,a.dtype,f)}var NG={kernelName:KS,backendName:"cpu",kernelFunc:TG};var AG={kernelName:qw,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;iZ([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=$D(a.shape,i,s),c=eF(u.length,i.length),l=tF(a.shape,i,s),h=nF(o,i.length),f=rF(l,o,i.length),d=jZ({inputs:{x:a},backend:n,attrs:{shape:u}}),p=nG({inputs:{x:d},backend:n,attrs:{perm:c}}),v=jZ({inputs:{x:p},backend:n,attrs:{shape:l}}),m=TG({inputs:{x:v},backend:n,attrs:{begin:h,size:f}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),m}};function RG(e,t,n,r,a){for(var i=Zx(r),o=dw(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function _G(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=uN([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var DG={kernelName:Kw,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=RG(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};var FG={kernelName:Xw,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=PN(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},OG=IZ((function(e){return Math.ceil(e)})),LG=cZ(Yw,OG),MG={kernelName:Yw,backendName:"cpu",kernelFunc:LG},PG=uZ(Jw,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),zG={kernelName:Jw,backendName:"cpu",kernelFunc:PG},BG={kernelName:eI,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(Zx(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],h=u[c];r[c]=Math.hypot(l,h)}return n.makeOutput(r,t.shape,"float32")}};function UG(e,t,n,r){var a=ew(n,Zx(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=Zx(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?RF(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}function WG(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var jG={kernelName:jI,backendName:"cpu",kernelFunc:WG};function ZG(e){var t=e.inputs,n=e.backend,r=Yx(e.attrs.axis,t[0].shape)[0],a=QD(t.map((function(e){return e.shape})),r);if(0===Zx(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return Zx(e.shape)>0}));if(1===i.length)return fZ({inputs:{x:i[0]},backend:n});var o=i.map((function(e){return e.shape}));if(XD(o,r),"complex64"===i[0].dtype){var s=i.map((function(e){return _Z({inputs:{input:e},backend:n})})),u=i.map((function(e){return WG({inputs:{input:e},backend:n})})),c=ZG({inputs:s,backend:n,attrs:{axis:r}}),l=ZG({inputs:u,backend:n,attrs:{axis:r}}),h=NZ({inputs:{real:c,imag:l},backend:n});return s.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),h}var f=i.map((function(e){var t=Zx(e.shape.slice(r));return jZ({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),d=f.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));a=QD(f.map((function(e){return e.shape})),1);var p=1===f[0].shape[0],v=UG(d,a,t[0].dtype,p),m=QD(i.map((function(e){return e.shape})),r),g=n.makeTensorInfo(m,t[0].dtype,v);return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}var GG={kernelName:tI,backendName:"cpu",kernelFunc:ZG};function HG(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;iZ([a,i],"conv2d");for(var h=CA(u),f=vA(a.shape,i.shape,o,c,s,l,!1,h),d=f.filterHeight,p=f.filterWidth,v=f.dilationHeight,m=f.dilationWidth,g=f.padInfo.left,y=f.padInfo.top,b="channelsLast"===f.dataFormat,k=new bE(f.outShape,a.dtype),V=cw(a.shape),x=cw(i.shape),w=V[0],I=b?V[1]:V[2],S=b?V[2]:1,C=b?1:V[1],E=k.strides[0],T=b?k.strides[1]:k.strides[2],N=b?k.strides[2]:1,A=b?1:k.strides[1],R=n.data.get(a.dataId).values,_=n.data.get(i.dataId).values,D=k.values,F=0;F<f.batchSize;++F)for(var O=F*w,L=F*E,M=0;M<f.outHeight;++M)for(var P=L+M*T,z=M*f.strideHeight-y,B=0;B<d;++B){var U=z+B*v;if(!(U<0||U>=f.inHeight))for(var W=B*x[0],j=O+U*I,Z=0;Z<f.outWidth;++Z)for(var G=P+Z*N,H=Z*f.strideWidth-g,q=0;q<p;++q){var K=H+q*m;if(!(K<0||K>=f.inWidth))for(var X=j+K*S,Q=W+q*x[1],Y=0;Y<f.inChannels;++Y){for(var J=R[X+Y*C],$=0;$<f.outChannels;++$)D[G+$*A]+=J*_[Q+$];Q+=f.outChannels}}}return n.makeTensorInfo(k.shape,k.dtype,D)}var qG={kernelName:nI,backendName:"cpu",kernelFunc:HG};var KG={kernelName:rI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;iZ([a,i],"conv2dBackpropFilter");for(var h=CA(u),f=vA(a.shape,l,o,1,s,c,!1,h),d=f.strideHeight,p=f.strideWidth,v=f.filterHeight,m=f.filterWidth,g="channelsLast"===f.dataFormat,y=new bE(f.filterShape,"float32"),b=f.padInfo.left,k=f.padInfo.top,V=n.data.get(a.dataId).values,x=n.data.get(i.dataId).values,w=new bE(a.shape,a.dtype,V),I=new bE(i.shape,i.dtype,x),S=0;S<v;++S)for(var C=Math.max(0,Math.ceil((k-S)/d)),E=Math.min(f.outHeight,(f.inHeight+k-S)/d),T=0;T<m;++T)for(var N=Math.max(0,Math.ceil((b-T)/p)),A=Math.min(f.outWidth,(f.inWidth+b-T)/p),R=0;R<f.inChannels;++R)for(var _=0;_<f.outChannels;++_){for(var D=0,F=0;F<f.batchSize;++F)for(var O=C;O<E;++O)for(var L=S+O*d-k,M=N;M<A;++M){var P=T+M*p-b;D+=g?w.get(F,L,P,R)*I.get(F,O,M,_):w.get(F,R,L,P)*I.get(F,_,O,M)}y.set(D,S,T,R,_)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var XG={kernelName:aI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,h=r.dimRoundingMode;iZ([a,i],"conv2dBackpropInput");var f=cw(i.shape),d=cw(a.shape),p=CA(c),v=vA(o,i.shape,s,1,u,h,!1,p),m=new bE(v.inShape,"float32"),g=m.values,y=n.data.get(a.dataId).values,b=n.data.get(i.dataId).values,k=(0,l.Z)(f,3),V=k[0],x=k[1],w=k[2],I=v.batchSize,S=v.filterHeight,C=v.filterWidth,E=v.inChannels,T=v.inHeight,N=v.inWidth,A=v.outChannels,R=v.outHeight,_=v.outWidth,D=v.strideHeight,F=v.strideWidth;p=v.dataFormat;for(var O=S-1-v.padInfo.top,L=C-1-v.padInfo.left,M="channelsLast"===p,P=m.strides[0],z=M?m.strides[1]:m.strides[2],B=M?m.strides[2]:1,U=M?1:m.strides[1],W=d[0],j=M?d[1]:d[2],Z=M?d[2]:1,G=M?1:d[1],H=0;H<I;++H)for(var q=0;q<E;++q)for(var K=0;K<T;++K)for(var X=K-O,Q=Math.max(0,Math.ceil(X/D)),Y=Math.min(R,(S+X)/D),J=0;J<N;++J){for(var $=J-L,ee=Math.max(0,Math.ceil($/F)),te=Math.min(_,(C+$)/F),ne=0,re=Q;re<Y;++re)for(var ae=re*D-X,ie=ee;ie<te;++ie)for(var oe=W*H+j*re+Z*ie,se=V*(S-1-ae)+x*(C-1-(ie*F-$))+w*q,ue=0;ue<A;++ue){ne+=y[oe+G*ue]*b[se+ue]}g[P*H+z*K+B*J+U*q]=ne}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var QG={kernelName:iI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;iZ([a,i],"conv3d");for(var c=mA(a.shape,i.shape,o,u,s),l=c.filterDepth,h=c.filterHeight,f=c.filterWidth,d=c.dilationDepth,p=c.dilationHeight,v=c.dilationWidth,m=c.padInfo,g=m.front,y=m.left,b=m.top,k=new bE(c.outShape,a.dtype),V=n.data.get(a.dataId).values,x=n.data.get(i.dataId).values,w=k.values,I=cw(a.shape),S=cw(i.shape),C=0;C<c.batchSize;++C)for(var E=C*I[0],T=C*k.strides[0],N=0;N<c.outDepth;++N)for(var A=T+N*k.strides[1],R=N*c.strideDepth-g,_=0;_<l;++_){var D=R+_*d;if(!(D<0||D>=c.inDepth))for(var F=_*S[0],O=E+D*I[1],L=0;L<c.outHeight;++L)for(var M=A+L*k.strides[2],P=L*c.strideHeight-b,z=0;z<h;++z){var B=P+z*p;if(!(B<0||B>=c.inHeight))for(var U=F+z*S[1],W=O+B*I[2],j=0;j<c.outWidth;++j)for(var Z=M+j*c.outChannels,G=j*c.strideWidth-y,H=0;H<f;++H){var q=G+H*v;if(!(q<0||q>=c.inWidth))for(var K=U+H*S[2],X=W+q*c.inChannels,Q=K,Y=0;Y<c.inChannels;++Y){for(var J=V[X+Y],$=0;$<c.outChannels;++$)w[Z+$]+=J*x[Q+$];Q+=c.outChannels}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var YG={kernelName:oI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;iZ([a,i],"conv3dBackpropFilterV2");for(var c=cw(a.shape),h=cw(i.shape),f=mA(a.shape,u,o,1,s),d=f.strideDepth,p=f.strideHeight,v=f.strideWidth,m=f.filterDepth,g=f.filterHeight,y=f.filterWidth,b=new bE(f.filterShape,"float32"),k=b.values,V=(0,l.Z)(b.strides,4),x=V[0],w=V[1],I=V[2],S=V[3],C=n.data.get(i.dataId).values,E=(0,l.Z)(h,4),T=E[0],N=E[1],A=E[2],R=E[3],_=n.data.get(a.dataId).values,D=(0,l.Z)(c,4),F=D[0],O=D[1],L=D[2],M=D[3],P=f.padInfo.front,z=f.padInfo.left,B=f.padInfo.top,U=0;U<m;++U)for(var W=Math.max(0,Math.ceil((P-U)/d)),j=Math.min(f.outDepth,(f.inDepth+P-U)/d),Z=U*x,G=0;G<g;++G)for(var H=Math.max(0,Math.ceil((B-G)/p)),q=Math.min(f.outHeight,(f.inHeight+B-G)/p),K=G*w+Z,X=0;X<y;++X)for(var Q=Math.max(0,Math.ceil((z-X)/v)),Y=Math.min(f.outWidth,(f.inWidth+z-X)/v),J=X*I+K,$=0;$<f.inChannels;++$)for(var ee=$*S+J,te=0;te<f.outChannels;++te){for(var ne=0,re=0;re<f.batchSize;++re)for(var ae=re*F,ie=re*T,oe=W;oe<j;++oe)for(var se=(U+oe*d-P)*O+ae,ue=oe*N+ie,ce=H;ce<q;++ce)for(var le=(G+ce*p-B)*L+se,he=ce*A+ue,fe=Q;fe<Y;++fe){var de=fe*R+he;ne+=_[(X+fe*v-z)*M+le+$]*C[de+te]}k[ee+te]=ne}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var JG={kernelName:sI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;iZ([a],"conv3dBackpropInputV2");for(var c=cw(a.shape),h=cw(i.shape),f=mA(u,i.shape,s,1,o),d=new bE(f.inShape,"float32"),p=d.values,v=(0,l.Z)(d.strides,4),m=v[0],g=v[1],y=v[2],b=v[3],k=n.data.get(a.dataId).values,V=(0,l.Z)(c,4),x=V[0],w=V[1],I=V[2],S=V[3],C=n.data.get(i.dataId).values,E=(0,l.Z)(h,4),T=E[0],N=E[1],A=E[2],R=E[3],_=f.batchSize,D=f.filterDepth,F=f.filterHeight,O=f.filterWidth,L=f.inChannels,M=f.inDepth,P=f.inHeight,z=f.inWidth,B=f.outChannels,U=f.outDepth,W=f.outHeight,j=f.outWidth,Z=f.strideDepth,G=f.strideHeight,H=f.strideWidth,q=D-1-f.padInfo.front,K=F-1-f.padInfo.top,X=O-1-f.padInfo.left,Q=0;Q<_;++Q)for(var Y=0;Y<L;++Y)for(var J=0;J<M;++J)for(var $=J-q,ee=Math.max(0,Math.ceil($/Z)),te=Math.min(U,(D+$)/Z),ne=0;ne<P;++ne)for(var re=ne-K,ae=Math.max(0,Math.ceil(re/G)),ie=Math.min(W,(F+re)/G),oe=0;oe<z;++oe){for(var se=oe-X,ue=Math.max(0,Math.ceil(se/H)),ce=Math.min(j,(O+se)/H),le=0,he=ee;he<te;++he)for(var fe=he*Z-$,de=ae;de<ie;++de)for(var pe=de*G-re,ve=ue;ve<ce;++ve)for(var me=x*Q+w*he+I*de+S*ve,ge=T*(D-1-fe)+N*(F-1-pe)+A*(O-1-(ve*H-se))+R*Y,ye=0;ye<B;++ye){le+=k[me+ye]*C[ge+ye]}p[m*Q+g*J+y*ne+b*oe+Y]=le}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},$G=uZ(uI,(function(e){return Math.cos(e)})),eH={kernelName:uI,backendName:"cpu",kernelFunc:$G},tH=uZ(cI,(function(e){return Math.cosh(e)})),nH={kernelName:cI,backendName:"cpu",kernelFunc:tH};var rH={kernelName:fI,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,h=(0,l.Z)(a.shape,4),f=h[0],d=h[1],p=h[2],v=h[3],m=i.shape[0],g=(0,l.Z)(s,2),y=g[0],b=g[1],k=uN([m,y,b,v],"float32"),V=n.data.get(i.dataId).values,x=n.data.get(o.dataId).values,w=n.data.get(a.dataId).values,I=cw(a.shape),S=cw(k.shape),C=0;C<m;C++){var E=4*C,T=V[E],N=V[E+1],A=V[E+2],R=V[E+3],_=x[C];if(!(_>=f))for(var D=y>1?(A-T)*(d-1)/(y-1):0,F=b>1?(R-N)*(p-1)/(b-1):0,O=0;O<y;O++){var L=y>1?T*(d-1)+O*D:.5*(T+A)*(d-1);if(L<0||L>d-1)for(var M=0;M<b;M++)for(var P=0;P<v;P++){var z=P+M*S[2]+O*S[1]+C*S[0];k.values[z]=c}else if("bilinear"===u)for(var B=Math.floor(L),U=Math.ceil(L),W=L-B,j=0;j<b;j++){var Z=b>1?N*(p-1)+j*F:.5*(N+R)*(p-1);if(Z<0||Z>p-1)for(var G=0;G<v;G++){var H=G+j*S[2]+O*S[1]+C*S[0];k.values[H]=c}else for(var q=Math.floor(Z),K=Math.ceil(Z),X=Z-q,Q=0;Q<v;Q++){var Y=Q+q*I[2]+B*I[1]+_*I[0],J=w[Y],$=w[Y=Q+K*I[2]+B*I[1]+_*I[0]],ee=w[Y=Q+q*I[2]+U*I[1]+_*I[0]],te=J+($-J)*X,ne=ee+(w[Y=Q+K*I[2]+U*I[1]+_*I[0]]-ee)*X;Y=Q+j*S[2]+O*S[1]+C*S[0],k.values[Y]=te+(ne-te)*W}}else for(var re=0;re<b;++re){var ae=b>1?N*(p-1)+re*F:.5*(N+R)*(p-1);if(ae<0||ae>p-1)for(var ie=0;ie<v;ie++){var oe=ie+re*S[2]+O*S[1]+C*S[0];k.values[oe]=c}else for(var se=Math.round(ae),ue=Math.round(L),ce=0;ce<v;ce++){var le=ce+se*I[2]+ue*I[1]+_*I[0],he=ce+re*S[2]+O*S[1]+C*S[0];k.values[he]=w[le]}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var aH={kernelName:lI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;iZ(a,"cumprod");var u=TR([i],a.shape.length),c=a;null!=u&&(c=nG({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=AR(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumprod in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var h=RE(c.dtype,"int32"),f=fw(Zx(c.shape),h),d=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],v=s?function(e,t){return e+p-t-1}:function(e,t){return e+t},m=0;m<d.length;m+=p)for(var g=0;g<p;g++){var y=v(m,g);if(0===g)f[y]=o?1:d[y];else{var b=v(m,g-1);f[y]=o?d[b]*f[b]:d[y]*f[b]}}var k=n.makeTensorInfo(c.shape,h,f);if(null!=u){var V=nG({inputs:{x:k},backend:n,attrs:{perm:NR(u)}});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(c),V}return k}};var iH={kernelName:hI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;iZ(a,"cumsum");var u=TR([i],a.shape.length),c=a;null!=u&&(c=nG({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=AR(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var h=RE(c.dtype,"int32"),f=dw(Zx(c.shape),h),d=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],v=s?function(e,t){return e+p-t-1}:function(e,t){return e+t},m=0;m<d.length;m+=p)for(var g=0;g<p;g++){var y=v(m,g);if(0===g)f[y]=o?0:d[y];else{var b=v(m,g-1);f[y]=o?d[b]+f[b]:d[y]+f[b]}}var k=n.makeTensorInfo(c.shape,h,f);if(null!=u){var V=nG({inputs:{x:k},backend:n,attrs:{perm:NR(u)}});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(c),V}return k}};var oH={kernelName:dI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=RG(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=_G(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};var sH={kernelName:pI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;Bx("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],h=u*i,f=c*i,d=l/(i*i),p=n.data.get(a.dataId).values,v=new Float32Array(s*h*f*d),m=0,g=0;g<s;++g)for(var y=0;y<h;++y)for(var b=Math.floor(y/i),k=y%i,V=0;V<f;++V)for(var x=Math.floor(V/i),w=(k*i+V%i)*d,I=0;I<d;++I){var S=I+w+l*(x+c*(b+u*g));v[m++]=p[S]}return n.makeTensorInfo([s,h,f,d],a.dtype,v)}};function uH(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;iZ([a,i],"depthwiseConv2DNative");var l=cw(a.shape),h=cw(i.shape),f=u;null==f&&(f=[1,1]),Bx(SA(o,f),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(f,"'")}));for(var d=vA(a.shape,i.shape,o,f,s,c,!0),p=d.filterHeight,v=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo,b=y.left,k=y.top,V=d.outChannels/d.inChannels,x=new bE(d.outShape,a.dtype),w=n.data.get(a.dataId).values,I=n.data.get(i.dataId).values,S=x.values,C=0;C<d.batchSize;++C)for(var E=C*l[0],T=C*x.strides[0],N=0;N<d.outHeight;++N)for(var A=T+N*x.strides[1],R=N*d.strideHeight-k,_=0;_<p;++_){var D=R+_*m;if(!(D<0||D>=d.inHeight))for(var F=_*h[0],O=E+D*l[1],L=0;L<d.outWidth;++L)for(var M=A+L*x.strides[2],P=L*d.strideWidth-b,z=0;z<v;++z){var B=P+z*g;if(!(B<0||B>=d.inWidth))for(var U=F+z*h[1],W=O+B*d.inChannels,j=M,Z=U,G=0;G<d.inChannels;++G){for(var H=w[W+G],q=0;q<V;++q)S[j+q]+=H*I[Z+q];j+=V,Z+=V}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}var cH={kernelName:vI,backendName:"cpu",kernelFunc:uH};var lH={kernelName:mI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;iZ([a,i],"depthwiseConv2dNativeBackpropFilter");for(var h=vA(a.shape,l,o,s,u,c,!0),f=h.strideHeight,d=h.strideWidth,p=h.filterHeight,v=h.filterWidth,m=new bE(h.filterShape,"float32"),g=h.padInfo.left,y=h.padInfo.top,b=h.outChannels/h.inChannels,k=n.data.get(a.dataId).values,V=new bE(a.shape,a.dtype,k),x=n.data.get(i.dataId).values,w=new bE(i.shape,i.dtype,x),I=0;I<p;++I)for(var S=Math.max(0,Math.ceil((y-I)/f)),C=Math.min(h.outHeight,(h.inHeight+y-I)/f),E=0;E<v;++E)for(var T=Math.max(0,Math.ceil((g-E)/d)),N=Math.min(h.outWidth,(h.inWidth+g-E)/d),A=0;A<h.outChannels;++A){for(var R=Math.trunc(A/b),_=A%b,D=0,F=0;F<h.batchSize;++F)for(var O=S;O<C;++O)for(var L=I+O*f-y,M=T;M<N;++M){var P=E+M*d-g;D+=V.get(F,L,P,R)*w.get(F,O,M,A)}m.set(D,I,E,R,_)}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var hH={kernelName:gI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,h=r.inputShape;iZ([a,i],"depthwiseConv2DNativeBackpropInput");for(var f=cw(a.shape),d=cw(i.shape),p=vA(h,i.shape,o,s,u,c,!0),v=new bE(p.inShape,"float32"),m=v.values,g=(0,l.Z)(v.strides,3),y=g[0],b=g[1],k=g[2],V=n.data.get(a.dataId).values,x=(0,l.Z)(f,3),w=x[0],I=x[1],S=x[2],C=n.data.get(i.dataId).values,E=(0,l.Z)(d,3),T=E[0],N=E[1],A=E[2],R=p.batchSize,_=p.filterHeight,D=p.filterWidth,F=p.inChannels,O=p.inHeight,L=p.inWidth,M=p.outChannels,P=p.outHeight,z=p.outWidth,B=p.strideHeight,U=p.strideWidth,W=_-1-p.padInfo.top,j=D-1-p.padInfo.left,Z=M/F,G=0;G<R;++G)for(var H=0;H<F;++H)for(var q=0;q<O;++q)for(var K=q-W,X=Math.max(0,Math.ceil(K/B)),Q=Math.min(P,(_+K)/B),Y=0;Y<L;++Y){for(var J=Y-j,$=Math.max(0,Math.ceil(J/U)),ee=Math.min(z,(D+J)/U),te=0,ne=X;ne<Q;++ne)for(var re=ne*B-K,ae=$;ae<ee;++ae)for(var ie=w*G+I*ne+S*ae,oe=T*(_-1-re)+N*(D-1-(ae*U-J))+A*H,se=0;se<Z;++se){te+=V[ie+(H*Z+se)]*C[oe+se]}m[y*G+b*q+k*Y+H]=te}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var fH={kernelName:yI,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=Zx(r.shape),i=n.data.get(r.dataId).values,o=uN([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat((0,H.Z)(r.shape),(0,H.Z)(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},dH={kernelName:bI,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,h=a.shape.length,f=c.data.get(i.dataId).values,d=i.shape.length,p=fA(a.shape,i.shape,o,s,"NHWC",u),v=p.batchSize,m=p.inHeight,g=p.inWidth,y=p.inChannels,b=p.outHeight,k=p.outWidth,V=p.padInfo,x=p.strideHeight,w=p.strideWidth,I=p.filterHeight,S=p.filterWidth,C=p.dilationHeight,E=p.dilationWidth,T=p.outShape,N=Zx(T),A=T.length,R=ew(a.dtype,N),_=0;_<v;++_)for(var D=0;D<b;++D)for(var F=D*x-V.top,O=0;O<k;++O)for(var L=O*w-V.left,M=0;M<y;++M){for(var P=Number.MIN_SAFE_INTEGER,z=0;z<I;++z){var B=F+z*C;if(B>=0&&B<m)for(var U=0;U<S;++U){var W=L+U*E;if(W>=0&&W<g){var j=mw([_,B,W,M],h,cw(a.shape)),Z=mw([z,U,M],d,cw(i.shape)),G=l[j]+f[Z];G>P&&(P=G)}}}R[mw([_,D,O,M],A,cw(T))]=P}return{dataId:c.write(oE(R,a.dtype),T,a.dtype),shape:T,dtype:a.dtype}}},pH={kernelName:VI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,h=hw(a.shape,l.data.get(a.dataId).values),f=hw(i.shape,l.data.get(i.dataId).values),d=fA(a.shape,i.shape,s,u,"NHWC",c),p=d.batchSize,v=d.inHeight,m=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,k=d.padInfo,V=d.strideHeight,x=d.strideWidth,w=d.filterHeight,I=d.filterWidth,S=d.dilationHeight,C=d.dilationWidth,E=d.outShape;Bx(o.rank===E.length,(function(){return"Error in ".concat(VI,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(o.rank)}));for(var T=hw(E,l.data.get(o.dataId).values),N=pw(i.shape,i.dtype),A=0;A<p;++A)for(var R=0;R<y;++R)for(var _=R*V-k.top,D=0;D<b;++D)for(var F=D*x-k.left,O=0;O<g;++O){for(var L=Number.MIN_SAFE_INTEGER,M=0,P=0,z=0;z<w;++z){var B=_+z*S;if(B>=0&&B<v)for(var U=0;U<I;++U){var W=F+U*C;if(W>=0&&W<m){var j=h[A][B][W][O]+f[z][U][O];j>L&&(L=j,M=z,P=U)}}}N[M][P][O]+=T[A][R][D][O]}return{dataId:l.write(oE(N,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},vH={kernelName:kI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,h=hw(a.shape,l.data.get(a.dataId).values),f=hw(i.shape,l.data.get(i.dataId).values),d=fA(a.shape,i.shape,s,u,"NHWC",c),p=d.batchSize,v=d.inHeight,m=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,k=d.padInfo,V=d.strideHeight,x=d.strideWidth,w=d.filterHeight,I=d.filterWidth,S=d.dilationHeight,C=d.dilationWidth,E=d.outShape;Bx(o.rank===E.length,(function(){return"Error in ".concat(kI,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(o.rank)}));for(var T=hw(E,l.data.get(o.dataId).values),N=pw(a.shape,a.dtype),A=0;A<p;++A)for(var R=0;R<y;++R)for(var _=R*V-k.top,D=0;D<b;++D)for(var F=D*x-k.left,O=0;O<g;++O){for(var L=Number.MIN_SAFE_INTEGER,M=_<0?0:_,P=F<0?0:F,z=0;z<w;++z){var B=_+z*S;if(B>=0&&B<v)for(var U=0;U<I;++U){var W=F+U*C;if(W>=0&&W<m){var j=h[A][B][W][O]+f[z][U][O];j>L&&(L=j,M=B,P=W)}}}N[A][M][P][O]+=T[A][R][D][O]}return{dataId:l.write(oE(N,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},mH=mZ((function(e,t){return e*t})),gH=PZ((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),yH=MZ(gS,mH,gH),bH={kernelName:gS,backendName:"cpu",kernelFunc:yH};function kH(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims;iZ(i,"sum");var u=(t="bool"===i.dtype?OZ({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):fZ({inputs:{x:i},backend:r})).shape.length,c=Yx(o,t.shape),h=TR(c,u),f=c,d=t;null!=h&&(d=nG({inputs:{x:t},backend:r,attrs:{perm:h}}),f=AR(f.length,u)),ER("sum",f,d.shape.length);for(var p=SR(d.shape,f),v=(0,l.Z)(p,2),m=v[0],g=v[1],y=RZ(r,m,RE(d.dtype,"int32")),b=Zx(g),k=r.data.get(y.dataId).values,V=r.data.get(d.dataId).values,x=0;x<k.length;++x){for(var w=x*b,I=0,S=0;S<b;++S)I+=V[w+S];k[x]=I}if(s){var C=y;y=jZ({inputs:{x:y},backend:r,attrs:{shape:CR(y.shape,c)}}),r.disposeIntermediateTensorInfo(C)}return r.disposeIntermediateTensorInfo(t),null!=h&&r.disposeIntermediateTensorInfo(d),y}var VH={kernelName:tC,backendName:"cpu",kernelFunc:kH};var xH={kernelName:wI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=kF(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;xF(i.length,s,r);for(var u=wF(o,s),c=u.path,l=u.steps,h=l.length,f=null,d=i.length,p=[],v=0;v<h;++v){var g,y=m(l[v]);try{for(y.s();!(g=y.n()).done;){var b=g.value,k=VF(d,s[b]),V=k.permutationIndices,x=k.expandDims,w=void 0;IF(V)?w=r[b]:(w=nG({inputs:{x:r[b]},backend:n,attrs:{perm:V}}),p.push(w));for(var I=w.shape.slice(),S=0;S<x.length;++S)I.splice(x[S],0,1);Gx(w.shape,I)||(w=jZ({inputs:{x:w},backend:n,attrs:{shape:I}}),p.push(w)),null===f?f=w:(f=yH({inputs:{a:w,b:f},backend:n}),p.push(f))}}catch(h6){y.e(h6)}finally{y.f()}v<h-1&&(c[v]>=0&&(f=kH({inputs:{x:f},backend:n,attrs:{axis:c[v]-(i.length-d),keepDims:!1}}),p.push(f)),d--)}for(var C=0,E=p;C<E.length;C++){var T=E[C];T!==f&&n.disposeIntermediateTensorInfo(T)}return f}};var wH={kernelName:SI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;iZ([r,a],"eluGrad");for(var i=new Float32Array(Zx(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=1?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},IH=mZ((function(e,t){return e===t?1:0})),SH=MZ(EI,IH,null,"bool"),CH={kernelName:EI,backendName:"cpu",kernelFunc:SH},EH=uZ(CI,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+.3275911*n);return t*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-n*n))})),TH={kernelName:CI,backendName:"cpu",kernelFunc:EH},NH=IZ((function(e){return Math.exp(e)})),AH=cZ(TI,NH,"float32"),RH={kernelName:TI,backendName:"cpu",kernelFunc:AH};function _H(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(Bx(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),jZ({inputs:{x:a},backend:n,attrs:{shape:s}})}var DH={kernelName:NI,backendName:"cpu",kernelFunc:_H},FH=IZ((function(e){return Math.expm1(e)})),OH=cZ(AI,FH),LH={kernelName:AI,backendName:"cpu",kernelFunc:OH},MH=mZ((function(e,t){return e/t})),PH=MZ(xI,MH),zH={kernelName:xI,backendName:"cpu",kernelFunc:PH},BH=mZ((function(e,t){return e-t})),UH=PZ((function(e,t,n,r){return{real:e-n,imag:t-r}})),WH=MZ(mC,BH,UH),jH={kernelName:mC,backendName:"cpu",kernelFunc:WH};function ZH(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=Zx(c),h=$x("float32",l),f=$x("float32",l),d=0;d<a;d++){for(var p=TG({inputs:{x:s},backend:n,attrs:{begin:[d,0],size:[1,i]}}),v=TG({inputs:{x:u},backend:n,attrs:{begin:[d,0],size:[1,i]}}),m=NZ({inputs:{real:p,imag:v},backend:n}),g=GH(m,t,n),y=pF(g.real,g.imag),b=0;b<i;b++){var k=vF(y,b);h[d*i+b]=k.real,f[d*i+b]=k.imag}n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m)}var V=n.makeTensorInfo(c,"float32",h),x=n.makeTensorInfo(c,"float32",f),w=NZ({inputs:{real:V,imag:x},backend:n});return n.disposeIntermediateTensorInfo(V),n.disposeIntermediateTensorInfo(x),w}function GH(e,t,n){var r=Zx(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0===((g=r)&g-1)){var s=HH(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),h=n.makeTensorInfo([],"float32",iE(r,"float32")),f=fZ({inputs:{x:h},backend:n}),d=zH.kernelFunc({inputs:{a:c,b:h},backend:n}),p=zH.kernelFunc({inputs:{a:l,b:f},backend:n}),v=n.data.get(d.dataId).values,m=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),{real:v,imag:m}}return s}var g,y=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=gF(a*s,t,n),c=vF(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),mF(r,i,o,a)}return r}(pF(i,o),r,t);return function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(y)}function HH(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=pF(e,t),o=n/2,s=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(i),u=s.real,c=s.imag,l=[u.length],h=a.makeTensorInfo(l,"float32",u),f=a.makeTensorInfo(l,"float32",c),d=NZ({inputs:{real:h,imag:f},backend:a}),p=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(i),v=p.real,m=p.imag,g=[v.length],y=a.makeTensorInfo(g,"float32",v),b=a.makeTensorInfo(g,"float32",m),k=NZ({inputs:{real:y,imag:b},backend:a}),V=HH(u,c,o,r,a),x=V.real,w=V.imag,I=[x.length],S=a.makeTensorInfo(I,"float32",x),C=a.makeTensorInfo(I,"float32",w),E=NZ({inputs:{real:S,imag:C},backend:a}),T=HH(v,m,o,r,a),N=T.real,A=T.imag,R=[N.length],_=a.makeTensorInfo(R,"float32",N),D=a.makeTensorInfo(R,"float32",A),F=NZ({inputs:{real:_,imag:D},backend:a}),O=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}(n,r),L=[O.real.length],M=a.makeTensorInfo(L,"float32",O.real),P=a.makeTensorInfo(L,"float32",O.imag),z=NZ({inputs:{real:M,imag:P},backend:a}),B=yH({inputs:{a:z,b:F},backend:a}),U=UZ({inputs:{a:E,b:B},backend:a}),W=WH({inputs:{a:E,b:B},backend:a}),j=_Z({inputs:{input:U},backend:a}),Z=_Z({inputs:{input:W},backend:a}),G=WG({inputs:{input:U},backend:a}),H=WG({inputs:{input:W},backend:a}),q=ZG({inputs:[j,Z],backend:a,attrs:{axis:0}}),K=ZG({inputs:[G,H],backend:a,attrs:{axis:0}}),X=a.data.get(q.dataId).values,Q=a.data.get(K.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(k),a.disposeIntermediateTensorInfo(S),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(_),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(M),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(Z),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(K),{real:X,imag:Q}}var qH={kernelName:RI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Zx(r.shape),i=r.shape[r.shape.length-1],o=jZ({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=ZH(o,!1,n),u=jZ({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function KH(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||ow(a),o=ew(i,Zx(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var XH={kernelName:_I,backendName:"cpu",kernelFunc:KH};var QH={kernelName:DI,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=$x(r.dtype,Zx(r.shape)),o=(0,l.Z)(r.shape,4),s=o[0],u=o[1],c=o[2],h=o[3],f=a.data.get(r.dataId).values,d=0;d<s;d++)for(var p=d*c*u*h,v=0;v<u;v++)for(var m=v*(c*h),g=0;g<c;g++)for(var y=g*h,b=0;b<h;b++){var k=Math.round(c-g-1),V=p+m+y+b,x=f[V];if(k>=0&&k<c)x=f[p+m+k*h+b];i[V]=x}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},YH=IZ((function(e){return Math.floor(e)})),JH=cZ(FI,YH),$H={kernelName:FI,backendName:"cpu",kernelFunc:JH},eq=mZ((function(e,t){return Math.floor(e/t)})),tq=MZ(OI,eq,null,"int32"),nq={kernelName:OI,backendName:"cpu",kernelFunc:tq};var rq={kernelName:RC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,f=r.dimRoundingMode,d=r.activation,p=r.leakyreluAlpha,v=HG({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:f}});if(o){var m=v;if("NCHW"===l&&1===o.shape.length&&1!==o.shape[0]){var g=jZ({inputs:{x:o},backend:n,attrs:{shape:[o.shape[0],1,1]}});v=UZ({inputs:{a:v,b:g},backend:n}),n.disposeIntermediateTensorInfo(g)}else v=UZ({inputs:{a:v,b:o},backend:n});n.disposeIntermediateTensorInfo(m)}if(d){var y=v;if("NCHW"===l&&"prelu"===d&&1===s.shape.length&&1!==s.shape[0]){var b=jZ({inputs:{x:s},backend:n,attrs:{shape:[s.shape[0],1,1]}});v=TZ(n,v,d,b,p),n.disposeIntermediateTensorInfo(b)}else v=TZ(n,v,d,s,p);n.disposeIntermediateTensorInfo(y)}return v}};var aq={kernelName:_C,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,f=r.dimRoundingMode,d=r.activation,p=r.leakyreluAlpha,v=uH({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:f}});if(o){var m=v;v=UZ({inputs:{a:v,b:o},backend:n}),n.disposeIntermediateTensorInfo(m)}if(d){var g=v;v=TZ(n,v,d,s,p),n.disposeIntermediateTensorInfo(g)}return v}};function iq(e,t,n,r,a,i,o,s,u){for(var c=uN([r,i],n),l=0;l<r;l++){for(var h=[],f=0,d=0;d<a;d++){var p=e[l*a+d];f+=p*o[d],h.push(p)}if(f<0||f>=u/i)throw new Error("Invalid indices: ".concat(h," does not index into ").concat(s));for(var v=0;v<i;v++)c.values[l*i+v]=t.get.apply(t,(0,H.Z)(t.indexToLoc(f*i+v)))}return c}var oq={kernelName:PI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=Zx(r.shape),o=a.shape,s=o[o.length-1],u=aF(r,a),c=(0,l.Z)(u,4),h=c[0],f=c[1],d=c[2],p=c[3];if(0===f)return n.makeTensorInfo(h,r.dtype,[]);var v=iq(n.data.get(a.dataId).values,n.bufferSync(r),r.dtype,f,s,d,p,r.shape,i);return n.makeTensorInfo(h,r.dtype,v.values)}};function sq(e,t,n){for(var r=uN(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);0<=c&&c<e.values.length&&(r.values[a]=e.values[c])}return r}var uq={kernelName:MI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;iZ([a,i],"gatherV2");for(var u=Yx(o,a.shape)[0],c=n.data.get(i.dataId).values,l=a.shape[u],h=function(e){var t=c[e];Bx(t<=l-1&&t>=0,(function(){return"GatherV2: the index value ".concat(t," is not in [0, ").concat(l-1,"]")}))},f=0;f<c.length;++f)h(f);var d=s;null==s&&(d=0);var p=Zx(i.shape),v=AF(a,i,u,d),m=jZ({inputs:{x:a},backend:n,attrs:{shape:[v.batchSize,v.outerSize,v.dimSize,v.sliceSize]}}),g=jZ({inputs:{x:i},backend:n,attrs:{shape:[v.batchSize,p/v.batchSize]}}),y=[v.batchSize,v.outerSize,p/v.batchSize,v.sliceSize],b=n.bufferSync(g),k=sq(n.bufferSync(m),b,y);return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),n.makeTensorInfo(v.outputShape,k.dtype,k.values)}},cq=mZ((function(e,t){return e>t?1:0})),lq=MZ(zI,cq,null,"bool"),hq={kernelName:zI,backendName:"cpu",kernelFunc:lq},fq=mZ((function(e,t){return e>=t?1:0})),dq=MZ(BI,fq,null,"bool"),pq={kernelName:BI,backendName:"cpu",kernelFunc:dq};var vq={kernelName:WI,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=Zx(r.shape),i=r.shape[r.shape.length-1],o=jZ({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=ZH(o,!0,n),u=jZ({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},mq=uZ(ZI,(function(e){return Number.isFinite(e)?1:0}),"bool"),gq={kernelName:ZI,backendName:"cpu",kernelFunc:mq},yq=uZ(GI,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),bq={kernelName:GI,backendName:"cpu",kernelFunc:yq},kq=uZ(HI,(function(e){return Number.isNaN(e)?1:0}),"bool"),Vq={kernelName:HI,backendName:"cpu",kernelFunc:kq},xq=mZ((function(e,t){return e<t?1:0})),wq=MZ(KI,xq,null,"bool"),Iq={kernelName:KI,backendName:"cpu",kernelFunc:wq},Sq=mZ((function(e,t){return e<=t?1:0})),Cq=MZ(XI,Sq,null,"bool"),Eq={kernelName:XI,backendName:"cpu",kernelFunc:Cq};function Tq(e,t,n){var r=(t-e)/(n-1),a=dw(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var Nq={kernelName:QI,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=Tq(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},Aq=IZ((function(e){return Math.log(e)})),Rq=cZ(YI,Aq),_q={kernelName:YI,backendName:"cpu",kernelFunc:Rq},Dq=uZ(JI,(function(e){return Math.log1p(e)})),Fq={kernelName:JI,backendName:"cpu",kernelFunc:Dq},Oq=mZ((function(e,t){return e&&t})),Lq=MZ($I,Oq,null,"bool"),Mq={kernelName:$I,backendName:"cpu",kernelFunc:Lq},Pq=uZ(eS,(function(e){return e?0:1}),"bool"),zq={kernelName:eS,backendName:"cpu",kernelFunc:Pq},Bq=mZ((function(e,t){return e||t})),Uq=MZ(tS,Bq,null,"bool"),Wq={kernelName:tS,backendName:"cpu",kernelFunc:Uq};var jq={kernelName:nS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;iZ(a,"LRN");var c=a.shape[3],l=c-1,h=n.data.get(a.dataId).values,f=Zx(a.shape),d=new Float32Array(f);function p(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=h[n];a+=o*o}return a}for(var v=0;v<f;v++){var m=p(v),g=h[v]*Math.pow(o+s*m,-u);d[v]=g}return n.makeTensorInfo(a.shape,a.dtype,d)}};var Zq={kernelName:rS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;iZ(o,"LRNGrad");for(var h=Zx(o.shape),f=o.shape[3],d=n.data.get(o.dataId).values,p=n.data.get(a.dataId).values,v=n.data.get(i.dataId).values,m=new Float32Array(h),g=h,y=0;y<g;y++){for(var b=y%f,k=y-b+Math.max(0,b-s),V=y-b+Math.min(f,b+s+1),x=0,w=k;w<V;w++)x+=Math.pow(p[w],2);x=c*x+u;for(var I=k;I<V;I++){var S=-2*c*l*p[I]*v[y]/x;y===I&&(S+=Math.pow(x,-l)),S*=d[y],m[I]+=S}}return n.makeTensorInfo(o.shape,a.dtype,m)}};function Gq(e,t,n,r){for(var a=$x(r,Zx(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];(Number.isNaN(c)||c>s)&&(s=c)}a[i]=s}return a}function Hq(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=n,u=a.shape,c=u.length,h=Yx(i,u),f=h,d=TR(f,c),p=s.data.get(a.dataId).values;if(null!=d){for(var v=new Array(c),m=0;m<v.length;m++)v[m]=u[d[m]];p=tG(p,u,a.dtype,d,v),f=AR(f.length,c),u=v}iZ(a,"max"),ER("max",f,c);var g=SR(u,f),y=(0,l.Z)(g,2),b=y[0],k=Gq(p,Zx(y[1]),b,a.dtype),V=s.write(k,b,a.dtype),x=b;o&&(x=v=CR(b,h));return{dataId:V,shape:x,dtype:a.dtype}}var qq={kernelName:aS,backendName:"cpu",kernelFunc:Hq},Kq=mZ((function(e,t){return Math.max(e,t)})),Xq=MZ(iS,Kq),Qq={kernelName:iS,backendName:"cpu",kernelFunc:Xq};var Yq={kernelName:oS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;iZ(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Bx(SA(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=dA(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&Gx(l.inShape,l.outShape))c=fZ({inputs:{x:a},backend:n});else{var h=n.data.get(a.dataId).values,f=cw(a.shape),d=bG(h,a.shape,a.dtype,f,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var Jq={kernelName:uS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat;iZ(a,"maxPool3d");var l=pA(a.shape,i,o,1,s,u,c),h=VG(n.data.get(a.dataId).values,a.shape,a.dtype,cw(a.shape),l,"max");return n.makeTensorInfo(h.shape,"float32",h.values)}};var $q={kernelName:cS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode;iZ([a,i],"maxPool3DGrad");for(var l=pA(i.shape,o,s,1,u,c),h=function(e,t){for(var n=uN(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left,v=0;v<t.batchSize;++v)for(var m=0;m<t.inChannels;++m)for(var g=0;g<t.outDepth;++g){for(var y=g*r-f,b=y;b<0;)b+=o;for(var k=Math.min(t.inDepth,c+y),V=0;V<t.outHeight;++V){for(var x=V*a-d,w=x;w<0;)w+=s;for(var I=Math.min(t.inHeight,l+x),S=0;S<t.outWidth;++S){for(var C=S*i-p,E=C;E<0;)E+=u;for(var T=Math.min(t.inWidth,h+C),N=Number.NEGATIVE_INFINITY,A=-1,R=b;R<k;R+=o)for(var _=R-y,D=w;D<I;D+=s)for(var F=D-x,O=E;O<T;O+=u){var L=O-C,M=e.get(v,R,D,O,m);M>=N&&(N=M,A=_*l*h+F*l+L)}n.set(A,v,g,V,S,m)}}}return n}(n.bufferSync(i),l),f=l.strideDepth,d=l.strideHeight,p=l.strideWidth,v=l.dilationDepth,m=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterDepth,b=l.effectiveFilterHeight,k=l.effectiveFilterWidth,V=y-1-l.padInfo.front,x=k-1-l.padInfo.left,w=b-1-l.padInfo.top,I=uN(i.shape,"float32"),S=n.bufferSync(a),C=0;C<l.batchSize;++C)for(var E=0;E<l.inChannels;++E)for(var T=0;T<l.inDepth;++T)for(var N=0;N<l.inHeight;++N)for(var A=0;A<l.inWidth;++A){for(var R=T-V,_=N-w,D=A-x,F=0,O=0;O<y;O+=v){var L=(R+O)/f;if(!(L<0||L>=l.outDepth||Math.floor(L)!==L))for(var M=0;M<b;M+=m){var P=(_+M)/d;if(!(P<0||P>=l.outHeight||Math.floor(P)!==P))for(var z=0;z<k;z+=g){var B=(D+z)/p;if(!(B<0||B>=l.outWidth||Math.floor(B)!==B)){var U=y*b*k-1-h.get(C,L,P,B,E)===O*b*k+M*k+z?1:0;if(0!==U)F+=S.get(C,L,P,B,E)*U}}}}I.set(F,C,T,N,A,E)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}};var eK={kernelName:sS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;iZ([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=dA(o.shape,s,u,1,c,l),f=n.data.get(o.dataId).values,d=uN(h.outShape,o.dtype,kG(f,o.shape,o.dtype,h).values),p=h.strideHeight,v=h.strideWidth,m=h.dilationHeight,g=h.dilationWidth,y=h.effectiveFilterHeight,b=h.effectiveFilterWidth,k=b-1-h.padInfo.left,V=y-1-h.padInfo.top,x=uN(o.shape,"float32"),w=n.data.get(a.dataId).values,I=uN(a.shape,"float32",w),S=0;S<h.batchSize;++S)for(var C=0;C<h.inChannels;++C)for(var E=0;E<h.inHeight;++E)for(var T=0;T<h.inWidth;++T){for(var N=E-V,A=T-k,R=0,_=0;_<y;_+=m){var D=(N+_)/p;if(!(D<0||D>=h.outHeight||Math.floor(D)!==D))for(var F=0;F<b;F+=g){var O=(A+F)/v;if(!(O<0||O>=h.outWidth||Math.floor(O)!==O)){var L=y*b-1-d.get(S,D,O,C)===_*b+F?1:0;if(0!==L)R+=I.get(S,D,O,C)*L}}}x.set(R,S,E,T,C)}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var tK={kernelName:lS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;iZ(a,"MaxPoolWithArgmax");var h=c.data.get(a.dataId).values,f=dA(a.shape,i,o,[1,1],s),d=function(e,t,n,r,a){var i=bG(e,0,n,cw(t),a,"max"),o=kG(e,t,n,a,!0,r);return[i.values,o.values]}(h,a.shape,a.dtype,u,f),p=(0,l.Z)(d,2),v=p[0],m=p[1],g=c.write(v,f.outShape,a.dtype),y=c.write(m,f.outShape,a.dtype);return[{dataId:g,shape:f.outShape,dtype:a.dtype},{dataId:y,shape:f.outShape,dtype:"int32"}]}};var nK={kernelName:hS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=Yx(i,a.shape),u=Zx(SR(a.shape,s)[1]),c=[],l=n.makeTensorInfo([],"float32",new Float32Array([u]));c.push(l);var h=OZ({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});c.push(h);var f=PH({inputs:{a:h,b:l},backend:n});c.push(f);var d=kH({inputs:{x:f},backend:n,attrs:{axis:i,keepDims:o}});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),d}};var rK={kernelName:fS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;iZ(a,"min");var s=Yx(i,a.shape),u=s,c=TR(u,a.shape.length),h=a;null!=c&&(h=nG({inputs:{x:a},backend:n,attrs:{perm:c}}),u=AR(u.length,a.shape.length)),ER("min",u,h.shape.length);for(var f=SR(h.shape,u),d=(0,l.Z)(f,2),p=d[0],v=Zx(d[1]),m=dw(Zx(p),h.dtype),g=n.data.get(h.dataId).values,y=0;y<m.length;++y){for(var b=y*v,k=g[b],V=0;V<v;++V){var x=g[b+V];(Number.isNaN(x)||x<k)&&(k=x)}m[y]=k}null!=c&&n.disposeIntermediateTensorInfo(h);var w=n.makeTensorInfo(p,h.dtype,m);if(o){var I=jZ({inputs:{x:w},backend:n,attrs:{shape:CR(p,s)}});return n.disposeIntermediateTensorInfo(w),I}return w}},aK=mZ((function(e,t){return Math.min(e,t)})),iK=MZ(dS,aK),oK={kernelName:dS,backendName:"cpu",kernelFunc:iK};var sK={kernelName:pS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;iZ(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),l="reflect"===o?0:1,h=n.data.get(a.dataId).values,f=a.shape.length,d=cw(a.shape),p=Zx(s),v=s.length,m=cw(s),g=$x(a.dtype,p),y=0;y<p;y++){for(var b=gw(y,v,m),k=0;k<v;k++)b[k]<u[k]?b[k]=2*u[k]-b[k]-l:b[k]>=c[k]&&(b[k]=2*(c[k]-1)-b[k]+l);b=b.map((function(e,t){return e-u[t]}));var V=mw(b,f,d);g[y]=h[V]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},uK=mZ((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),cK=MZ(vS,uK),lK={kernelName:vS,backendName:"cpu",kernelFunc:cK};function hK(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=Yx([s],a.shape),c=Hq({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=CR(c.shape,u),h=jZ({inputs:{x:c},backend:n,attrs:{shape:l}}),f=WH({inputs:{a:a,b:h},backend:n}),d=AH({inputs:{x:f},backend:n}),p=kH({inputs:{x:d},backend:n,attrs:{axis:u,keepDims:!1}}),v=jZ({inputs:{x:p},backend:n,attrs:{shape:l}}),m=PH({inputs:{a:d,b:v},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),m}var fK={kernelName:aC,backendName:"cpu",kernelFunc:hK};var dK={kernelName:mS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;iZ(a,"multinomial");for(var u=s?a:hK({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],h=n.data.get(u.dataId).values,f=[c,i],d=dw(Zx(f),"int32"),p=0;p<c;++p){var v=p*l,m=new Float32Array(l-1);m[0]=h[v];for(var g=1;g<m.length;++g)m[g]=m[g-1]+h[v+g];for(var y=UR.alea(o.toString()),b=p*i,k=0;k<i;++k){var V=y();d[b+k]=m.length;for(var x=0;x<m.length;x++)if(V<m[x]){d[b+k]=x;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(f,"int32",d)}};function pK(e,t,n){var r=iE(-1,n);return mH([],t,r,e,n)}var vK={kernelName:yS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;iZ(r,"neg");var a=pK(n.data.get(r.dataId).values,r.shape,r.dtype),i=(0,l.Z)(a,2),o=i[0],s=i[1];return n.makeTensorInfo(s,r.dtype,o)}},mK=q_;var gK={kernelName:kS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;iZ(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,h=mK(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},yK=K_;var bK={kernelName:VS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;iZ(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,f=yK(l,h,o,s,u,c),d=f.selectedIndices,p=f.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},kK=X_;var VK={kernelName:xS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;iZ(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,f=kK(l,h,o,s,u,c),d=f.selectedIndices,p=f.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([p.length],"float32",new Float32Array(p))]}},xK=mZ((function(e,t){return e!==t?1:0})),wK=MZ(bS,xK,null,"bool"),IK={kernelName:bS,backendName:"cpu",kernelFunc:wK};var SK={kernelName:IS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue;iZ(a,"oneHot");var c=Zx(a.shape),l=new Float32Array(c*o);l.fill(u);for(var h=n.data.get(a.dataId).values,f=0;f<c;++f)h[f]>=0&&h[f]<o&&(l[f*o+h[f]]=s);return n.makeTensorInfo([].concat((0,H.Z)(a.shape),[o]),i,l)}};function CK(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=_Z({inputs:{input:r},backend:n}),i=CK({inputs:{x:a},backend:n}),o=WG({inputs:{input:r},backend:n}),s=CK({inputs:{x:o},backend:n}),u=NZ({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return KH({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var EK={kernelName:CC,backendName:"cpu",kernelFunc:CK};var TK={kernelName:wS,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=_Z({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=WG({inputs:{input:a},backend:r}),u=CK({inputs:{x:s},backend:r}),c=NZ({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return KH({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function NK(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return _H({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Ux(a,e.shape,"All tensors passed to stack must have matching shapes"),Bx(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=t.map((function(e){var t=_H({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),u=ZG({inputs:s,backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}var AK={kernelName:SS,backendName:"cpu",kernelFunc:NK};var RK={kernelName:CS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;iZ(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,l=Zx(a.shape),h=a.shape.length,f=cw(a.shape),d=Zx(s),p=s.length,v=cw(s),m=$x(a.dtype,d);0!==o&&m.fill(o);for(var g=0;g<l;g++){m[mw(gw(g,h,f).map((function(e,t){return e+u[t]})),p,v)]=c[g]}return{dataId:n.write(m,s,a.dtype),shape:s,dtype:a.dtype}}},_K=mZ((function(e,t){return Math.pow(e,t)})),DK=MZ(ES,_K),FK={kernelName:ES,backendName:"cpu",kernelFunc:DK};function OK(e,t,n,r){for(var a=SR(e,r),i=(0,l.Z)(a,2),o=i[0],s=i[1],u=RE(t,"int32"),c=dw(Zx(o),u),h=Zx(s),f=0;f<c.length;++f){for(var d=f*h,p=1,v=0;v<h;++v)p*=n[d+v];c[f]=p}return{outVals:c,outShape:o,outDtype:u}}var LK={kernelName:NS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;iZ(a,"prod");var s=a.shape.length,u=Yx(i,a.shape),c=TR(u,s),l=u,h=a,f=[];null!=c&&(h=nG({inputs:{x:a},backend:n,attrs:{perm:c}}),f.push(h),l=AR(l.length,s));var d=n.data.get(h.dataId).values,p=OK(h.shape,h.dtype,d,l),v=p.outVals,m=p.outShape,g=p.outDtype,y=m;return o&&(y=CR(m,u)),f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(y,g,v)}},MK=ZD,PK=function(){function e(t,n,r,a,i,o,s,u,c,l){var h;f(this,e),this.shape=t,this.shapeShape=n,this.values=r,this.valuesShape=a,this.valuesDType=i,this.defaultValue=o,this.defaultValueShape=s,this.rowPartitionValues=u,this.rowPartitionValuesShapes=c,this.rowPartitionTypes=function(e){var t,n={FIRST_DIM_SIZE:ZD.FIRST_DIM_SIZE,VALUE_ROWIDS:ZD.VALUE_ROWIDS,ROW_LENGTHS:ZD.ROW_LENGTHS,ROW_SPLITS:ZD.ROW_SPLITS,ROW_LIMITS:ZD.ROW_LIMITS,ROW_STARTS:ZD.ROW_STARTS},r=[],a=m(e);try{for(a.s();!(t=a.n()).done;){var i=t.value;if(!(i in n))break;r.push(n[i])}}catch(h6){a.e(h6)}finally{a.f()}return r}(l),this.raggedRank=0===(h=this.rowPartitionTypes).length?0:h[0]===ZD.FIRST_DIM_SIZE?h.length-1:h.length}return p(e,[{key:"getRowPartitionTypeByDimension",value:function(e){return this.rowPartitionTypes[0]===MK.FIRST_DIM_SIZE?this.rowPartitionTypes[e+1]:this.rowPartitionTypes[e]}},{key:"getRowPartitionTensor",value:function(e){return this.rowPartitionTypes[0]===MK.FIRST_DIM_SIZE?this.rowPartitionValues[e+1]:this.rowPartitionValues[e]}},{key:"getMaxWidth",value:function(t){var n=this.getRowPartitionTensor(t-1);switch(this.getRowPartitionTypeByDimension(t-1)){case MK.VALUE_ROWIDS:return e.getMaxWidthValueRowID(n);case MK.ROW_SPLITS:return e.getMaxWidthRowSplit(n);default:throw new Error("Cannot handle partition type ".concat(MK[this.getRowPartitionTypeByDimension(t-1)]))}}},{key:"tensorShapeFromTensor",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(0===t.length){if(-1===e[0])return[];throw new Error("The only valid scalar shape tensor is the fully unknown shape specified as -1.")}return BK(e,n)}},{key:"calculateOutputSize",value:function(e){var t=this.valuesShape;!function(e,t){if(null!=e&&null!=t){var n=e.length,r=t.length;if(n>=r)throw new Error("defaultValue.shape=".concat(e," and ragged tensor flatValues.shape=").concat(t,", are incompatible: defaultValue.rank = ").concat(n," must be less than ragged tensor input flatValues.rank = ").concat(r,")"));for(var a=0;a<Math.min(n,r-1);++a){var i=e[a],o=t[a+1];if(i>=0&&o>=0&&1!==i&&i!==o)throw new Error("defaultValue.shape=".concat(e,", and ragged tensor input flatValues.shape=").concat(t," are incompatible: defaultValue.shape[").concat(a-e.length,"] = ").concat(i," but ragged tensor input.flatValues.shape[").concat(a-e.length,"] = ").concat(o))}}}(this.defaultValueShape,t);var n=this.tensorShapeFromTensor(this.shape,this.shapeShape),r=function(e,t,n){var r=new Array;if(null==n&&null==t)return r;if(null==t)for(;r.length<e+n.length;)r.push(-1);else r=t.slice();if(null==n)return r;if(e+n.length!==r.length)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.rank = ").concat(e+n.length,", but shape.rank = ").concat(r.length));for(var a=1;a<n.length;++a){var i=n[a],o=r[r.length-n.length+a],s=r[o];if(i>=0)if(s>=0){if(s!==i)throw new Error("rt input.shape and shape=".concat(t," are incompatible: rt input.shape[").concat(a+e,"] = ").concat(i," but shape[").concat(a+e,"] = ").concat(s))}else r[o]=i}return r}(this.raggedRank,n,t),a=r;a[0]<0&&(a[0]=e);for(var i=1;i<=this.raggedRank;++i)a[i]<0&&(a[i]=this.getMaxWidth(i));return a}},{key:"calculateFirstParentOutputIndex",value:function(e,t,n){for(var r=Math.min(e,n),a=[],i=0,o=0;o<r;++o,i+=t)a.push(i);for(var s=r;s<e;++s)a.push(-1);return Bx(a.length===e,(function(){return"Final length of result must be equal to firstDimension."})),a}},{key:"calculateOutputIndexRowSplit",value:function(e,t,n,r){for(var a=e.length,i=[],o=0;o<a-1;++o){var s=e[o+1]-e[o],u=Math.min(r,s),c=t[o];-1===c&&(u=0);for(var l=0;l<u;++l)i.push(c),c+=n;for(var h=0;h<s-u;++h)i.push(-1)}if(a>0&&i.length!==e[a-1])throw new Error("Invalid row split size.");return i}},{key:"calculateOutputIndexValueRowID",value:function(e,t,n,r){var a=e.length,i=[];if(0===a)return[];var o=0,s=e[0];if(s>=t.length)throw new Error("Got currentValueRowId=".concat(s,", which is not less than ").concat(t.length));var u=t[s];i.push(u);for(var c=1;c<a;++c){var l=e[c];if(l===s)u>=0&&(++o<r?u+=n:u=-1);else{if(o=0,s=l,l>=t.length)throw new Error("Got nextValueRowId=".concat(l," which is not less than ").concat(t.length));u=t[l]}i.push(u)}if(i.length!==e.length)throw new Error("Invalid row ids.");return i}},{key:"calculateOutputIndex",value:function(e,t,n,r){var a=this.getRowPartitionTensor(e),i=this.getRowPartitionTypeByDimension(e);switch(i){case MK.VALUE_ROWIDS:return this.calculateOutputIndexValueRowID(a,t,n,r);case MK.ROW_SPLITS:if(a.length-1>t.length)throw new Error("Row partition size is greater than output size: ".concat(a.length-1," > ").concat(t.length));return this.calculateOutputIndexRowSplit(a,t,n,r);default:throw new Error("Unsupported partition type: ".concat(MK[i]))}}},{key:"getFirstDimensionSize",value:function(){var e=this.rowPartitionValues[0];if(0===this.rowPartitionTypes.length)throw new Error("No row_partition_types given.");var t=this.rowPartitionTypes[0];switch(t){case MK.FIRST_DIM_SIZE:return e[0];case MK.VALUE_ROWIDS:throw new Error("Cannot handle VALUE_ROWIDS in first dimension.");case MK.ROW_SPLITS:return this.rowPartitionValuesShapes[0][0]-1;default:throw new Error("Cannot handle type ".concat(MK[t]))}}},{key:"compute",value:function(){if(this.rowPartitionValues[0].length<=0)throw new Error("Invalid first partition input. Tensor requires at least one element.");var e=this.getFirstDimensionSize(),t=this.calculateOutputSize(e),n=new Array(this.raggedRank+1);n[n.length-1]=1;for(var r=n.length-2;r>=0;--r)n[r]=n[r+1]*t[r+1];var a=BK(t,!1),i=ew(this.valuesDType,Zx(a));if(n[0]*t[0]>0){for(var o=this.calculateFirstParentOutputIndex(e,n[0],t[0]),s=1;s<=this.raggedRank;++s){o=this.calculateOutputIndex(s-1,o,n[s],t[s])}this.setOutput(this.raggedRank,o,i,a)}return[a,i]}},{key:"setOutput",value:function(e,t,n,r){if(0!==n.length){var a=this.values,i=n,o=r.slice(),s=Zx(o=o.slice(e+1)),u=t.length,c=this.defaultValue;if(c.length!==s&&1!==c.length){var l=this.defaultValueShape;eA((function(){var e=TA(c,l),t=OA(e,o);c=t.dataSync()}))}for(var h=0,f=0,d=0,p=0;p<=u;++p){var v=p<u?t[p]:-1;if(v!==d){if(f<d){var m=a.subarray(h*s);zK(i.subarray(f*s),m,(d-f)*s)}if(p>=u){var g=n.length;v=Math.floor(g/s)}if(v>d)if(1===this.defaultValue.length)i.subarray(d*s,v*s).fill(this.defaultValue[0]),d=v;else for(;v>d;){zK(i.slice(d*s),c,s),++d}v<0?(h=p+1,f=d):(h=p,d=(f=d)+1)}else++d}}}}],[{key:"getMaxWidthRowSplit",value:function(e){var t=e.length;if(0===t||1===t)return 0;for(var n=0,r=0;r<t-1;++r){var a=e[r+1]-e[r];a>n&&(n=a)}return n}},{key:"getMaxWidthValueRowID",value:function(e){var t=e.length;if(0===t)return 0;for(var n=0,r=e[0],a=0,i=1;i<t;++i){var o=e[i];o!==r&&(r=o,a=Math.max(i-n,a),n=i)}return Math.max(t-n,a)}}]),e}();function zK(e,t,n){for(var r=0;r<n;r++)e[r]=t[r]}function BK(e,t){var n,r=[],a=m(e);try{for(a.s();!(n=a.n()).done;){var i=n.value;if(i<0){if(!t)throw new Error("Dimension ".concat(i," must be >= 0"));if(i<-1)throw new Error("Dimension ".concat(i," must be >= -1"));i=-1}r.push(i)}}catch(h6){a.e(h6)}finally{a.f()}return r}function UK(e,t,n,r,a,i,o,s,u,c){return new PK(e,t,n,r,a,i,o,s,u,c).compute()}var WK={kernelName:AS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,f=n.data.get(o.dataId).values,d=s.map((function(e){return n.data.get(e.dataId).values})),p=s.map((function(e){return e.shape})),v=UK(c,a.shape,h,i.shape,i.dtype,f,o.shape,d,p,u),m=(0,l.Z)(v,2),g=m[0],y=m[1];return n.makeTensorInfo(g,i.dtype,y)}};function jK(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return dw(0,r);var a=dw(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var ZK={kernelName:RS,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=jK(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},GK=uZ(DS,(function(e){return 1/e})),HK={kernelName:DS,backendName:"cpu",kernelFunc:GK};var qK={kernelName:PS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;iZ(a,"resizeBilinear");for(var u=cw(a.shape),c=(0,l.Z)(s,2),h=c[0],f=c[1],d=(0,l.Z)(a.shape,4),p=d[0],v=d[1],m=d[2],g=d[3],y=n.data.get(a.dataId).values,b=new Float32Array(Zx([p,h,f,g])),k=[i&&h>1?v-1:v,i&&f>1?m-1:m],V=[i&&h>1?h-1:h,i&&f>1?f-1:f],x=0,w=k[0]/V[0],I=k[1]/V[1],S=0;S<p;S++)for(var C=0;C<h;C++){var E=void 0;E=o?w*(C+.5)-.5:w*C;for(var T=Math.max(0,Math.floor(E)),N=E-T,A=Math.min(v-1,Math.ceil(E)),R=S*u[0]+T*u[1],_=S*u[0]+A*u[1],D=0;D<f;D++){var F=void 0;F=o?I*(D+.5)-.5:I*D;for(var O=Math.max(0,Math.floor(F)),L=F-O,M=Math.min(m-1,Math.ceil(F)),P=R+O*u[2],z=_+O*u[2],B=R+M*u[2],U=_+M*u[2],W=0;W<g;W++){var j=y[P+W],Z=y[z+W],G=j+(y[B+W]-j)*L,H=G+(Z+(y[U+W]-Z)*L-G)*N;b[x++]=H}}}return n.makeTensorInfo([p,h,f,g],"float32",b)}};var KK={kernelName:zS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;iZ([i,a],"resizeBilinearGrad");for(var s=cw(a.shape),u=(0,l.Z)(a.shape,4),c=u[0],h=u[1],f=u[2],d=u[3],p=(0,l.Z)(i.shape,3),v=p[1],m=p[2],g=new Float32Array(c*h*f*d),y=[o&&v>1?h-1:h,o&&m>1?f-1:f],b=[o&&v>1?v-1:v,o&&m>1?m-1:m],k=y[0]/b[0],V=y[1]/b[1],x=n.data.get(i.dataId).values,w=0,I=0;I<c;I++)for(var S=I*s[0],C=0;C<v;C++)for(var E=C*k,T=Math.floor(E),N=Math.min(Math.ceil(E),h-1),A=S+T*s[1],R=S+N*s[1],_=E-T,D=1-_,F=0;F<m;F++)for(var O=F*V,L=Math.floor(O),M=Math.min(Math.ceil(O),f-1),P=O-L,z=1-P,B=A+L*s[2],U=A+M*s[2],W=R+L*s[2],j=R+M*s[2],Z=D*z,G=D*P,H=_*z,q=_*P,K=0;K<d;K++){var X=x[w++];g[B+K]+=X*Z,g[U+K]+=X*G,g[W+K]+=X*H,g[j+K]+=X*q}return n.makeTensorInfo([c,f,h,d],"float32",g)}};var XK={kernelName:LS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;iZ(a,"resizeNearestNeighbor");for(var u=cw(a.shape),c=(0,l.Z)(s,2),h=c[0],f=c[1],d=(0,l.Z)(a.shape,4),p=d[0],v=d[1],m=d[2],g=d[3],y=n.data.get(a.dataId).values,b=new Float32Array(p*h*f*g),k=[i&&h>1?v-1:v,i&&f>1?m-1:m],V=[i&&h>1?h-1:h,i&&f>1?f-1:f],x=k[0]/V[0],w=k[1]/V[1],I=0,S=0;S<p;S++)for(var C=S*u[0],E=0;E<h;E++){var T=o?x*(E+.5):x*E,N=Math.min(v-1,i?Math.round(T):Math.floor(T));o&&(N=Math.max(0,N));for(var A=C+N*u[1],R=0;R<f;R++){var _=o?w*(R+.5):w*R,D=Math.min(m-1,i?Math.round(_):Math.floor(_));o&&(D=Math.max(0,D));for(var F=A+D*u[2],O=0;O<g;O++){var L=y[F+O];b[I++]=L}}}return n.makeTensorInfo([p,h,f,g],a.dtype,b)}};var QK={kernelName:MS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;iZ([i,a],"resizeNearestNeighborGrad");for(var s=cw(a.shape),u=cw(i.shape),c=(0,l.Z)(a.shape,4),h=c[0],f=c[1],d=c[2],p=c[3],v=(0,l.Z)(i.shape,3),m=v[1],g=v[2],y=new Float32Array(h*f*d*p),b=n.data.get(i.dataId).values,k=[o&&m>1?f-1:f,o&&g>1?d-1:d],V=[o&&m>1?m-1:m,o&&g>1?g-1:g],x=k[0]/V[0],w=k[1]/V[1],I=1/x,S=1/w,C=2*Math.ceil(I)+2,E=2*Math.ceil(S)+2,T=0;T<h;T++)for(var N=T*s[0],A=0;A<f;A++)for(var R=N+A*s[1],_=Math.floor(A*I),D=Math.floor(_-C/2),F=0;F<d;F++)for(var O=R+F*s[2],L=Math.floor(F*S),M=Math.floor(L-E/2),P=0;P<p;P++){for(var z=0,B=0;B<C;B++){var U=B+D;if(!(U<0||U>=m)){var W=N+U*u[1],j=U*x;if(A===Math.min(f-1,o?Math.round(j):Math.floor(j)))for(var Z=0;Z<E;Z++){var G=Z+M;if(!(G<0||G>=g)){var H=W+G*u[2],q=G*w;F===Math.min(d-1,o?Math.round(q):Math.floor(q))&&(z+=b[H+P])}}}}y[O+P]=z}return n.makeTensorInfo(a.shape,a.dtype,y)}};var YK={kernelName:US,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;iZ(a,"reverse");var o=a.shape.length,s=Yx(i,a.shape);if(0===o)return fZ({inputs:{x:a},backend:n});for(var u=new bE(a.shape,a.dtype),c=n.bufferSync(a),l=function(e){var t=u.indexToLoc(e),n=t.slice();s.forEach((function(e){return n[e]=a.shape[e]-1-n[e]})),u.set.apply(u,[c.get.apply(c,(0,H.Z)(n))].concat((0,H.Z)(t)))},h=0;h<u.size;h++)l(h);return n.makeTensorInfo(u.shape,u.dtype,u.values)}},JK={kernelName:NC,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=$x(a.dtype,Zx(a.shape)),h=(0,l.Z)(a.shape,4),f=h[0],d=h[1],p=h[2],v=h[3],m=JD(s,d,p),g=(0,l.Z)(m,2),y=g[0],b=g[1],k=Math.sin(i),V=Math.cos(i),x=u.data.get(a.dataId).values,w=0;w<f;w++)for(var I=w*p*d*v,S=0;S<d;S++)for(var C=S*(p*v),E=0;E<p;E++)for(var T=E*v,N=0;N<v;N++){var A=[f,S,E,N],R=A[2],_=A[1],D=(R-y)*V-(_-b)*k,F=(R-y)*k+(_-b)*V;D=Math.round(D+y),F=Math.round(F+b);var O=o;if("number"!==typeof o&&(O=3===N?255:o[N]),D>=0&&D<p&&F>=0&&F<d)O=x[I+F*(p*v)+D*v+N];c[I+C+T+N]=O}return{dataId:u.write(c,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},$K=uZ(WS,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),eX={kernelName:WS,backendName:"cpu",kernelFunc:$K},tX=IZ((function(e){return 1/Math.sqrt(e)})),nX=cZ(jS,tX),rX={kernelName:jS,backendName:"cpu",kernelFunc:nX};function aX(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],h=e.values,f=t.values;if(0===r)return uN(n,t.dtype);var d=uN(l,t.dtype);"string"===typeof u||"number"===typeof u?d.values.fill(u):"boolean"===typeof u&&d.values.fill(+u);for(var p=0;p<i;p++){for(var v=[],m=0,g=0;g<o;g++){var y=h[p*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(n));for(var b=0;b<a;b++)c?d.values[m*a+b]+=f[p*a+b]:d.values[m*a+b]=0===t.rank?f[0]:f[p*a+b]}return d}var iX={kernelName:ZS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=iF(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,f=s.outputSize,d=aX(n.bufferSync(a),n.bufferSync(i),o,f,l,c,u,h,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}};function oX(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<t?n=a+1:r=a;return r}function sX(e,t){for(var n=0,r=e.length,a=0;n<r;)e[a=Math.floor((n+r)/2)]<=t?n=a+1:r=a;return r}var uX={kernelName:GS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=function(e,t,n,r,a,i){for(var o=ew("int32",n*a),s=0;s<n;++s)for(var u=e.slice(s*r,(s+1)*r),c=s*a,l=0;l<a;++l)o[c+l]="left"===i?oX(u,t[l+c]):sX(u,t[l+c]);return o}(n.data.get(a.dataId).values,n.data.get(i.dataId).values,a.shape[0],a.shape[1],i.shape[1],o);return n.makeTensorInfo(i.shape,"int32",s)}};var cX={kernelName:HS,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;iZ([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=RE(a.dtype,i.dtype),h=dw(Zx(a.shape),l),f=0,d=0===o||o>1||1===a.shape.length?1:Zx(a.shape.slice(1)),p=0;p<s.length;p++)for(var v=0;v<d;v++)1===s[p]?h[f++]=u[p]:h[f++]=c[p];return n.makeTensorInfo(a.shape,l,h)}},lX=uZ(qS,(function(e){return e>=0?1.0507009873554805*e:1.7580993408473768*(Math.exp(e)-1)})),hX={kernelName:qS,backendName:"cpu",kernelFunc:lX},fX=uZ(YS,(function(e){return e<0?-1:e>0?1:0})),dX={kernelName:YS,backendName:"cpu",kernelFunc:fX},pX=uZ(XS,(function(e){return Math.sin(e)})),vX={kernelName:XS,backendName:"cpu",kernelFunc:pX},mX=uZ(QS,(function(e){return Math.sinh(e)})),gX={kernelName:QS,backendName:"cpu",kernelFunc:mX},yX=Math.log(1.1920928955078125e-7)+2,bX=uZ($S,(function(e){var t=e>-yX,n=e<yX,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),kX={kernelName:$S,backendName:"cpu",kernelFunc:bX};var VX={kernelName:nC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;iZ([a],"spaceToBatchND");var s=Zx(i),u=[[0,0]];u.push.apply(u,(0,H.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=RK.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),h=$D(l.shape,i,s,!1),f=eF(h.length,i.length,!1),d=tF(l.shape,i,s,!1),p=jZ({inputs:{x:l},backend:n,attrs:{shape:h}}),v=nG({inputs:{x:p},backend:n,attrs:{perm:f}}),m=jZ({inputs:{x:v},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),m}};function xX(e,t,n,r,a,i,o){var s=t[0],u=i[0],c=new Array(u),l=new Array(s),h=t[1];if(0===u){if(0!==s)throw new Error("Received SparseTensor with denseShape[0] = 0 but\n  indices.shape[0] = ".concat(s));return[ew(n,0),[0,h],ew(a,0),c,l]}for(var f,d=!0,p=0,v=new Array(u).fill(0),m=0;m<s;++m){var g=e[m*h];if(g<0)throw new Error((f=g,"indices(".concat(m,", 0) is invalid: ").concat(f," < 0")));if(g>=u)throw new Error(EF(m,g,u));++v[g],d=d&&g>=p,p=g}for(var y=!0,b=0;b<u;++b){var k=0===v[b];c[b]=k,y=y&&!k,v[b]=Math.max(v[b],1),b>0&&(v[b]+=v[b-1])}if(y&&d){for(var V=e,x=r,w=0;w<s;++w)l[w]=w;return[V,[s,h],x,c,l]}for(var I=v[u-1],S=ew(n,I*h),C=ew(a,I),E=new Array(u).fill(0),T=0;T<s;++T){var N=e[T*h],A=E[N],R=(0===N?0:v[N-1])+A;E[N]++;for(var _=0;_<h;++_)S[R*h+_]=e[T*h+_];C[R]=r[T],l[T]=R}for(var D=0;D<u;++D){if(0===E[D]){var F=0===D?0:v[D-1];S[F*h+0]=D;for(var O=1;O<h;++O)S[F*h+O]=0;C[F]=o}}return[S,[I,h],C,c,l]}var wX={kernelName:iC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n        ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n        ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,h=n.data.get(o.dataId).values[0],f=xX(s,r.shape,r.dtype,u,a.dtype,c,h),d=(0,l.Z)(f,5),p=d[0],v=d[1],m=d[2],g=d[3],y=d[4];return[n.makeTensorInfo(v,r.dtype,p),n.makeTensorInfo([v[0]],a.dtype,m),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map((function(e){return Number(e)})))),n.makeTensorInfo([y.length],r.dtype,new Int32Array(y))]}};function IX(e,t,n,r,a){for(var i,o,s=Zx(r),u=t[0],c=a.length,l=[],h=1,f=-1,d=0;d<c;++d){var p=a[d];if(-1===p){if(-1!==f)throw new Error((o=d,"only one output dimension may be -1, not both ".concat(f," and ").concat(o)));f=d,l.push(1)}else{if(p<0)throw new Error((i=p,"size ".concat(d," must be non-negative, not ").concat(i)));h*=p,l.push(p)}}if(-1!==f){if(h<=0)throw new Error("reshape cannot infer the missing input size for an empty tensor unless all specified input sizes are non-zero");var v=Math.trunc(s/h);if(h*v!==s)throw new Error(function(e,t){var n=Zx(e),r=Zx(t);return"Input to reshape is a SparseTensor with ".concat(n,"\n  dense values, but the requested shape requires a multiple of ").concat(r,". inputShape=").concat(e," outputShape= ").concat(t)}(r,l));l[f]=v}if(Zx(l)!==s)throw new Error(function(e,t){var n=Zx(e),r=Zx(t);return"Input to reshape is a tensor with ".concat(n," dense values, but the requested shape has ").concat(r,". inputShape=").concat(e," outputShape=").concat(t)}(r,l));var m=r.length,g=[];if(m>0){g[m-1]=1;for(var y=m-2;y>=0;--y)g[y]=g[y+1]*r[y+1]}var b=[];if(c>0){b[c-1]=1;for(var k=c-2;k>=0;--k)b[k]=b[k+1]*l[k+1]}for(var V=ew(n,u*c),x=0;x<u;++x){for(var w=0,I=0;I<m;++I)w+=e[x*m+I]*g[I];for(var S=0;S<c;++S)V[x*c+S]=Math.trunc(w/b[S]),w%=b[S]}return[V,[u,c],l]}var SX={kernelName:oC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape\n        ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape\n        ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.data.get(a.dataId).values),s=n.data.get(r.dataId).values,u=Array.from(n.data.get(i.dataId).values),c=IX(s,r.shape,r.dtype,o,u),h=(0,l.Z)(c,3),f=h[0],d=h[1],p=h[2];return[n.makeTensorInfo(d,r.dtype,f),n.makeTensorInfo([p.length],i.dtype,new Int32Array(p))]}};function CX(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=r.length,u=[t[0],e.length/t[0]],c=u[1],l=s>0?a[s-1]+1:0,h=l;if(h<0)throw new Error("segment ids must be >= 0");var f=t.slice();f[0]=h;var d=f.reduce((function(e,t){return e*t}),1),p=ew(n,d);if(0===s)return h>0&&p.fill(o),[p,f];if(h<=0)throw new Error("segment ids must be >= 0");for(var v=0,m=1,g=0,y=a[v];;){var b=0;if(m<s){if(y===(b=a[m])){++m;continue}if(y>=b)throw new Error("segment ids are not increasing")}if(y<0||y>=h)throw new Error(TF(y,h));y>g&&p.fill(o,g*c,y*c);for(var k=v;k<m;++k){var V=r[k];if(V<0||V>=u[0])throw new Error(NF(k,r[k],u[0]));for(var x=0;x<c;x++)p[y*c+x]+=e[V*c+x]}if(i)for(var w=0;w<c;w++)p[y*c+w]/=m-v;if(v=m,g=y+1,y=b,++m>s)break}return g<h&&p.fill(o,g*c,h*c),[p,f]}var EX={kernelName:sC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n          ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n          ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=CX(o,r.shape,r.dtype,s,u,!0),h=(0,l.Z)(c,2),f=h[0],d=h[1];return n.makeTensorInfo(d,r.dtype,f)}};var TX={kernelName:uC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n         ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n         ".concat(i.shape));if(a.shape[0]!==i.shape[0])throw new Error("segmentIds and indices should have same size.");var o=n.data.get(r.dataId).values,s=n.data.get(a.dataId).values,u=n.data.get(i.dataId).values,c=CX(o,r.shape,r.dtype,s,u),h=(0,l.Z)(c,2),f=h[0],d=h[1];return n.makeTensorInfo(d,r.dtype,f)}};var NX={kernelName:cC,backendName:"cpu",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.sparseIndices,o=n.sparseValues,s=n.defaultValue,u=a.outputShape,c=iF(0,i,u),l=c.sliceRank,h=c.numUpdates,f=c.sliceSize,d=c.strides,p=c.outputSize,v=!1,m=r.bufferSync(i);switch(o.dtype){case"bool":t=aX(m,r.bufferSync(o),u,p,f,h,l,d,Boolean(r.data.get(s.dataId).values[0]),v);break;case"float32":t=aX(m,r.bufferSync(o),u,p,f,h,l,d,r.data.get(s.dataId).values[0],v);break;case"int32":t=aX(m,r.bufferSync(o),u,p,f,h,l,d,r.data.get(s.dataId).values[0],v);break;case"string":t=aX(m,r.bufferSync(o),u,p,f,h,l,d,cE(r.data.get(s.dataId).values[0]),v);break;default:throw new Error("Unsupported type ".concat(o.dtype))}return r.makeTensorInfo(u,t.dtype,t.values)}};var AX={kernelName:rC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=Yx(r.axis,a.shape)[0],s=CF(a,i,o),u=new Array(a.shape.length).fill(0),c=a.shape.slice();return s.map((function(e){var t=(0,H.Z)(c);t[o]=e;var r=TG({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r}))}},RX=IZ((function(e){return Math.sqrt(e)})),_X=uZ(eC,(function(e){return Math.sqrt(e)})),DX={kernelName:eC,backendName:"cpu",kernelFunc:_X},FX={kernelName:hC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;iZ(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},OX=mZ((function(e,t){var n=e-t;return n*n})),LX=MZ(lC,OX),MX={kernelName:lC,backendName:"cpu",kernelFunc:LX},PX=uZ(EC,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),zX={kernelName:EC,backendName:"cpu",kernelFunc:PX};function BX(e,t,n,r){for(var a=uN(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat((0,H.Z)(o)))}return a}var UX={kernelName:fC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,h=r.newAxisMask,f=r.shrinkAxisMask;iZ(a,"stridedSlice");var d,p=qN(a.shape,i,o,s,u,c,l,h,f),v=p.finalShapeSparse,m=p.finalShape,g=p.isIdentity,y=p.sliceDim0,b=p.isSimpleSlice,k=p.begin,V=p.end,x=p.strides;if(g)d=jZ({inputs:{x:a},backend:n,attrs:{shape:m}});else if(y||b){Bx(a.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(a.shape.length)}));var w=jN(k,V,x),I=TG({inputs:{x:a},backend:n,attrs:{begin:k,size:w}});d=jZ({inputs:{x:I},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(I)}else{var S=BX(v,n.bufferSync(a),x,k);d=n.makeTensorInfo(m,S.dtype,S.values)}return d}},WX=function(){function e(t,n,r,a,i,o){f(this,e),this.separator=uE(t),this.nGramWidths=n,this.leftPad=uE(r),this.rightPad=uE(a),this.padWidth=i,this.preserveShort=o}return p(e,[{key:"getPadWidth",value:function(e){return Math.min(this.padWidth<0?e-1:this.padWidth,e-1)}},{key:"getNumNGrams",value:function(e,t){var n=this.getPadWidth(t);return Math.max(0,e+2*n-t+1)}},{key:"createNGrams",value:function(e,t,n,r,a,i){for(var o=this,s=function(s){var u=o.getPadWidth(i),c=Math.max(0,u-s),l=Math.max(0,u-(a-(s+1))),h=i-(c+l),f=t+(c>0?0:s-u),d=0;d+=c*o.leftPad.length;for(var p=0;p<h;++p)d+=e[f+p].length;d+=l*o.rightPad.length,d+=(c+l+h-1)*o.separator.length,n[r+s]=new Uint8Array(d);for(var v=n[r+s],m=0,g=function(e){return e.forEach((function(e){return v[m++]=e}))},y=0;y<c;++y)g(o.leftPad),g(o.separator);for(var b=0;b<h-1;++b)g(e[f+b]),g(o.separator);if(h>0){g(e[f+h-1]);for(var k=0;k<l;++k)g(o.separator),g(o.rightPad)}else{for(var V=0;V<l-1;++V)g(o.rightPad),g(o.separator);g(o.rightPad)}},u=0;u<a;++u)s(u)}},{key:"compute",value:function(e,t){var n=this,r=e.length,a=t.length;if(a>0){var i=t[0];if(0!==i)throw new Error("First split value must be 0, got ".concat(i));for(var o=1;o<a;++o){var s=t[o]>=i;if(!(s=s&&t[o]<=r))throw new Error("Invalid split value ".concat(t[o],", must be in [").concat(i,", ").concat(r,"]"));i=t[o]}if(i!==r)throw new Error("Last split value must be data size. Expected ".concat(r,", got ").concat(i))}var u=a-1,c=ew("int32",a);if(0===r||0===a){for(var l=new Array(r),h=0;h<=u;++h)c[h]=0;return[l,c]}c[0]=0;for(var f=function(e){var r=t[e]-t[e-1],a=0;n.nGramWidths.forEach((function(e){a+=n.getNumNGrams(r,e)})),n.preserveShort&&r>0&&0===a&&(a=1),c[e]=c[e-1]+a},d=1;d<=u;++d)f(d);for(var p=new Array(c[u]),v=function(r){var a=t[r],i=c[r];if(n.nGramWidths.forEach((function(o){var s=t[r+1]-t[r],u=n.getNumNGrams(s,o);n.createNGrams(e,a,p,i,u,o),i+=u})),n.preserveShort&&i===c[r]){var o=t[r+1]-t[r];if(0===o)return"continue";var s=o+2*n.padWidth;n.createNGrams(e,a,p,i,1,s)}},m=0;m<u;++m)v(m);return[p,c]}}]),e}();function jX(e,t,n,r,a,i,o,s){return new WX(n,r,a,i,o,s).compute(e,t)}var ZX={kernelName:dC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,h=t.data,f=t.dataSplits,d=jX(n.data.get(h.dataId).values,n.data.get(f.dataId).values,a,i,o,s,u,c),p=(0,l.Z)(d,2),v=p[0],m=p[1];return[n.makeTensorInfo([v.length],"string",v),n.makeTensorInfo(f.shape,"int32",m)]}};function GX(e,t,n,r){if(e.length)if(0!==t.length)if(1!==t.length){for(var a=0,i=0;i<e.length+1;i++)if(i===e.length||-1!==t.indexOf(e[i])){var o=e.subarray(a,i);n&&0===o.length||r.push(o),a=i+1}}else{for(var s=t[0],u=e.indexOf(s);-1!==u;){var c=e.subarray(0,u);n&&0===c.length||r.push(c),u=(e=e.subarray(u+1)).indexOf(s)}n&&0===e.length||r.push(e)}else for(var l=0;l<e.length;++l)r.push(e.subarray(l,l+1))}function HX(e,t,n){for(var r=e.length,a=[],i=0,o=0,s=new Array(r),u=0;u<r;++u){var c=a.length;GX(e[u],t,n,a);var l=a.length-c;s[u]=l,i+=l,o=Math.max(o,l)}for(var h=ew("int32",2*i),f=new Array(i),d=[r,o],p=0,v=0;v<r;++v)for(var m=0;m<s[v];++m)h[2*p]=v,h[2*p+1]=m,f[p]=a[p],++p;return[h,f,d]}var qX={kernelName:pC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=HX(n.data.get(a.dataId).values,n.data.get(i.dataId).values[0],r),s=(0,l.Z)(o,3),u=s[0],c=s[1],h=s[2],f=c.length;return[n.makeTensorInfo([f,2],"int32",u),n.makeTensorInfo([f],"string",c),n.makeTensorInfo([2],"int32",new Int32Array(h))]}};function KX(e,t){for(var n=ew("int32",e.length),r=0;r<e.length;++r)n[r]=aE(e[r]).modulo(t).getLowBitsUnsigned();return n}var XX={kernelName:vC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=KX(n.data.get(a.dataId).values,r);return n.makeTensorInfo(a.shape,"int32",i)}},QX=uZ(gC,(function(e){return Math.tan(e)})),YX={kernelName:gC,backendName:"cpu",kernelFunc:QX},JX=uZ(yC,(function(e){return Math.tanh(e)}));function $X(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=uN(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}var eQ={kernelName:bC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;iZ(a,"tile");var o=$X(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}},tQ=function(e,t){var n=t.value-e.value;return 0===n?e.index-t.index:n};function nQ(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1;r>n;){if(r-n>600){var a=r-n+1,i=t-n+1,o=Math.log(a),s=.5*Math.exp(2*o/3),u=.5*Math.sqrt(o*s*(a-s)/a)*Math.sign(i-a/2),c=Math.max(n,Math.floor(t-i*s/a+u)),l=Math.min(r,Math.floor(t+(a-i)*s/a+u));nQ(e,t,c,l)}var h=e[t],f=n,d=r;for(Px(e,n,t),tQ(e[r],h)>0&&Px(e,n,r);f<d;){for(Px(e,f,d),f++,d--;tQ(e[f],h)<0;)f+=1;for(;tQ(e[d],h)>0;)d-=1}0===tQ(e[n],h)?Px(e,n,d):Px(e,d+=1,r),d<=t&&(n=d+1),t<=d&&(r=d-1)}}function rQ(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=$x(n,o*r),c=$x("int32",o*r),l=function(t){var n=t*s,i=e.subarray(n,n+s),o=new Array(i.length);i.forEach((function(e,t){return o[t]={value:e,index:t}})),r<o.length&&(nQ(o,r),o=o.slice(0,r)),a&&o.sort(tQ);for(var l=t*r,h=u.subarray(l,l+r),f=c.subarray(l,l+r),d=0;d<r;d++)h[d]=o[d].value,f[d]=o[d].index},h=0;h<o;h++)l(h);var f=t.slice();return f[f.length-1]=r,[uN(f,n,u),uN(f,"int32",c)]}var aQ={kernelName:kC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted;iZ(a,"topk");var s=rQ(n.data.get(a.dataId).values,a.shape,a.dtype,i,o),u=(0,l.Z)(s,2),c=u[0],h=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(h.shape,h.dtype,h.values)]}};var iQ={kernelName:VC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=t.transforms,o=n.interpolation,s=n.fillMode,u=n.fillValue,c=n.outputShape,h=(0,l.Z)(a.shape,4),f=h[0],d=h[1],p=h[2],v=h[3],m=null!=c?c:[d,p],g=(0,l.Z)(m,2),y=g[0],b=g[1],k=[f,y,b,v],V=cw(a.shape),x=V[0],w=V[1],I=V[2],S=cw(k),C=S[0],E=S[1],T=S[2],N=$x(a.dtype,Zx(k));N.fill(u);for(var A=r.data.get(a.dataId).values,R=r.data.get(i.dataId).values,_=0;_<f;++_){for(var D=1===i.shape[0]?R:R.subarray(8*_,8*_+8),F=0;F<y;++F)for(var O=0;O<b;++O)for(var L=0;L<v;++L){var M=void 0,P=D[6]*O+D[7]*F+1;if(0!==P){var z=(D[0]*O+D[1]*F+D[2])/P,B=(D[3]*O+D[4]*F+D[5])/P,U=oQ(z,p,s),W=oQ(B,d,s);switch(o){case"nearest":M=uQ(A,d,p,x,w,I,_,W,U,L,u);break;case"bilinear":M=cQ(A,d,p,x,w,I,_,W,U,L,u);break;default:throw new Error("Error in Transform: Expect 'nearest' or "+"'bilinear', but got ".concat(o))}N[_*C+F*E+O*T+L]=M}}return r.makeTensorInfo(k,a.dtype,N)}return{dataId:r.write(N,k,a.dtype),shape:a.shape,dtype:a.dtype}}};function oQ(e,t,n){switch(n){case"reflect":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=2*t;n<r&&(n=r*Math.trunc(-n/r)+n),n=n<-t?n+r:-n-1}else if(n>t-1)if(t<=1)n=0;else{var a=2*t;(n-=a*Math.trunc(n/a))>=t&&(n=a-n-1)}return Lx(0,n,t-1)}(e,t);case"wrap":return function(e,t){var n=e;if(n<0)if(t<=1)n=0;else{var r=t-1;n+=t*(Math.trunc(-n/r)+1)}else if(n>t-1)if(t<=1)n=0;else{var a=t-1;n-=t*Math.trunc(n/a)}return Lx(0,n,t-1)}(e,t);case"nearest":return function(e,t){return Lx(0,e,t-1)}(e,t);default:return function(e,t){return e}(e)}}function sQ(e,t,n,r,a,i,o,s,u,c,l){return 0<=s&&s<t&&0<=u&&u<n?e[o*r+s*a+u*i+c]:l}function uQ(e,t,n,r,a,i,o,s,u,c,l){return sQ(e,t,n,r,a,i,o,Math.round(s),Math.round(u),c,l)}function cQ(e,t,n,r,a,i,o,s,u,c,l){var h=Math.floor(s),f=Math.floor(u),d=h+1,p=f+1;return(d-s)*((p-u)*sQ(e,t,n,r,a,i,o,h,f,c,l)+(u-f)*sQ(e,t,n,r,a,i,o,h,p,c,l))+(s-h)*((p-u)*sQ(e,t,n,r,a,i,o,d,f,c,l)+(u-f)*sQ(e,t,n,r,a,i,o,d,p,c,l))}function lQ(e,t,n,r){for(var a=Yx(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u={},c=new Int32Array(n[a]),l=new bE(i,r,e),h=[],f=1===i[0]&&1===i[2],d=0;d<n[a];d++){var p=void 0;if(f)p=e[d].toString();else{for(var v=[],m=0;m<i[0];m++)for(var g=0;g<i[2];g++)v.push(l.get(m,d,g));p=v.join(",")}if(void 0!==u[p])c[d]=u[p];else{var y=Object.keys(u).length;u[p]=y,c[d]=y,h.push(d)}}var b=i.slice();b[1]=Object.keys(u).length;var k=new bE(b,r);h.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)k.set(l.get(n,e,r),n,t,r)}));var V=n.slice();return V[a]=b[1],{outputValues:k.values,outputShape:V,indices:c}}var hQ={kernelName:wC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;iZ(i,"unique");var o=lQ(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var fQ={kernelName:IC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var h=new Array(o).fill(0),f=a.shape.slice();f[i]=1;for(var d=new Array(s),p=0;p<d.length;p++){h[i]=p;var v=TG({inputs:{x:a},backend:n,attrs:{begin:h,size:f}});d[p]=jZ({inputs:{x:v},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(v)}return d}};for(var dQ={kernelName:SC,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;iZ(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,h=0;h<c;++h){var f=_H({inputs:{input:l},backend:n,attrs:{dim:h+1}});l=f,u.push(f)}for(var d=0;d<o;++d){var p=iE(d,"int32"),v=n.makeTensorInfo([],"int32",p),m=SH({inputs:{a:v,b:l},backend:n}),g=OZ({inputs:{x:m},backend:n,attrs:{dtype:"float32"}}),y=yH({inputs:{a:g,b:a},backend:n}),b=kH({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(v),u.push(m),u.push(g),u.push(y),u.push(b)}var k=NK({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),k}},pQ=0,vQ=[qZ,XZ,YZ,$Z,WZ,eG,aG,iG,oG,sG,cG,hG,dG,mG,yG,xG,wG,IG,SG,HZ,CG,AG,DG,FG,LZ,MG,zG,AZ,BG,GG,qG,KG,XG,QG,YG,JG,eH,nH,rH,aH,iH,oH,sH,cH,lH,hH,fH,dH,pH,vH,xH,hZ,wH,CH,TH,RH,DH,LH,qH,XH,QH,$H,nq,rq,aq,oq,uq,hq,pq,dZ,vq,jG,gq,bq,Vq,vZ,Iq,Eq,Nq,_q,Fq,Mq,zq,Wq,jq,Zq,qq,Qq,Yq,Jq,$q,eK,tK,nK,rK,oK,sK,lK,dK,bH,vK,gK,bK,VK,IK,SK,TK,AK,RK,FK,bZ,LK,WK,ZK,DZ,zH,HK,VZ,wZ,ZZ,qK,KK,XK,QK,YK,JK,eX,rX,iX,uX,cX,hX,EZ,dX,vX,gX,NG,fK,kX,VX,wX,SX,EX,TX,NX,AX,DX,FX,MX,zX,UX,ZX,qX,XX,jH,VH,YX,{kernelName:yC,backendName:"cpu",kernelFunc:JX},eQ,aQ,iQ,rG,hQ,fQ,dQ,EK];pQ<vQ.length;pQ++){zC(vQ[pQ])}var mQ,gQ,yQ,bQ={},kQ={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function VQ(e,t){if(!(e in bQ)||null!=t){var n=function(e,t){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var n=null==t?function(e){if("undefined"!==typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e):t;n.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete bQ[e]}),!1),ww().getBool("SOFTWARE_WEBGL_ENABLED")&&(kQ.failIfMajorPerformanceCaveat=!1);if(1===e)return n.getContext("webgl",kQ)||n.getContext("experimental-webgl",kQ);return n.getContext("webgl2",kQ)}(e,t);if(null===n)return console.log("Could not get context for WebGL version",e),null;bQ[e]=n}var r=bQ[e];return null==r||r.isContextLost()?(delete bQ[e],VQ(e)):(r.disable(r.DEPTH_TEST),r.disable(r.STENCIL_TEST),r.disable(r.BLEND),r.disable(r.DITHER),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SAMPLE_COVERAGE),r.enable(r.SCISSOR_TEST),r.enable(r.CULL_FACE),r.cullFace(r.BACK),bQ[e])}function xQ(e,t){return[t,e]}function wQ(e){var t=Zx(e);return qx(Math.ceil(t/4))}function IQ(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function SQ(e,t){var n,r,a,i,o,s,u,c,l,h,f=e;return 2===ww().getNumber("WEBGL_VERSION")?(n=f.R32F,r=f.R16F,a=f.RGBA16F,i=f.RGBA32F,o=f.RED,u=4,c=1,l=f.HALF_FLOAT,h=f.FLOAT,s=f.RGBA8):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=f.RGBA,o=e.RGBA,u=4,c=4,l=null!=t?t.HALF_FLOAT_OES:null,h=e.FLOAT,s=e.RGBA),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:s,downloadUnpackNumChannels:u,defaultNumChannels:c,textureTypeHalfFloat:l,textureTypeFloat:h}}function CQ(e,t){var n=t();return ww().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(mQ||(mQ={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(gQ||(gQ={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(yQ||(yQ={}));function EQ(e){return!!(ww().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function TQ(e,t){return UQ(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}var NQ,AQ,RQ=/ERROR: [0-9]+:([0-9]+):/g;function _Q(e,t){var n=RQ.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return Kx((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),h=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(Kx(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}function DQ(e,t){if(CQ(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function FQ(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(CQ(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),CQ(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),CQ(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function OQ(e,t,n){return UQ(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function LQ(e,t,n){return e.getUniformLocation(t,n)}function MQ(e,t,n,r){CQ(e,(function(){return function(e,t,n){WQ(e,n),CQ(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),CQ(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),CQ(e,(function(){return e.uniform1i(n,r)}))}function PQ(e,t,n){CQ(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),CQ(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function zQ(e,t){CQ(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),CQ(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function BQ(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function UQ(e,t,n){var r=CQ(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function WQ(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function jQ(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return Zx(e.slice(0,e.length-t))}function ZQ(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function GQ(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[jQ(e)].concat((0,H.Z)(ZQ(e)))),t}function HQ(e){return e%2===0}function qQ(e,t){if(Gx(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(HQ(n)&&HQ(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&HQ(e[0])&&HQ(t[0])}function KQ(e,t){return null!=e.getExtension(t)}function XQ(e){try{if(null!=VQ(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function QQ(e){if(0===e)return!1;var t=VQ(e);if(1!==e){if(KQ(t,"EXT_color_buffer_float"))return YQ(t);var n="EXT_color_buffer_half_float";if(KQ(t,n)){var r=t.getExtension(n);return function(e,t){var n=SQ(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!!KQ(t,"OES_texture_float")&&(!!KQ(t,"WEBGL_color_buffer_float")&&YQ(t))}function YQ(e){var t=SQ(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function JQ(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&Bx("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."}))}))}var $Q=ww();function eY(){var e,t,n,r,a,i,o,s,u,c;return 2===ww().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        uint floatToUint = floatBitsToUint(val);\n        return (floatToUint & 0x7fffffffu) > 0x7f800000u;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function tY(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=cw(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function nY(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=cw(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / outShapeStrides[").concat(a,"]"),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * outShapeStrides[").concat(a,"]"):"index -= ".concat(e[a]," * outShapeStrides[").concat(a,"]");return"".concat(i,"; ").concat(o,";")})).join("")}function rY(e,t){var n=e.length,r=e.map((function(e){return"".concat(t,"[").concat(e,"]")})),a=new Array(n-1);a[n-2]=r[n-1];for(var i=n-3;i>=0;--i)a[i]="(".concat(a[i+1]," * ").concat(r[i+1],")");return a}function aY(e){var t=cw(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}$Q.registerFlag("HAS_WEBGL",(function(){return $Q.getNumber("WEBGL_VERSION")>0})),$Q.registerFlag("WEBGL_VERSION",(function(){return XQ(2)?2:XQ(1)?1:0})),$Q.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),$Q.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===$Q.get("WEBGL_VERSION")})),$Q.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),$Q.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),$Q.registerFlag("WEBGL_PACK",(function(){return $Q.getBool("HAS_WEBGL")})),$Q.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return $Q.getBool("WEBGL_PACK")})),$Q.registerFlag("WEBGL_PACK_CLIP",(function(){return $Q.getBool("WEBGL_PACK")})),$Q.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return $Q.getBool("WEBGL_PACK")})),$Q.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return $Q.getBool("WEBGL_PACK")})),$Q.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return $Q.getBool("WEBGL_PACK")})),$Q.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return $Q.getBool("WEBGL_PACK")})),$Q.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return $Q.getBool("WEBGL_PACK")})),$Q.registerFlag("WEBGL_PACK_REDUCE",(function(){return $Q.getBool("WEBGL_PACK")})),$Q.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return $Q.getBool("WEBGL_PACK")})),$Q.registerFlag("WEBGL_CONV_IM2COL",(function(){return $Q.getBool("WEBGL_PACK")})),$Q.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==NQ){var t=VQ(e);NQ=t.getParameter(t.MAX_TEXTURE_SIZE)}return NQ}($Q.getNumber("WEBGL_VERSION"))})),$Q.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==AQ){var t=VQ(e);AQ=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,AQ)}($Q.getNumber("WEBGL_VERSION"))})),$Q.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=$Q.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=VQ(e);return KQ(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:KQ(t,"EXT_disjoint_timer_query")?1:0}(e)})),$Q.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return $Q.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!GE()})),$Q.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=VQ(e);if(1===e){if(!KQ(t,"OES_texture_float"))return!1}else if(!KQ(t,"EXT_color_buffer_float"))return!1;return YQ(t)}($Q.getNumber("WEBGL_VERSION"))})),$Q.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!$Q.getBool("WEBGL_FORCE_F16_TEXTURES")&&$Q.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),$Q.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return QQ($Q.getNumber("WEBGL_VERSION"))})),$Q.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=$Q.getNumber("WEBGL_VERSION"))&&null!=VQ(e).fenceSync;var e})),$Q.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return $Q.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),$Q.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))})),$Q.registerFlag("WEBGL_FLUSH_THRESHOLD",(function(){return GE()?1:-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_FLUSH_THRESHOLD must be -1 (indicating never "+"manual flush) or at least 0, but got ".concat(e,"."))})),$Q.registerFlag("CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 128})),$Q.registerFlag("WEBGL_USE_SHAPES_UNIFORMS",(function(){return!1})),$Q.registerFlag("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD",(function(){return 1e5})),$Q.registerFlag("TOPK_K_CPU_HANDOFF_THRESHOLD",(function(){return 128})),$Q.registerFlag("WEBGL_EXP_CONV",(function(){return!1})),$Q.registerFlag("SOFTWARE_WEBGL_ENABLED",(function(){return $Q.getBool("IS_TEST")}));var iY="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",oY=LN;function sY(e,t,n){var r=[];if(e.forEach((function(e){var t=Zx(e.shapeInfo.logicalShape);if(e.shapeInfo.isUniform?r.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(r.push("uniform sampler2D ".concat(e.name,";")),r.push("uniform int offset".concat(e.name,";"))),n.enableShapeUniforms){switch(CY(n.packedInputs,e.shapeInfo.logicalShape,e.shapeInfo.texShape).uniformShape.length){case 1:r.push("uniform int ".concat(e.name,"Shape;"));break;case 2:r.push("uniform ivec2 ".concat(e.name,"Shape;"));break;case 3:r.push("uniform ivec3 ".concat(e.name,"Shape;"));break;case 4:r.push("uniform ivec4 ".concat(e.name,"Shape;"))}r.push("uniform ivec2 ".concat(e.name,"TexShape;"))}})),n.enableShapeUniforms){switch(t.logicalShape.length){case 1:r.push("uniform int outShape;");break;case 2:r.push("uniform ivec2 outShape;"),r.push("uniform int outShapeStrides;");break;case 3:r.push("uniform ivec3 outShape;"),r.push("uniform ivec2 outShapeStrides;");break;case 4:r.push("uniform ivec4 outShape;"),r.push("uniform ivec3 outShapeStrides;")}r.push("uniform ivec2 outTexShape;")}n.customUniforms&&n.customUniforms.forEach((function(e){r.push("uniform ".concat(e.type," ").concat(e.name).concat(e.arrayIndex?"[".concat(e.arrayIndex,"]"):"",";"))}));var a,i,o=r.join("\n"),s=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3?arguments[3]:void 0,a="";a+=n?cY(e,r):uY(e,r);var i=e.shapeInfo.logicalShape,o=t.logicalShape;i.length<=o.length&&(a+=n?wY(e,t):IY(e,t));return a}(e,t,n.packedInputs,n.enableShapeUniforms)})).join("\n"),u=t.texShape,c=eY(),l=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(c),h=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(lY,"\n    ").concat(hY,"\n    ").concat(fY,"\n  ")}(c);return t.isPacked?(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===r[0])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ceil(float(outTexShape[1]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(r[1],".0);\n      }\n    ");if(1===r[1])return n?"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ceil(float(outTexShape[0]) / 2.0));\n      }\n    ":"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(r[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      return 2 * (resTexRC.x * packedTexShape[1] + resTexRC.y);\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      return 2 * (resTexRC.x * ").concat(r[1]," + resTexRC.y);\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(Gx(e,t))return n?"\n      ivec2 getOutputCoords() {\n        ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n        return 2 * ivec2(resultUV.yx * vec2(packedTexShape[0], packedTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(r[0],", ").concat(r[1],"));\n      }\n    ");var a=Math.ceil(e[1]/2);if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n)return"\n    ivec3 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      int texelsInLogicalRow = int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec3(b, r, c);\n    }\n  ";var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[2]/2),i=a*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t,n);default:return function(e,t,n){if(n)return"\n    ivec4 getOutputCoords() {\n      ivec2 packedTexShape = ivec2(ceil(float(outTexShape[0]) / 2.0), ceil(float(outTexShape[1]) / 2.0));\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(packedTexShape[0], packedTexShape[1]));\n      int index = resTexRC.x * packedTexShape[1] + resTexRC.y;\n\n      int texelsInLogicalRow = int(ceil(float(outShape[3]) / 2.0));\n      int texelsInBatch = texelsInLogicalRow * int(ceil(float(outShape[2]) / 2.0));\n      int texelsInBatchN = texelsInBatch * outShape[1];\n\n      int b2 = index / texelsInBatchN;\n      index -= b2 * texelsInBatchN;\n\n      int b = index / texelsInBatch;\n      index -= b * texelsInBatch;\n\n      int r = 2 * (index / texelsInLogicalRow);\n      int c = imod(index, texelsInLogicalRow) * 2;\n\n      return ivec4(b2, b, r, c);\n    }\n  ";for(var r=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],a=Math.ceil(e[e.length-1]/2),i=a*Math.ceil(e[e.length-2]/2),o=i,s="",u="b, r, c",c=2;c<e.length-1;c++)o*=e[e.length-c-1],s="\n      int b".concat(c," = index / ").concat(o,";\n      index -= b").concat(c," * ").concat(o,";\n    ")+s,u="b".concat(c,", ")+u;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(r[0],", ").concat(r[1],"));\n      int index = resTexRC.x * ").concat(r[1]," + resTexRC.y;\n\n      ").concat(s,"\n\n      int b = index / ").concat(i,";\n      index -= b * ").concat(i,";\n\n      int r = 2 * (index / ").concat(a,");\n      int c = imod(index, ").concat(a,") * 2;\n\n      return ivec").concat(e.length,"(").concat(u,");\n    }\n  ")}(e,t,n)}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(c)):(a=function(e,t,n){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t,n){if(1===t[0])return n?"\n      int getOutputCoords() {\n        return int(resultUV.x * float(outTexShape[1]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return n?"\n      int getOutputCoords() {\n        return int(resultUV.y * float(outTexShape[0]));\n      }\n    ":"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");if(n)return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      return resTexRC.x * outTexShape[1] + resTexRC.y;\n    }\n  ";return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t,n);case 2:return function(e,t,n){if(Gx(e,t))return n?"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(outTexShape[0], outTexShape[1]));\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return n?"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(outTexShape[0], outTexShape[1]));\n        int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ":"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");if(n)return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      int r = index / outShape[1];\n      int c = index - r * outShape[1];\n      return ivec2(r, c);\n    }\n  ";return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t,n);case 3:return function(e,t,n){if(n){var r=nY(["r","c","d"],e);return"\n  ivec3 getOutputCoords() {\n    ivec2 resTexRC = ivec2(resultUV.yx *\n                           vec2(outTexShape[0], outTexShape[1]));\n    int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n    ".concat(r,"\n    return ivec3(r, c, d);\n  }\n")}var a=tY(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t,n);case 4:return function(e,t,n){if(n){var r=nY(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(outTexShape[0], outTexShape[1]));\n      int index = resTexRC.x * outTexShape[1] + resTexRC.y;\n      ".concat(r,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}var a=tY(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(a,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t,n);case 5:return function(e,t){var n=tY(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=tY(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,u,n.enableShapeUniforms),i=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(c)),n.packedInputs&&(h+=dY),[h,l,i,o,a,s,n.userCode].join("\n")}function uY(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.shapeInfo.logicalShape;switch(n.length){case 0:return vY(e,t);case 1:return mY(e,t);case 2:return gY(e,t);case 3:return yY(e,t);case 4:return bY(e,t);case 5:return kY(e);case 6:return VY(e);default:throw new Error("".concat(n.length,"-D input sampling")+" is not yet supported")}}function cY(e,t){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=eY();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=eY();if(t)return"\n    vec4 ".concat(r,"(int index) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      vec2 uv = packedUVfrom1D(\n        packedTexShape[0], packedTexShape[1], index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ");var o=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];return"\n    vec4 ".concat(r,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(o[0],", ").concat(o[1],", index);\n      return ").concat(i.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t);case 2:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=i[0],s=i[1],u=eY();if(null!=i&&Gx(n,i))return t?"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    "):"\n      vec4 ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n\n        return ").concat(u.texture2D,"(").concat(r,", uv);\n      }\n    ");if(t)return"\n    vec4 ".concat(a,"(int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom2D(valuesPerRow, packedTexShape[0], packedTexShape[1], row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ");var c=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],l=Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(l,", ").concat(c[0],", ").concat(c[1],", row, col);\n      return ").concat(u.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===n[0]){var s=[1,2],u=EY(e,n.slice(1)),c=["b","row","col"];return"\n        ".concat(cY(u,t),"\n        vec4 ").concat(a,"(int b, int row, int col) {\n          return ").concat(a,"(").concat(TY(c,s),");\n        }\n      ")}var l=eY();if(t)return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(r,"TexShape[0]) / 2.0), ceil(float(").concat(r,"TexShape[1]) / 2.0));\n      int valuesPerRow = int(ceil(float(").concat(r,"Shape[2]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(r,"Shape[1]) / 2.0));\n      vec2 uv = packedUVfrom3D(\n        packedTexShape[0], packedTexShape[1], texelsInBatch, valuesPerRow, b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ");var h=o[0],f=o[1],d=Math.ceil(n[2]/2),p=d*Math.ceil(n[1]/2);return"\n    vec4 ".concat(a,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(h,", ").concat(f,", ").concat(p,", ").concat(d,", b, row, col);\n      return ").concat(l.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e,t);default:return function(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=eY();if(t)return"\n    vec4 ".concat(r,"(int b2, int b, int row, int col) {\n      int valuesPerRow = int(ceil(float(").concat(n,"Shape[3]) / 2.0));\n      int texelsInBatch = valuesPerRow * int(ceil(float(").concat(n,"Shape[2]) / 2.0));\n      int index = b * texelsInBatch + (row / 2) * valuesPerRow + (col / 2);\n      texelsInBatch *= ").concat(n,"Shape[1];\n      index = b2 * texelsInBatch + index;\n      ivec2 packedTexShape = ivec2(ceil(float(").concat(n,"TexShape[0]) / 2.0), ceil(float(").concat(n,"TexShape[1]) / 2.0));\n      int texR = index / packedTexShape[1];\n      int texC = index - texR * packedTexShape[1];\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(packedTexShape[1], packedTexShape[0]); return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ");for(var i=e.shapeInfo.logicalShape,o=i.length,s=e.shapeInfo.texShape,u=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],c=u[0],l=u[1],h=Math.ceil(i[o-1]/2),f=h*Math.ceil(i[o-2]/2),d="int b, int row, int col",p="b * ".concat(f," + (row / 2) * ").concat(h," + (col / 2)"),v=2;v<o-1;v++)d="int b".concat(v,", ")+d,f*=i[o-v-1],p="b".concat(v," * ").concat(f," + ")+p;return"\n    vec4 ".concat(r,"(").concat(d,") {\n      int index = ").concat(p,";\n      int texR = index / ").concat(l,";\n      int texC = index - texR * ").concat(l,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(l,", ").concat(c,");\n      return ").concat(a.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e,t)}}var lY="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",hY="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",fY="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",dY="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function pY(e){return"offset".concat(e)}function vY(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(r,"() {return ").concat(n,";}");var a=(0,l.Z)(e.shapeInfo.texShape,2),i=a[0],o=a[1];if(1===i&&1===o)return"\n      float ".concat(r,"() {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=pY(n);if(t)return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var u=(0,l.Z)(e.shapeInfo.texShape,2),c=u[0],h=u[1];return"\n    float ".concat(r,"() {\n      vec2 uv = uvFromFlat(").concat(c,", ").concat(h,", ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function mY(e,t){var n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int index) {\n        ").concat(xY(e),"\n      }\n    ");var a=e.shapeInfo.texShape,i=a[0],o=a[1];if(1===o&&1===i)return"\n      float ".concat(r,"(int index) {\n        return sampleTexture(").concat(n,", halfCR);\n      }\n    ");var s=pY(n);return 1===o?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[0]));\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(s,") + 0.5) / ").concat(i,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):1===i?t?"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / float(").concat(n,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):"\n      float ".concat(r,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(s,") + 0.5) / ").concat(o,".0, 0.5);\n        return sampleTexture(").concat(n,", uv);\n      }\n    "):t?"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(n,"TexShape[0], ").concat(n,"TexShape[1], index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  "):"\n    float ".concat(r,"(int index) {\n      vec2 uv = uvFromFlat(").concat(i,", ").concat(o,", index + ").concat(s,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function gY(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape;if(null!=i&&Gx(n,i)){if(t)return"\n      float ".concat(a,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var o=i[0],s=i[1];return"\n    float ".concat(a,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}var u=Jx(n),c=u.newShape,l=u.keptDims,h=c;if(h.length<n.length){var f=EY(e,h);return"\n      ".concat(uY(f,t),"\n      float ").concat(a,"(int row, int col) {\n        return ").concat(a,"(").concat(TY(["row","col"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(n[1],", 1)));\n        ").concat(xY(e),"\n      }\n    ");var d=i[0],p=i[1],v=pY(r);return 1===p?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2(0.5, (index + 0.5) / float(").concat(r,"TexShape[0]));\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(d,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):1===d?t?"\n      float ".concat(a,"(int row, int col) {\n        float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(r,"Shape[1], 1, 1));\n        vec2 uv = vec2((index + 0.5) / float(").concat(r,"TexShape[1]), 0.5);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(n[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(p,".0, 0.5);\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):t?"\n      float ".concat(a,"(int row, int col) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(r,"Shape[1] + col + ").concat(v,";\n        vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n  float ".concat(a,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(n[1]," + col + ").concat(v,";\n    vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index);\n    return sampleTexture(").concat(r,", uv);\n  }\n")}function yY(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[1]*n[2],o=n[2],s=Jx(n),u=s.newShape,c=s.keptDims,l=u;if(l.length<n.length){var h=EY(e,l);return"\n        ".concat(uY(h,t),"\n        float ").concat(a,"(int row, int col, int depth) {\n          return ").concat(a,"(").concat(TY(["row","col","depth"],c),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(i,", ").concat(o,", 1)));\n        ").concat(xY(e),"\n      }\n    ");var f=e.shapeInfo.texShape,d=f[0],p=f[1],v=e.shapeInfo.flatOffset;if(p===i&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        int stride1 = ").concat(r,"Shape[2];\n        float texR = float(row);\n        float texC = dot(vec2(col, depth), vec2(stride1, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n        float ".concat(a,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(o,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(p,".0, ").concat(d,".0);\n          return sampleTexture(").concat(r,", uv);\n        }\n      ");if(p===o&&null==v)return t?"\n      float ".concat(a,"(int row, int col, int depth) {\n        float texR = dot(vec2(row, col), vec2(").concat(r,"Shape[1], 1));\n        float texC = float(depth);\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n    float ".concat(a,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(n[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(p,".0, ").concat(d,".0);\n      return sampleTexture(").concat(r,", uv);\n    }\n  ");var m=pY(r);return t?"\n    float ".concat(a,"(int row, int col, int depth) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int stride0 = ").concat(r,"Shape[1] * ").concat(r,"Shape[2];\n      int stride1 = ").concat(r,"Shape[2];\n      int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(m,";\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index);\n      return sampleTexture(").concat(r,", uv);\n    }\n    "):"\n      float ".concat(a,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(i," + col * ").concat(o," + depth + ").concat(m,";\n        vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index);\n        return sampleTexture(").concat(r,", uv);\n      }\n  ")}function bY(e,t){var n=e.shapeInfo.logicalShape,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=n[3],o=n[2]*i,s=n[1]*o,u=Jx(n),c=u.newShape,l=u.keptDims;if(c.length<n.length){var h=EY(e,c);return"\n      ".concat(uY(h,t),"\n      float ").concat(a,"(int row, int col, int depth, int depth2) {\n        return ").concat(a,"(").concat(TY(["row","col","depth","depth2"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(s,", ").concat(o,", ").concat(i,", 1)));\n        ").concat(xY(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],v=d[1],m="int stride2 = ".concat(r,"Shape[3];"),g="int stride1 = ".concat(r,"Shape[2] * stride2;"),y="int stride0 = ".concat(r,"Shape[1] * stride1;");if(v===s&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        ").concat(m,"\n        ").concat(g,"\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(stride1, stride2, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(o,", ").concat(i,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(p,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");if(v===i&&null==f)return t?"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(r,"Shape[1] * ").concat(r,"Shape[2], ").concat(r,"Shape[2], 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(r,"TexShape[1], ").concat(r,"TexShape[0]);\n        return sampleTexture(").concat(r,", uv);\n      }\n    "):"\n      float ".concat(a,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(n[1]*n[2],", ").concat(n[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(p,".0);\n        return sampleTexture(").concat(r,", uv);\n      }\n    ");var b=pY(r);return t?"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      ").concat(m,"\n      ").concat(g,"\n      ").concat(y,"\n      int index = row * stride0 + col * stride1 +\n          depth * stride2 + depth2;\n      vec2 uv = uvFromFlat(").concat(r,"TexShape[0], ").concat(r,"TexShape[1], index + ").concat(b,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  "):"\n    float ".concat(a,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," +\n          depth * ").concat(i," + depth2;\n      vec2 uv = uvFromFlat(").concat(p,", ").concat(v,", index + ").concat(b,");\n      return sampleTexture(").concat(r,", uv);\n    }\n  ")}function kY(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=Jx(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var h=EY(e,c);return"\n      ".concat(uY(h),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(TY(["row","col","depth","depth2","depth3"],l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(xY(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],v=d[1];if(v===s&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===a&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var m=pY(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(m,";\n      vec2 uv = uvFromFlat(").concat(p,", ").concat(v,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function VY(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=Jx(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=EY(e,i);return"\n      ".concat(uY(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(TY(["row","col","depth","depth2","depth3","depth4"],o),");\n      }\n    ")}var u=t[5],c=t[4]*u,l=t[3]*c,h=t[2]*l,f=t[1]*h;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(f,", ").concat(h,", ").concat(l,", ").concat(c,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(u,", 1)));\n        ").concat(xY(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,v=p[0],m=p[1];if(m===f&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(h,", ").concat(l,", ").concat(c,", ").concat(u,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(m===u&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=pY(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(f," + col * ").concat(h," + depth * ").concat(l," +\n          depth2 * ").concat(c," + depth3 * ").concat(u," + depth4 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(m,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}function xY(e){var t=e.name,n=Zx(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function wY(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=oY(e.shapeInfo.logicalShape,t.logicalShape),c=SY(s),l=s-o,h=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(h[e+l]," = 0;")})).join("\n");var f="";f=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(h[t+l])})).join(", ");var d="return outputValue;",p=1===Zx(e.shapeInfo.logicalShape),v=1===Zx(t.logicalShape);if(1!==o||p||v){if(p&&!v)d=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var m=o-2,g=o-1;u.indexOf(m)>-1&&u.indexOf(g)>-1?d="return vec4(outputValue.x);":u.indexOf(m)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(f,");\n      ").concat(d,"\n    }\n  ")}function IY(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&Gx(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=SY(u),h=oY(e.shapeInfo.logicalShape,t.logicalShape),f=u-s,d=["x","y","z","w","u","v"];c=0===s?"":u<2&&h.length>=1?"coords = 0;":h.map((function(e){return"coords.".concat(d[e+f]," = 0;")})).join("\n");var p="";return p=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+f])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(p,");\n    }\n  ")}function SY(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function CY(e,t,n){var r=Jx(t),a=r.newShape,i=r.keptDims,o=t.length,s=e&&3===o&&1===t[0],u=s?t.slice(1):a,c=!e&&o>1&&!Gx(t,n)&&a.length<o||s;return{useSqueezeShape:c,uniformShape:c?u:t,keptDims:i}}function EY(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function TY(e,t){return t.map((function(t){return e[t]})).join(", ")}function NY(e,t,n,r){var a=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),i=a.map((function(e){return e.shapeInfo})),o={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},s=sY(a,o,t),u=function(e,t){var n=UQ(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(CQ(e,(function(){return e.shaderSource(n,t)})),CQ(e,(function(){return e.compileShader(n)})),ww().get("ENGINE_COMPILE_ONLY"))return n;if(!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw _Q(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}(e.gl,s),c=e.createProgram(u);return ww().get("ENGINE_COMPILE_ONLY")?{program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o,uniformLocations:null,customUniformLocations:null,infLoc:null,nanLoc:null,inShapesLocations:null,inTexShapesLocations:null,outShapeLocation:null,outShapeStridesLocation:null,outTexShapeLocation:null}:Object.assign({program:t,fragmentShader:u,source:s,webGLProgram:c,inShapeInfos:i,outShapeInfo:o},AY(e,t,c))}function AY(e,t,n){var r,a,i,o,s={},u={},c={},l=[],h=null;o=e.getUniformLocation(n,"NAN",!1),1===ww().getNumber("WEBGL_VERSION")&&(h=e.getUniformLocation(n,"INFINITY",!1));for(var f=!1,d=0;d<t.variableNames.length;d++){var p=t.variableNames[d];s[p]=e.getUniformLocation(n,p,f),s["offset".concat(p)]=e.getUniformLocation(n,"offset".concat(p),f),t.enableShapeUniforms&&(u["".concat(p,"Shape")]=e.getUniformLocation(n,"".concat(p,"Shape"),f),c["".concat(p,"TexShape")]=e.getUniformLocation(n,"".concat(p,"TexShape"),f))}return t.enableShapeUniforms&&(r=e.getUniformLocation(n,"outShape",f),i=e.getUniformLocation(n,"outShapeStrides",f),a=e.getUniformLocation(n,"outTexShape",f)),t.customUniforms&&t.customUniforms.forEach((function(t,r){l[r]=e.getUniformLocation(n,t.name,f)})),{uniformLocations:s,customUniformLocations:l,infLoc:h,nanLoc:o,inShapesLocations:u,inTexShapesLocations:c,outShapeLocation:r,outShapeStridesLocation:i,outTexShapeLocation:a}}function RY(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!Gx(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!Gx(o,s))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function _Y(e,t,n,r,a){t.program.enableShapeUniforms||(RY(t.inShapeInfos,n),RY([t.outShapeInfo],[r]));var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i.texture,o[0],o[1]):e.setOutputMatrixTexture(i.texture,o[0],o[1]),e.setProgram(t.webGLProgram),1===ww().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset".concat(a)],s=t.inShapesLocations["".concat(a,"Shape")],u=t.inTexShapesLocations["".concat(a,"TexShape")];if(s){var c=CY(t.program.packedInputs,n.shape,n.texData.texShape).uniformShape;switch(c.length){case 1:e.gl.uniform1iv(s,new Int32Array(c));break;case 2:e.gl.uniform2iv(s,new Int32Array(c));break;case 3:e.gl.uniform3iv(s,new Int32Array(c));break;case 4:e.gl.uniform4iv(s,new Int32Array(c))}}if(u&&e.gl.uniform2i(u,n.texData.texShape[0],n.texData.texShape[1]),null!=i)if(n.isUniform)if(Zx(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var l=n.uniformValues;l instanceof Float32Array||(l=new Float32Array(l)),e.gl.uniform1fv(i,l)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture.texture,i,r)}));var s=t.outShapeLocation;if(s)switch(r.shape.length){case 1:e.gl.uniform1iv(s,new Int32Array(r.shape));break;case 2:e.gl.uniform2iv(s,new Int32Array(r.shape));break;case 3:e.gl.uniform3iv(s,new Int32Array(r.shape));break;case 4:e.gl.uniform4iv(s,new Int32Array(r.shape))}if(t.outShapeStridesLocation){var u=cw(r.shape);switch(r.shape.length){case 2:e.gl.uniform1iv(t.outShapeStridesLocation,new Int32Array(u));break;case 3:e.gl.uniform2iv(t.outShapeStridesLocation,new Int32Array(u));break;case 4:e.gl.uniform3iv(t.outShapeStridesLocation,new Int32Array(u))}}t.outTexShapeLocation&&e.gl.uniform2i(t.outTexShapeLocation,r.texData.texShape[0],r.texData.texShape[1]),t.program.customUniforms&&a&&t.program.customUniforms.forEach((function(n,r){var i=t.customUniformLocations[r],o=a[r];if("float"===n.type)e.gl.uniform1fv(i,o);else if("vec2"===n.type)e.gl.uniform2fv(i,o);else if("vec3"===n.type)e.gl.uniform3fv(i,o);else if("vec4"===n.type)e.gl.uniform4fv(i,o);else if("int"===n.type)e.gl.uniform1iv(i,o);else if("ivec2"===n.type)e.gl.uniform2iv(i,o);else if("ivec3"===n.type)e.gl.uniform3iv(i,o);else{if("ivec4"!==n.type)throw Error("uniform type ".concat(n.type," is not supported yet."));e.gl.uniform4iv(i,o)}})),e.executeProgram()}function DY(e,t,n){var r="";t.concat(n).forEach((function(t){var a=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0;if(e.enableShapeUniforms&&!t.isUniform){var i=t.texData.texShape,o=CY(e.packedInputs,t.shape,i),s=o.useSqueezeShape,u=o.uniformShape,c=o.keptDims,l="",h="",f="";if(1===u.length&&e.packedInputs){var d=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];l="".concat(d[0]>1,"_").concat(d[1]>1)}else if(2!==u.length||e.packedInputs){if(u.length>2&&!e.packedInputs){var p=cw(u);f="".concat(p[0]===i[1],"_").concat(p[p.length-1]===i[1])}}else h="".concat(u[0]>1,"_").concat(u[1]>1);var v=t.shape.length,m=2===u.length&&Gx(t.shape,i),g=1===Zx(t.shape),y=LN(t.shape,n.shape),b=!e.packedInputs&&v===n.shape.length&&Gx(i,n.texData.texShape),k=e.packedInputs||u.length>2?"":"".concat(i[0]>1,"_").concat(i[1]>1);r+="".concat(v,"_").concat(b,"_").concat(s?c:"","_").concat(u.length,"_").concat(g,"_").concat(y,"_").concat(m,"_").concat(l,"_").concat(h,"_").concat(f,"_").concat(k,"_").concat(a)}else{var V=t.isUniform?"uniform":t.texData.texShape;r+="".concat(t.shape,"_").concat(V,"_").concat(a)}}));var a=e.userCode,i=e.constructor.name;return i+="_"+r+"_"+a+"".concat(ww().getNumber("WEBGL_VERSION"))}function FY(e){return ww().getBool("WEBGL_USE_SHAPES_UNIFORMS")&&e<=4}var OY=p((function e(t){f(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=mQ.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=eY();this.outputShape=t,this.enableShapeUniforms=FY(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?nY(["r","c","d"],t):tY(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),LY=p((function e(t){f(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=mQ.DENSE,this.customUniforms=[{name:"texShape",type:"ivec2"}];var n=eY();this.outputShape=t,this.enableShapeUniforms=FY(this.outputShape.length),this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(this.enableShapeUniforms?nY(["r","c","d"],t):tY(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx * vec2(texShape[0], texShape[1]));\n        int index = 4 * (resTexRC.x * texShape[1] + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),MY=p((function e(t){f(this,e),this.variableNames=["A"],this.outTexUsage=gQ.DOWNLOAD;var n=eY();this.outputShape=t,this.userCode="\n      ".concat(iY,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),PY=p((function e(t){f(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=gQ.DOWNLOAD;var n=eY();this.outputShape=t,this.userCode="\n      ".concat(iY,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),zY=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f(this,e),this.variableNames=["A"],this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=eY();this.outputShape=t,this.enableShapeUniforms=FY(this.outputShape.length);var a="result";n&&(a="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":aY(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / texShape[1];\n        int c = imod(flatIndex, texShape[1]);\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n        vec4 values = ").concat(r.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(r.output," = vec4(").concat(a,", 0., 0., 0.);\n      }\n    ")})),BY=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];f(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.customUniforms=[{name:"texShape",type:"ivec2"}];var r=eY();this.outputShape=t,this.enableShapeUniforms=FY(this.outputShape.length);var a="",i="result";n&&(i="floor(result * 255. + 0.5)");for(var o=0;o<=1;o++)for(var s=0;s<=1;s++){var u=2*o+s;a+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(s," < ").concat(this.enableShapeUniforms?"outShape[2]":"".concat(t[2]),") {\n          localCoords[2] += ").concat(s,";\n          if (localCoords[1] + ").concat(o," < ").concat(this.enableShapeUniforms?"outShape[1]":"".concat(t[1]),") {\n            localCoords[1] += ").concat(o,";\n\n            flatIndex = getFlatIndex(localCoords);\n            offset = imod(flatIndex, 4);\n\n            flatIndex = idiv(flatIndex, 4, 1.);\n\n            int r = flatIndex / texShape[1];\n            int c = imod(flatIndex, texShape[1]);\n            vec2 uv = (vec2(c, r) + halfCR) / vec2(texShape[1], texShape[0]);\n            values = ").concat(r.texture2D,"(A, uv);\n\n            if (offset == 0) {\n              result[").concat(u,"] = values[0];\n            } else if (offset == 1) {\n              result[").concat(u,"] = values[1];\n            } else if (offset == 2) {\n              result[").concat(u,"] = values[2];\n            } else {\n              result[").concat(u,"] = values[3];\n            }\n          }\n        }\n        ")}this.userCode="\n        ".concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":aY(t),"\n\n        void main() {\n          ivec3 coords = getOutputCoords();\n\n          vec4 result = vec4(0.);\n          int flatIndex, r, c, offset;\n          ivec3 localCoords;\n          vec2 uv;\n          vec4 values;\n\n          ").concat(a,"\n\n          ").concat(r.output," = ").concat(i,";\n        }\n    ")}));function UY(e){var t=eY();return function(e,t){var n=UQ(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(CQ(e,(function(){return e.shaderSource(n,t)})),CQ(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function WY(e){return function(e,t){var n=UQ(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return CQ(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),CQ(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function jY(e){return function(e,t){var n=UQ(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return CQ(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),CQ(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}function ZY(e,t,n,r,a,i){!function(e,t){var n=ww().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}(t,n);var o=function(e){return UQ(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return CQ(e,(function(){return e.bindTexture(s,o)})),CQ(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),CQ(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),CQ(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),CQ(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),1===ww().getNumber("WEBGL_VERSION")?CQ(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})):CQ(e,(function(){return e.texStorage2D(s,1,r,t,n)})),CQ(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),{texture:o,texShape:[n,t]}}function GY(e){return e.internalFormatFloat}function HY(e){return e.internalFormatHalfFloat}function qY(e){return e.downloadTextureFormat}function KY(e){return e.internalFormatPackedFloat}function XY(e){return e.internalFormatPackedHalfFloat}function QY(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=IQ(e,t),r=(0,l.Z)(n,2);return r[0]*r[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}var YY=function(){function e(t){f(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=ww().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){bQ[e]=t}(n,t)):this.gl=VQ(n);var r="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(this.parallelCompilationExtension=this.gl.getExtension("KHR_parallel_shader_compile"),1===ww().getNumber("WEBGL_VERSION")){var i="OES_texture_half_float";if(this.textureFloatExtension=TQ(this.gl,"OES_texture_float"),KQ(this.gl,i))this.textureHalfFloatExtension=TQ(this.gl,i);else if(ww().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),KQ(this.gl,a))this.colorBufferHalfFloatExtension=TQ(this.gl,a);else if(ww().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",KQ(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!KQ(this.gl,a))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(a)}this.vertexBuffer=WY(this.gl),this.indexBuffer=jY(this.gl),this.framebuffer=function(e){return UQ(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=SQ(this.gl,this.textureHalfFloatExtension)}return p(e,[{key:"debug",get:function(){return ww().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;CQ(t,(function(){return t.finish()})),CQ(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),CQ(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),CQ(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),CQ(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),CQ(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=xQ(t,n),i=(0,l.Z)(a,2);return ZY(e,i[0],i[1],GY(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=xQ(t,n),i=(0,l.Z)(a,2);return ZY(e,i[0],i[1],HY(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=xQ(t,n),i=(0,l.Z)(a,2);return ZY(e,i[0],i[1],qY(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){CQ(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?2===ww().getNumber("WEBGL_VERSION")?CQ(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n.width,n.height,e.RGBA,e.UNSIGNED_BYTE,n.data)})):CQ(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):2===ww().getNumber("WEBGL_VERSION")?CQ(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,n)})):CQ(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),CQ(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;CQ(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),2===ww().getNumber("WEBGL_VERSION")?CQ(e,(function(){return e.texSubImage2D(e.TEXTURE_2D,0,0,0,n,r,e.RGBA,s,o)})):CQ(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),CQ(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=IQ(t,n),i=(0,l.Z)(a,2);return ZY(e,i[0],i[1],XY(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=IQ(t,n),i=(0,l.Z)(a,2);return ZY(e,i[0],i[1],KY(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(zQ(this.gl,this.framebuffer),this.outputTexture=null),CQ(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=xQ(t,n),i=(0,l.Z)(a,2),o=i[0],s=i[1],u=new Uint8Array(t*n*4);return CQ(e,(function(){return e.readPixels(0,0,o,s,r.downloadTextureFormat,e.UNSIGNED_BYTE,u)})),new Float32Array(u.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return QY(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();CQ(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return CQ(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),CQ(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),CQ(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(ww().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return CQ(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){var t=this;this.throwIfDisposed();var n=this.gl;null==this.vertexShader&&(this.vertexShader=UY(n));var r=function(e){return UQ(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(n);return CQ(n,(function(){return n.attachShader(r,t.vertexShader)})),CQ(n,(function(){return n.attachShader(r,e)})),function(e,t){if(CQ(e,(function(){return e.linkProgram(t)})),!ww().get("ENGINE_COMPILE_ONLY")&&!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(n,r),this.debug&&DQ(n,r),this.vertexAttrsAreBound||(this.setProgram(r),this.vertexAttrsAreBound=function(e,t,n){return CQ(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),FQ(e,t,"clipSpacePos",n,3,20,0)&&FQ(e,t,"uv",n,2,20,12)}(n,this.program,this.vertexBuffer)),r}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&CQ(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&DQ(this.gl,this.program),CQ(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?OQ(this.gl,e,t):LQ(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),CQ(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),MQ(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=IQ(t,n),a=(0,l.Z)(r,2),i=a[0],o=a[1];this.setOutputMatrixTextureDriver(e,i,o)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&DQ(this.gl,this.program),BQ(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),CQ(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),CQ(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=TQ(this.gl,2===ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=c(s().mark((function e(t){var n=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Xx((function(){return n.disposed||n.isQueryAvailable(t,ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||Xx((function(){return n.pollItems(),0===n.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),PQ(this.gl,e,this.framebuffer),this.debug&&BQ(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(PQ(this.gl,this.outputTexture,this.framebuffer),this.debug&&BQ(this.gl)):zQ(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;PQ(r,e,this.framebuffer),this.debug&&BQ(r),this.outputTexture=e,CQ(r,(function(){return r.viewport(0,0,t,n)})),CQ(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),CQ(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var JY=zZ,$Y=RG,eJ=_G,tJ=FZ,nJ=OG,rJ=UG,aJ=IH,iJ=NH,oJ=FH,sJ=YH,uJ=iq,cJ=sq,lJ=cq,hJ=fq,fJ=xq,dJ=Sq,pJ=Tq,vJ=Aq,mJ=Gq,gJ=Kq,yJ=aK,bJ=mH,kJ=pK,VJ=xK,xJ=OK,wJ=UK,IJ=jK,SJ=tX,CJ=aX,EJ=SZ,TJ=KZ,NJ=EG,AJ=xX,RJ=IX,_J=CX,DJ=RX,FJ=BX,OJ=jX,LJ=HX,MJ=KX,PJ=BH,zJ=$X,BJ=rQ,UJ=tG,WJ=lQ;function jJ(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function ZJ(e,t){return 1===t?[e]:jJ(e,t)}var GJ=function(){function e(t){if(f(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.enableShapeUniforms=FY(this.outputShape.length),0===this.rank)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var n=ZJ("rc",this.rank),r=SY(this.rank),a=this.getOutOfBoundsCondition(n),i=this.getSetup(n),o=this.getOutput(n);this.userCode="\n        void main() {\n          ".concat(r," rc = getOutputCoords();\n\n          if(").concat(a,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(i,"\n\n            setOutput(vec4(").concat(o,"));\n          }\n        }\n      ")}}return p(e,[{key:"getSourceCoordsArr",value:function(e){for(var t=[],n=0;n<=1;n++)for(var r=0;r<=1;r++){for(var a="".concat(0===n?"r":"rp1",", ").concat(0===r?"c":"cp1"),i=2;i<this.rank;i++)a="".concat(e[e.length-1-i],",")+a;t.push(a)}return t}},{key:"getOutOfBoundsCondition",value:function(e){if(1===this.rank)return"rc > ".concat(this.enableShapeUniforms?"outShape":this.outputShape[0]);for(var t="",n=this.rank-2;n<this.rank;n++)t+="".concat(e[n]," >= ").concat(this.enableShapeUniforms?"outShape[".concat(n,"]"):this.outputShape[n]),n<this.rank-1&&(t+="||");return t}},{key:"getSetup",value:function(e){if(1===this.rank)return"";var t=e.slice(-2),n=this.enableShapeUniforms?"outShape[".concat(this.rank," - 1]"):this.outputShape[this.rank-1],r=this.enableShapeUniforms?"outShape[".concat(this.rank," - 2]"):this.outputShape[this.rank-2];return"\n      int r = ".concat(t[0],";\n      int c = ").concat(t[1],";\n      int rp1 = r + 1;\n      int cp1 = c + 1;\n\n      bool cEdge = cp1 >= ").concat(n,";\n      bool rEdge = rp1 >= ").concat(r,";\n    ")}},{key:"getOutput",value:function(e){var t=this.getSourceCoordsArr(e);if(1===this.rank){var n=this.enableShapeUniforms?"outShape":this.outputShape[0];return"getA(rc), (rc + 1 >= ".concat(n," ? 0. : getA(rc + 1)), 0, 0")}return"getA(".concat(t[0],"),\n            cEdge ? 0. : getA(").concat(t[1],"),\n            rEdge ? 0. : getA(").concat(t[2],"),\n            rEdge || cEdge ? 0. : getA(").concat(t[3],")")}}]),e}(),HJ=p((function e(t,n){f(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec3"}],this.outputShape=t,this.enableShapeUniforms=FY(this.outputShape.length);for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e,t){var n=t?function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=e.map((function(e,t){return t})),a=rY(r,t);return a.map((function(t,r){var i="int ".concat(e[r]," = ").concat(n," / ").concat(a[r]),o=r===a.length-1?"int ".concat(e[r+1]," = ").concat(n," - ").concat(e[r]," * ").concat(a[r]):"index -= ".concat(e[r]," * ").concat(a[r]);return"".concat(i,"; ").concat(o,";")})).join("")}(["r","c","d"],"inputShape"):tY(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(n,this.enableShapeUniforms),"\n      ").concat(this.enableShapeUniforms?"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * outShapeStrides[0] + coords.y * outShapeStrides[1] + coords.z;\n  }\n":aY(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(this.enableShapeUniforms?"outShape[1]":t[1],";\n        int cols = ").concat(this.enableShapeUniforms?"outShape[2]":t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var qJ=function(){function e(t){f(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return p(e,[{key:"acquireTexture",value:function(e,t,n){var r=XJ(t,n),a=QJ(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=KJ(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===yQ.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===yQ.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===yQ.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===yQ.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===yQ.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=XJ(n,r),i=QJ(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=KJ(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=ww().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e.texture),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t.texture)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function KJ(e,t,n,r,a){var i,o=function(e,t){switch(e){case yQ.PACKED_2X2_FLOAT32:return KY(t);case yQ.PACKED_2X2_FLOAT16:return XY(t);case yQ.UNPACKED_FLOAT32:return GY(t);case yQ.UNPACKED_FLOAT16:return HY(t);case yQ.PACKED_4X1_UNSIGNED_BYTE:return qY(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=IQ(e[0],e[1]),u=(0,l.Z)(s,2);i=u[0]*u[1]}else{var c=xQ(e[0],e[1]),h=(0,l.Z)(c,2);i=h[0]*h[1]}var f=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;if(t===n.RGBA8)return 4;throw new Error("Unknown internal format ".concat(t))}(n,o);return i*f}function XJ(e,t){if(e===gQ.UPLOAD)return yQ.PACKED_2X2_FLOAT32;if(e===gQ.RENDER||null==e)return function(e){return ww().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?yQ.PACKED_2X2_FLOAT32:yQ.UNPACKED_FLOAT32:e?yQ.PACKED_2X2_FLOAT16:yQ.UNPACKED_FLOAT16}(t);if(e===gQ.DOWNLOAD||e===gQ.PIXELS)return yQ.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function QJ(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var YJ=p((function e(t,n){f(this,e),this.variableNames=["A"],this.outputShape=t,this.enableShapeUniforms=FY(this.outputShape.length),this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),JJ="if (isnan(x)) return x;",$J="return x;",e$="return abs(x);";var t$="return (x >= 0.0) ? x : (exp(x) - 1.0);",n$=JJ+"\n  return (x < 0.0) ? 0.0 : x;\n",r$=JJ+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",a$="return x;",i$="return 1.0 / (1.0 + exp(-1.0 * x));",o$="return x;",s$="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",u$="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",c$="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",l$="return 1.0 / (1.0 + exp(-1.0 * x));",h$=p((function e(t,n){f(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.enableShapeUniforms=FY(this.outputShape.length),this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),f$=p((function e(t){f(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t,this.enableShapeUniforms=FY(this.outputShape.length);var n=t.length,r=ZJ("rc",n),a=SY(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),d$=_F,p$={};var v$=ww().getNumber("CPU_HANDOFF_SIZE_THRESHOLD");var m$=function(e){b(n,e);var t=w(n);function n(e){var r,a,i;if(f(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.lastGlFlushTime=0,r.warnedAboutMemory=!1,r.pendingDeletes=0,r.disposed=!1,!ww().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null!=e){if(e instanceof YY)a=e;else{var o=VQ(ww().getNumber("WEBGL_VERSION"),e);a=new YY(o)}r.binaryCache={},r.gpgpuCreatedLocally=!1}else{var s=VQ(ww().getNumber("WEBGL_VERSION"));a=new YY(s),r.binaryCache=((i=ww().getNumber("WEBGL_VERSION"))in p$||(p$[i]={}),p$[i]),r.gpgpuCreatedLocally=!0}return r.gpgpu=a,r.canvas=r.gpgpu.gl.canvas,r.textureManager=new qJ(r.gpgpu),r.numMBBeforeWarning=null==ww().global.screen?1024:ww().global.screen.height*ww().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new _x(g(r),JN()),r}return p(n,[{key:"nextDataId",value:function(){return n.nextDataId++}},{key:"numDataIds",value:function(){return this.texData.numDataIds()-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((ww().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||ww().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={id:this.nextDataId()};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:gQ.UPLOAD,refCount:1}),r}},{key:"refCount",value:function(e){return this.texData.has(e)?this.texData.get(e).refCount:0}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"move",value:function(e,t,n,r,a){if(ww().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:gQ.UPLOAD,refCount:a})}},{key:"disposeIntermediateTensorInfo",value:function(e){this.disposeData(e.dataId)}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new h$(o,a$):new YJ(o,a$);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var h,f,d=null!=this.activeTimers;(d&&(h=sE()),"complex64"===r)?f=pF(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):f=this.getValuesFromTexture(e);return d&&(this.downloadWaitMs+=sE()-h),this.convertAndCacheOnCPU(e,f)}},{key:"read",value:function(){var e=c(s().mark((function e(t){var n,r,a,i,o,u,c,l,h,f,d,p,v,m,g,y,b,k,V,x,w,I,S;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,u=r.dtype,c=r.complexTensorInfos,l=r.isPacked,null==o){e.next=11;break}return h=l?new h$(i,a$):new YJ(i,a$),f=this.runWebGLProgram(h,[{dataId:t,shape:i,dtype:u}],u),d=this.read(f.dataId),this.disposeIntermediateTensorInfo(f),e.abrupt("return",d);case 11:if(null==a){e.next=13;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 13:if(!ww().getBool("DEBUG")){e.next=16;break}if(ww().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==ww().getNumber("WEBGL_VERSION")){e.next=16;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 16:if(p=null,"complex64"!==u&&ww().get("WEBGL_BUFFER_SUPPORTED")&&(v=this.decode(t),g=this.texData.get(v.dataId),p=(m=this.gpgpu).createBufferFromTexture.apply(m,[g.texture.texture].concat((0,H.Z)(wQ(i))))),this.pendingRead.set(t,[]),"complex64"===u){e.next=22;break}return e.next=22,this.gpgpu.createAndWaitForFence();case 22:if("complex64"!==u){e.next=31;break}return e.next=25,Promise.all([this.read(c.real.dataId),this.read(c.imag.dataId)]);case 25:b=e.sent,k=b[0],V=b[1],y=pF(k,V),e.next=32;break;case 31:null==p?y=this.getValuesFromTexture(t):(x=Zx(i),y=this.gpgpu.downloadFloat32MatrixFromBuffer(p,x));case 32:return null!=v&&this.disposeIntermediateTensorInfo(v),null!=p&&CQ(w=this.gpgpu.gl,(function(){return w.deleteBuffer(p)})),I=this.convertAndCacheOnCPU(t,y),S=this.pendingRead.get(t),this.pendingRead.delete(t),S.forEach((function(e){return e(I)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t)&&JN().removeDataId(t,this),this.pendingDeletes--),e.abrupt("return",I);case 40:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readToGPU",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.texData.get(e),r=n.values,a=n.shape,i=n.slice,o=n.dtype,s=n.isPacked,u=n.texture;if("complex64"===o)throw new Error("Does not support reading texture for complex64 dtype.");if(null!=i){var c;c=s?new h$(a,a$):new YJ(a,a$);var l=this.runWebGLProgram(c,[{dataId:e,shape:a,dtype:o}],o),h=this.readToGPU(l,t);return this.disposeIntermediateTensorInfo(l),h}if(null==u)throw null!=r?new Error("Data is not on GPU but on CPU."):new Error("There is no data on GPU or CPU.");var f=this.decode(e,t.customTexShape),d=JN().makeTensorFromTensorInfo(f),p=this.texData.get(f.dataId);return Object.assign({tensorRef:d},p.texture)}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId);if("string"===e.dtype)try{var n=t.map((function(e){return cE(e)}));return uN(e.shape,e.dtype,n)}catch(Bv){throw new Error("Failed to decode encoded string bytes into utf-8")}return uN(e.shape,e.dtype,t)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!EQ(n)){if(ww().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=Zx(n);if(ww().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture.texture].concat((0,H.Z)(wQ(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=ww().getBool("WEBGL_PACK")&&!0===a,h=l?GQ(n):n,f=l?new PY(h):new MY(h),d=this.runWebGLProgram(f,[{shape:h,dtype:r,dataId:e}],"float32"),p=this.texData.get(d.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture.texture,p.texShape[0],p.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(d),v}},{key:"timerAvailable",value:function(){return ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0}},{key:"time",value:function(e){var t=this,n=this.activeTimers,r=[],a=!1;null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,e();var i=jx(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=jx(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e}));this.activeTimers=n,a&&(this.programTimersStack=null);var u={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};return c(s().mark((function e(){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=8;break}return e.next=3,Promise.all(i);case 3:n=e.sent,u.kernelMs=zx(n),u.getExtraProfileInfo=function(){return n.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=9;break;case 8:u.kernelMs={error:"WebGL query timers are not supported in this environment."};case 9:return t.uploadWaitMs=0,t.downloadWaitMs=0,e.abrupt("return",u);case 12:case"end":return e.stop()}}),e)})))()}},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:sE(),endMs:null}}},{key:"endTimer",value:function(e){return ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=sE(),e)}},{key:"getQueryTime",value:function(){var e=c(s().mark((function e(t){var n;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(ww().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.pendingDisposal.has(e))return!1;if(!this.texData.has(e))return!0;if(t?this.texData.get(e).refCount=0:this.texData.get(e).refCount--,!t&&this.texData.get(e).refCount>0)return!1;if(this.pendingRead.has(e))return this.pendingDisposal.add(e),this.pendingDeletes++,!1;this.releaseGPUData(e);var n=this.texData.get(e),r=n.complexTensorInfos;return null!=r&&(this.disposeData(r.real.dataId,t),this.disposeData(r.imag.dataId,t)),this.texData.delete(e),!0}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture.texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:v$;return ww().getBool("WEBGL_CPU_FORWARD")&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&Zx(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){DC("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return d$(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new h$(e.shape,t),a=this.compileAndRun(r,[e],n);return JN().makeTensorFromTensorInfo(a)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=TJ(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(ww().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,e$,e.dtype);var n=new YJ(e.shape,e$),r=this.compileAndRun(n,[e]);return JN().makeTensorFromTensorInfo(r)}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&aw(n[0])){var a=n.map((function(e){return uE(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){return JN().makeTensorFromTensorInfo(this.makeTensorInfo(e,t,n),this)}},{key:"unpackTensor",value:function(e){var t=new f$(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new GJ(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[jQ(e.shape)].concat((0,H.Z)(ZQ(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[jQ(t)].concat((0,H.Z)(ZQ(t))),i=new HJ(a,n),o=[n],s=this.runWebGLProgram(i,[r],e.dtype,o,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}},{key:"decode",value:function(e,t){var n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype;null!=t&&Bx(Zx(a)<=t[0]*t[1]*4,(function(){return"customTexShape is too small. Row * Column * 4 should be equal or larger than the size of the tensor data."}));var o,s=GQ(a);o=r?new LY(s):new OY(s);var u=[null!=t?t:wQ(s)];return{dtype:i,shape:a,dataId:this.runWebGLProgram(o,[{shape:s,dtype:i,dataId:e}],i,u,!0,t).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5?arguments[5]:void 0,s=this.makeTensorInfo(e.outputShape,n),u=this.texData.get(s.dataId);if(e.packedOutput&&(u.isPacked=!0),e.outPackingScheme===mQ.DENSE){var c=null!=o?o:wQ(e.outputShape);u.texShape=c.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(u.usage=e.outTexUsage),0===Zx(s.shape))return u.values=$x(s.dtype,0),s;var l=[],h=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&Zx(t.shape)<=ww().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}if(a.uploadToGPU(t.dataId),!!n.isPacked!==!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),l.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!qQ(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),l.push(t),n=a.texData.get(t.dataId),r.shape=i}return{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(s.dataId);var f,d={shape:s.shape,texData:u,isUniform:!1},p=DY(e,h,d),v=this.getAndSaveBinary(p,(function(){return NY(a.gpgpu,e,h,d)})),m=null!=this.activeTimers;m&&(f=this.startTimer()),ww().get("ENGINE_COMPILE_ONLY")||_Y(this.gpgpu,v,h,d,r),l.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),m&&(f=this.endTimer(f),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(f)}));var g=ww().get("WEBGL_FLUSH_THRESHOLD");if(g>0){var y=sE();y-this.lastGlFlushTime>g&&(this.gpgpu.gl.flush(),this.lastGlFlushTime=y)}if(!ww().getBool("WEBGL_LAZILY_UNPACK")&&u.isPacked&&!1===i){var b=this.unpackTensor(s);return this.disposeIntermediateTensorInfo(s),b}return s}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;var i=this.runWebGLProgram(e,t,n,r,a);return i}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;if(!this.disposed){if(!ww().getBool("IS_TEST"))Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}));this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=eA((function(){if(!ww().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=ww().getBool("DEBUG");ww().set("DEBUG",!1);var n=e.abs(iA(1e-8)).dataSync()[0];if(ww().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,c=null!=this.activeTimers;c&&(u=sE());var h=t.texShape;if(null==h&&(h=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=ww().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,1===(e=e.map((function(t,n){return n>=e.length-2?Mx(e[n]):e[n]}))).length&&(e=[2,e[0]])),2!==e.length){var r=Jx(e);e=r.newShape}var a=Zx(e);if(e.length<=1&&a<=n)return[1,a];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var i=jQ(e),o=2,s=2;if(e.length){var u=ZQ(e),c=(0,l.Z)(u,2);o=c[0],s=c[1]}return qx(a=i*(o/2)*(s/2)).map((function(e){return 2*e}))}return qx(a)}(n,s),t.texShape=h),null!=a){var f,d=GQ(n),p=h[1],v=h[0],m=a instanceof Uint8Array||a instanceof Uint8ClampedArray;if(s||!m){var g=IQ(h[0],h[1]),y=(0,l.Z)(g,2);p=y[0],v=y[1]}f=s?new BY(d,m):new zY(d,m);var b=m?[v,p]:h,k=this.makeTensorInfo(b,r),V=this.texData.get(k.dataId);V.usage=m?gQ.PIXELS:gQ.UPLOAD,V.texShape=b,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(k.dataId),p,v,a);var x=[[v,p]],w=this.runWebGLProgram(f,[k],r,x,!0),I=this.texData.get(w.dataId);t.texShape=I.texShape,t.isPacked=I.isPacked,t.usage=I.usage,ww().get("ENGINE_COMPILE_ONLY")?this.disposeData(w.dataId):(t.texture=I.texture,t.values=null,this.texData.delete(w.dataId)),this.disposeIntermediateTensorInfo(k),c&&(this.uploadWaitMs+=sE()-u)}else{var S=this.acquireTexture(h,o,r,s);t.texture=S}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*rw(t)}},{key:"checkCompileCompletion",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=(0,l.Z)(t[e],2)[1];this.checkCompletion_(n)}}},{key:"checkCompileCompletionAsync",value:function(){var e=c(s().mark((function e(){var t,n,r,a,i,o,u,c,h=this;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=[],!this.gpgpu.parallelCompilationExtension){e.next=6;break}for(n=0,r=Object.entries(this.binaryCache);n<r.length;n++)a=(0,l.Z)(r[n],2),i=a[1],t.push(this.checkCompletionAsync_(i));return e.abrupt("return",Promise.all(t));case 6:for(o=function(){var e=(0,l.Z)(c[u],2)[1],n=new Promise((function(t){try{h.checkCompletion_(e),t(!0)}catch(n){throw n}}));t.push(n)},u=0,c=Object.entries(this.binaryCache);u<c.length;u++)o();return e.abrupt("return",Promise.all(t));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkCompletionAsync_",value:function(){var e=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.gpgpu.gl.getProgramParameter(t.webGLProgram,this.gpgpu.parallelCompilationExtension.COMPLETION_STATUS_KHR)){e.next=4;break}return e.abrupt("return",this.checkCompletion_(t));case 4:return e.next=6,KD();case 6:return e.abrupt("return",this.checkCompletionAsync_(t));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"checkCompletion_",value:function(e){if(!1===this.gpgpu.gl.getProgramParameter(e.webGLProgram,this.gpgpu.gl.LINK_STATUS)){if(console.log(this.gpgpu.gl.getProgramInfoLog(e.webGLProgram)),!1===this.gpgpu.gl.getShaderParameter(e.fragmentShader,this.gpgpu.gl.COMPILE_STATUS))throw _Q(e.source,this.gpgpu.gl.getShaderInfoLog(e.fragmentShader)),new Error("Failed to compile fragment shader.");throw new Error("Failed to link vertex and fragment shaders.")}return!0}},{key:"getUniformLocations",value:function(){for(var e=0,t=Object.entries(this.binaryCache);e<t.length;e++){var n=(0,l.Z)(t[e],2)[1],r=AY(this.gpgpu,n.program,n.webGLProgram),a=r.uniformLocations,i=r.customUniformLocations,o=r.infLoc,s=r.nanLoc,u=r.inShapesLocations,c=r.inTexShapesLocations,h=r.outShapeLocation,f=r.outShapeStridesLocation,d=r.outTexShapeLocation;n.uniformLocations=a,n.customUniformLocations=i,n.infLoc=o,n.nanLoc=s,n.inShapesLocations=u,n.inTexShapesLocations=c,n.outShapeLocation=h,n.outShapeStridesLocation=f,n.outTexShapeLocation=d}}}]),n}(Dx);m$.nextDataId=0;HE()&&rA("webgl",(function(){return new m$}),2);var g$=p((function e(t,n,r){f(this,e),this.variableNames=["A","B"],this.outputShape=PN(n,r),this.enableShapeUniforms=FY(this.outputShape.length),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),y$=p((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];f(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=PN(n,r);var i=this.outputShape.length;this.enableShapeUniforms=FY(i);var o="";if(a)if(0===i||1===Zx(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{var s=SY(i);if(o="\n          ".concat(s," coords = getOutputCoords();\n        "),1===i)this.enableShapeUniforms?o+="\n            result.y = (coords + 1) >= outShape ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ":o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=ZJ("coords",i);this.enableShapeUniforms?o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= outShape[").concat(i," - 2];\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= outShape[").concat(i," - 1];\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          "):o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function b$(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var k$={kernelName:UI,backendName:"webgl",kernelFunc:b$};function V$(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=b$({inputs:{x:r},backend:n}),u=b$({inputs:{x:a},backend:n});return o.complexTensorInfos={real:s,imag:u},i}var x$={kernelName:$w,backendName:"webgl",kernelFunc:V$},w$="return (a < 0.) ? b * a : a;",I$="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var S$={kernelName:qI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",iE(i,"float32")),s=ww().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new y$(I$,a.shape,o.shape):new g$(w$,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],"float32");return n.disposeIntermediateTensorInfo(o),u}},C$="return (a < 0.) ? b * a : a;",E$="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var T$={kernelName:TS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=ww().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new y$(E$,r.shape,a.shape):new g$(C$,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],"float32")}};function N$(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var h=c.texData.get(u.dataId),f=r(h.values,l);return c.makeTensorInfo(u.shape,l,f)}return i=ww().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new h$(u.shape,n):new YJ(u.shape,t),c.runWebGLProgram(i,[u],l)}}function A$(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,h=r.b,f=i;if(o&&"complex64"===c.dtype){var d=f.texData.get(c.dataId),p=f.texData.get(h.dataId),v=[[d.complexTensorInfos.real,p.complexTensorInfos.real],[d.complexTensorInfos.imag,p.complexTensorInfos.imag]].map((function(e){var n=(0,l.Z)(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:h.shape},s=new g$(t,c.shape,h.shape);return f.runWebGLProgram(s,[i,o],RE(r.dtype,a.dtype))})),m=(0,l.Z)(v,2),g=m[0],y=m[1],b=V$({inputs:{real:g,imag:y},backend:f});return f.disposeIntermediateTensorInfo(g),f.disposeIntermediateTensorInfo(y),b}var k,V=u||RE(c.dtype,h.dtype);if(("string"===c.dtype||"string"===h.dtype||f.shouldExecuteOnCPU([c,h]))&&null!=s){var x=f.texData.get(c.dataId).values,w=f.texData.get(h.dataId).values,I="string"===c.dtype?RF(x):x,S="string"===c.dtype?RF(w):w,C=s(c.shape,h.shape,I,S,V),E=(0,l.Z)(C,2),T=E[0],N=E[1],A=f.makeTensorInfo(N,V);return f.texData.get(A.dataId).values=T,A}return k=ww().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new y$(n,c.shape,h.shape,a):new g$(t,c.shape,h.shape),f.runWebGLProgram(k,[c,h],V)}}function R$(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?o$:$J;if("relu"===e)return t?u$:n$;if("elu"===e)return t?s$:t$;if("relu6"===e)return t?c$:r$;if("prelu"===e)return t?E$:C$;if("leakyrelu"===e)return t?I$:w$;if("sigmoid"===e)return t?l$:i$;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var _$=p((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];f(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r,this.enableShapeUniforms=FY(this.outputShape.length);var l=a?t[1]:t[2],h=Math.ceil(l/2),d=a?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",v=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],m=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],g="",y="";s&&(g=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),y="result = activation(result);");var b=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var k="rc.x",V="rc.x";t[0]<n[0]?k="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(V="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(g,"\n      // Don't use uniform for sharedDimensionPacked for performance.\n      const float sharedDimension = ").concat(h,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(h,"; i++) {\n          int batchA = ").concat(k,";\n          int batchB = ").concat(V,";\n          vec4 a = getMatrixA(batchA, ").concat(d,");\n          vec4 b = getMatrixB(batchB, ").concat(p,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(v[0]," * ").concat(m[0],");\n          result += (").concat(v[1]," * ").concat(m[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(b,"\n\n        ").concat(y,"\n\n        setOutput(result);\n      }\n    ")})),D$="return areal * breal - aimag * bimag;",F$="return areal * bimag + aimag * breal;",O$=p((function e(t,n,r){f(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=PN(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),L$="return a * b;";function M$(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=RE(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new O$(D$,a.shape,i.shape),h=new O$(F$,a.shape,i.shape),f=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],d=r.runWebGLProgram(c,f,"float32"),p=r.runWebGLProgram(h,f,"float32"),v=V$({inputs:{real:d,imag:p},backend:r});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(p),v}if(r.shouldExecuteOnCPU([a,i])){var m=r.texData.get(a.dataId),g=r.texData.get(i.dataId),y=bJ(a.shape,i.shape,m.values,g.values,o),b=(0,l.Z)(y,2),k=b[0],V=b[1],x=r.makeTensorInfo(V,o);return r.texData.get(x.dataId).values=k,x}return t=ww().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new y$(L$,a.shape,i.shape):new g$(L$,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var P$={kernelName:gS,backendName:"webgl",kernelFunc:M$};function z$(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=Zx(a.shape),u=Qx(i,s),c=Zx(u);Bx(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."}));var l=o.texData.get(a.dataId);return!l.isPacked||qQ(a.shape,u)||null!==l.texture&&qQ(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[jQ(e.shape)].concat((0,H.Z)(ZQ(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[jQ(t)].concat((0,H.Z)(ZQ(t))),o=new HJ(i,r),s=[r],u=n.runWebGLProgram(o,[a],e.dtype,s,!0);return{dataId:u.dataId,shape:t,dtype:u.dtype}}(a,u,o)}var B$={kernelName:OS,backendName:"webgl",kernelFunc:z$},U$=p((function e(t,n){f(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(Hx(l)?l.toPrecision(2):l,", ones);")}var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),W$=p((function e(t,n){f(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),h=r%4,d="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n        if (").concat("min"===n," || ").concat("max"===n,") {\n          minMaxValue = ").concat(u,"(values, minMaxValue);\n          bvec4 isNaN = isnan(values);\n          if (isNaN.r || isNaN.g || isNaN.b || isNaN.a) {\n            minMaxValue = vec4(NAN);\n          }\n        }\n      }\n    "),p="vec4";"all"===n?(s="1.0",d="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===n&&(s="0.0",d="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");var v="";i%r>0&&(v="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(v,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(d,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===h,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(2===h,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(d,"\n        } else if (").concat(3===h,") {\n          ").concat(p," values = ").concat(p,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(d,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function j$(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=YD(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,h=u.outSize,f=void 0;f="mean"===n?0===o?new U$({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h},c):new U$({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h}):new W$({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h},n),s=i,i=r.runWebGLProgram(f,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var Z$=p((function e(t,n){f(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=SY(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var G$=p((function e(t,n){f(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=SY(this.rank),o=jJ("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),h="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(h,";\n      if(").concat(l,") {\n        result[1] = ").concat(h,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(h,";\n        if(").concat(l,") {\n          result[3] = ").concat(h,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function H$(e,t,n){var r=ww().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new G$(e.shape,t):new Z$(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function q$(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=Yx(a,e.shape),s=o,u=TR(s,i),c=null!=u,h=e;c&&(h=H$(e,u,r),s=AR(s.length,i)),ER("sum",s,i);var f=SR(h.shape,s),d=(0,l.Z)(f,2),p=d[0],v=d[1],m=p;n&&(m=CR(p,o));var g=Zx(v),y=z$({inputs:{x:h},attrs:{shape:[Zx(e.shape)/g,g]},backend:r}),b=j$(y,_E(e.dtype),"sum",r),k=z$({inputs:{x:b},attrs:{shape:m},backend:r});return r.disposeIntermediateTensorInfo(y),r.disposeIntermediateTensorInfo(b),c&&r.disposeIntermediateTensorInfo(h),k}(t.x,r.axis,r.keepDims,n)}var K$={kernelName:tC,backendName:"webgl",kernelFunc:q$};function X$(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var h=s.texData.get(i.dataId).values,f=UJ(h,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=f}else t=H$(i,o,s);return t}var Q$={kernelName:xC,backendName:"webgl",kernelFunc:X$};function Y$(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,f=e.activation,d=void 0===f?null:f,p=t.shape.length,v=n.shape.length,m=r?t.shape[p-2]:t.shape[p-1],g=a?n.shape[v-1]:n.shape[v-2],y=r?t.shape[p-1]:t.shape[p-2],b=a?n.shape[v-2]:n.shape[v-1],k=t.shape.slice(0,-2),V=n.shape.slice(0,-2),x=Zx(k),w=Zx(V),I=PN(t.shape.slice(0,-2),n.shape.slice(0,-2)).concat([y,b]);Bx(m===g,(function(){return"Error in matMul: inner shapes (".concat(m,") and (")+"".concat(g,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match.")}));var S,C=r?[x,m,y]:[x,y,m],E=a?[w,b,g]:[w,g,b],T=z$({inputs:{x:t},backend:i,attrs:{shape:C}}),N=z$({inputs:{x:n},backend:i,attrs:{shape:E}}),A=[T,N],R=Math.max(x,w),_=r?T.shape[1]:T.shape[2],D=null!=s,F=null!=c,O="leakyrelu"===d,L=null!=d?R$(d,!0):null;if((1===y||1===b)&&_>1e3&&!1===(D||F||O||null!=L)){var M=T,P=N;r&&(M=X$({inputs:{x:T},backend:i,attrs:{perm:[0,2,1]}}),A.push(M)),a&&(P=X$({inputs:{x:N},backend:i,attrs:{perm:[0,2,1]}}),A.push(P));var z=1===b,B=M;1!==b&&(B=z$({inputs:{x:M},backend:i,attrs:{shape:[R,_,1]}}),A.push(B));var U=1===b?2:1,W=P;z&&(W=z$({inputs:{x:P},backend:i,attrs:{shape:[R,1,_]}}),A.push(W));var j=M$({inputs:{a:B,b:W},backend:i});S=q$({inputs:{x:j},backend:i,attrs:{axis:U,keepDims:!0}}),A.push(j)}else{var Z=RE(t.dtype,n.dtype),G=new _$(C,E,[R,y,b],r,a,D,L,F,O),H=[T,N];if(null!=s&&H.push(s),F&&H.push(c),O){var q=i.makeTensorInfo([],"float32",iE(h,"float32"));H.push(q),A.push(q)}S=i.runWebGLProgram(G,H,Z)}var K=z$({inputs:{x:S},backend:i,attrs:{shape:I}});A.push(S);for(var X=0,Q=A;X<Q.length;X++){var Y=Q[X];i.disposeIntermediateTensorInfo(Y)}return K}var J$={kernelName:AC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return Y$({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},$$="return abs(x);";var e0={kernelName:Tw,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=TJ(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=ww().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new h$(a.shape,$$):new YJ(a.shape,$$),r.runWebGLProgram(t,[a],a.dtype)}},t0=N$({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),n0={kernelName:Nw,backendName:"webgl",kernelFunc:t0},r0=N$({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),a0={kernelName:Aw,backendName:"webgl",kernelFunc:r0},i0="return a + b;",o0=A$({opSnippet:i0,packedOpSnippet:i0,supportsComplex:!0,cpuKernelImpl:JY}),s0={kernelName:Rw,backendName:"webgl",kernelFunc:o0},u0=p((function e(t,n){f(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),c0=p((function e(t,n){f(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var l0={kernelName:_w,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return b$({inputs:{x:a[0]},backend:r});if(a.length>ww().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return RE(e,t)})),c=a.map((function(e){return e.shape})),l=ww().getBool("WEBGL_PACK")?new c0(a[0].shape,c):new u0(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var h0={kernelName:Dw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Yx(i,a.shape),c=u,h=TR(c,s),f=a;null!=h&&(f=X$({inputs:{x:a},backend:n,attrs:{perm:h}}),c=AR(c.length,s)),ER("all",c,s);var d,p=SR(f.shape,c),v=(0,l.Z)(p,2),m=v[0],g=z$({inputs:{x:f},backend:n,attrs:{shape:[-1,Zx(v[1])]}}),y=j$(g,g.dtype,"all",n);return d=z$(o?{inputs:{x:y},backend:n,attrs:{shape:CR(m,u)}}:{inputs:{x:y},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),null!=h&&n.disposeIntermediateTensorInfo(f),d}};var f0={kernelName:Fw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Yx(i,a.shape),c=u,h=TR(c,s),f=a;null!=h&&(f=X$({inputs:{x:a},backend:n,attrs:{perm:h}}),c=AR(c.length,s)),ER("any",c,s);var d,p=SR(f.shape,c),v=(0,l.Z)(p,2),m=v[0],g=z$({inputs:{x:f},backend:n,attrs:{shape:[-1,Zx(v[1])]}}),y=j$(g,g.dtype,"any",n);return d=z$(o?{inputs:{x:y},backend:n,attrs:{shape:CR(m,u)}}:{inputs:{x:y},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),null!=h&&n.disposeIntermediateTensorInfo(f),d}},d0=p((function e(t,n,r){f(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),p0=p((function e(t,n,r,a){f(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,Bx(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,h=SY(l),d=ZJ("coords",l);if(1===o){var p=SY(u=l+1);s="\n        ".concat(p," sourceLocR = ").concat(p,"(").concat(d.join(),", 0);\n        ++").concat(d[l-1],";\n        ").concat(p," sourceLocG = ").concat(p,"(").concat(d.join(),", 0);\n        ++").concat(d[l-2],";\n        ").concat(p," sourceLocA = ").concat(p,"(").concat(d.join(),", 0);\n        --").concat(d[l-1],";\n        ").concat(p," sourceLocB = ").concat(p,"(").concat(d.join(),", 0);\n        --").concat(d[l-2],";")}else u=l,s="\n        ".concat(h," sourceLocR = coords;\n        ++").concat(d[l-1],";\n        ").concat(h," sourceLocG = coords;\n        ++").concat(d[l-2],";\n        ").concat(h," sourceLocA = coords;\n        --").concat(d[l-1],";\n        ").concat(h," sourceLocB = coords;\n        --").concat(d[l-2],";");var v=["x","y","z","w","u","v"].slice(0,u),m="."+v[u-1],g=v.map((function(e){return"int "+e})),y=ZJ("sourceLocR",u-1).concat("inIdx.r"),b=ZJ("sourceLocG",u-1).concat("inIdx.g"),k=ZJ("sourceLocB",u-1).concat("inIdx.b"),V=ZJ("sourceLocA",u-1).concat("inIdx.a"),x="max"===r?"greaterThan":"lessThan",w=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(k.join(),"),\n                             getBestIndicesAChannel(").concat(V.join(),")));"),I="vec4(\n            getAChannel(".concat(y.join(),"),\n            hasNextCol ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(k.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(V.join(),") : 0.)"),S=a?"":"\n      float getBestIndicesAChannel(".concat(g.join(),") {\n        return getChannel(getBestIndicesA(").concat(v.join(),"),\n                                          vec2(").concat(v.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(g.join(),") {\n        return getChannel(getA(").concat(v.join(),"),\n                               vec2(").concat(v.slice(-2).join(),"));\n      }\n      ").concat(S,"\n      void main() {\n        ").concat(h," coords = getOutputCoords();\n        bool hasNextCol = ").concat(d[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(d[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(m,", sourceLocG").concat(m,",\n          sourceLocB").concat(m,", sourceLocA").concat(m,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(I,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(I,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(x,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function v0(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=YD(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new d0(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var h=v0(e,t,n,l);return e.disposeIntermediateTensorInfo(l),h}function m0(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=a[a.length-1],o=YD(i),s=new p0(a,o,n,null==r),u=null==r?[t]:[t,r],c=e.runWebGLProgram(s,u,"int32");if(c.shape.length===t.shape.length){var l=m0(e,t,n,c);return e.disposeIntermediateTensorInfo(c),l}return c}function g0(e,t,n,r){var a=[n];if(ER("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!ww().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=e.texData.get(t.dataId),s=t;null!==o&&o.isPacked&&(s=e.unpackTensor(t),i.push(s));var u=SR(s.shape,a),c=(0,l.Z)(u,2),h=c[0],f=Zx(c[1]),d=z$({inputs:{x:s},backend:e,attrs:{shape:[-1,f]}});i.push(d);var p=v0(e,d,r);i.push(p);var v=z$({inputs:{x:p},backend:e,attrs:{shape:h}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),v}return m0(e,t,r)}var y0={kernelName:Ow,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=Yx(r.axis,a.shape),o=TR(i,a.shape.length),s=a,u=[];null!=o&&(s=X$({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=AR(i.length,s.shape.length)),ER("argMax",[i[0]],s.shape.length);var c=g0(n,s,i[0],"max");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}};var b0={kernelName:Lw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=Yx(r.axis,a.shape),o=TR(i,a.shape.length),s=a,u=[];null!=o&&(s=X$({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=AR(i.length,s.shape.length)),ER("argMin",[i[0]],s.shape.length);var c=g0(n,s,i[0],"min");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},k0=N$({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),V0={kernelName:Mw,backendName:"webgl",kernelFunc:k0},x0=N$({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),w0={kernelName:Pw,backendName:"webgl",kernelFunc:x0},I0=N$({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),S0={kernelName:zw,backendName:"webgl",kernelFunc:I0},C0=A$({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),E0={kernelName:Uw,backendName:"webgl",kernelFunc:C0},T0=N$({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),N0={kernelName:Bw,backendName:"webgl",kernelFunc:T0},A0=p((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(f(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=t.padInfo.top,v=t.padInfo.left;this.outputShape=t.outShape;var m="avg"===n,g="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),b="0.0";if(m||(b="-1.0 / 1e-20"),r){var k=">=";this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(p,", ").concat(v,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(k," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?g:y:"wR * ".concat(d," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var V="max",x="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(x="avgValue / count");var w=4*Math.floor(o/4),I=o%4,S="\n      if (".concat(m,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(V,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(p,", ").concat(v,");\n      const float initializationValue = ").concat(b,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(b,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(S,"\n          }\n\n          int xC = xCCorner + ").concat(w,";\n          if (").concat(1===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(2===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(3===I,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(S,"\n          }\n        }\n        setOutput(").concat(x,");\n      }\n    ")}})),R0=p((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(f(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,h=t.dilationHeight,d=t.dilationWidth,p=t.effectiveFilterDepth,v=t.effectiveFilterHeight,m=t.effectiveFilterWidth,g=t.padInfo.front,y=t.padInfo.top,b=t.padInfo.left;this.outputShape=t.outShape;var k="avg"===n,V="0.0";if(k||(V="-1.0 / 1e-20"),r){var x=">=";this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(g,", ").concat(y,", ").concat(b,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(p,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(v,";\n                wR += ").concat(h,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(m,";\n                  wC += ").concat(d,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(x," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(v," * ").concat(m," +\n                      wR * ").concat(m," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="max",I="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(I="avgValue / count");var S=4*Math.floor(o/4),C=o%4,E="\n      if (".concat(k,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(w,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(g,", ").concat(y,", ").concat(b,");\n      const float initializationValue = ").concat(V,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(V,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(p,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(v,";\n            wR += ").concat(h,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(S,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(d,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(d,", ch)\n              );\n\n              ").concat(E,"\n            }\n\n            int xC = xCCorner + ").concat(S,";\n            if (").concat(1===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(E,"\n            } else if (").concat(2===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(E,"\n            } else if (").concat(3===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(d,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(d,", ch),\n                initializationValue\n              );\n\n              ").concat(E,"\n            }\n          }\n          setOutput(").concat(I,");\n        }\n      }\n    ")}}));var _0={kernelName:Ww,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;JQ(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Bx(SA(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=dA(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Gx(c.inShape,c.outShape))return b$({inputs:{x:a},backend:n});var l=new A0(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var D0={kernelName:Zw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=pA(a.shape,i,o,[1,1,1],s,u,c),h=new R0(l,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}},F0=p((function e(t){f(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,h=c-1-t.padInfo.left,d=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(h,");\n      const float avgMultiplier = float(").concat(d,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),O0=p((function e(t){f(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterDepth,d=t.effectiveFilterHeight,p=t.effectiveFilterWidth,v=h-1-t.padInfo.front,m=d-1-t.padInfo.top,g=p-1-t.padInfo.left,y=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(v,", ").concat(m,", ").concat(g,");\n      const float avgMultiplier = float(").concat(y,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(h,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(d,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(p,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var L0={kernelName:Gw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=pA(i.shape,o,s,[1,1,1],u,c),h=new O0(l);return n.runWebGLProgram(h,[a],i.dtype)}};var M0={kernelName:jw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;JQ([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=dA(o.shape,s,u,1,c),h=new F0(l);return n.runWebGLProgram(h,[a],o.dtype)}};var P0={kernelName:Hw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return Y$({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},z0=p((function e(t,n,r,a,i,o){f(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],PN(t,n),PN(t,r);var s="0.0";null!=a&&(PN(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(PN(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),B0=p((function e(t,n,r,a,i,o){f(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],PN(t,n),PN(t,r);var s="vec4(0.0)";null!=a&&(PN(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(PN(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),U0={kernelName:LI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;Bx(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),Bx(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),Bx(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],h=null;null!=s&&(h=s.shape,l.push(s));var f=null;null!=u&&(f=u.shape,l.push(u));var d=ww().getBool("WEBGL_PACK_NORMALIZATION")?new B0(a.shape,i.shape,o.shape,h,f,c):new z0(a.shape,i.shape,o.shape,h,f,c);return n.runWebGLProgram(d,l,l[0].dtype)}},W0=p((function e(t){f(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n=SY(this.rank);this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var r,a=function(e){if(1===e)return"sourceLoc";if(e<=6)return j0.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),i=t.map((function(e,t){return"sourceLoc.".concat(j0[t]," = start[").concat(t,"] + coords.").concat(j0[t],";")}));r="\n        ".concat(n," sourceLoc;\n        ").concat(n," coords = getOutputCoords();\n        ").concat(i.join("\n"),"\n      "),this.userCode="\n      void main() {\n        ".concat(r,"\n        setOutput(getSource(").concat(a,"));\n      }\n    ")})),j0=["x","y","z","w","u","v"];var Z0=p((function e(t){f(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length,this.customUniforms=[{name:"start",arrayIndex:this.rank,type:"int"}];var n=SY(this.rank),r=ZJ("coords",this.rank),a=ZJ("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      void main() {\n        ".concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}));function G0(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=HN(a,r.begin,r.size),o=(0,l.Z)(i,2),s=o[0],u=o[1];if(WN(a,s,u),0===Zx(u))return n.makeTensorInfo(u,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var c=n.texData.get(a.dataId),h=NJ(c.values,s,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,h)}var f=n.texData.get(a.dataId).isPacked,d=ZN(a.shape,s,u);if(f||!d){var p=ww().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Z0(u):new W0(u),v=[s];return n.runWebGLProgram(p,[a],a.dtype,v)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=GN(t,cw(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,s,u,n)}var H0={kernelName:KS,backendName:"webgl",kernelFunc:G0},q0={kernelName:qw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;Bx(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=$D(a.shape,i,s),c=eF(u.length,i.length),l=tF(a.shape,i,s),h=nF(o,i.length),f=rF(l,o,i.length),d=[],p=z$({inputs:{x:a},backend:n,attrs:{shape:u}}),v=X$({inputs:{x:p},backend:n,attrs:{perm:c}}),m=z$({inputs:{x:v},backend:n,attrs:{shape:l}}),g=G0({inputs:{x:m},backend:n,attrs:{begin:h,size:f}});return d.push(p),d.push(v),d.push(m),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var K0={kernelName:Kw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=$Y(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}};var X0={kernelName:Xw,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.s0,a=t.s1,i=n.readSync(r.dataId),o=n.readSync(a.dataId),s=PN(Array.from(i),Array.from(o));return n.makeTensorInfo([s.length],"int32",Int32Array.from(s))}},Q0=A$({opSnippet:"return float(a != b);",cpuKernelImpl:VJ,dtype:"bool"}),Y0={kernelName:bS,backendName:"webgl",kernelFunc:Q0};function J0(e){var t=e.inputs,n=e.backend,r=t.input;return b$({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var $0={kernelName:_S,backendName:"webgl",kernelFunc:J0};var e1={kernelName:Qw,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return b$({inputs:{x:i},backend:r});var s=LR(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=V$({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var h=J0({inputs:{input:i},backend:r}),f=e({inputs:{x:h},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(h),f}if(!tw(i.dtype,o)){var d=b$({inputs:{x:i},backend:r});return{dataId:d.dataId,shape:d.shape,dtype:o}}if(r.shouldExecuteOnCPU([i])){var p=r.texData.get(i.dataId).values,v=tJ(p,i.shape,i.dtype,o),m=(0,l.Z)(v,3),g=m[0],y=m[1],b=m[2];return r.makeTensorInfo(g,y,b)}if("int32"===o)return function(e,t){var n=new YJ(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var k=r.makeTensorInfo([],"bool",$x("bool",1)),V=Q0({inputs:{a:i,b:k},backend:r});return r.disposeIntermediateTensorInfo(k),V}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},t1="return ceil(x);",n1=N$({opSnippet:t1,packedOpSnippet:t1,cpuKernelImpl:nJ}),r1={kernelName:Yw,backendName:"webgl",kernelFunc:n1},a1=p((function e(t){f(this,e),this.variableNames=["A"],this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "})),i1=p((function e(t){f(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"minVal",type:"float"},{name:"maxVal",type:"float"}],this.outputShape=t,this.userCode="\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}));var o1={kernelName:Jw,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax;t=ww().getBool("WEBGL_PACK_CLIP")?new i1(i.shape):new a1(i.shape);var u=[[o],[s]];return r.runWebGLProgram(t,[i],i.dtype,u)}},s1=p((function e(t){f(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function u1(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var c1={kernelName:eI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new s1(r.shape),o=[u1(r,a.complexTensorInfos.real),u1(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},l1=p((function e(t){f(this,e),this.outputShape=[],this.outputShape=QD(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),h1=p((function e(t,n){f(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=QD(t,n);var r=this.outputShape,a=r.length,i=SY(a),o=ZJ("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],h=s.slice(-2),d=s.join(),p="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(d,"), vec2(").concat(h.join(),"));\n        }"),v=1;v<u.length;v++){var m=u[v-1];p+="\n        if (".concat(l," < ").concat(u[v],"  && ").concat(l," >= ").concat(u[v-1],") {\n          return getChannel(\n            getT").concat(v,"(").concat(f1(s,l,m),"),\n            vec2(").concat(f1(h,l,m),"));\n        }")}var g=u.length,y=u[u.length-1];p+="\n        return getChannel(\n          getT".concat(g,"(").concat(f1(s,l,y),"),\n          vec2(").concat(f1(h,l,y),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(p,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function f1(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function d1(e){var t=e.inputs,n=e.backend,r=t.input;return b$({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var p1={kernelName:jI,backendName:"webgl",kernelFunc:d1};function v1(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return J0({inputs:{input:e},backend:n})})),i=e.map((function(e){return d1({inputs:{input:e},backend:n})})),o=v1(a,t,n),s=v1(i,t,n),u=V$({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}var c=n.shouldExecuteOnCPU(e);if("string"===r&&(c=!0),c){var l=e.map((function(e){var r=Zx(e.shape.slice(t));return z$({inputs:{x:e},backend:n,attrs:{shape:[-1,r]}})})),h=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),f=QD(l.map((function(e){return e.shape})),1),d=1===l[0].shape[0],p=rJ(h,f,r,d),v=QD(e.map((function(e){return e.shape})),t),m=n.makeTensorInfo(v,r,p);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}var g=ww().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER");if(e.length>g){for(var y=[],b=0;b<e.length;b+=g){var k=e.slice(b,b+g);y.push(v1(k,t,n))}for(var V=v1(y,t,n),x=0,w=y;x<w.length;x++){var I=w[x];n.disposeIntermediateTensorInfo(I)}return V}if(ww().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){var S=new h1(e.map((function(e){return e.shape})),t);return n.runWebGLProgram(S,e,r)}var C=function(e,t,n){var r=QD(e.map((function(e){return e.shape})),t),a=e.map((function(e){return z$({inputs:{x:e},attrs:{shape:[-1,Zx(e.shape.slice(t))]},backend:n})}));return{tensors2D:a,outShape:r}}(e,t,n),E=C.tensors2D,T=C.outShape,N=new l1(E.map((function(e){return e.shape}))),A=n.runWebGLProgram(N,E,r);E.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var R=z$({inputs:{x:A},attrs:{shape:T},backend:n});return n.disposeIntermediateTensorInfo(A),R}function m1(e){var t=e.inputs,n=e.backend,r=Yx(e.attrs.axis,t[0].shape)[0],a=QD(t.map((function(e){return e.shape})),r);if(0===Zx(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return Zx(e.shape)>0}));if(1===i.length)return b$({inputs:{x:i[0]},backend:n});var o=i.map((function(e){return e.shape}));return XD(o,r),v1(i,r,n)}var g1={kernelName:tI,backendName:"webgl",kernelFunc:m1},y1=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];f(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,d=t.filterHeight,p=t.filterWidth,v=4*Math.floor(t.inChannels/4),m=t.inChannels%4,g="channelsLast"===t.dataFormat,y=g?1:2,b=g?2:3,k=g?3:1,V="",x="";r&&(V=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),x="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(V,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(k,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(y,"], coords[").concat(b,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(d,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(p,"; wC++) {\n            int xC = xCCorner + wC * ").concat(h,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(v,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(g,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===m,") {\n\n              if (").concat(g,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(v,") *\n                    getW(wR, wC, ").concat(v,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(v,", xR, xC) *\n                    getW(wR, wC, ").concat(v,", d2);\n              }\n\n            } else if (").concat(2===m,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(v,", d2),\n                getW(wR, wC, ").concat(v," + 1, d2)\n              );\n\n              if (").concat(g,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(v,"),\n                  getX(batch, xR, xC, ").concat(v," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(v,", xR, xC),\n                  getX(batch, ").concat(v," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===m,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(v,", d2),\n                getW(wR, wC, ").concat(v," + 1, d2),\n                getW(wR, wC, ").concat(v," + 2, d2)\n              );\n\n              if (").concat(g,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(v,"),\n                  getX(batch, xR, xC, ").concat(v," + 1),\n                  getX(batch, xR, xC, ").concat(v," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(v,", xR, xC),\n                  getX(batch, ").concat(v," + 1, xR, xC),\n                  getX(batch, ").concat(v," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(x,"\n        setOutput(result);\n      }\n    ")})),b1=p((function e(t){f(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterDepth,d=t.filterHeight,p=t.filterWidth,v=4*Math.floor(t.inChannels/4),m=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(h,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(d,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(p,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(v,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===m,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(v,") *\n                  getW(wF, wR, wC, ").concat(v,", d2);\n              } else if (").concat(2===m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(v,"),\n                  getX(batch, xF, xR, xC, ").concat(v," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(v,", d2),\n                  getW(wF, wR, wC, ").concat(v," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(v,"),\n                  getX(batch, xF, xR, xC, ").concat(v," + 1),\n                  getX(batch, xF, xR, xC, ").concat(v," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(v,", d2),\n                  getW(wF, wR, wC, ").concat(v," + 1, d2),\n                  getW(wF, wR, wC, ").concat(v," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),k1=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];f(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=FY(this.outputShape.length);for(var o=t.padInfo.left,s=t.strideWidth,u=t.dilationWidth,c=t.filterHeight,l=t.filterWidth,h=l,d="\n       int xR; int xC; int xCOffset;\n       vec4 wTexel; vec4 previous; vec4 final;",p=0;p<l;p++)d+="\n           vec4 xTexelC".concat(2*p,";\n           int xTexelC").concat(2*p,"Ready;\n           vec4 xTexelC").concat(2*p+1,";\n           int xTexelC").concat(2*p+1,"Ready;\n           vec4 xC").concat(p,";");d+="\n     for (int r = 0; r < ".concat(c,"; r++) {\n      for (int d1 = 0; d1 < ").concat(t.inChannels,"; d1 += 2) {\n       ");for(var v=0;v<l;v++)d+="\n           xTexelC".concat(2*v," = vec4(0.0);\n           xTexelC").concat(2*v,"Ready = 0;\n           xTexelC").concat(2*v+1," = vec4(0.0);\n           xTexelC").concat(2*v+1,"Ready = 0;\n           xC").concat(v," = vec4(0.0);");d+="\n         xR = xRCorner + r * dilations[0];\n         if (xR >=0 && xR < inDims[0]) {\n       ";for(var m=0;m<(h+1)/2;m++){var g=2*m;if(d+="\n           xC = xCCorner + ".concat(g*u,";\n           "),1===s){if(g<l&&(o%2===1?(d+="\n                 xCOffset = xC + 1;\n                 if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n               "),d+=1===u&&g>0?"\n                 xC".concat(g," = vec4(xTexelC").concat(g-2,".zw, xTexelC").concat(g,".xy);\n                 "):"\n                   xCOffset = xC + 1 - 2;\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       previous.zw = vec2(0.0);\n                     }\n\n                     xC".concat(g," = vec4(previous.zw, xTexelC").concat(g,".xy);\n                   } else {\n                     xC").concat(g," = vec4(0.0, 0.0, xTexelC").concat(g,".xy);\n                   }\n                   ")):d+="\n                 if (xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n\n                 xC").concat(g," = xTexelC").concat(g,";\n                 "),g+1<l)){var y=o%2===0?Mx(u):u;u%2===0&&o%2===1||u%2!==0&&o%2!==1?(d+="\n                   xCOffset = xC + imod(pads[1], 2) + ".concat(y,";\n\n                   if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                     xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n\n                     // Need to manually clear unused channels in case\n                     // we're reading from recycled texture.\n                     if (xCOffset + 1 >= inDims[1]) {\n                       xTexelC").concat(g+1,".zw = vec2(0.0);\n                     }\n                     xTexelC").concat(g+1,"Ready = 1;\n                   }\n                   "),d+=u>1?"\n                     xCOffset -= 2;\n                     if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                      previous = getX(batch, xR, xCOffset, d1);\n                      xC".concat(g+1," = vec4(previous.zw, xTexelC").concat(g+1,".xy);\n                     } else {\n                      xC").concat(g+1," = vec4(0.0, 0.0, xTexelC").concat(g+1,".xy);\n                     }\n                     "):"\n                     xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".xy);\n                     ")):d+=1===y?"\n                     xC".concat(g+1," = xTexelC").concat(g,";\n                     "):"\n                     xCOffset = xC + ".concat(y,";\n\n                     if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                       xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                       if (xCOffset + 1 >= inDims[1]) {\n                         xTexelC").concat(g+1,".zw = vec2(0.0);\n                       }\n                       xTexelC").concat(g+1,"Ready = 1;\n                     }\n\n                     xC").concat(g+1," = xTexelC").concat(g+1,";\n                     ")}}else g<l&&(o%2===1?(d+="\n                 xCOffset = xC + 1 - strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xCOffset, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n\n                 if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                   xTexelC").concat(g+1," = getX(batch, xR, xC + 1, d1);\n                   // Need to manually clear unused channels in case\n                   // we're reading from recycled texture.\n                   if (xC + 2 >= inDims[1]) {\n                     xTexelC").concat(g+1,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g+1,"Ready = 1;\n                 }\n\n                 xC").concat(g," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n               "),g+1<l&&(d+="\n                   final = vec4(0.0);\n                   xCOffset = xC + 1 + strides[1];\n                   if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                     final = getX(batch, xR, xCOffset, d1);\n                   }\n                   xC".concat(g+1," = vec4(xTexelC").concat(g+1,".xy, final.xy);\n                 "))):(d+="\n                 if(xC >= 0 && xC < inDims[1] && xTexelC".concat(g,"Ready == 0) {\n                   xTexelC").concat(g," = getX(batch, xR, xC, d1);\n                   if (xC + 1 >= inDims[1]) {\n                     xTexelC").concat(g,".zw = vec2(0.0);\n                   }\n                   xTexelC").concat(g,"Ready = 1;\n                 }\n\n                 xCOffset = xC + strides[1];\n                 if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(g+1,"Ready == 0) {\n                   xTexelC").concat(g+1," = getX(batch, xR, xCOffset, d1);\n                   if (xCOffset + 1 >= inDims[1]) {\n                     xTexelC").concat(g+1,".zw = vec2(0.);\n                   }\n                   xTexelC").concat(g+1,"Ready = 1;\n                 }\n\n                 xC").concat(g," = vec4(\n                   xTexelC").concat(g,".xy, xTexelC").concat(g+1,".xy);\n               "),g+1<l&&(d+="\n                   xC".concat(g+1," = vec4(xTexelC").concat(g,".zw, xTexelC").concat(g+1,".zw);\n                 "))));g<l&&(d+="\n             wTexel = getW(r, ".concat(g,", d1, d2);\n             dotProd += xC").concat(g,".xxzz * vec4(wTexel.xy, wTexel.xy);\n             if(d1 + 1 < ").concat(t.inChannels,") {\n               dotProd += xC").concat(g,".yyww * vec4(wTexel.zw, wTexel.zw);\n             }\n           "),g+1<l&&(d+="\n               wTexel = getW(r, ".concat(g+1,", d1, d2);\n               dotProd += xC").concat(g+1,".xxzz * vec4(wTexel.xy, wTexel.xy);\n               if(d1 + 1 < ").concat(t.inChannels,") {\n                 dotProd += xC").concat(g+1,".yyww * vec4(wTexel.zw, wTexel.zw);\n               }\n             ")))}d+="\n     }\n   ",d+="\n     }\n   ",d+="\n     }\n   ";var b="",k="";r&&(b=a?"vec4 activation(vec4 a) {\n           vec4 b = getPreluActivationWeightsAtOutCoords();\n           ".concat(r,"\n         }"):i?"vec4 activation(vec4 a) {\n           vec4 b = getLeakyreluAlphaAtOutCoords();\n           ".concat(r,"\n         }"):"vec4 activation(vec4 x) {\n           ".concat(r,"\n         }"),k="result = activation(result);");var V=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n       ".concat(b,"\n\n       void main() {\n         ivec4 coords = getOutputCoords();\n         int batch = coords.x;\n         ivec2 xRCCorner = coords.yz * strides - pads;\n         int d2 = coords.w;\n         int xRCorner = xRCCorner.x;\n         int xCCorner = xRCCorner.y;\n\n         //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n         vec4 dotProd = vec4(0.000000000000001);\n\n         ").concat(d,"\n\n         vec4 result = dotProd - vec4(0.000000000000001);\n         ").concat(V,"\n         ").concat(k,"\n         setOutput(result);\n       }\n     ")})),V1=p((function e(t,n){f(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"inputShape",type:"ivec4"},{name:"pad",type:"ivec2"},{name:"stride",type:"ivec2"},{name:"dilation",type:"ivec2"},{name:"inChannels",type:"int"},{name:"itemsPerBlockRow",type:"int"},{name:"outWidth",type:"int"}],this.outputShape=t,this.enableShapeUniforms=FY(this.outputShape.length);for(var r=n.dataFormat,a=eY(),i="channelsLast"===r,o=i?1:2,s=i?2:3,u=this.enableShapeUniforms?"if(blockIndex < outShape[2] && pos < outShape[1]) {":"if(blockIndex < ".concat(t[2]," && pos < ").concat(t[1],") {"),c="",l=0;l<=1;l++)for(var h=0;h<=1;h++)c+="\n          blockIndex = rc.z + ".concat(h,";\n          pos = rc.y + ").concat(l,";\n\n          ").concat(u,"\n            offsetY = int(blockIndex / outWidth) * stride[0] - pad[0];\n            d0 = offsetY + dilation[0] * (pos / itemsPerBlockRow);\n\n            if(d0 < inputShape[").concat(o,"] && d0 >= 0) {\n              // Use custom imod instead mod. On Intel GPU, mod may generate\n              // unexpected value.\n              // https://github.com/tensorflow/tfjs/issues/5447\n              offsetX = imod(blockIndex, outWidth) * stride[1] - pad[1];\n              d1 = offsetX + dilation[1] * (imod(pos, itemsPerBlockRow) /\n                  inChannels);\n\n              if(d1 < inputShape[").concat(s,"] && d1 >= 0) {\n\n                ch = imod(pos, inChannels);\n\n                if (").concat(i,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*l+h,"] = getChannel(\n                    getA(rc.x, d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*l+h,"] = getChannel(\n                    getA(rc.x, ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(c,"\n\n        ").concat(a.output," = result;\n      }\n    ")}));function x1(e,t){var n=e.length;return n>=3?[].concat((0,H.Z)(e.slice(0,-3)),t?[e[n-3]*e[n-2],e[n-1]]:[e[n-3],e[n-2]*e[n-1]]):!t&&1===n&&e[0]>1?[e[0],1]:null}function w1(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,f=e.activation,d=void 0===f?null:f,p=n.shape,v=i.texData.get(n.dataId),m=a.inChannels,g=p[0]*p[1]*p[2],y=a.outChannels,b="channelsLast"===a.dataFormat,k=[];if(null!=c){var V=x1(c.shape,b);null!=V&&(c=z$({inputs:{x:c},backend:i,attrs:{shape:V}}),k.push(c))}if(null!=s){var x=x1(s.shape,b);null!=x&&(s=z$({inputs:{x:s},backend:i,attrs:{shape:x}}),k.push(s))}if(!((1===g||1===y)&&m>1e3)&&v.isPacked&&b&&null!=v.texture&&p[2]%2!==0&&Gx(v.shape.slice(-3),p.slice(-3))){var w=p[0]*p[1]*(p[2]+1),I={dataId:n.dataId,shape:[1,w,a.inChannels],dtype:n.dtype},S=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,Bx(qQ(v.shape,I.shape),(function(){return"packed reshape ".concat(v.shape," to ").concat(I.shape," isn't free")}));var C=z$({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});k.push(C);var E=Y$({a:I,b:C,backend:i,transposeA:!1,transposeB:false,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:h}),T=i.texData.get(E.dataId);Bx(T.isPacked,(function(){return"batchMatMul result is expected to be packed"})),v.shape=S,T.shape=a.outShape,(t=b$({inputs:{x:E},backend:i})).shape=a.outShape,k.push(E)}else{var N=a.outHeight*a.outWidth,A=z$({inputs:{x:n},backend:i,attrs:{shape:b?[a.batchSize,N,a.inChannels]:[a.batchSize,a.inChannels,N]}}),R=z$({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),_=Y$({a:b?A:R,b:b?R:A,transposeA:!b,transposeB:false,backend:i,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:h});t=z$({inputs:{x:_},backend:i,attrs:{shape:a.outShape}}),k.push(A),k.push(R),k.push(_)}for(var D=0,F=k;D<F.length;D++){var O=F[D];i.disposeIntermediateTensorInfo(O)}return t}function I1(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,h=e.activation,f=void 0===h?null:h,d=r.filterWidth,p=r.filterHeight,v=r.inChannels,m=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=d*p*v,k=g*m,V=[r.batchSize,b,k],x=[];if(null!=u){var w=x1(u.shape,y);null!=w&&(u=z$({inputs:{x:u},backend:a,attrs:{shape:w}}),x.push(u))}if(null!=o){var I=x1(o.shape,y);null!=I&&(o=z$({inputs:{x:o},backend:a,attrs:{shape:I}}),x.push(o))}var S=z$({inputs:{x:n},backend:a,attrs:{shape:[1,b,Zx(n.shape)/b]}});x.push(S);var C=new V1(V,r),E=[t.shape,[r.padInfo.top,r.padInfo.left],[r.strideHeight,r.strideWidth],[r.dilationHeight,r.dilationWidth],[r.inChannels],[r.filterWidth*r.inChannels],[r.outWidth]],T=a.runWebGLProgram(C,[t],"float32",E),N=z$({inputs:{x:T},backend:a,attrs:{shape:V}});x.push(T),x.push(N);var A=null!=o,R=null!=u,_="leakyrelu"===f,D=f?R$(f,!0):null,F=new _$(y?N.shape:S.shape,y?S.shape:N.shape,y?[r.batchSize,k,r.outChannels]:[r.batchSize,r.outChannels,k],!0,!1,A,D,R,_),O=y?[N,S]:[S,N];if(o&&O.push(o),R&&O.push(u),_){var L=a.makeTensorInfo([],"float32",iE(l,"float32"));O.push(L),x.push(L)}var M=a.runWebGLProgram(F,O,"float32"),P=z$({inputs:{x:M},backend:a,attrs:{shape:r.outShape}});x.push(M);for(var z=0,B=x;z<B.length;z++){var U=B[z];a.disposeIntermediateTensorInfo(U)}return P}var S1={kernelName:nI,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,h=a.dimRoundingMode,f=CA(c),d=vA(i.shape,o.shape,s,l,u,h,!1,f);if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(d.strideWidth<=2&&"channelsLast"===f&&ww().getBool("WEBGL_EXP_CONV")){var p=new k1(d),v=[[d.padInfo.top,d.padInfo.left],[d.strideHeight,d.strideWidth],[d.dilationHeight,d.dilationWidth],[d.inHeight,d.inWidth]];t=r.runWebGLProgram(p,[i,o],"float32",v)}else if(ww().getBool("WEBGL_CONV_IM2COL"))t=I1({x:i,filter:o,convInfo:d,backend:r});else{var m=new y1(d);t=r.runWebGLProgram(m,[i,o],"float32")}else t=w1({x:i,filter:o,convInfo:d,backend:r});var g=z$({inputs:{x:t},backend:r,attrs:{shape:d.outShape}});return r.disposeIntermediateTensorInfo(t),g}},C1=p((function e(t){f(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),E1=p((function e(t){f(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,h=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(h,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),T1=p((function e(t){f(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),N1=p((function e(t){f(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var A1={kernelName:rI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,h=CA(u),f=vA(a.shape,l,o,1,s,c,!1,h),d=new C1(f);return n.runWebGLProgram(d,[a,i],"float32")}};var R1={kernelName:aI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,h=CA(c),f=vA(o,i.shape,s,1,u,l,!1,h),d=new E1(f);return n.runWebGLProgram(d,[a,i],"float32")}};var _1={kernelName:iI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=mA(a.shape,i.shape,o,u,s),l=new b1(c);return n.runWebGLProgram(l,[a,i],"float32")}};var D1={kernelName:oI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=mA(a.shape,u,o,1,s),l=new T1(c);return n.runWebGLProgram(l,[a,i],"float32")}};var F1,O1={kernelName:sI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=mA(r.inputShape,i.shape,s,1,o),c=new N1(u);return n.runWebGLProgram(c,[a,i],"float32")}},L1=N$({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),M1={kernelName:uI,backendName:"webgl",kernelFunc:L1},P1=N$({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),z1={kernelName:cI,backendName:"webgl",kernelFunc:P1},B1=p((function e(t,n,r,a,i){f(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=(0,l.Z)(t,4),s=o[0],u=o[1],c=o[2],h=o[3],d=(0,l.Z)(n,1)[0],p=(0,l.Z)(r,2),v=p[0],m=p[1];this.outputShape=[d,v,m,h];var g="bilinear"===a?1:0,y="".concat(u-1,".0"),b="".concat(c-1,".0"),k=v>1?["".concat((u-1)/(v-1)),"(y2-y1) * height_ratio","y1*".concat(y," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(y)],V=(0,l.Z)(k,3),x=V[0],w=V[1],I=V[2],S=m>1?["".concat((c-1)/(m-1)),"(x2-x1) * width_ratio","x1*".concat(b," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(b)],C=(0,l.Z)(S,3),E=C[0],T=C[1],N=C[2];this.userCode="\n      const float height_ratio = float(".concat(x,");\n      const float width_ratio = float(").concat(E,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(w,";\n        float width_scale = ").concat(T,";\n\n        float in_y = ").concat(I,";\n        if( in_y < 0.0 || in_y > ").concat(y," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(N,";\n        if( in_x < 0.0 || in_x > ").concat(b," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(g," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),U1={kernelName:fI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new B1(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}};!function(e){e.Prod="*",e.Sum="+"}(F1||(F1={}));var W1=p((function e(t,n,r,a){f(this,e),this.op=t,this.outputShape=n,this.variableNames=["x"],this.customUniforms=[{name:"index",type:"float"}];var i=this.outputShape.length,o=this.op===F1.Prod?"1.0":"0.0",s=r?o:"getX(".concat(j1(i,"coords",this.op),")"),u=this.outputShape[this.outputShape.length-1],c="",l="";r?(c=a?"end != ".concat(u-1):"end != 0",l=a?"end + 1":"end - 1"):(c=a?"end + pow2 < ".concat(u):"end >= pow2",l=a?"end + pow2":"end - pow2"),this.userCode="\n      void main() {\n        ".concat(SY(i)," coords = getOutputCoords();\n        int end = ").concat(Z1(i,"coords",this.op),";\n        float val = ").concat(s,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(c,") {\n          int idx = ").concat(l,";\n          ").concat(Z1(i,"coords",this.op)," = idx;\n          val ").concat(this.op,"= getX(").concat(j1(i,"coords",this.op),");\n        }\n        setOutput(val);\n      }\n    ")}));function j1(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function Z1(e,t,n){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw new Error("Cumulative ".concat(n," for rank ").concat(e," is not yet supported"))}function G1(e,t,n,r,a,i){var o=t.shape.length,s=TR([r],o),u=t;null!=s&&(u=X$({inputs:{x:t},backend:n,attrs:{perm:s}}));var c=AR(1,o)[0];if(c!==o-1)throw new Error("WebGL cumprod shader expects an inner-most axis=".concat(t.shape.length-1," ")+"but got axis=".concat(r));for(var l=u.shape[c],h=b$({inputs:{x:u},backend:n}),f=0;f<=Math.ceil(Math.log2(l))-1;f++){var d=new W1(e,u.shape,!1,i),p=[[f]],v=h;h=n.runWebGLProgram(d,[h],h.dtype,p),n.disposeIntermediateTensorInfo(v)}if(a){var m=new W1(e,u.shape,a,i),g=h;h=n.runWebGLProgram(m,[h],h.dtype),n.disposeIntermediateTensorInfo(g)}if(null!=s){var y=X$({inputs:{x:h},backend:n,attrs:{perm:NR(s)}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(u),y}return h}var H1={kernelName:lI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return G1(F1.Prod,a,n,i,o,s)}};var q1={kernelName:hI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;return G1(F1.Sum,a,n,i,o,s)}};var K1={kernelName:dI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=$Y(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var h=n.bufferSync(a),f=n.bufferSync(i),d=eJ(h,f,o,s);return n.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}},X1=function(){function e(t,n,r){f(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return p(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var Q1={kernelName:pI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat,s=a.shape[0],u=("NHWC"===o?a.shape[1]:a.shape[2])*i,c=("NHWC"===o?a.shape[2]:a.shape[3])*i,l=("NHWC"===o?a.shape[3]:a.shape[1])/(i*i),h=new X1("NHWC"===o?[s,u,c,l]:[s,l,u,c],i,o);return n.runWebGLProgram(h,[a],a.dtype)}},Y1=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];f(this,e),this.variableNames=["x","W"],this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=FY(this.outputShape.length);var o=t.filterHeight,s=t.filterWidth,u=t.outChannels/t.inChannels,c="",l="";r&&(c=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),l="result = activation(result);");var h=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(c,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(u,";\n        int q = d2 - d1 * ").concat(u,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(o,"; wR++) {\n          int xR = xRCorner + wR * dilations[0];\n\n          if (xR < 0 || xR >= inDims[0]) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(s,"; wC++) {\n            int xC = xCCorner + wC * dilations[1];\n\n            if (xC < 0 || xC >= inDims[1]) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(h,"\n        ").concat(l,"\n        setOutput(result);\n      }\n    ")})),J1=p((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];f(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"pads",type:"ivec2"},{name:"strides",type:"ivec2"},{name:"dilations",type:"ivec2"},{name:"inDims",type:"ivec2"}],this.outputShape=t.outShape,this.enableShapeUniforms=FY(this.outputShape.length);for(var o=t.outChannels/t.inChannels,s=t.padInfo.left,u=t.strideWidth,c=t.dilationWidth,l=t.filterHeight,h=t.filterWidth,d=h,p="\n      int xR; int xC; int xCOffset;\n      vec4 wTexel; vec4 previous; vec4 final;",v=0;v<h;v++)p+="\n          vec4 xTexelC".concat(2*v,";\n          int xTexelC").concat(2*v,"Ready;\n          vec4 xTexelC").concat(2*v+1,";\n          int xTexelC").concat(2*v+1,"Ready;\n          vec4 xC").concat(v,";");p+="\n    for (int r = 0; r < ".concat(l,"; r++) {\n      ");for(var m=0;m<h;m++)p+="\n          xTexelC".concat(2*m," = vec4(0.0);\n          xTexelC").concat(2*m,"Ready = 0;\n          xTexelC").concat(2*m+1," = vec4(0.0);\n          xTexelC").concat(2*m+1,"Ready = 0;\n          xC").concat(m," = vec4(0.0);");p+="\n        xR = xRCorner + r * dilations[0];\n        if (xR >=0 && xR < inDims[0]) {\n      ";for(var g=0;g<(d+1)/2;g++){var y=2*g;if(p+="\n          xC = xCCorner + ".concat(y*c,";\n          "),1===u){if(y<h&&(s%2===1?(p+="\n                xCOffset = xC + 1;\n                if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n              "),p+=1===c&&y>0?"\n                xC".concat(y," = vec4(xTexelC").concat(y-2,".zw, xTexelC").concat(y,".xy);\n                "):"\n                  xCOffset = xC + 1 - 2;\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                    previous = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      previous.zw = vec2(0.0);\n                    }\n\n                    xC".concat(y," = vec4(previous.zw, xTexelC").concat(y,".xy);\n                  } else {\n                    xC").concat(y," = vec4(0.0, 0.0, xTexelC").concat(y,".xy);\n                  }\n                  ")):p+="\n                if (xC >= 0 && xC < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                xC").concat(y," = xTexelC").concat(y,";\n                "),y+1<h)){var b=s%2===0?Mx(c):c;c%2===0&&s%2===1||c%2!==0&&s%2!==1?(p+="\n                  xCOffset = xC + imod(pads[1], 2) + ".concat(b,";\n\n                  if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                    xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n\n                    // Need to manually clear unused channels in case\n                    // we're reading from recycled texture.\n                    if (xCOffset + 1 >= inDims[1]) {\n                      xTexelC").concat(y+1,".zw = vec2(0.0);\n                    }\n                    xTexelC").concat(y+1,"Ready = 1;\n                  }\n                  "),p+=c>1?"\n                    xCOffset -= 2;\n                    if (xCOffset >= 0 && xCOffset < inDims[1]) {\n                     previous = getX(batch, xR, xCOffset, d1);\n                     xC".concat(y+1," = vec4(previous.zw, xTexelC").concat(y+1,".xy);\n                    } else {\n                     xC").concat(y+1," = vec4(0.0, 0.0, xTexelC").concat(y+1,".xy);\n                    }\n                    "):"\n                    xC".concat(y+1," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".xy);\n                    ")):p+=1===b?"\n                    xC".concat(y+1," = xTexelC").concat(y,";\n                    "):"\n                    xCOffset = xC + ".concat(b,";\n\n                    if (xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                      xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n                      if (xCOffset + 1 >= inDims[1]) {\n                        xTexelC").concat(y+1,".zw = vec2(0.0);\n                      }\n                      xTexelC").concat(y+1,"Ready = 1;\n                    }\n\n                    xC").concat(y+1," = xTexelC").concat(y+1,";\n                    ")}}else y<h&&(s%2===1?(p+="\n                xCOffset = xC + 1 - strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xCOffset, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                  xTexelC").concat(y+1," = getX(batch, xR, xC + 1, d1);\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if (xC + 2 >= inDims[1]) {\n                    xTexelC").concat(y+1,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y+1,"Ready = 1;\n                }\n\n                xC").concat(y," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".zw);\n              "),y+1<h&&(p+="\n                  final = vec4(0.0);\n                  xCOffset = xC + 1 + strides[1];\n                  if(xCOffset >= 0 && xCOffset < inDims[1]) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xC".concat(y+1," = vec4(xTexelC").concat(y+1,".xy, final.xy);\n                "))):(p+="\n                if(xC >= 0 && xC < inDims[1] && xTexelC".concat(y,"Ready == 0) {\n                  xTexelC").concat(y," = getX(batch, xR, xC, d1);\n                  if (xC + 1 >= inDims[1]) {\n                    xTexelC").concat(y,".zw = vec2(0.0);\n                  }\n                  xTexelC").concat(y,"Ready = 1;\n                }\n\n                xCOffset = xC + strides[1];\n                if(xCOffset >= 0 && xCOffset < inDims[1] && xTexelC").concat(y+1,"Ready == 0) {\n                  xTexelC").concat(y+1," = getX(batch, xR, xCOffset, d1);\n                  if (xCOffset + 1 >= inDims[1]) {\n                    xTexelC").concat(y+1,".zw = vec2(0.);\n                  }\n                  xTexelC").concat(y+1,"Ready = 1;\n                }\n\n                xC").concat(y," = vec4(\n                  xTexelC").concat(y,".xy, xTexelC").concat(y+1,".xy);\n              "),y+1<h&&(p+="\n                  xC".concat(y+1," = vec4(xTexelC").concat(y,".zw, xTexelC").concat(y+1,".zw);\n                "))));y<h&&(p+="\n            wTexel = getW(r, ".concat(y,", d1, q);\n            dotProd += xC").concat(y," * vec4(wTexel.xz, wTexel.xz);\n          "),y+1<h&&(p+="\n              wTexel = getW(r, ".concat(y+1,", d1, q);\n              dotProd += xC").concat(y+1," * vec4(wTexel.xz, wTexel.xz);\n            ")))}p+="\n    }\n  ",p+="\n      }\n    ";var k="",V="";r&&(k=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),V="result = activation(result);");var x=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(k,"\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(o,";\n        int q = d2 - d1 * ").concat(o,";\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        //intialize dotProd with a small epsilon seems to reduce GPU accuracy loss.\n        vec4 dotProd = vec4(0.000000000000001);\n\n        ").concat(p,"\n\n        vec4 result = dotProd - vec4(0.000000000000001);\n        ").concat(x,"\n        ").concat(V,"\n        setOutput(result);\n      }\n    ")}));var $1={kernelName:vI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),Bx(SA(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var h,f=vA(a.shape,i.shape,o,l,s,c,!0);h=ww().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?new J1(f):new Y1(f);var d=[[f.padInfo.top,f.padInfo.left],[f.strideHeight,f.strideWidth],[f.dilationHeight,f.dilationWidth],[f.inHeight,f.inWidth]];return n.runWebGLProgram(h,[a,i],"float32",d)}},e2=p((function e(t){f(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),t2=p((function e(t){f(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var n2={kernelName:mI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,h=vA(a.shape,l,o,s,u,c,!0),f=new e2(h);return n.runWebGLProgram(f,[a,i],"float32")}};var r2={kernelName:gI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=vA(r.inputShape,i.shape,o,s,u,c,!0),h=new t2(l);return n.runWebGLProgram(h,[a,i],"float32")}},a2=p((function e(t){f(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var i2={kernelName:yI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat((0,H.Z)(r.shape),(0,H.Z)(r.shape)),i=Zx(r.shape),o=z$({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new a2(i),u=n.runWebGLProgram(s,[o],o.dtype),c=z$({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},o2=p((function e(t){f(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,h=a.top,d=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(h,", ").concat(d,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var s2={kernelName:bI,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=fA(i.shape,o.shape,s,u,"NHWC",c),h=new o2(l),f=z$({inputs:{x:t=r.runWebGLProgram(h,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),f}};var u2={kernelName:wI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t,a=kF(e.attrs.equation,r.length),i=a.allDims,o=a.summedDims,s=a.idDims;xF(i.length,s,r);for(var u=wF(o,s),c=u.path,l=u.steps,h=l.length,f=null,d=i.length,p=[],v=0;v<h;++v){var g,y=m(l[v]);try{for(y.s();!(g=y.n()).done;){var b=g.value,k=VF(d,s[b]),V=k.permutationIndices,x=k.expandDims,w=void 0;IF(V)?w=r[b]:(w=X$({inputs:{x:r[b]},backend:n,attrs:{perm:V}}),p.push(w));for(var I=w.shape.slice(),S=0;S<x.length;++S)I.splice(x[S],0,1);Gx(w.shape,I)||(w=z$({inputs:{x:w},backend:n,attrs:{shape:I}}),p.push(w)),null===f?f=w:(f=M$({inputs:{a:w,b:f},backend:n}),p.push(f))}}catch(h6){y.e(h6)}finally{y.f()}v<h-1&&(c[v]>=0&&(f=q$({inputs:{x:f},backend:n,attrs:{axis:c[v]-(i.length-d),keepDims:!1}}),p.push(f)),d--)}for(var C=0,E=p;C<E.length;C++){var T=E[C];T!==f&&n.disposeIntermediateTensorInfo(T)}return f}},c2=N$({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),l2={kernelName:II,backendName:"webgl",kernelFunc:c2},h2={kernelName:SI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=ww().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new y$("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new g$("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},f2=A$({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool",cpuKernelImpl:aJ}),d2={kernelName:EI,backendName:"webgl",kernelFunc:f2},p2=N$({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(uF,";\n  float a1 = ").concat(cF,";\n  float a2 = ").concat(lF,";\n  float a3 = ").concat(hF,";\n  float a4 = ").concat(fF,";\n  float a5 = ").concat(dF,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),v2={kernelName:CI,backendName:"webgl",kernelFunc:p2},m2=N$({opSnippet:"if (isnan(x)) return x;\n  return exp(x);\n",packedOpSnippet:"\n  vec4 result = exp(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:iJ,dtype:"float32"}),g2={kernelName:TI,backendName:"webgl",kernelFunc:m2};function y2(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(Bx(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),z$({inputs:{x:i},backend:r,attrs:{shape:s}})}var b2={kernelName:NI,backendName:"webgl",kernelFunc:y2},k2="return exp(x) - 1.0;",V2=N$({opSnippet:k2,packedOpSnippet:k2,cpuKernelImpl:oJ}),x2={kernelName:AI,backendName:"webgl",kernelFunc:V2},w2=p((function e(t,n,r){f(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function I2(e,t,n){var r=n.texData.get(e.dataId),a=Zx(e.shape),i=e.shape[e.shape.length-1],o=z$({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new w2("real",s,t),c=new w2("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],h=n.runWebGLProgram(u,l,"float32"),f=n.runWebGLProgram(c,l,"float32"),d=V$({inputs:{real:h,imag:f},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f);var p=z$({inputs:{x:d},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(d),p}var S2={kernelName:RI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return I2(t.input,!1,n)}},C2=p((function e(t,n){f(this,e),this.outputShape=[],this.customUniforms=[{name:"value",type:"float"}],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}));function E2(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||ow(a))){var o=ew(i,Zx(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new C2(r,a),u=[[a]];return t.runWebGLProgram(s,[],i,u)}var T2,N2={kernelName:_I,backendName:"webgl",kernelFunc:E2},A2=p((function e(t){f(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x - 1;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),R2={kernelName:DI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new A2(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},_2="return floor(x);",D2=N$({opSnippet:_2,packedOpSnippet:_2,cpuKernelImpl:sJ}),F2={kernelName:FI,backendName:"webgl",kernelFunc:D2},O2=A$({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),L2={kernelName:OI,backendName:"webgl",kernelFunc:O2},M2=p((function e(t){f(this,e),this.variableNames=["A"];var n=eY(),r=(0,l.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),P2=p((function e(t){f(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=eY(),r=(0,l.Z)(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),z2={kernelName:TC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement,u=o?[a.videoWidth,a.videoHeight]:[a.width,a.height],c=(0,l.Z)(u,2),h=c[0],f=c[1],d=[f,h],p=[f,h,i];if(s||o){var v=ww().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");null!=T2&&v===B2||(B2=v,T2=document.createElement("canvas").getContext("2d",{willReadFrequently:B2})),T2.canvas.width=h,T2.canvas.height=f,T2.drawImage(a,0,0,h,f),a=T2.canvas}var m=n.makeTensorInfo(d,"int32");n.texData.get(m.dataId).usage=gQ.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(m.dataId),a);var g=ww().getBool("WEBGL_PACK")?new P2(p):new M2(p),y=n.runWebGLProgram(g,[m],"int32");return n.disposeData(m.dataId),y}},B2=ww().getBool("CANVAS2D_WILL_READ_FREQUENTLY_FOR_GPU");var U2={kernelName:RC,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,h=a.dataFormat,f=a.dilations,d=a.dimRoundingMode,p=a.activation,v=a.leakyreluAlpha,m=CA(h),g=vA(i.shape,o.shape,c,f,l,d,!1,m),y=[],b=null!=s,k=null!=u,V="leakyrelu"===p,x=function(){var e=[i,o],t=function(e,t){if("NCHW"===t&&1===e.shape.length&&1!==e.shape[0]){var n=z$({inputs:{x:e},backend:r,attrs:{shape:[e.shape[0],1,1]}});return y.push(n),n}return e};if(b&&e.push(t(s,h)),k&&e.push(t(u,h)),V){var n=r.makeTensorInfo([],"float32",iE(v,"float32"));e.push(n),y.push(n)}return e};if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(g.strideWidth<=2&&"channelsLast"===m&&ww().getBool("WEBGL_EXP_CONV")){var w=p?R$(p,!0):null,I=new k1(g,b,w,k,V),S=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],C=x();t=r.runWebGLProgram(I,C,"float32",S)}else if(ww().getBool("WEBGL_CONV_IM2COL"))t=I1({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:p,preluActivationWeights:u,leakyreluAlpha:v});else{var E=p?R$(p,!1):null,T=new y1(g,b,E,k,V),N=x();t=r.runWebGLProgram(T,N,"float32")}else t=w1({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:p,preluActivationWeights:u,leakyreluAlpha:v});var A=z$({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),A}};var W2={kernelName:_C,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,h=r.dimRoundingMode,f=r.activation,d=r.leakyreluAlpha,p=[],v=l;null==v&&(v=[1,1]),Bx(SA(u,v),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(v,"'")}));var m,g=vA(a.shape,i.shape,u,v,c,h,!0),y=ww().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=f?R$(f,y):null,k=[a,i],V=null!=o,x=null!=s,w="leakyrelu"===f;if(V&&k.push(o),x&&k.push(s),w){var I=n.makeTensorInfo([],"float32",iE(d,"float32"));k.push(I),p.push(I)}m=y?new J1(g,V,b,x,w):new Y1(g,V,b,x,w);var S=[[g.padInfo.top,g.padInfo.left],[g.strideHeight,g.strideWidth],[g.dilationHeight,g.dilationWidth],[g.inHeight,g.inWidth]],C=n.runWebGLProgram(m,k,"float32",S);return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),C}},j2=p((function e(t,n,r,a){f(this,e),this.sliceDim=t,this.strides=n,this.paramsShape=a,this.variableNames=["x","indices"],this.outputShape=r;var i=SY(n.length),o=SY(r.length),s=this.sliceDim>1?"strides[j]":"strides",u=SY(a.length),c=a.length>1?"paramsShape[j]":"paramsShape";this.userCode="\n        ".concat(i," strides = ").concat(i,"(").concat(this.strides,");\n        ").concat(u," paramsShape = ").concat(u,"(").concat(this.paramsShape,");\n         void main() {\n          ").concat(o," coords = getOutputCoords();\n          int flattenIndex = 0;\n          bool out_of_bounds = false;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            out_of_bounds = out_of_bounds || index < 0;\n            out_of_bounds = out_of_bounds || index >= ").concat(c,";\n            flattenIndex += index * ").concat(s,";\n          }\n          setOutput(out_of_bounds ? 0.0 : getX(flattenIndex, coords[1]));\n        }\n      ")}));var Z2={kernelName:PI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=Zx(r.shape),u=aF(r,a),c=(0,l.Z)(u,4),h=c[0],f=c[1],d=c[2],p=c[3],v=z$({inputs:{x:a},backend:n,attrs:{shape:[f,o]}}),m=z$({inputs:{x:r},backend:n,attrs:{shape:[Zx(r.shape)/d,d]}});if(n.shouldExecuteOnCPU([r,a])||"string"===r.dtype){var g=n.readSync(a.dataId),y=n.bufferSync(r),b=uJ(g,y,r.dtype,f,o,d,p,r.shape,s);return n.makeTensorInfo(h,r.dtype,b.values)}var k=new j2(o,p,[f,d],r.shape),V=n.runWebGLProgram(k,[m,v],m.dtype),x=z$({inputs:{x:V},backend:n,attrs:{shape:h}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(V),x}},G2=p((function e(t,n){f(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=SY(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("index"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        int index = int(getIndices(resRC.x, resRC.z));\n        float inBounds = (index >= 0) && (index < ").concat(t[2],") ? 1.0 : 0.0;\n        setOutput(inBounds * getA(").concat(a,"));\n      }\n    ")}));function H2(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=Yx(o,a.shape)[0];ww().get("DEBUG")&&function(){for(var e=n.readSync(i.dataId),t=a.shape[u],r=function(n){var r=e[n];Bx(r<=t-1&&r>=0,(function(){return"GatherV2: the index value ".concat(r," is not in [0, ").concat(t-1,"]")}))},o=0;o<e.length;++o)r(o)}();var c=AF(a,i,u,s),l=Zx(i.shape),h=[],f=z$({inputs:{x:a},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),d=z$({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,l/c.batchSize]}});h.push(f),h.push(d);var p=[c.batchSize,c.outerSize,l/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var v=n.bufferSync(d),m=n.bufferSync(f),g=cJ(m,v,p);return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(c.outputShape,g.dtype,g.values)}var y=new G2(f.shape,p),b=n.runWebGLProgram(y,[f,d],f.dtype);h.push(b);var k=z$({inputs:{x:b},backend:n,attrs:{shape:c.outputShape}});return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),k}var q2={kernelName:MI,backendName:"webgl",kernelFunc:H2},K2=A$({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:lJ,dtype:"bool"}),X2={kernelName:zI,backendName:"webgl",kernelFunc:K2},Q2=A$({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool",cpuKernelImpl:hJ}),Y2={kernelName:BI,backendName:"webgl",kernelFunc:Q2};var J2={kernelName:WI,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return I2(t.input,!0,n)}},$2=N$({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),e3={kernelName:ZI,backendName:"webgl",kernelFunc:$2},t3=N$({opSnippet:"return float(isinf(x));",dtype:"bool"}),n3={kernelName:GI,backendName:"webgl",kernelFunc:t3},r3=N$({opSnippet:"return float(isnan(x));",dtype:"bool"}),a3={kernelName:HI,backendName:"webgl",kernelFunc:r3},i3=A$({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:fJ,dtype:"bool"}),o3={kernelName:KI,backendName:"webgl",kernelFunc:i3},s3=A$({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",cpuKernelImpl:dJ,dtype:"bool"}),u3={kernelName:XI,backendName:"webgl",kernelFunc:s3};var c3={kernelName:QI,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=pJ(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},l3=N$({opSnippet:"if (isnan(x)) return x;\n  return x < 0.0 ? 0./0. : log(x);\n",packedOpSnippet:"\n  vec4 result = log(x);\n  bvec4 isNaN = isnan(x);\n  result.r = isNaN.r ? x.r : (x.r < 0.0 ? 0./0. : result.r);\n  result.g = isNaN.g ? x.g : (x.g < 0.0 ? 0./0. : result.g);\n  result.b = isNaN.b ? x.b : (x.b < 0.0 ? 0./0. : result.b);\n  result.a = isNaN.a ? x.a : (x.a < 0.0 ? 0./0. : result.a);\n  return result;\n",cpuKernelImpl:vJ}),h3={kernelName:YI,backendName:"webgl",kernelFunc:l3},f3=N$({opSnippet:"if (isnan(x)) return x;\n  return log(1.0 + x);\n"}),d3={kernelName:JI,backendName:"webgl",kernelFunc:f3},p3=A$({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),v3={kernelName:$I,backendName:"webgl",kernelFunc:p3},m3=N$({opSnippet:"return float(!(x >= 1.0));"}),g3={kernelName:eS,backendName:"webgl",kernelFunc:m3},y3=A$({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),b3={kernelName:tS,backendName:"webgl",kernelFunc:y3},k3=p((function e(t,n,r,a,i){f(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")})),V3=p((function e(t,n,r,a,i){f(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")})),x3={kernelName:nS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=ww().getBool("WEBGL_PACK_NORMALIZATION")?new V3(a.shape,i,o,s,u):new k3(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},w3=p((function e(t,n,r,a,i){f(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),I3={kernelName:rS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,h=new w3(a.shape,s,u,c,l);return n.runWebGLProgram(h,[a,i,o],a.dtype)}};function S3(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=Yx(i,a.shape),c=u,h=TR(c,s),f=null!=h,d=n.shouldExecuteOnCPU([a]),p=a;if(f){if(d){for(var v=n.texData.get(p.dataId).values,m=new Array(s),g=0;g<m.length;g++)m[g]=a.shape[h[g]];var y=UJ(v,a.shape,a.dtype,h,m);p=n.makeTensorInfo(m,a.dtype),n.texData.get(p.dataId).values=y}else p=H$(a,h,n);c=AR(c.length,s)}ER("max",c,s);var b,k=SR(p.shape,c),V=(0,l.Z)(k,2),x=V[0],w=V[1],I=x;if(o&&(I=CR(x,u)),d){v=n.texData.get(p.dataId).values;var S=mJ(v,Zx(w),I,a.dtype);b=n.makeTensorInfo(I,a.dtype),n.texData.get(b.dataId).values=S}else b=function(e,t,n,r){var a=Zx(t),i=z$({inputs:{x:e},attrs:{shape:[Zx(e.shape)/a,a]},backend:r}),o=j$(i,e.dtype,"max",r),s=z$({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(p,w,I,n);return f&&n.disposeIntermediateTensorInfo(p),b}var C3={kernelName:aS,backendName:"webgl",kernelFunc:S3},E3=A$({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:gJ}),T3={kernelName:iS,backendName:"webgl",kernelFunc:E3};var N3={kernelName:oS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;JQ(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;Bx(SA(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=dA(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&Gx(c.inShape,c.outShape))return b$({inputs:{x:a},backend:n});var l=new A0(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var A3={kernelName:uS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=pA(a.shape,i,o,[1,1,1],s,c,u),h=new R0(l,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}},R3=p((function e(t){f(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),_3=p((function e(t){f(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,h=u-1-t.padInfo.front,d=c-1-t.padInfo.top,p=l-1-t.padInfo.left,v=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(d,", ").concat(p,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(v," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var D3={kernelName:cS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=pA(i.shape,o,s,[1,1,1],u,c),h=new R0(l,"max",!0),f=n.runWebGLProgram(h,[i],i.dtype),d=new _3(l),p=n.runWebGLProgram(d,[a,f],i.dtype);return n.disposeIntermediateTensorInfo(f),p}};var F3={kernelName:sS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;JQ([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=dA(o.shape,s,u,1,c,l),f=new A0(h,"max",!0),d=n.runWebGLProgram(f,[o],o.dtype),p=new R3(h),v=n.runWebGLProgram(p,[a,d],o.dtype);return n.disposeIntermediateTensorInfo(d),v}};var O3={kernelName:lS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;Bx(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var h=[1,1];Bx(SA(o,h),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(h,"'")}));var f=dA(a.shape,i,o,h,s),d=function(e,t,n,r){var a=new A0(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new A0(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,f,c),p=(0,l.Z)(d,2);return[p[0],p[1]]}};var L3={kernelName:hS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,c=Yx(o,a.shape),h=c,f=TR(h,u),d=null!=f,p=s.shouldExecuteOnCPU([a]),v=[],m=a;if(d){if(p){for(var g=s.texData.get(m.dataId).values,y=new Array(u),b=0;b<y.length;b++)y[b]=a.shape[f[b]];var k=UJ(g,a.shape,a.dtype,f,y);m=s.makeTensorInfo(y,a.dtype),s.texData.get(m.dataId).values=k}else m=H$(a,f,s);v.push(m),h=AR(h.length,u)}ER("sum",h,u);var V=SR(m.shape,h),x=(0,l.Z)(V,2),w=x[0],I=x[1],S=w;i&&(S=CR(w,c));for(var C=function(e,t,n,r){var a=Zx(t),i=z$({inputs:{x:e},attrs:{shape:[Zx(e.shape)/a,a]},backend:r}),o=j$(i,"float32","mean",r),s=z$({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(m,I,S,s),E=0,T=v;E<T.length;E++){b=T[E];s.disposeIntermediateTensorInfo(b)}return C}};var M3={kernelName:fS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=Yx(i,a.shape),c=u,h=TR(c,s),f=a;null!=h&&(f=X$({inputs:{x:a},backend:n,attrs:{perm:h}}),c=AR(c.length,a.shape.length)),ER("min",c,s);var d,p=SR(f.shape,c),v=(0,l.Z)(p,2),m=v[0],g=z$({inputs:{x:f},backend:n,attrs:{shape:[-1,Zx(v[1])]}}),y=j$(g,g.dtype,"min",n);return d=z$(o?{inputs:{x:y},backend:n,attrs:{shape:CR(m,u)}}:{inputs:{x:y},backend:n,attrs:{shape:m}}),n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(y),null!=h&&n.disposeIntermediateTensorInfo(f),d}},P3=A$({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:yJ}),z3={kernelName:dS,backendName:"webgl",kernelFunc:P3},B3=p((function e(t,n,r){f(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=SY(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),U3=p((function e(t,n,r){f(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=SY(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=ZJ("rc",a),c=ZJ("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),d="reflect"===r?0:1,p="";if(1===a){var v="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(d,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(d,";\n        }\n        source -= start;\n      ");p="\n        ".concat(i," rc = outputLoc;\n        ").concat(v,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(v,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ")}else{var m="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(d,") +\n                gte * ((end - 1) * 2 - source + ").concat(d,");\n        source -= start;\n      ");p="\n        ".concat(i," rc = outputLoc;\n        ").concat(m,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(m,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(m,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(m,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")})),W3={kernelName:pS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=ww().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new U3(a.shape,i,o):new B3(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},j3=A$({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),Z3={kernelName:vS,backendName:"webgl",kernelFunc:j3},G3=p((function e(t,n,r){f(this,e),this.variableNames=["probs"],this.customUniforms=[{name:"seed",type:"float"}],this.outputShape=[t,r],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")})),H3=A$({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),q3={kernelName:xI,backendName:"webgl",kernelFunc:H3},K3="return a - b;",X3=A$({opSnippet:K3,packedOpSnippet:K3,supportsComplex:!0,cpuKernelImpl:PJ}),Q3={kernelName:mC,backendName:"webgl",kernelFunc:X3};function Y3(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=Yx([r.dim],a.shape),o=S3({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),s=CR(o.shape,i),u=z$({inputs:{x:o},backend:n,attrs:{shape:s}}),c=X3({inputs:{a:a,b:u},backend:n}),l=m2({inputs:{x:c},backend:n}),h=q$({inputs:{x:l},backend:n,attrs:{axis:i,keepDims:!1}}),f=z$({inputs:{x:h},backend:n,attrs:{shape:s}}),d=H3({inputs:{a:l,b:f},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),d}var J3={kernelName:aC,backendName:"webgl",kernelFunc:Y3};var $3={kernelName:mS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:Y3({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],h=new G3(c,l,i),f=[[o]],d=n.runWebGLProgram(h,[u],"int32",f);return s||n.disposeIntermediateTensorInfo(u),d}};var e4={kernelName:yS,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=kJ(i.values,a.shape,a.dtype),s=(0,l.Z)(o,2),u=s[0],c=s[1];return r.makeTensorInfo(c,a.dtype,u)}return t=ww().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new h$(a.shape,"\n  vec4 result = -x;\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"):new YJ(a.shape,"if (isnan(x)) return x;\n  return -x;\n"),r.runWebGLProgram(t,[a],a.dtype)}},t4=q_;var n4={kernelName:kS,backendName:"webgl",kernelFunc:function(e){DC("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),h=t4(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},r4=K_;var a4={kernelName:VS,backendName:"webgl",kernelFunc:function(e){DC("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),h=n.readSync(i.dataId),f=r4(l,h,o,s,u,c),d=f.selectedIndices,p=f.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},i4=X_;var o4={kernelName:xS,backendName:"webgl",kernelFunc:function(e){DC("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),h=n.readSync(i.dataId),f=i4(l,h,o,s,u,c),d=f.selectedIndices,p=f.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([p.length],"float32",new Float32Array(p))]}},s4=p((function e(t,n,r,a){f(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),u4={kernelName:IS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.dtype,o=r.depth,s=r.onValue,u=r.offValue,c=Zx(a.shape),l=new s4(c,o,s,u),h=z$({inputs:{x:a},backend:n,attrs:{shape:[c]}}),f=n.runWebGLProgram(l,[h],i);n.disposeIntermediateTensorInfo(h);var d=z$({inputs:{x:f},backend:n,attrs:{shape:[].concat((0,H.Z)(a.shape),[o])}});return n.disposeIntermediateTensorInfo(f),d}};function c4(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=J0({inputs:{input:r},backend:n}),i=c4({inputs:{x:a},backend:n}),o=d1({inputs:{input:r},backend:n}),s=c4({inputs:{x:o},backend:n}),u=V$({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return E2({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var l4={kernelName:CC,backendName:"webgl",kernelFunc:c4};var h4={kernelName:wS,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=J0({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=d1({inputs:{input:a},backend:r}),u=c4({inputs:{x:s},backend:r}),c=V$({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return E2({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var f4={kernelName:SS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return y2({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){Ux(a,e.shape,"All tensors passed to stack must have matching shapes"),Bx(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=t.map((function(e){var t=y2({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),u=m1({inputs:s,backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),u}},d4=p((function e(t,n,r){f(this,e),this.variableNames=["x"],this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=SY(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(value);\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(value);\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),p4=p((function e(t,n,r){f(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.customUniforms=[{name:"value",type:"float"}],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=SY(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=ZJ("rc",a),c=ZJ("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),d=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],p=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",v="",m=0,g=1===a?2:4;m<g;m++)v+="\n        ".concat(d[m],"\n        if (").concat(p,") {\n          result[").concat(m,"] = float(value);\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(m,"] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ");v+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(v,"\n        setOutput(result);\n      }\n    ")})),v4=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;if(0===Zx(a.shape)){var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]}));return E2({backend:n,attrs:{shape:s,value:o,dtype:a.dtype}})}var u=ww().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new p4(a.shape,i,o):new d4(a.shape,i,o),c=[[o]];return n.runWebGLProgram(u,[a],a.dtype,c)},m4={kernelName:CS,backendName:"webgl",kernelFunc:v4},g4=A$({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),y4={kernelName:ES,backendName:"webgl",kernelFunc:g4};var b4={kernelName:NS,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=[],h=Yx(o,i.shape),f=h,d=TR(f,u),p=i;if(null!=d&&(p=X$({inputs:{x:i},backend:r,attrs:{perm:d}}),f=AR(f.length,u),c.push(p)),ER("prod",f,u),r.shouldExecuteOnCPU([p])){var v=r.texData.get(p.dataId).values,m=xJ(p.shape,p.dtype,v,f),g=m.outVals,y=m.outShape,b=m.outDtype;t=r.makeTensorInfo(y,b,g)}else{var k=SR(p.shape,f),V=(0,l.Z)(k,2),x=V[0],w=Zx(V[1]),I=z$({inputs:{x:p},backend:r,attrs:{shape:[-1,w]}}),S=j$(I,_E(i.dtype),"prod",r);t=z$({inputs:{x:S},backend:r,attrs:{shape:x}}),c.push(I),c.push(S)}if(s){c.push(t);var C=CR(t.shape,h);t=z$({inputs:{x:t},backend:r,attrs:{shape:C}})}return c.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}};var k4={kernelName:AS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.shape,i=t.values,o=t.defaultValue,s=t.rowPartitionTensors,u=r.rowPartitionTypes,c=n.readSync(a.dataId),h=n.readSync(i.dataId),f=n.readSync(o.dataId),d=s.map((function(e){return n.readSync(e.dataId)})),p=s.map((function(e){return e.shape})),v=wJ(c,a.shape,h,i.shape,i.dtype,f,o.shape,d,p,u),m=(0,l.Z)(v,2),g=m[0],y=m[1];return n.makeTensorInfo(g,i.dtype,y)}},V4=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=IJ(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},x4={kernelName:RS,backendName:"webgl",kernelFunc:V4},w4=N$({opSnippet:"return 1.0 / x;"}),I4={kernelName:DS,backendName:"webgl",kernelFunc:w4},S4=N$({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),C4={kernelName:FS,backendName:"webgl",kernelFunc:S4},E4=N$({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),T4={kernelName:BS,backendName:"webgl",kernelFunc:E4},N4=p((function e(t,n,r,a,i){f(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,l.Z)(t,4),s=o[0],u=o[1],c=o[2],h=o[3];this.outputShape=[s,n,r,h];var d,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],v=[a&&n>1?n-1:n,a&&r>1?r-1:r];d=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(p[0]/v[0],",\n          ").concat(p[1]/v[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),A4=p((function e(t,n,r,a,i){f(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,l.Z)(t,4),s=o[0],u=o[1],c=o[2],h=o[3];this.outputShape=[s,n,r,h];var d,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],v=[a&&n>1?n-1:n,a&&r>1?r-1:r];d=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(p[0]/v[0],",\n          ").concat(p[1]/v[1],",\n          ").concat(p[1]/v[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(h-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var R4={kernelName:PS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,l.Z)(s,2),c=u[0],h=u[1],f=ww().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new A4(a.shape,c,h,i,o):new N4(a.shape,c,h,i,o);return n.runWebGLProgram(f,[a],"float32")}},_4=p((function e(t,n,r){f(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,l.Z)(n,3),i=a[1],o=a[2],s=(0,l.Z)(t,3),u=s[1],c=s[2],h=[r&&u>1?i-1:i,r&&c>1?o-1:o],d=[r&&u>1?u-1:u,r&&c>1?c-1:c],p=h[0]/d[0],v=h[1]/d[1],m=1/p,g=1/v,y=2*Math.ceil(m)+2,b=2*Math.ceil(g)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(p,");\n        const float widthScale = float(").concat(v,");\n\n        const float invHeightScale = float(").concat(m,");\n        const float invWidthScale = float(").concat(g,");\n\n        const int winHeight = int(").concat(y,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var D4={kernelName:zS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new _4(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},F4=p((function e(t,n,r,a,i){f(this,e),this.variableNames=["A"],this.outputShape=[];var o=(0,l.Z)(t,4),s=o[0],u=o[1],c=o[2],h=o[3];this.outputShape=[s,n,r,h];var d,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],v=[a&&n>1?n-1:n,a&&r>1?r-1:r],m=a?"0.5":"0.0";d=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(p[0]/v[0],",\n          ").concat(p[1]/v[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(m,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")})),O4=p((function e(t,n,r,a,i){f(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=(0,l.Z)(t,4),s=o[0],u=o[1],c=o[2],h=o[3];this.outputShape=[s,n,r,h];var d,p=[a&&n>1?u-1:u,a&&r>1?c-1:c],v=[a&&n>1?n-1:n,a&&r>1?r-1:r],m=a?"0.5":"0.0";d=i?"max((vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC, vec3(0.0))":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(p[0]/v[0],",\n          ").concat(p[1]/v[1],",\n          ").concat(p[1]/v[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(d,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec3 sourceNearestRC = ivec3(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(m,")));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(h-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        vec4 newValue = vec4(\n          getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d),\n          hasNextCol ? getAValue(b, sourceNearestRC.x, sourceNearestRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceNearestRC.x, sourceNearestRC.z, d + 1) : 0.0);\n\n        setOutput(newValue);\n      }\n    ")}));var L4={kernelName:LS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size,u=(0,l.Z)(s,2),c=u[0],h=u[1],f=ww().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new O4(a.shape,c,h,i,o):new F4(a.shape,c,h,i,o);return n.runWebGLProgram(f,[a],a.dtype)}},M4=p((function e(t,n,r){f(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=(0,l.Z)(n,3),i=a[1],o=a[2],s=(0,l.Z)(t,3),u=s[1],c=s[2],h=[r&&u>1?i-1:i,r&&c>1?o-1:o],d=[r&&u>1?u-1:u,r&&c>1?c-1:c],p=h[0]/d[0],v=h[1]/d[1],m=1/p,g=1/v,y=2*Math.ceil(m)+2,b=2*Math.ceil(g)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(p,");\n        const float widthScale = float(").concat(v,");\n\n        const float invHeightScale = float(").concat(m,");\n        const float invWidthScale = float(").concat(g,");\n\n        const int winHeight = int(").concat(y,");\n        const int winWidth = int(").concat(b,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(h[0],") *\n                (float(dyR) / float(").concat(d[0],"));\n\n            float sourceFracCol =\n                float(").concat(h[1],") *\n                  (float(dyC) / float(").concat(d[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var P4={kernelName:MS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new M4(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},z4=p((function e(t,n){f(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=SY(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),B4=p((function e(t,n){f(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=ZJ("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=SY(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var U4={kernelName:US,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=Yx(i,a.shape);if(0===o)return b$({inputs:{x:a},backend:n});var u=ww().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new B4(a.shape,s):new z4(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},W4=p((function e(t,n){f(this,e),this.variableNames=["Image"],this.outputShape=[],this.customUniforms=[{name:"params",type:"vec4"}];var r=t[1],a=t[2];this.outputShape=t;var i="";i="number"===typeof n?"float outputValue = ".concat(n.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(n.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - params[0]) * params[3] -\n            (float(y) - params[1]) * params[2];\n          float coordYFloat = (float(x) - params[0]) * params[2] +\n            (float(y) - params[1]) * params[3];\n          int coordX = int(round(coordXFloat + params[0]));\n          int coordY = int(round(coordYFloat + params[1]));\n          ".concat(i,"\n          if(coordX >= 0 && coordX < ").concat(a," && coordY >= 0 && coordY < ").concat(r,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),j4={kernelName:NC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new W4(a.shape,o),h=JD(s,a.shape[1],a.shape[2]),f=(0,l.Z)(h,2),d=[[f[0],f[1],Math.sin(i),Math.cos(i)]];return u.runWebGLProgram(c,[a],a.dtype,d)}},Z4=N$({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),G4={kernelName:WS,backendName:"webgl",kernelFunc:Z4},H4=N$({opSnippet:"return inversesqrt(x);",cpuKernelImpl:SJ}),q4={kernelName:jS,backendName:"webgl",kernelFunc:H4},K4=p((function e(t,n,r,a,i,o){f(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=SY(i.length),u=SY(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="getIndices(".concat(c,")"),h="";1===a?h="i":2===a&&(h="i, coords[1]");var d="getUpdates(".concat(h,")"),p=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(p,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(d,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")}));var X4={kernelName:ZS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=iF(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,f=s.outputSize,d=[f/l,l];if(0===f)return n.makeTensorInfo(o,a.dtype);var p=z$({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),v=z$({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new K4(c,u,p.shape.length,v.shape.length,h,d),y=n.runWebGLProgram(g,[v,p,m],v.dtype),b=z$({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),b}},Q4=p((function e(t,n,r,a){f(this,e),this.variableNames=["sortedSequence","values"],this.customUniforms=[{name:"numInputs",type:"int"}],this.outputShape=[t,r];var i="for (int i = 0; i < ".concat(Math.ceil(Math.log2(n+1)),"; ++i) { if (left >= right) break;"),o=2===ww().getNumber("WEBGL_VERSION")?"while (left < right) {":i,s="left"===a?"<":"<=";this.userCode="\n       int findBound(int batch, float value) {\n         int left = 0;\n         int right = numInputs;\n         int mid;\n         ".concat(o,"\n           mid = (left + right) / 2;\n           if (getSortedSequence(batch, mid) ").concat(s," value) {\n             left = mid + 1;\n           } else {\n             right = mid;\n           }\n         }\n         return right;\n       }\n\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int valueIndex = coords[1];\n\n         float value = getValues(batch, valueIndex);\n\n         setOutput(float(findBound(batch, value)));\n       }\n     ")}));var Y4={kernelName:GS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sortedSequence,i=t.values,o=r.side,s=new Q4(a.shape[0],a.shape[1],i.shape[1],o),u=[[a.shape[1]]];return n.runWebGLProgram(s,[a,i],"int32",u)}},J4=p((function e(t,n,r){var a,i;if(f(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=SY(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var $4={kernelName:HS,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new J4(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],RE(a.dtype,i.dtype))}},e5=N$({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(oF,";\n  float scale = ").concat(sF,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),t5={kernelName:qS,backendName:"webgl",kernelFunc:e5},n5=N$({opSnippet:"if (isnan(x)) return x;\n  return 1.0 / (1.0 + exp(-1.0 * x));\n",packedOpSnippet:"\n  vec4 result = 1.0 / (1.0 + exp(-1.0 * x));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",cpuKernelImpl:EJ}),r5={kernelName:JS,backendName:"webgl",kernelFunc:n5},a5=N$({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),i5={kernelName:YS,backendName:"webgl",kernelFunc:a5},o5=N$({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),s5={kernelName:XS,backendName:"webgl",kernelFunc:o5},u5=N$({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),c5={kernelName:QS,backendName:"webgl",kernelFunc:u5},l5=N$({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),h5={kernelName:$S,backendName:"webgl",kernelFunc:l5},f5={kernelName:nC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;Bx(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,(0,H.Z)(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],h=v4({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),f=$D(h.shape,i,s,!1),d=eF(f.length,i.length,!1),p=tF(h.shape,i,s,!1),v=z$({inputs:{x:h},backend:n,attrs:{shape:f}}),m=X$({inputs:{x:v},backend:n,attrs:{perm:d}}),g=z$({inputs:{x:m},backend:n,attrs:{shape:p}});return l.push(h),l.push(v),l.push(m),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var d5={kernelName:iC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.indices,a=t.values,i=t.denseShape,o=t.defaultValue;if(1!==i.shape.length)throw new Error("Dense shape must be a vector, saw:\n         ".concat(i.shape));if(2!==r.shape.length)throw new Error("Indices must be a matrix, saw:\n         ".concat(r.shape));if(1!==a.shape.length)throw new Error("Values must be a vector, saw:\n         ".concat(a.shape));if(0!==o.shape.length)throw new Error("Default value must be a scalar, saw:\n        ".concat(o.shape));var s=n.readSync(r.dataId),u=n.readSync(a.dataId),c=n.readSync(i.dataId),h=n.readSync(o.dataId)[0],f=AJ(s,r.shape,r.dtype,u,a.dtype,c,h),d=(0,l.Z)(f,5),p=d[0],v=d[1],m=d[2],g=d[3],y=d[4];return[n.makeTensorInfo(v,r.dtype,p),n.makeTensorInfo([v[0]],a.dtype,m),n.makeTensorInfo([g.length],"bool",new Uint8Array(g.map((function(e){return Number(e)})))),n.makeTensorInfo([y.length],r.dtype,new Int32Array(y))]}};var p5={kernelName:oC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.inputIndices,a=t.inputShape,i=t.newShape;if(2!==r.shape.length)throw new Error("Input indices should be a matrix but received shape ".concat(r.shape));if(1!==a.shape.length)throw new Error("Input shape should be a vector but received shape ".concat(a.shape));if(1!==i.shape.length)throw new Error("Target shape should be a vector but received shape ".concat(i.shape));var o=Array.from(n.readSync(a.dataId)),s=n.readSync(r.dataId),u=Array.from(n.readSync(i.dataId)),c=RJ(s,r.shape,r.dtype,o,u),h=(0,l.Z)(c,3),f=h[0],d=h[1],p=h[2];return[n.makeTensorInfo(d,r.dtype,f),n.makeTensorInfo([p.length],i.dtype,new Int32Array(p))]}};var v5={kernelName:sC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n              ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n              ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=_J(o,r.shape,r.dtype,s,u,!0),h=(0,l.Z)(c,2),f=h[0],d=h[1];return n.makeTensorInfo(d,r.dtype,f)}};var m5={kernelName:uC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.data,a=t.indices,i=t.segmentIds;if(r.shape.length<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.shape.length)throw new Error("Indices should be a vector but received shape\n             ".concat(a.shape));if(1!==i.shape.length)throw new Error("Segment ids should be a vector but received shape\n             ".concat(i.shape));var o=n.readSync(r.dataId),s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=_J(o,r.shape,r.dtype,s,u),h=(0,l.Z)(c,2),f=h[0],d=h[1];return n.makeTensorInfo(d,r.dtype,f)}};var g5={kernelName:cC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=iF(0,a,s),c=u.sliceRank,l=u.numUpdates,h=u.sliceSize,f=u.strides,d=u.outputSize;if("string"===i.dtype){var p=n.bufferSync(a),v=n.bufferSync(i),m=cE(n.readSync(o.dataId)[0]),g=CJ(p,v,s,d,h,l,c,f,m,false);return n.makeTensorInfo(s,g.dtype,g.values)}var y=new K4(l,c,a.shape.length,i.shape.length,f,[d,1],false),b=n.runWebGLProgram(y,[i,a,o],i.dtype),k=z$({inputs:{x:b},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(b),k}};var y5={kernelName:rC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=Yx(r.axis,a.shape)[0],s=CF(a,i,o),u=a.shape.length,c=new Array(u).fill(0),l=a.shape.slice();return s.map((function(e){var t=(0,H.Z)(l);t[o]=e;var r=G0({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r}))}},b5="return sqrt(x);",k5=N$({opSnippet:b5,packedOpSnippet:b5,cpuKernelImpl:DJ}),V5={kernelName:eC,backendName:"webgl",kernelFunc:k5},x5={kernelName:hC,backendName:"webgl",kernelFunc:N$({opSnippet:"return x * x;"})},w5="return (a - b) * (a - b);",I5=A$({opSnippet:w5,packedOpSnippet:w5}),S5={kernelName:lC,backendName:"webgl",kernelFunc:I5};var C5={kernelName:EC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=JJ+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new YJ(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},E5=p((function e(t,n,r){f(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=SY(r.length),o=SY(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var T5={kernelName:fC,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,h=a.ellipsisMask,f=a.newAxisMask,d=a.shrinkAxisMask,p=qN(i.shape,o,s,u,c,l,h,f,d),v=p.finalShapeSparse,m=p.finalShape,g=p.isIdentity,y=p.sliceDim0,b=p.isSimpleSlice,k=p.begin,V=p.end,x=p.strides;if(g)t=z$({inputs:{x:i},backend:r,attrs:{shape:m}});else if(y||b){Bx(i.shape.length>=1,(function(){return"Input must have rank at least 1, got: ".concat(i.shape.length)}));var w=jN(k,V,x),I=G0({inputs:{x:i},backend:r,attrs:{begin:k,size:w}});t=z$({inputs:{x:I},backend:r,attrs:{shape:m}}),r.disposeIntermediateTensorInfo(I)}else{if(r.shouldExecuteOnCPU([i])){var S=r.readSync(i.dataId),C=uN(i.shape,i.dtype,S),E=FJ(v,C,x,k);t=r.makeTensorInfo(m,i.dtype,E.values)}else{var T=new E5(k,x,v);t=r.runWebGLProgram(T,[i],i.dtype)}}var N=z$({inputs:{x:t},backend:r,attrs:{shape:m}});return r.disposeIntermediateTensorInfo(t),N}};var N5={kernelName:dC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=r.separator,i=r.nGramWidths,o=r.leftPad,s=r.rightPad,u=r.padWidth,c=r.preserveShortSequences,h=t.data,f=t.dataSplits,d=n.readSync(h.dataId),p=n.readSync(f.dataId),v=OJ(d,p,a,i,o,s,u,c),m=(0,l.Z)(v,2),g=m[0],y=m[1];return[n.makeTensorInfo([g.length],"string",g),n.makeTensorInfo(f.shape,"int32",y)]}};var A5={kernelName:pC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.skipEmpty,a=t.input,i=t.delimiter;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(1!==a.shape.length)throw new Error("Input must be a vector, got shape: ".concat(a.shape));if(0!==i.shape.length)throw new Error("Delimiter must be a scalar, got shape: ".concat(i.shape));var o=n.readSync(a.dataId),s=n.readSync(i.dataId)[0],u=LJ(o,s,r),c=(0,l.Z)(u,3),h=c[0],f=c[1],d=c[2],p=f.length;return[n.makeTensorInfo([p,2],"int32",h),n.makeTensorInfo([p],"string",f),n.makeTensorInfo([2],"int32",new Int32Array(d))]}};var R5={kernelName:vC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.numBuckets,a=t.input;if("string"!==a.dtype)throw new Error("Input must be of datatype string");if(r<=0)throw new Error("Number of buckets must be at least 1");var i=n.readSync(a.dataId),o=MJ(i,r);return n.makeTensorInfo(a.shape,"int32",o)}},_5=N$({opSnippet:"return tan(x);"}),D5={kernelName:gC,backendName:"webgl",kernelFunc:_5},F5=N$({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),O5={kernelName:yC,backendName:"webgl",kernelFunc:F5},L5=p((function e(t,n){f(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=SY(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function M5(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype||a.shape.length>5){var o=n.readSync(a.dataId),s="string"===a.dtype?o.map((function(e){return cE(e)})):o,u=uN(a.shape,a.dtype,s),c=zJ(u,i);return n.makeTensorInfo(c.shape,c.dtype,c.values)}var l=new L5(a.shape,i);return n.runWebGLProgram(l,[a],a.dtype)}var P5={kernelName:bC,backendName:"webgl",kernelFunc:M5},z5=p((function e(t){f(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"negativeInf",type:"float"},{name:"dir",type:"int"},{name:"inc",type:"int"}],this.outputShape=t,this.userCode="\n       void main() {\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // We compare elements pair-wise within a group of size 2 * inc.\n         // The comparing rule for each group alternates between ascending\n         // and descending. Within each group, we compare each pair at\n         // positions i and i+inc. To decide whether an element at position i\n         // is x0 or x1, we mod it by 2 * inc, if the result is smaller than\n         // inc, it is in the first half of the group, we denote it as x0,\n         // otherwise we denote it as x1.\n         // For example, as shown in the Bitonic top K paper referenced above,\n         // Figure5(a) shows that element[1] is in the\n         // second half of the group when group size is 2, but it is in the\n         // first half of the group when group size is 4.\n\n         bool isFirstInPair = imod(elemIdx, 2 * inc) < inc;\n         int i = isFirstInPair ? elemIdx : elemIdx - inc;\n\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + inc : int(getIndices(batch, i + inc));\n         float x0 = i0 < n ? getX(batch, i0) : negativeInf;\n         float x1 = i1 < n ? getX(batch, i1) : negativeInf;\n\n         // Denotes which direction indices are in (ascending or descending).\n         bool reverse = imod(elemIdx, 2 * dir) >= dir;\n         bool isGreater = x0 > x1 || (x0 == x1 && i1 > i0);\n         if (reverse == isGreater) { // Elements in opposite order of direction\n           int iTemp = i0;\n           i0 = i1;\n           i1 = iTemp;\n         }\n         if (isFirstInPair) {\n            setOutput(float(i0));\n         } else {\n            setOutput(float(i1));\n         }\n       }\n     "})),B5=p((function e(t){f(this,e),this.variableNames=["x","indices"],this.customUniforms=[{name:"n",type:"int"},{name:"firstPass",type:"int"},{name:"k",type:"int"}],this.outputShape=t,this.userCode="\n    void main() {\n         // Takes max of indices (0, k), (1, k + 1), (2, k + 2) ...\n         ivec2 coords = getOutputCoords();\n         int batch = coords[0];\n         int elemIdx = coords[1];\n\n         // The output size is half of the previous size.\n         // If the previous sequence is | | | | _ _ _ _  | | | |  _ _ _ _ (k=4),\n         // we only need to output the indices at positions |, the indices at\n         // positions _ can be thrown away, see Figure5(b) After Phase 2\n         // (Merge phase) in the Bitonic Top K paper referenced above.\n         // For example, the paper shows we only need to output the orange bars.\n         // The output sequence should look like this | | | | | | | |.\n         // Because the sequence is halved, to map the output index back\n         // to the previous sequence to find the corresponding value,\n         // we need to double the index. When we double the index,\n         // we basically interpolate a position, so 2i looks like\n         // | _ | _ | _ | _ | _ | _ | _. We move the | to the first k position\n         // of each 2k positions by - elemIdx % k. E.g. for output at\n         // index 4,5,6,7, we want to get the corresponding element at\n         // original index 8,9,10,11, for output at index 8,9,10,11,\n         // we want to get the corresponding element at original index\n         // 16,17,18,19, so on and so forth.\n\n         int i = elemIdx < k ? elemIdx : (elemIdx * 2 - imod(elemIdx, k));\n         int i0 = firstPass == 1 ? i : int(getIndices(batch, i));\n         int i1 = firstPass == 1 ? i + k : int(getIndices(batch, i + k));\n\n         float x0 = getX(batch, i0);\n         float x1 = i1 < n ? getX(batch, i1) : x0;\n\n         setOutput(x0 >= x1 ? float(i0) : float(i1));\n       }\n     "}));function U5(e,t){null!==t&&e.disposeIntermediateTensorInfo(t)}function W5(e){for(var t=1;t<e;)t*=2;return t}var j5={kernelName:kC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=ww().getNumber("TOPK_LAST_DIM_CPU_HANDOFF_SIZE_THRESHOLD"),u=ww().getNumber("TOPK_K_CPU_HANDOFF_THRESHOLD"),c=a.shape,h=c[c.length-1];if(n.shouldExecuteOnCPU([a])||h<s||i>u){var f=n.readSync(a.dataId),d=BJ(f,c,a.dtype,i,o),p=(0,l.Z)(d,2),v=p[0],m=p[1];return[n.makeTensorInfo(v.shape,v.dtype,v.values),n.makeTensorInfo(m.shape,m.dtype,m.values)]}if(0===i)return c[c.length-1]=0,[n.makeTensorInfo(c,a.dtype,[]),n.makeTensorInfo(c,"int32",[])];if(1===h)return[a,E2({attrs:{shape:c,dtype:"int32",value:0},backend:n})];var g=n.texData.get(a.dataId),y=null!==g&&g.isPacked,b=y?n.unpackTensor(a):a,k=Zx(c)/h,V=z$({inputs:{x:b},attrs:{shape:[k,h]},backend:n});y&&U5(n,b);for(var x=W5(i),w=W5(h),I=null,S=function(){return null===I?[V,V]:[V,I]},C=function(e,t,r){var a=S(),i=new z5(r),o=[[h],[null===I?1:0],[Number.NEGATIVE_INFINITY],[e],[t]],s=I;I=n.runWebGLProgram(i,a,"int32",o),U5(n,s)},E=1;E<x;E*=2)for(var T=2*E,N=E;N>=1;N/=2)C(T,N,[k,w]);for(var A=w;A>x;A/=2){var R=S(),_=new B5([k,A/2]),D=[[h],[null===I?1:0],[x]],F=I;I=n.runWebGLProgram(_,R,"int32",D),U5(n,F);for(var O=x/2,L=2*O,M=O;M>=1;M/=2)C(L,M,I.shape)}var P=I;I=G0({inputs:{x:I},backend:n,attrs:{begin:0,size:[k,i]}}),U5(n,P);var z=H2({inputs:{x:V,indices:I},backend:n,attrs:{axis:1,batchDims:1}});U5(n,V);var B=c.slice(0,-1);B.push(i),P=I,I=z$({inputs:{x:I},attrs:{shape:B},backend:n}),U5(n,P);var U=z;return z=z$({inputs:{x:z},attrs:{shape:B},backend:n}),U5(n,U),[z,I]}},Z5=p((function e(t,n,r,a,i,o){f(this,e),this.variableNames=["Image","Transforms"],this.outputShape=o;var s,u="nearest"===r?1:2;switch(a){case"constant":default:s=1;break;case"reflect":s=2;break;case"wrap":s=3;break;case"nearest":s=4}this.userCode="\n            float mapCoord(float outCoord, float len) {\n              float inCoord = outCoord;\n              if(".concat(s," == 2) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    if (inCoord < sz2) {\n                      inCoord = sz2 * float(int(float(-inCoord / sz2))) +\n                      inCoord;\n                    }\n                    inCoord = inCoord < -len ? inCoord + sz2 : -inCoord - 1.0;\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz2 = 2.0 * len;\n                    inCoord -= sz2 * float(int(float(inCoord / sz2)));\n                    if (inCoord >= len) {\n                      inCoord = sz2 - inCoord - 1.0;\n                    }\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 3) {\n                if (inCoord < 0.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord += len * (float(int(float(-inCoord / sz))) + 1.0);\n                  }\n                } else if (inCoord > len - 1.0) {\n                  if (len <= 1.0) {\n                    inCoord = 0.0;\n                  } else {\n                    float sz = len - 1.0;\n                    inCoord -= len * float(int(float(inCoord / sz)));\n                  }\n                }\n                return clamp(inCoord, 0.0, len - 1.0);\n              } else if (").concat(s," == 4) {\n                return clamp(outCoord, 0.0, len - 1.0);\n              } else {\n                return outCoord;\n              }\n            }\n\n            float readWithFillValue(int batch, int coordY, int coordX,\n              int channel) {\n              float outputValue;\n              if (0 <= coordY && coordY < ").concat(t," && 0 <= coordX && coordX < ").concat(n,") {\n                  outputValue = getImage(batch, coordY, coordX, channel);\n              } else {\n                outputValue = float(").concat(i,");\n              }\n              return outputValue;\n            }\n\n            void main() {\n              ivec4 coords = getOutputCoords();\n              float outputValue;\n              int batch = coords[0];\n              int x = coords[2];\n              int y = coords[1];\n              int channel = coords[3];\n              float xf = float(x);\n              float yf = float(y);\n              float a1 = getTransforms(batch, 0);\n              float a2 = getTransforms(batch, 1);\n              float a3 = getTransforms(batch, 2);\n              float b1 = getTransforms(batch, 3);\n              float b2 = getTransforms(batch, 4);\n              float b3 = getTransforms(batch, 5);\n              float c1 = getTransforms(batch, 6);\n              float c2 = getTransforms(batch, 7);\n              float projection = c1 * xf + c2 * yf + 1.0;\n              if (projection == 0.0) {\n                outputValue = float(").concat(i,");\n              } else {\n                float inX = (a1 * xf + a2 * yf + a3) / projection;\n                float inY = (b1 * xf + b2 * yf + b3) / projection;\n                float mapX = mapCoord(inX, float(").concat(n,"));\n                float mapY = mapCoord(inY, float(").concat(t,"));\n\n                if (").concat(u," == 1) {\n                  int coordY = int(round(mapY));\n                  int coordX = int(round(mapX));\n                  outputValue = readWithFillValue(batch, coordY, coordX,\n                    channel);\n                } else {\n                  float yFloor = floor(mapY);\n                  float xFloor = floor(mapX);\n                  float yCeil = yFloor + 1.0;\n                  float xCeil = xFloor + 1.0;\n                  float valueYFloor = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yFloor), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yFloor), int(xCeil), channel);\n                  float valueYCeil = (xCeil - mapX) *\n                  readWithFillValue(batch, int(yCeil), int(xFloor), channel) +\n                  (mapX - xFloor) *\n                  readWithFillValue(batch, int(yCeil), int(xCeil), channel);\n                  outputValue = (yCeil - mapY) * valueYFloor +\n                  (mapY - yFloor) * valueYCeil;\n                }\n              }\n              setOutput(outputValue);\n            }\n        ")}));var G5={kernelName:VC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.transforms,o=r.interpolation,s=r.fillMode,u=r.fillValue,c=r.outputShape,h=(0,l.Z)(a.shape,4),f=h[0],d=h[1],p=h[2],v=h[3],m=null!=c?c:[d,p],g=(0,l.Z)(m,2),y=g[0],b=g[1],k=new Z5(d,p,o,s,u,[f,y,b,v]);return n.runWebGLProgram(k,[a,i],"float32")}};var H5={kernelName:wC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;JQ(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=WJ(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var q5={kernelName:IC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,h=0;h<s;h++)h!==i&&(c[l++]=o.shape[h]);var f=[],d=new Array(s).fill(0),p=o.shape.slice();p[i]=1;for(var v=new Array(u),m=0;m<v.length;m++){d[i]=m;var g=G0({inputs:{x:o},backend:n,attrs:{begin:d,size:p}}),y=z$({inputs:{x:g},backend:n,attrs:{shape:c}});v[m]=y,f.push(g)}return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}},K5=p((function e(t,n){f(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var d="";i%r>0&&(d="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(d,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var X5={kernelName:SC,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=TR([c],s),h=a;null!=l&&(h=X$({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(h),c=AR(1,s)[0]);var f=function(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}(h.shape,c,o),d=Zx([h.shape[c]]),p=z$({inputs:{x:h},backend:n,attrs:{shape:[-1,d]}});u.push(p);var v=function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=uw(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=uw(e,n+1);return n}(c,o),h=new K5({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),f=n.compileAndRun(h,[t,a],i);if(u.push(f),f.shape[1]===o)return f;var d=V4({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),p=M5({inputs:{x:d},backend:n,attrs:{reps:[c/l]}});return u.push(d),u.push(p),e(f,r,p,i,o)}(p,"unsortedSegmentSum",i,_E(a.dtype),o),m=z$({inputs:{x:v},backend:n,attrs:{shape:f}}),g=m;if(null!=l){u.push(m);var y=NR(l);g=X$({inputs:{x:g},backend:n,attrs:{perm:y}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},Q5=0,Y5=[J$,e0,n0,a0,s0,l0,h0,f0,y0,b0,V0,w0,S0,E0,N0,_0,D0,L0,M0,P0,U0,q0,K0,X0,e1,r1,o1,x$,c1,g1,S1,A1,R1,_1,D1,O1,M1,z1,U1,H1,q1,K1,Q1,$1,n2,r2,i2,s2,u2,l2,h2,d2,v2,g2,b2,x2,S2,N2,R2,F2,L2,z2,U2,W2,Z2,q2,X2,Y2,k$,J2,p1,e3,n3,a3,S$,o3,u3,c3,h3,d3,v3,g3,b3,x3,I3,C3,T3,N3,A3,D3,F3,O3,L3,M3,z3,W3,Z3,$3,P$,e4,n4,a4,o4,Y0,u4,h4,f4,m4,y4,T$,b4,k4,x4,$0,q3,I4,C4,T4,B$,R4,D4,L4,P4,U4,j4,G4,q4,X4,Y4,$4,t5,r5,i5,s5,c5,H0,J3,h5,f5,d5,p5,v5,m5,g5,y5,V5,x5,S5,C5,T5,N5,A5,R5,Q3,K$,D5,O5,P5,j5,G5,Q$,H5,q5,X5,l4];Q5<Y5.length;Q5++){zC(Y5[Q5])}function J5(){var e=(0,r.useState)(""),t=(0,l.Z)(e,2),n=t[0],a=t[1],i=(0,r.useState)("shirts"),o=(0,l.Z)(i,2),u=o[0],h=o[1],d=(0,r.useState)(null),v=(0,l.Z)(d,2),m=v[0],g=v[1],y=p((function e(t){return f(this,e),function(e){return new zU(e)}(t)}));function b(e){return new Promise((function(t,n){var r=new Image;r.crossOrigin="anonymous",r.src=e,r.onload=function(){t(r)}}))}function k(e){return V.apply(this,arguments)}function V(){return(V=c(s().mark((function e(t){var n,r,a,i,o,u;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("MAKING IMAGE"),e.next=3,b(t);case 3:return n=e.sent,console.log("MADE IMAGE"),e.next=7,UN(n).resizeBilinear([224,224]).div(225);case 7:return r=e.sent,r=tR(r,0),console.log("TENSOR:"),e.t0=console,e.next=13,r.data();case 13:return e.t1=e.sent,e.t0.log.call(e.t0,e.t1),a=m.predict(r),e.next=18,a.data();case 18:i=e.sent,o=["shirt","shoes","pants","shirt","pants","pants","shirt","pants","shirt","shirt","shoes","pants","shirt","shirt","shirt","shirt"],u=i.indexOf(Math.max.apply(Math,(0,H.Z)(i))),console.log(i),alert(o[u]+u),w(o[u]);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(){return(x=c(s().mark((function e(t){return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a(t),k(t);case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){h(e)}function I(){return(I=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,ay.collection(u).add({photo:n});case 2:t=e.sent,console.log(t.id),a("");case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}return y.className="L2",YN(y),(0,r.useEffect)((function(){var e=function(){var e=c(s().mark((function e(){var t;return s().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return alert("WAIT! loading model... will notify when done"),console.log("loading model.... please wait"),e.next=4,yU("tfjs_model/model.json");case 4:t=e.sent,g(t);case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e().then((function(){alert("LOADED MODEL!"),console.log("LOADED!")})).catch((function(e){alert("ERROR LOADING MODEL: ",e),console.error("ERROR LOADING MODEL: ",e)}))}),[g]),(0,Vy.jsxs)("div",{id:"cameraDiv",children:[!n&&(0,Vy.jsx)(Rx(),{onTakePhoto:function(e){!function(e){x.apply(this,arguments)}(e)},idealFacingMode:Ax.FACING_MODES.ENVIRONMENT,isFullscreen:!0,style:{visibility:n?"hidden":"visible"}}),(0,Vy.jsx)("img",{src:n,id:"takenImage",alt:"",style:{width:"100%",height:"90%",visibility:n?"visible":"hidden"}}),n&&(0,Vy.jsx)("button",{onClick:function(){return I.apply(this,arguments)},children:"upload photo"}),n&&(0,Vy.jsx)("button",{onClick:function(){a(null)},children:"retake photo"}),(0,Vy.jsx)("div",{style:{height:"100px"}})]})}var $5=function(e){var t=(0,r.useState)(),n=(0,l.Z)(t,2),a=n[0],i=n[1],o=(0,r.useState)(),u=(0,l.Z)(o,2),h=u[0],f=u[1],d=(0,r.useState)(),p=(0,l.Z)(d,2),v=p[0],m=p[1],g=(0,r.useState)(e.currentShirt),y=(0,l.Z)(g,2),b=y[0],k=y[1],V=(0,r.useState)(e.currentPants),x=(0,l.Z)(V,2),w=x[0],I=x[1],S=(0,r.useState)(e.currentShoes),C=(0,l.Z)(S,2),E=C[0],T=C[1];function N(){return(N=c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e.fitId){t.next=3;break}return t.next=3,ay.collection("fits").doc(e.fitId).delete();case 3:e.setFitStatus(!1),e.setFitStatus2(!1);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function A(){return(A=c(s().mark((function t(){return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null==e.fitId){t.next=3;break}return t.next=3,ay.collection("fits").doc(e.fitId).delete();case 3:return t.next=5,ay.collection("fits").add({shirt:b,pants:w,shoes:E});case 5:e.setFitStatus(!1),e.setFitStatus2(!1);case 7:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return(0,r.useEffect)((function(){var e=[];ay.collection("shirts").onSnapshot((function(t){for(var n=0;n<t.docs.length;n++)t.docs[n].data().photo&&e.push({id:t.docs[n].id,photo:t.docs[n].data().photo});i(e)}));var t=[];ay.collection("pants").onSnapshot((function(e){for(var n=0;n<e.docs.length;n++)e.docs[n].data().photo&&t.push({id:e.docs[n].id,photo:e.docs[n].data().photo});f(t)}));var n=[];ay.collection("shoes").onSnapshot((function(e){for(var t=0;t<e.docs.length;t++)e.docs[t].data().photo&&n.push({id:e.docs[t].id,photo:e.docs[t].data().photo});m(n)}))}),[]),(0,Vy.jsxs)("div",{className:"maincontainer",children:[(0,Vy.jsxs)("div",{className:"scrollmenu",children:[(0,Vy.jsx)("div",{}),a&&a.map((function(e,t){return(0,Vy.jsx)("img",{src:e.photo,alt:"shirt",onClick:function(){return k(e.id)},style:e.id==b?{borderColor:"black",borderSize:"2px",borderStyle:"solid"}:{}},t)})),(0,Vy.jsx)("div",{})]}),(0,Vy.jsxs)("div",{className:"scrollmenu",children:[(0,Vy.jsx)("div",{}),h&&h.map((function(e,t){return(0,Vy.jsx)("img",{src:e.photo,alt:"pant",onClick:function(){return I(e.id)},style:e.id==w?{borderColor:"black",borderSize:"2px",borderStyle:"solid"}:{}},t)})),(0,Vy.jsx)("div",{})]}),(0,Vy.jsxs)("div",{className:"scrollmenu",children:[(0,Vy.jsx)("div",{}),v&&v.map((function(e,t){return(0,Vy.jsx)("img",{src:e.photo,alt:"shoe",onClick:function(){return T(e.id)},style:e.id==E?{borderColor:"black",borderSize:"2px",borderStyle:"solid"}:{}},t)})),(0,Vy.jsx)("div",{})]}),(0,Vy.jsxs)(ik,{textAlign:"center",spacing:2,direction:"row",children:[(0,Vy.jsx)(yk,{onClick:function(){e.setFitStatus(!1),e.setFitStatus2(!1)},variant:"contained",children:"Go Back"}),(0,Vy.jsx)(yk,{onClick:function(){return A.apply(this,arguments)},variant:"contained",children:"Confirm Fit"}),(0,Vy.jsx)(yk,{onClick:function(){return N.apply(this,arguments)},variant:"contained",children:"Delete Fit"})]}),(0,Vy.jsx)("div",{style:{height:"50px"}})]})};function e6(e){return(0,ob.Z)("MuiFab",e)}var t6=(0,Wy.Z)("MuiFab",["root","primary","secondary","extended","circular","focusVisible","disabled","colorInherit","sizeSmall","sizeMedium","sizeLarge","info","error","warning","success"]),n6=["children","className","color","component","disabled","disableFocusRipple","focusVisibleClassName","size","variant"],r6=(0,cy.ZP)(db,{name:"MuiFab",slot:"Root",overridesResolver:function(e,t){var n=e.ownerState;return[t.root,t[n.variant],t["size".concat((0,Lb.Z)(n.size))],"inherit"===n.color&&t.colorInherit,t[(0,Lb.Z)(n.size)],t[n.color]]}})((function(e){var t,n,r,a=e.theme,i=e.ownerState;return(0,oy.Z)({},a.typography.button,(t={minHeight:36,transition:a.transitions.create(["background-color","box-shadow","border-color"],{duration:a.transitions.duration.short}),borderRadius:"50%",padding:0,minWidth:0,width:56,height:56,zIndex:(a.vars||a).zIndex.fab,boxShadow:(a.vars||a).shadows[6],"&:active":{boxShadow:(a.vars||a).shadows[12]},color:a.vars?a.vars.palette.text.primary:null==(n=(r=a.palette).getContrastText)?void 0:n.call(r,a.palette.grey[300]),backgroundColor:(a.vars||a).palette.grey[300],"&:hover":{backgroundColor:(a.vars||a).palette.grey.A100,"@media (hover: none)":{backgroundColor:(a.vars||a).palette.grey[300]},textDecoration:"none"}},(0,h.Z)(t,"&.".concat(t6.focusVisible),{boxShadow:(a.vars||a).shadows[6]}),(0,h.Z)(t,"&.".concat(t6.disabled),{color:(a.vars||a).palette.action.disabled,boxShadow:(a.vars||a).shadows[0],backgroundColor:(a.vars||a).palette.action.disabledBackground}),t),"small"===i.size&&{width:40,height:40},"medium"===i.size&&{width:48,height:48},"extended"===i.variant&&{borderRadius:24,padding:"0 16px",width:"auto",minHeight:"auto",minWidth:48,height:48},"extended"===i.variant&&"small"===i.size&&{width:"auto",padding:"0 8px",borderRadius:17,minWidth:34,height:34},"extended"===i.variant&&"medium"===i.size&&{width:"auto",padding:"0 16px",borderRadius:20,minWidth:40,height:40},"inherit"===i.color&&{color:"inherit"})}),(function(e){var t=e.theme,n=e.ownerState;return(0,oy.Z)({},"inherit"!==n.color&&"default"!==n.color&&null!=(t.vars||t).palette[n.color]&&{color:(t.vars||t).palette[n.color].contrastText,backgroundColor:(t.vars||t).palette[n.color].main,"&:hover":{backgroundColor:(t.vars||t).palette[n.color].dark,"@media (hover: none)":{backgroundColor:(t.vars||t).palette[n.color].main}}})})),a6=r.forwardRef((function(e,t){var n=(0,ly.Z)({props:e,name:"MuiFab"}),r=n.children,a=n.className,i=n.color,o=void 0===i?"default":i,s=n.component,u=void 0===s?"button":s,c=n.disabled,l=void 0!==c&&c,h=n.disableFocusRipple,f=void 0!==h&&h,d=n.focusVisibleClassName,p=n.size,v=void 0===p?"large":p,m=n.variant,g=void 0===m?"circular":m,y=(0,iy.Z)(n,n6),b=(0,oy.Z)({},n,{color:o,component:u,disabled:l,disableFocusRipple:f,size:v,variant:g}),k=function(e){var t=e.color,n=e.variant,r=e.classes,a=e.size,i={root:["root",n,"size".concat((0,Lb.Z)(a)),"inherit"===t?"colorInherit":t]};return(0,uy.Z)(i,e6,r)}(b);return(0,Vy.jsx)(r6,(0,oy.Z)({className:(0,sy.Z)(k.root,a),component:u,disabled:l,focusRipple:!f,focusVisibleClassName:(0,sy.Z)(k.focusVisible,d),ownerState:b,ref:t},y,{children:r}))})),i6=a6,o6=n(2419),s6=n(3385),u6=n(2017);function c6(){var e=(0,r.useState)(),t=(0,l.Z)(e,2),n=t[0],a=t[1],i=(0,r.useState)(0),o=(0,l.Z)(i,2),u=o[0],h=o[1],f=(0,r.useState)(!1),d=(0,l.Z)(f,2),p=d[0],v=d[1],m=(0,r.useState)(!1),g=(0,l.Z)(m,2),y=g[0],b=g[1];return(0,r.useEffect)((function(){var e=[];ay.collection("fits").onSnapshot(function(){var t=c(s().mark((function t(n){var r,i,o,u,c,l,h;return s().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:r=0;case 1:if(!(r<n.docs.length)){t.next=21;break}return t.next=4,ay.collection("shirts").doc(n.docs[r].data().shirt).get();case 4:return i=t.sent,t.next=7,ay.collection("pants").doc(n.docs[r].data().pants).get();case 7:return o=t.sent,t.next=10,ay.collection("shoes").doc(n.docs[r].data().shoes).get();case 10:u=t.sent,c=void 0,l=void 0,h=void 0;try{c=o.data().photo}catch(s){c="./noPhotoFound.png"}try{l=u.data().photo}catch(s){l="./noPhotoFound.png"}try{h=i.data().photo}catch(s){h="./noPhotoFound.png"}e.push({shirt:h,shirtId:n.docs[r].data().shirt,pants:c,pantsId:n.docs[r].data().pants,shoes:l,shoesId:n.docs[r].data().shoes,fitId:n.docs[r].id});case 18:r++,t.next=1;break;case 21:a(e);case 22:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}())}),[p,y]),(0,Vy.jsxs)("div",{children:[!(p||y)&&null!=n&&n.length>0&&(0,Vy.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,Vy.jsx)(i6,{color:"primary",style:{width:"100px",height:"50px",marginLeft:"10px"},onClick:function(){h(u-1<0?u:u-1)},children:(0,Vy.jsx)(u6.Z,{})}),(0,Vy.jsx)("div",{style:{display:"flex",justifyContent:"center"},onClick:function(){console.log("i was clicked"),b(!0),v(!0)},children:(0,Vy.jsxs)("div",{style:{width:"100%"},children:[(0,Vy.jsx)("div",{children:(0,Vy.jsx)("img",{id:"fitPhoto",src:n[u].shirt})}),(0,Vy.jsx)("div",{children:(0,Vy.jsx)("img",{id:"fitPhoto",src:n[u].pants})}),(0,Vy.jsx)("div",{children:(0,Vy.jsx)("img",{id:"fitPhoto",src:n[u].shoes})})]})}),(0,Vy.jsx)(i6,{color:"primary",style:{width:"100px",height:"50px",marginRight:"10px"},onClick:function(){h(u+1>=n.length?u:u+1)},children:(0,Vy.jsx)(s6.Z,{})})]}),(p||y)&&(0,Vy.jsx)($5,{setFitStatus:v,setFitStatus2:b,currentShirt:y&&null!=n&&n.length>0?n[u].shirtId:null,currentPants:y&&null!=n&&n.length>0?n[u].pantsId:null,currentShoes:y&&null!=n&&n.length>0?n[u].shoesId:null,fitId:y&&null!=n&&n.length>0?n[u].fitId:null}),!(p||y)&&(0,Vy.jsx)(i6,{color:"primary",onClick:function(){return v(!0)},children:(0,Vy.jsx)(o6.Z,{})}),(0,Vy.jsx)("div",{style:{height:"200px"}})]})}var l6=function(e,t){var n,r;return lV({basename:null==t?void 0:t.basename,history:(r={window:null==t?void 0:t.window},void 0===r&&(r={}),Uk((function(e,t){var n,r,a=e.location;return Pk("",{pathname:a.pathname,search:a.search,hash:a.hash},(null==(n=t.state)?void 0:n.usr)||null,(null==(r=t.state)?void 0:r.key)||"default")}),(function(e,t){return"string"===typeof t?t:zk(t)}),null,r)),hydrationData:(null==t?void 0:t.hydrationData)||(null==(n=window)?void 0:n.__staticRouterHydrationData),routes:wx(e)}).initialize()}([{path:"/",element:(0,Vy.jsx)(Nx,{}),children:[{path:"wardrobe",element:(0,Vy.jsx)(bk,{})},{path:"camera",element:(0,Vy.jsx)(J5,{})},{path:"fits",element:(0,Vy.jsx)(c6,{})}]}]);i.createRoot(document.getElementById("root")).render((0,Vy.jsx)(r.StrictMode,{children:(0,Vy.jsx)(vx,{router:l6})}))}()}();
//# sourceMappingURL=main.524ddf0e.js.map